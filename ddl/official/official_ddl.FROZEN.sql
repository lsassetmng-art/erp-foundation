--
--
-- PostgreSQL database dump
-- PostgreSQL database dump
--
--


\restrict DkrQVuibXIsZSjxFtU8nJK2M1MThrhXcViCROqfXBMgLLYBbM9XuNsewHAFmbQG
\restrict DkrQVuibXIsZSjxFtU8nJK2M1MThrhXcViCROqfXBMgLLYBbM9XuNsewHAFmbQG


-- Dumped from database version 17.6
-- Dumped from database version 17.6
-- Dumped by pg_dump version 18.1
-- Dumped by pg_dump version 18.1


SET statement_timeout = 0;
SET statement_timeout = 0;
SET lock_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET check_function_bodies = false;
SET xmloption = content;
SET xmloption = content;
SET client_min_messages = warning;
SET client_min_messages = warning;
SET row_security = off;
SET row_security = off;


--
--
-- Name: accounting; Type: SCHEMA; Schema: -; Owner: -
-- Name: accounting; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA accounting;
CREATE SCHEMA accounting;




--
--
-- Name: analytics; Type: SCHEMA; Schema: -; Owner: -
-- Name: analytics; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA analytics;
CREATE SCHEMA analytics;




--
--
-- Name: approval; Type: SCHEMA; Schema: -; Owner: -
-- Name: approval; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA approval;
CREATE SCHEMA approval;




--
--
-- Name: audit; Type: SCHEMA; Schema: -; Owner: -
-- Name: audit; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA audit;
CREATE SCHEMA audit;




--
--
-- Name: auth; Type: SCHEMA; Schema: -; Owner: -
-- Name: auth; Type: SCHEMA; Schema: -; Owner: -
--
--






--
--
-- Name: billing; Type: SCHEMA; Schema: -; Owner: -
-- Name: billing; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA billing;
CREATE SCHEMA billing;




--
--
-- Name: ci; Type: SCHEMA; Schema: -; Owner: -
-- Name: ci; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA ci;
CREATE SCHEMA ci;




--
--
-- Name: compliance; Type: SCHEMA; Schema: -; Owner: -
-- Name: compliance; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA compliance;
CREATE SCHEMA compliance;




--
--
-- Name: core; Type: SCHEMA; Schema: -; Owner: -
-- Name: core; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA core;
CREATE SCHEMA core;




--
--
-- Name: pg_cron; Type: EXTENSION; Schema: -; Owner: -
-- Name: pg_cron; Type: EXTENSION; Schema: -; Owner: -
--
--


CREATE EXTENSION IF NOT EXISTS pg_cron WITH SCHEMA pg_catalog;
CREATE EXTENSION IF NOT EXISTS pg_cron WITH SCHEMA pg_catalog;




--
--
-- Name: EXTENSION pg_cron; Type: COMMENT; Schema: -; Owner: -
-- Name: EXTENSION pg_cron; Type: COMMENT; Schema: -; Owner: -
--
--


COMMENT ON EXTENSION pg_cron IS 'Job scheduler for PostgreSQL';
COMMENT ON EXTENSION pg_cron IS 'Job scheduler for PostgreSQL';




--
--
-- Name: devops; Type: SCHEMA; Schema: -; Owner: -
-- Name: devops; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA devops;
CREATE SCHEMA devops;




--
--
-- Name: extensions; Type: SCHEMA; Schema: -; Owner: -
-- Name: extensions; Type: SCHEMA; Schema: -; Owner: -
--
--






--
--
-- Name: finance; Type: SCHEMA; Schema: -; Owner: -
-- Name: finance; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA finance;
CREATE SCHEMA finance;




--
--
-- Name: governance; Type: SCHEMA; Schema: -; Owner: -
-- Name: governance; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA governance;
CREATE SCHEMA governance;




--
--
-- Name: graphql; Type: SCHEMA; Schema: -; Owner: -
-- Name: graphql; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA graphql;
CREATE SCHEMA graphql;




--
--
-- Name: graphql_public; Type: SCHEMA; Schema: -; Owner: -
-- Name: graphql_public; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA graphql_public;
CREATE SCHEMA graphql_public;




--
--
-- Name: hr; Type: SCHEMA; Schema: -; Owner: -
-- Name: hr; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA hr;
CREATE SCHEMA hr;




--
--
-- Name: integration; Type: SCHEMA; Schema: -; Owner: -
-- Name: integration; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA integration;
CREATE SCHEMA integration;




--
--
-- Name: inventory; Type: SCHEMA; Schema: -; Owner: -
-- Name: inventory; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA inventory;
CREATE SCHEMA inventory;




--
--
-- Name: manufacturing; Type: SCHEMA; Schema: -; Owner: -
-- Name: manufacturing; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA manufacturing;
CREATE SCHEMA manufacturing;




--
--
-- Name: media; Type: SCHEMA; Schema: -; Owner: -
-- Name: media; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA media;
CREATE SCHEMA media;




--
--
-- Name: pg_net; Type: EXTENSION; Schema: -; Owner: -
-- Name: pg_net; Type: EXTENSION; Schema: -; Owner: -
--
--


CREATE EXTENSION IF NOT EXISTS pg_net WITH SCHEMA public;
CREATE EXTENSION IF NOT EXISTS pg_net WITH SCHEMA public;




--
--
-- Name: EXTENSION pg_net; Type: COMMENT; Schema: -; Owner: -
-- Name: EXTENSION pg_net; Type: COMMENT; Schema: -; Owner: -
--
--


COMMENT ON EXTENSION pg_net IS 'Async HTTP';
COMMENT ON EXTENSION pg_net IS 'Async HTTP';




--
--
-- Name: notify; Type: SCHEMA; Schema: -; Owner: -
-- Name: notify; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA notify;
CREATE SCHEMA notify;




--
--
-- Name: ops; Type: SCHEMA; Schema: -; Owner: -
-- Name: ops; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA ops;
CREATE SCHEMA ops;




--
--
-- Name: pgbouncer; Type: SCHEMA; Schema: -; Owner: -
-- Name: pgbouncer; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA pgbouncer;
CREATE SCHEMA pgbouncer;




--
--
-- Name: purchase; Type: SCHEMA; Schema: -; Owner: -
-- Name: purchase; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA purchase;
CREATE SCHEMA purchase;




--
--
-- Name: realtime; Type: SCHEMA; Schema: -; Owner: -
-- Name: realtime; Type: SCHEMA; Schema: -; Owner: -
--
--






--
--
-- Name: sales; Type: SCHEMA; Schema: -; Owner: -
-- Name: sales; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA sales;
CREATE SCHEMA sales;




--
--
-- Name: storage; Type: SCHEMA; Schema: -; Owner: -
-- Name: storage; Type: SCHEMA; Schema: -; Owner: -
--
--






--
--
-- Name: system; Type: SCHEMA; Schema: -; Owner: -
-- Name: system; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA system;
CREATE SCHEMA system;




--
--
-- Name: tenant; Type: SCHEMA; Schema: -; Owner: -
-- Name: tenant; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA tenant;
CREATE SCHEMA tenant;




--
--
-- Name: vault; Type: SCHEMA; Schema: -; Owner: -
-- Name: vault; Type: SCHEMA; Schema: -; Owner: -
--
--


CREATE SCHEMA vault;
CREATE SCHEMA vault;




--
--
-- Name: pg_graphql; Type: EXTENSION; Schema: -; Owner: -
-- Name: pg_graphql; Type: EXTENSION; Schema: -; Owner: -
--
--


CREATE EXTENSION IF NOT EXISTS pg_graphql WITH SCHEMA graphql;
CREATE EXTENSION IF NOT EXISTS pg_graphql WITH SCHEMA graphql;




--
--
-- Name: EXTENSION pg_graphql; Type: COMMENT; Schema: -; Owner: -
-- Name: EXTENSION pg_graphql; Type: COMMENT; Schema: -; Owner: -
--
--


COMMENT ON EXTENSION pg_graphql IS 'pg_graphql: GraphQL support';
COMMENT ON EXTENSION pg_graphql IS 'pg_graphql: GraphQL support';




--
--
-- Name: pg_stat_statements; Type: EXTENSION; Schema: -; Owner: -
-- Name: pg_stat_statements; Type: EXTENSION; Schema: -; Owner: -
--
--






--
--
-- Name: EXTENSION pg_stat_statements; Type: COMMENT; Schema: -; Owner: -
-- Name: EXTENSION pg_stat_statements; Type: COMMENT; Schema: -; Owner: -
--
--


COMMENT ON EXTENSION pg_stat_statements IS 'track planning and execution statistics of all SQL statements executed';
COMMENT ON EXTENSION pg_stat_statements IS 'track planning and execution statistics of all SQL statements executed';




--
--
-- Name: pgcrypto; Type: EXTENSION; Schema: -; Owner: -
-- Name: pgcrypto; Type: EXTENSION; Schema: -; Owner: -
--
--






--
--
-- Name: EXTENSION pgcrypto; Type: COMMENT; Schema: -; Owner: -
-- Name: EXTENSION pgcrypto; Type: COMMENT; Schema: -; Owner: -
--
--


COMMENT ON EXTENSION pgcrypto IS 'cryptographic functions';
COMMENT ON EXTENSION pgcrypto IS 'cryptographic functions';




--
--
-- Name: supabase_vault; Type: EXTENSION; Schema: -; Owner: -
-- Name: supabase_vault; Type: EXTENSION; Schema: -; Owner: -
--
--


CREATE EXTENSION IF NOT EXISTS supabase_vault WITH SCHEMA vault;
CREATE EXTENSION IF NOT EXISTS supabase_vault WITH SCHEMA vault;




--
--
-- Name: EXTENSION supabase_vault; Type: COMMENT; Schema: -; Owner: -
-- Name: EXTENSION supabase_vault; Type: COMMENT; Schema: -; Owner: -
--
--


COMMENT ON EXTENSION supabase_vault IS 'Supabase Vault Extension';
COMMENT ON EXTENSION supabase_vault IS 'Supabase Vault Extension';




--
--
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
--
--






--
--
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: -
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: -
--
--


COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';
COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';




--
--
-- Name: aal_level; Type: TYPE; Schema: auth; Owner: -
-- Name: aal_level; Type: TYPE; Schema: auth; Owner: -
--
--


    'aal1',
    'aal1',
    'aal2',
    'aal2',
    'aal3'
    'aal3'
);
);




--
--
-- Name: code_challenge_method; Type: TYPE; Schema: auth; Owner: -
-- Name: code_challenge_method; Type: TYPE; Schema: auth; Owner: -
--
--


    's256',
    's256',
    'plain'
    'plain'
);
);




--
--
-- Name: factor_status; Type: TYPE; Schema: auth; Owner: -
-- Name: factor_status; Type: TYPE; Schema: auth; Owner: -
--
--


    'unverified',
    'unverified',
    'verified'
    'verified'
);
);




--
--
-- Name: factor_type; Type: TYPE; Schema: auth; Owner: -
-- Name: factor_type; Type: TYPE; Schema: auth; Owner: -
--
--


    'totp',
    'totp',
    'webauthn',
    'webauthn',
    'phone'
    'phone'
);
);




--
--
-- Name: oauth_authorization_status; Type: TYPE; Schema: auth; Owner: -
-- Name: oauth_authorization_status; Type: TYPE; Schema: auth; Owner: -
--
--


    'pending',
    'pending',
    'approved',
    'approved',
    'denied',
    'denied',
    'expired'
    'expired'
);
);




--
--
-- Name: oauth_client_type; Type: TYPE; Schema: auth; Owner: -
-- Name: oauth_client_type; Type: TYPE; Schema: auth; Owner: -
--
--


    'public',
    'public',
    'confidential'
    'confidential'
);
);




--
--
-- Name: oauth_registration_type; Type: TYPE; Schema: auth; Owner: -
-- Name: oauth_registration_type; Type: TYPE; Schema: auth; Owner: -
--
--


    'dynamic',
    'dynamic',
    'manual'
    'manual'
);
);




--
--
-- Name: oauth_response_type; Type: TYPE; Schema: auth; Owner: -
-- Name: oauth_response_type; Type: TYPE; Schema: auth; Owner: -
--
--


    'code'
    'code'
);
);




--
--
-- Name: one_time_token_type; Type: TYPE; Schema: auth; Owner: -
-- Name: one_time_token_type; Type: TYPE; Schema: auth; Owner: -
--
--


    'confirmation_token',
    'confirmation_token',
    'reauthentication_token',
    'reauthentication_token',
    'recovery_token',
    'recovery_token',
    'email_change_token_new',
    'email_change_token_new',
    'email_change_token_current',
    'email_change_token_current',
    'phone_change_token'
    'phone_change_token'
);
);




--
--
-- Name: action; Type: TYPE; Schema: realtime; Owner: -
-- Name: action; Type: TYPE; Schema: realtime; Owner: -
--
--


    'INSERT',
    'INSERT',
    'UPDATE',
    'UPDATE',
    'DELETE',
    'DELETE',
    'TRUNCATE',
    'TRUNCATE',
    'ERROR'
    'ERROR'
);
);




--
--
-- Name: equality_op; Type: TYPE; Schema: realtime; Owner: -
-- Name: equality_op; Type: TYPE; Schema: realtime; Owner: -
--
--


    'eq',
    'eq',
    'neq',
    'neq',
    'lt',
    'lt',
    'lte',
    'lte',
    'gt',
    'gt',
    'gte',
    'gte',
    'in'
    'in'
);
);




--
--
-- Name: user_defined_filter; Type: TYPE; Schema: realtime; Owner: -
-- Name: user_defined_filter; Type: TYPE; Schema: realtime; Owner: -
--
--


	column_name text,
	column_name text,
	op realtime.equality_op,
	op realtime.equality_op,
	value text
	value text
);
);




--
--
-- Name: wal_column; Type: TYPE; Schema: realtime; Owner: -
-- Name: wal_column; Type: TYPE; Schema: realtime; Owner: -
--
--


	name text,
	name text,
	type_name text,
	type_name text,
	type_oid oid,
	type_oid oid,
	value jsonb,
	value jsonb,
	is_pkey boolean,
	is_pkey boolean,
	is_selectable boolean
	is_selectable boolean
);
);




--
--
-- Name: wal_rls; Type: TYPE; Schema: realtime; Owner: -
-- Name: wal_rls; Type: TYPE; Schema: realtime; Owner: -
--
--


	wal jsonb,
	wal jsonb,
	is_rls_enabled boolean,
	is_rls_enabled boolean,
	subscription_ids uuid[],
	subscription_ids uuid[],
	errors text[]
	errors text[]
);
);




--
--
-- Name: buckettype; Type: TYPE; Schema: storage; Owner: -
-- Name: buckettype; Type: TYPE; Schema: storage; Owner: -
--
--


    'STANDARD',
    'STANDARD',
    'ANALYTICS',
    'ANALYTICS',
    'VECTOR'
    'VECTOR'
);
);




--
--
-- Name: enqueue_ai_event(uuid, text, bigint, text, text, jsonb); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: enqueue_ai_event(uuid, text, bigint, text, text, jsonb); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.enqueue_ai_event(p_company_id uuid, p_source_table text, p_source_id bigint, p_event_type text, p_severity text, p_payload jsonb) RETURNS void
CREATE FUNCTION analytics.enqueue_ai_event(p_company_id uuid, p_source_table text, p_source_id bigint, p_event_type text, p_severity text, p_payload jsonb) RETURNS void
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  insert into analytics.ai_event
  insert into analytics.ai_event
    (company_id, source_table, source_id, event_type, severity, payload)
    (company_id, source_table, source_id, event_type, severity, payload)
  values
  values
    (p_company_id, p_source_table, p_source_id, p_event_type, p_severity,
    (p_company_id, p_source_table, p_source_id, p_event_type, p_severity,
     coalesce(p_payload,'{}'::jsonb));
     coalesce(p_payload,'{}'::jsonb));
$$;
$$;




--
--
-- Name: enqueue_ai_insights(); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: enqueue_ai_insights(); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.enqueue_ai_insights() RETURNS void
CREATE FUNCTION analytics.enqueue_ai_insights() RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  INSERT INTO analytics.ai_insight_job
  INSERT INTO analytics.ai_insight_job
    (company_id, insight_type, target_key, context)
    (company_id, insight_type, target_key, context)
  SELECT
  SELECT
    company_id,
    company_id,
    'approval_opt',
    'approval_opt',
    schema_name,
    schema_name,
    jsonb_build_object('approved_count', approved_count)
    jsonb_build_object('approved_count', approved_count)
  FROM analytics.v_ai_approval_opt_candidate;
  FROM analytics.v_ai_approval_opt_candidate;


  INSERT INTO analytics.ai_insight_job
  INSERT INTO analytics.ai_insight_job
    (company_id, insight_type, target_key, context)
    (company_id, insight_type, target_key, context)
  SELECT
  SELECT
    NULL,
    NULL,
    'sla_risk',
    'sla_risk',
    domain,
    domain,
    jsonb_build_object('p90_seconds', p90_seconds)
    jsonb_build_object('p90_seconds', p90_seconds)
  FROM analytics.v_ai_sla_risk;
  FROM analytics.v_ai_sla_risk;


  INSERT INTO analytics.ai_insight_job
  INSERT INTO analytics.ai_insight_job
    (company_id, insight_type, target_key, context)
    (company_id, insight_type, target_key, context)
  SELECT
  SELECT
    NULL,
    NULL,
    'rule_suggest',
    'rule_suggest',
    domain,
    domain,
    jsonb_build_object('reject_rate', reject_rate)
    jsonb_build_object('reject_rate', reject_rate)
  FROM analytics.v_ai_rule_suggest;
  FROM analytics.v_ai_rule_suggest;
END;
END;
$$;
$$;




--
--
-- Name: eval_ai_judgement_db(); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: eval_ai_judgement_db(); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.eval_ai_judgement_db() RETURNS void
CREATE FUNCTION analytics.eval_ai_judgement_db() RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  insert into analytics.audit_alert_ai_judgement
  insert into analytics.audit_alert_ai_judgement
    (alert_event_id, is_anomaly, confidence, judgement_reason, decided_by)
    (alert_event_id, is_anomaly, confidence, judgement_reason, decided_by)
  select
  select
    e.alert_event_id,
    e.alert_event_id,
    (e.severity >= 4 or (e.severity = 3 and e.matched_count >= 5)),
    (e.severity >= 4 or (e.severity = 3 and e.matched_count >= 5)),
    case
    case
      when e.severity >= 4 then 0.90
      when e.severity >= 4 then 0.90
      when e.severity = 3 then 0.70
      when e.severity = 3 then 0.70
      else 0.40
      else 0.40
    end,
    end,
    format(
    format(
      'DB-AI判定: severity=%s, matched_count=%s',
      'DB-AI判定: severity=%s, matched_count=%s',
      e.severity,
      e.severity,
      e.matched_count
      e.matched_count
    ),
    ),
    'rule'
    'rule'
  from analytics.audit_alert_event e
  from analytics.audit_alert_event e
  left join analytics.audit_alert_ai_judgement j
  left join analytics.audit_alert_ai_judgement j
    on j.alert_event_id = e.alert_event_id
    on j.alert_event_id = e.alert_event_id
  where j.alert_event_id is null;
  where j.alert_event_id is null;
end;
end;
$$;
$$;




--
--
-- Name: eval_audit_alert_rules(timestamp with time zone); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: eval_audit_alert_rules(timestamp with time zone); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.eval_audit_alert_rules(p_now timestamp with time zone DEFAULT now()) RETURNS integer
CREATE FUNCTION analytics.eval_audit_alert_rules(p_now timestamp with time zone DEFAULT now()) RETURNS integer
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  r record;
  r record;
  window_start timestamptz;
  window_start timestamptz;
  hit_count integer;
  hit_count integer;
  sev integer;
  sev integer;
  inserted integer := 0;
  inserted integer := 0;
BEGIN
BEGIN
  FOR r IN
  FOR r IN
    SELECT * FROM analytics.audit_alert_rule WHERE is_enabled
    SELECT * FROM analytics.audit_alert_rule WHERE is_enabled
  LOOP
  LOOP
    window_start := p_now - make_interval(secs => r.window_seconds);
    window_start := p_now - make_interval(secs => r.window_seconds);


    SELECT count(*) INTO hit_count
    SELECT count(*) INTO hit_count
    FROM audit.audit_trail_db t
    FROM audit.audit_trail_db t
    WHERE t.company_id = r.company_id
    WHERE t.company_id = r.company_id
      AND t.occurred_at > window_start
      AND t.occurred_at > window_start
      AND t.occurred_at <= p_now
      AND t.occurred_at <= p_now
      AND (r.table_name_like IS NULL OR t.table_name ILIKE r.table_name_like)
      AND (r.table_name_like IS NULL OR t.table_name ILIKE r.table_name_like)
      AND (r.actions IS NULL OR t.action = ANY(r.actions));
      AND (r.actions IS NULL OR t.action = ANY(r.actions));


    IF hit_count >= r.threshold_count THEN
    IF hit_count >= r.threshold_count THEN
      sev := LEAST(
      sev := LEAST(
        r.severity_cap,
        r.severity_cap,
        r.severity_base + (hit_count / r.threshold_count)
        r.severity_base + (hit_count / r.threshold_count)
      );
      );


      INSERT INTO analytics.audit_alert_event
      INSERT INTO analytics.audit_alert_event
        (rule_id, company_id, window_start, window_end, matched_count, severity)
        (rule_id, company_id, window_start, window_end, matched_count, severity)
      VALUES
      VALUES
        (r.rule_id, r.company_id, window_start, p_now, hit_count, sev)
        (r.rule_id, r.company_id, window_start, p_now, hit_count, sev)
      ON CONFLICT DO NOTHING;
      ON CONFLICT DO NOTHING;


      inserted := inserted + 1;
      inserted := inserted + 1;
    END IF;
    END IF;
  END LOOP;
  END LOOP;


  RETURN inserted;
  RETURN inserted;
END;
END;
$$;
$$;




--
--
-- Name: fn_detect_audit_anomalies(integer); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: fn_detect_audit_anomalies(integer); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.fn_detect_audit_anomalies(p_lookback_minutes integer DEFAULT 30) RETURNS void
CREATE FUNCTION analytics.fn_detect_audit_anomalies(p_lookback_minutes integer DEFAULT 30) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  r record;
  r record;
  v_window_end timestamptz;
  v_window_end timestamptz;
  v_from timestamptz;
  v_from timestamptz;
  v_cnt int;
  v_cnt int;
  v_samples text[];
  v_samples text[];
BEGIN
BEGIN
  v_window_end := date_trunc('minute', now());
  v_window_end := date_trunc('minute', now());


  FOR r IN
  FOR r IN
    SELECT *
    SELECT *
    FROM analytics.audit_alert_rule
    FROM analytics.audit_alert_rule
    WHERE is_active
    WHERE is_active
  LOOP
  LOOP
    v_from := v_window_end - make_interval(secs => r.window_seconds);
    v_from := v_window_end - make_interval(secs => r.window_seconds);


    SELECT count(*),
    SELECT count(*),
           array_agg(DISTINCT at.entity_type) FILTER (WHERE at.entity_type IS NOT NULL)
           array_agg(DISTINCT at.entity_type) FILTER (WHERE at.entity_type IS NOT NULL)
      INTO v_cnt, v_samples
      INTO v_cnt, v_samples
    FROM analytics.v_audit_with_impact at
    FROM analytics.v_audit_with_impact at
    WHERE at.performed_at >= v_from
    WHERE at.performed_at >= v_from
      AND at.performed_at <  v_window_end
      AND at.performed_at <  v_window_end
      AND (r.company_id IS NULL OR at.company_id = r.company_id)
      AND (r.company_id IS NULL OR at.company_id = r.company_id)
      AND at.entity_type LIKE r.entity_type_like
      AND at.entity_type LIKE r.entity_type_like
      AND at.action = ANY (r.actions)
      AND at.action = ANY (r.actions)
      AND at.impact_score >= r.min_impact_score;
      AND at.impact_score >= r.min_impact_score;


    IF v_cnt >= r.threshold THEN
    IF v_cnt >= r.threshold THEN
      INSERT INTO analytics.audit_alert_event(
      INSERT INTO analytics.audit_alert_event(
        rule_id, company_id, entity_type_like, actions,
        rule_id, company_id, entity_type_like, actions,
        window_seconds, threshold, min_impact_score, severity,
        window_seconds, threshold, min_impact_score, severity,
        window_end, matched_count, sample_entity_types
        window_end, matched_count, sample_entity_types
      )
      )
      VALUES (
      VALUES (
        r.rule_id, r.company_id, r.entity_type_like, r.actions,
        r.rule_id, r.company_id, r.entity_type_like, r.actions,
        r.window_seconds, r.threshold, r.min_impact_score, r.severity,
        r.window_seconds, r.threshold, r.min_impact_score, r.severity,
        v_window_end, v_cnt, COALESCE(v_samples, ARRAY[]::text[])
        v_window_end, v_cnt, COALESCE(v_samples, ARRAY[]::text[])
      )
      )
      ON CONFLICT (rule_id, window_end) DO NOTHING;
      ON CONFLICT (rule_id, window_end) DO NOTHING;
    END IF;
    END IF;
  END LOOP;
  END LOOP;
END;
END;
$$;
$$;




--
--
-- Name: run_ai_job_cycle(); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: run_ai_job_cycle(); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.run_ai_job_cycle() RETURNS void
CREATE FUNCTION analytics.run_ai_job_cycle() RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  -- ① AI対象を queued に積む（severity >= 3）
  -- ① AI対象を queued に積む（severity >= 3）
  insert into analytics.audit_ai_job (alert_event_id)
  insert into analytics.audit_ai_job (alert_event_id)
  select e.alert_event_id
  select e.alert_event_id
  from analytics.audit_alert_event e
  from analytics.audit_alert_event e
  left join analytics.audit_ai_job j
  left join analytics.audit_ai_job j
    on j.alert_event_id = e.alert_event_id
    on j.alert_event_id = e.alert_event_id
  where j.alert_event_id is null
  where j.alert_event_id is null
    and e.severity >= 3;
    and e.severity >= 3;


  -- ② queued -> processing（最大10件）
  -- ② queued -> processing（最大10件）
  update analytics.audit_ai_job
  update analytics.audit_ai_job
  set
  set
    status = 'processing',
    status = 'processing',
    started_at = now()
    started_at = now()
  where job_id in (
  where job_id in (
    select job_id
    select job_id
    from analytics.audit_ai_job
    from analytics.audit_ai_job
    where status = 'queued'
    where status = 'queued'
    order by created_at
    order by created_at
    limit 10
    limit 10
  );
  );


  -- ③ processing -> done（judgement 作成済み）
  -- ③ processing -> done（judgement 作成済み）
  update analytics.audit_ai_job j
  update analytics.audit_ai_job j
  set
  set
    status = 'done',
    status = 'done',
    finished_at = now()
    finished_at = now()
  from analytics.audit_alert_ai_judgement g
  from analytics.audit_alert_ai_judgement g
  where g.alert_event_id = j.alert_event_id
  where g.alert_event_id = j.alert_event_id
    and j.status = 'processing';
    and j.status = 'processing';


  -- ④ failed -> queued（再実行）
  -- ④ failed -> queued（再実行）
  update analytics.audit_ai_job
  update analytics.audit_ai_job
  set
  set
    status = 'queued',
    status = 'queued',
    retry_count = retry_count + 1,
    retry_count = retry_count + 1,
    last_error = null,
    last_error = null,
    started_at = null,
    started_at = null,
    finished_at = null
    finished_at = null
  where status = 'failed'
  where status = 'failed'
    and retry_count < 3
    and retry_count < 3
    and started_at < now() - interval '10 minutes';
    and started_at < now() - interval '10 minutes';
end;
end;
$$;
$$;




--
--
-- Name: sweep_ai_event(uuid, integer); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: sweep_ai_event(uuid, integer); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.sweep_ai_event(p_company_id uuid, p_keep_days integer DEFAULT 30) RETURNS integer
CREATE FUNCTION analytics.sweep_ai_event(p_company_id uuid, p_keep_days integer DEFAULT 30) RETURNS integer
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_deleted int;
  v_deleted int;
begin
begin
  if p_company_id is null then
  if p_company_id is null then
    raise exception 'company_id is required';
    raise exception 'company_id is required';
  end if;
  end if;


  delete from analytics.ai_event
  delete from analytics.ai_event
   where company_id = p_company_id
   where company_id = p_company_id
     and severity in ('info','warn')
     and severity in ('info','warn')
     and created_at < now() - make_interval(days => p_keep_days);
     and created_at < now() - make_interval(days => p_keep_days);


  get diagnostics v_deleted = row_count;
  get diagnostics v_deleted = row_count;
  return v_deleted;
  return v_deleted;
end;
end;
$$;
$$;




--
--
-- Name: FUNCTION sweep_ai_event(p_company_id uuid, p_keep_days integer); Type: COMMENT; Schema: analytics; Owner: -
-- Name: FUNCTION sweep_ai_event(p_company_id uuid, p_keep_days integer); Type: COMMENT; Schema: analytics; Owner: -
--
--


COMMENT ON FUNCTION analytics.sweep_ai_event(p_company_id uuid, p_keep_days integer) IS 'Phase9: cleanup old ai_event (info/warn) by company_id';
COMMENT ON FUNCTION analytics.sweep_ai_event(p_company_id uuid, p_keep_days integer) IS 'Phase9: cleanup old ai_event (info/warn) by company_id';




--
--
-- Name: sweep_ai_event_phase9(); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: sweep_ai_event_phase9(); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.sweep_ai_event_phase9() RETURNS integer
CREATE FUNCTION analytics.sweep_ai_event_phase9() RETURNS integer
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_count integer;
  v_count integer;
begin
begin
  update analytics.ai_event
  update analytics.ai_event
     set status   = 'swept',
     set status   = 'swept',
         swept_at = now()
         swept_at = now()
   where status = 'pending'
   where status = 'pending'
     and is_active = true;
     and is_active = true;


  get diagnostics v_count = row_count;
  get diagnostics v_count = row_count;
  return v_count;
  return v_count;
end;
end;
$$;
$$;




--
--
-- Name: trg_ai_job_apply_master(); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: trg_ai_job_apply_master(); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.trg_ai_job_apply_master() RETURNS trigger
CREATE FUNCTION analytics.trg_ai_job_apply_master() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  m analytics.ai_job_type_master%rowtype;
  m analytics.ai_job_type_master%rowtype;
begin
begin
  select * into m
  select * into m
    from analytics.ai_job_type_master
    from analytics.ai_job_type_master
   where job_type = NEW.job_type;
   where job_type = NEW.job_type;


  -- 未登録job_typeはそのまま（Runner側でunknown扱いにできる）
  -- 未登録job_typeはそのまま（Runner側でunknown扱いにできる）
  if not found then
  if not found then
    return NEW;
    return NEW;
  end if;
  end if;


  -- 無効job_typeは pending に残す（実行させない）
  -- 無効job_typeは pending に残す（実行させない）
  if m.is_enabled = false then
  if m.is_enabled = false then
    NEW.requires_approval := true;
    NEW.requires_approval := true;
    return NEW;
    return NEW;
  end if;
  end if;


  -- マスタが approval 推奨なら、requires_approval=false を true に引き上げる
  -- マスタが approval 推奨なら、requires_approval=false を true に引き上げる
  if m.default_requires_approval and NEW.requires_approval = false then
  if m.default_requires_approval and NEW.requires_approval = false then
    NEW.requires_approval := true;
    NEW.requires_approval := true;
  end if;
  end if;


  return NEW;
  return NEW;
end;
end;
$$;
$$;




--
--
-- Name: trg_audit_alert_to_ai_event(); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: trg_audit_alert_to_ai_event(); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.trg_audit_alert_to_ai_event() RETURNS trigger
CREATE FUNCTION analytics.trg_audit_alert_to_ai_event() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  perform analytics.enqueue_ai_event(
  perform analytics.enqueue_ai_event(
    NEW.company_id,
    NEW.company_id,
    'audit_alert_event',
    'audit_alert_event',
    NEW.alert_event_id,
    NEW.alert_event_id,
    'audit_alert',
    'audit_alert',
    NEW.severity,
    NEW.severity,
    to_jsonb(NEW)
    to_jsonb(NEW)
  );
  );
  return NEW;
  return NEW;
end;
end;
$$;
$$;




--
--
-- Name: trg_enqueue_alert_notifications(); Type: FUNCTION; Schema: analytics; Owner: -
-- Name: trg_enqueue_alert_notifications(); Type: FUNCTION; Schema: analytics; Owner: -
--
--


CREATE FUNCTION analytics.trg_enqueue_alert_notifications() RETURNS trigger
CREATE FUNCTION analytics.trg_enqueue_alert_notifications() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
BEGIN
BEGIN
  INSERT INTO analytics.audit_alert_notification(alert_event_id, channel_type, webhook_ref)
  INSERT INTO analytics.audit_alert_notification(alert_event_id, channel_type, webhook_ref)
  VALUES (NEW.alert_event_id, 'SLACK', 'SLACK_WEBHOOK_URL')
  VALUES (NEW.alert_event_id, 'SLACK', 'SLACK_WEBHOOK_URL')
  ON CONFLICT DO NOTHING;
  ON CONFLICT DO NOTHING;


  INSERT INTO analytics.audit_alert_notification(alert_event_id, channel_type, webhook_ref)
  INSERT INTO analytics.audit_alert_notification(alert_event_id, channel_type, webhook_ref)
  VALUES (NEW.alert_event_id, 'TEAMS', 'TEAMS_WEBHOOK_URL')
  VALUES (NEW.alert_event_id, 'TEAMS', 'TEAMS_WEBHOOK_URL')
  ON CONFLICT DO NOTHING;
  ON CONFLICT DO NOTHING;


  RETURN NEW;
  RETURN NEW;
END;
END;
$$;
$$;




--
--
-- Name: approve_request(uuid, uuid, text); Type: FUNCTION; Schema: approval; Owner: -
-- Name: approve_request(uuid, uuid, text); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.approve_request(p_request_id uuid, p_actor uuid, p_note text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION approval.approve_request(p_request_id uuid, p_actor uuid, p_note text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update approval_request
  update approval_request
     set status='approved',
     set status='approved',
         decided_at=now(),
         decided_at=now(),
         decided_by=p_actor,
         decided_by=p_actor,
         decision_note=p_note
         decision_note=p_note
   where request_id=p_request_id
   where request_id=p_request_id
     and status='pending';
     and status='pending';


  insert into approval_log
  insert into approval_log
    (approval_request_id, action, actor, note)
    (approval_request_id, action, actor, note)
  values
  values
    (p_request_id, 'approve', p_actor, p_note);
    (p_request_id, 'approve', p_actor, p_note);
end;
end;
$$;
$$;




--
--
-- Name: assert_saas_limit(uuid); Type: FUNCTION; Schema: approval; Owner: -
-- Name: assert_saas_limit(uuid); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.assert_saas_limit(p_company_id uuid) RETURNS void
CREATE FUNCTION approval.assert_saas_limit(p_company_id uuid) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v record;
  v record;
begin
begin
  select *
  select *
    into v
    into v
  from approval.v_saas_limit_status ls
  from approval.v_saas_limit_status ls
  join approval.saas_company_map scm
  join approval.saas_company_map scm
    on scm.subscription_id = ls.subscription_id
    on scm.subscription_id = ls.subscription_id
   and scm.company_id = p_company_id
   and scm.company_id = p_company_id
  limit 1;
  limit 1;


  if not found then
  if not found then
    raise exception 'No active subscription for company %', p_company_id;
    raise exception 'No active subscription for company %', p_company_id;
  end if;
  end if;


  if v.max_companies is not null and v.used_companies > v.max_companies then
  if v.max_companies is not null and v.used_companies > v.max_companies then
    raise exception 'Company limit exceeded';
    raise exception 'Company limit exceeded';
  end if;
  end if;


  if v.max_approvals_mo is not null and v.used_approvals >= v.max_approvals_mo then
  if v.max_approvals_mo is not null and v.used_approvals >= v.max_approvals_mo then
    raise exception 'Monthly approval limit exceeded';
    raise exception 'Monthly approval limit exceeded';
  end if;
  end if;
end;
end;
$$;
$$;




--
--
-- Name: check_plan_limit(uuid); Type: FUNCTION; Schema: approval; Owner: -
-- Name: check_plan_limit(uuid); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.check_plan_limit(p_company_id uuid) RETURNS boolean
CREATE FUNCTION approval.check_plan_limit(p_company_id uuid) RETURNS boolean
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_plan text;
  v_plan text;
  v_limit integer;
  v_limit integer;
  v_used integer;
  v_used integer;
begin
begin
  select cp.plan_code
  select cp.plan_code
    into v_plan
    into v_plan
  from approval.company_plan cp
  from approval.company_plan cp
  where cp.company_id = p_company_id;
  where cp.company_id = p_company_id;


  select pm.max_requests_per_month
  select pm.max_requests_per_month
    into v_limit
    into v_limit
  from approval.plan_master pm
  from approval.plan_master pm
  where pm.plan_code = v_plan;
  where pm.plan_code = v_plan;


  select coalesce(m.request_count, 0)
  select coalesce(m.request_count, 0)
    into v_used
    into v_used
  from approval.v_monthly_request_count m
  from approval.v_monthly_request_count m
  where m.company_id = p_company_id
  where m.company_id = p_company_id
    and m.month = date_trunc('month', now());
    and m.month = date_trunc('month', now());


  return v_used < v_limit;
  return v_used < v_limit;
end;
end;
$$;
$$;




--
--
-- Name: decide_approval(uuid, text, uuid, text); Type: FUNCTION; Schema: approval; Owner: -
-- Name: decide_approval(uuid, text, uuid, text); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.decide_approval(p_request_id uuid, p_decision text, p_decided_by uuid, p_note text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION approval.decide_approval(p_request_id uuid, p_decision text, p_decided_by uuid, p_note text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_order_id bigint;
  v_order_id bigint;
begin
begin
  update approval_request
  update approval_request
     set status        = p_decision,
     set status        = p_decision,
         decided_at    = now(),
         decided_at    = now(),
         decided_by    = p_decided_by,
         decided_by    = p_decided_by,
         decision_note = p_note
         decision_note = p_note
   where request_id = p_request_id
   where request_id = p_request_id
   returning order_id into v_order_id;
   returning order_id into v_order_id;


  -- sales.order_header へ反映
  -- sales.order_header へ反映
  if p_decision = 'approved' then
  if p_decision = 'approved' then
    update sales.order_header
    update sales.order_header
       set status_code = 'approved'
       set status_code = 'approved'
     where order_id = v_order_id;
     where order_id = v_order_id;
  else
  else
    update sales.order_header
    update sales.order_header
       set status_code = 'rejected'
       set status_code = 'rejected'
     where order_id = v_order_id;
     where order_id = v_order_id;
  end if;
  end if;
end;
end;
$$;
$$;




--
--
-- Name: decide_request(uuid, text, text); Type: FUNCTION; Schema: approval; Owner: -
-- Name: decide_request(uuid, text, text); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.decide_request(p_request_id uuid, p_decision text, p_note text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION approval.decide_request(p_request_id uuid, p_decision text, p_note text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public', 'approval'
    SET search_path TO 'public', 'approval'
    AS $$
    AS $$
declare
declare
  v_company_id uuid;
  v_company_id uuid;
  v_order_id bigint;
  v_order_id bigint;
begin
begin
  if p_decision not in ('approved','rejected') then
  if p_decision not in ('approved','rejected') then
    raise exception 'invalid decision';
    raise exception 'invalid decision';
  end if;
  end if;


  select company_id, order_id
  select company_id, order_id
    into v_company_id, v_order_id
    into v_company_id, v_order_id
  from approval_request
  from approval_request
  where request_id = p_request_id;
  where request_id = p_request_id;


  if not exists (
  if not exists (
    select 1 from approval.approver
    select 1 from approval.approver
     where company_id = v_company_id
     where company_id = v_company_id
       and user_id = auth.uid()
       and user_id = auth.uid()
  ) then
  ) then
    raise exception 'not approver';
    raise exception 'not approver';
  end if;
  end if;


  update approval_request
  update approval_request
     set status = p_decision,
     set status = p_decision,
         decided_at = now(),
         decided_at = now(),
         decided_by = auth.uid(),
         decided_by = auth.uid(),
         decision_note = p_note
         decision_note = p_note
   where request_id = p_request_id
   where request_id = p_request_id
     and status = 'pending';
     and status = 'pending';


  insert into approval_log(approval_request_id, action, actor, note)
  insert into approval_log(approval_request_id, action, actor, note)
  values (
  values (
    p_request_id,
    p_request_id,
    case when p_decision='approved' then 'approve' else 'reject' end,
    case when p_decision='approved' then 'approve' else 'reject' end,
    auth.uid(),
    auth.uid(),
    p_note
    p_note
  );
  );


  if v_order_id is not null then
  if v_order_id is not null then
    update sales.order_header
    update sales.order_header
       set status_code = p_decision
       set status_code = p_decision
     where order_id = v_order_id;
     where order_id = v_order_id;
  end if;
  end if;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_rework_from_bad(); Type: FUNCTION; Schema: approval; Owner: -
-- Name: enqueue_rework_from_bad(); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.enqueue_rework_from_bad() RETURNS integer
CREATE FUNCTION approval.enqueue_rework_from_bad() RETURNS integer
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public', 'approval'
    SET search_path TO 'public', 'approval'
    AS $$
    AS $$
declare
declare
  v_count integer := 0;
  v_count integer := 0;
begin
begin
  insert into approval.policy_eval_event
  insert into approval.policy_eval_event
    (auto_policy_id, company_id, order_id, entity_id, outcome)
    (auto_policy_id, company_id, order_id, entity_id, outcome)
  select
  select
    b.auto_policy_id,
    b.auto_policy_id,
    b.company_id,
    b.company_id,
    b.order_id,
    b.order_id,
    b.entity_id,
    b.entity_id,
    'bad'
    'bad'
  from approval.v_bad_candidate_audit b
  from approval.v_bad_candidate_audit b
  where not exists (
  where not exists (
    select 1
    select 1
    from approval.policy_eval_event e
    from approval.policy_eval_event e
    where e.auto_policy_id = b.auto_policy_id
    where e.auto_policy_id = b.auto_policy_id
      and e.order_id = b.order_id
      and e.order_id = b.order_id
      and e.outcome = 'bad'
      and e.outcome = 'bad'
  );
  );


  get diagnostics v_count = row_count;
  get diagnostics v_count = row_count;


  insert into approval.rework_task
  insert into approval.rework_task
    (auto_policy_id, company_id, order_id, entity_id, reason)
    (auto_policy_id, company_id, order_id, entity_id, reason)
  select
  select
    b.auto_policy_id,
    b.auto_policy_id,
    b.company_id,
    b.company_id,
    b.order_id,
    b.order_id,
    b.entity_id,
    b.entity_id,
    b.bad_reason
    b.bad_reason
  from approval.v_bad_candidate_audit b
  from approval.v_bad_candidate_audit b
  where not exists (
  where not exists (
    select 1
    select 1
    from approval.rework_task t
    from approval.rework_task t
    where t.auto_policy_id = b.auto_policy_id
    where t.auto_policy_id = b.auto_policy_id
      and t.order_id = b.order_id
      and t.order_id = b.order_id
      and t.status = 'open'
      and t.status = 'open'
  );
  );


  return v_count;
  return v_count;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_rework_from_bad_all(); Type: FUNCTION; Schema: approval; Owner: -
-- Name: enqueue_rework_from_bad_all(); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.enqueue_rework_from_bad_all() RETURNS integer
CREATE FUNCTION approval.enqueue_rework_from_bad_all() RETURNS integer
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public', 'approval'
    SET search_path TO 'public', 'approval'
    AS $$
    AS $$
declare
declare
  v_count integer := 0;
  v_count integer := 0;
begin
begin
  insert into approval.policy_eval_event(
  insert into approval.policy_eval_event(
    auto_policy_id, company_id, order_id, entity_id, outcome
    auto_policy_id, company_id, order_id, entity_id, outcome
  )
  )
  select
  select
    b.auto_policy_id,
    b.auto_policy_id,
    b.company_id,
    b.company_id,
    b.order_id,
    b.order_id,
    b.entity_id,
    b.entity_id,
    'bad'
    'bad'
  from approval.v_bad_candidate_all b
  from approval.v_bad_candidate_all b
  where not exists (
  where not exists (
    select 1
    select 1
    from approval.policy_eval_event pe2
    from approval.policy_eval_event pe2
    where pe2.auto_policy_id = b.auto_policy_id
    where pe2.auto_policy_id = b.auto_policy_id
      and pe2.order_id = b.order_id
      and pe2.order_id = b.order_id
      and pe2.outcome = 'bad'
      and pe2.outcome = 'bad'
  );
  );


  get diagnostics v_count = row_count;
  get diagnostics v_count = row_count;


  insert into approval.rework_task(
  insert into approval.rework_task(
    auto_policy_id, company_id, order_id, entity_id, reason
    auto_policy_id, company_id, order_id, entity_id, reason
  )
  )
  select
  select
    b.auto_policy_id,
    b.auto_policy_id,
    b.company_id,
    b.company_id,
    b.order_id,
    b.order_id,
    b.entity_id,
    b.entity_id,
    b.bad_reason
    b.bad_reason
  from approval.v_bad_candidate_all b
  from approval.v_bad_candidate_all b
  where not exists (
  where not exists (
    select 1
    select 1
    from approval.rework_task t
    from approval.rework_task t
    where t.auto_policy_id = b.auto_policy_id
    where t.auto_policy_id = b.auto_policy_id
      and t.order_id = b.order_id
      and t.order_id = b.order_id
      and t.status = 'open'
      and t.status = 'open'
  );
  );


  return v_count;
  return v_count;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_rework_from_bad_extended(); Type: FUNCTION; Schema: approval; Owner: -
-- Name: enqueue_rework_from_bad_extended(); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.enqueue_rework_from_bad_extended() RETURNS integer
CREATE FUNCTION approval.enqueue_rework_from_bad_extended() RETURNS integer
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'public', 'approval'
    SET search_path TO 'public', 'approval'
    AS $$
    AS $$
declare
declare
  v_count integer := 0;
  v_count integer := 0;
begin
begin
  -- bad イベント（重複防止）
  -- bad イベント（重複防止）
  insert into approval.policy_eval_event(
  insert into approval.policy_eval_event(
    auto_policy_id, company_id, order_id, entity_id, outcome
    auto_policy_id, company_id, order_id, entity_id, outcome
  )
  )
  select
  select
    b.auto_policy_id,
    b.auto_policy_id,
    b.company_id,
    b.company_id,
    b.order_id,
    b.order_id,
    b.entity_id,
    b.entity_id,
    'bad'
    'bad'
  from approval.v_bad_candidate_extended b
  from approval.v_bad_candidate_extended b
  where not exists (
  where not exists (
    select 1
    select 1
    from approval.policy_eval_event pe2
    from approval.policy_eval_event pe2
    where pe2.auto_policy_id = b.auto_policy_id
    where pe2.auto_policy_id = b.auto_policy_id
      and pe2.order_id = b.order_id
      and pe2.order_id = b.order_id
      and pe2.outcome = 'bad'
      and pe2.outcome = 'bad'
  );
  );


  get diagnostics v_count = row_count;
  get diagnostics v_count = row_count;


  -- 再修正タスク（open がなければ作成）
  -- 再修正タスク（open がなければ作成）
  insert into approval.rework_task(
  insert into approval.rework_task(
    auto_policy_id, company_id, order_id, entity_id, reason
    auto_policy_id, company_id, order_id, entity_id, reason
  )
  )
  select
  select
    b.auto_policy_id,
    b.auto_policy_id,
    b.company_id,
    b.company_id,
    b.order_id,
    b.order_id,
    b.entity_id,
    b.entity_id,
    b.bad_reason
    b.bad_reason
  from approval.v_bad_candidate_extended b
  from approval.v_bad_candidate_extended b
  where not exists (
  where not exists (
    select 1
    select 1
    from approval.rework_task t
    from approval.rework_task t
    where t.auto_policy_id = b.auto_policy_id
    where t.auto_policy_id = b.auto_policy_id
      and t.order_id = b.order_id
      and t.order_id = b.order_id
      and t.status = 'open'
      and t.status = 'open'
  );
  );


  return v_count;
  return v_count;
end;
end;
$$;
$$;




--
--
-- Name: is_in_rollout(integer, text); Type: FUNCTION; Schema: approval; Owner: -
-- Name: is_in_rollout(integer, text); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.is_in_rollout(p_rollout_percent integer, p_seed text) RETURNS boolean
CREATE FUNCTION approval.is_in_rollout(p_rollout_percent integer, p_seed text) RETURNS boolean
    LANGUAGE sql IMMUTABLE
    LANGUAGE sql IMMUTABLE
    AS $$
    AS $$
  select (abs(('x' || substr(md5(coalesce(p_seed,'')), 1, 8))::bit(32)::int) % 100) < p_rollout_percent;
  select (abs(('x' || substr(md5(coalesce(p_seed,'')), 1, 8))::bit(32)::int) % 100) < p_rollout_percent;
$$;
$$;




--
--
-- Name: mark_invoice_paid(uuid); Type: FUNCTION; Schema: approval; Owner: -
-- Name: mark_invoice_paid(uuid); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.mark_invoice_paid(p_invoice_id uuid) RETURNS void
CREATE FUNCTION approval.mark_invoice_paid(p_invoice_id uuid) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update approval.billing_invoice
  update approval.billing_invoice
     set status='paid'
     set status='paid'
   where invoice_id=p_invoice_id
   where invoice_id=p_invoice_id
     and status <> 'paid';
     and status <> 'paid';
end;
end;
$$;
$$;




--
--
-- Name: reject_request(uuid, uuid, text); Type: FUNCTION; Schema: approval; Owner: -
-- Name: reject_request(uuid, uuid, text); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.reject_request(p_request_id uuid, p_actor uuid, p_note text) RETURNS void
CREATE FUNCTION approval.reject_request(p_request_id uuid, p_actor uuid, p_note text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update approval_request
  update approval_request
     set status='rejected',
     set status='rejected',
         decided_at=now(),
         decided_at=now(),
         decided_by=p_actor,
         decided_by=p_actor,
         decision_note=p_note
         decision_note=p_note
   where request_id=p_request_id
   where request_id=p_request_id
     and status='pending';
     and status='pending';


  insert into approval_log
  insert into approval_log
    (approval_request_id, action, actor, note)
    (approval_request_id, action, actor, note)
  values
  values
    (p_request_id, 'reject', p_actor, p_note);
    (p_request_id, 'reject', p_actor, p_note);
end;
end;
$$;
$$;




--
--
-- Name: safe_request_approval(uuid, bigint, text, text); Type: FUNCTION; Schema: approval; Owner: -
-- Name: safe_request_approval(uuid, bigint, text, text); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.safe_request_approval(p_company_id uuid, p_order_id bigint, p_policy_id text, p_reason text) RETURNS void
CREATE FUNCTION approval.safe_request_approval(p_company_id uuid, p_order_id bigint, p_policy_id text, p_reason text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  if not approval.check_plan_limit(p_company_id) then
  if not approval.check_plan_limit(p_company_id) then
    raise exception 'plan_limit_exceeded';
    raise exception 'plan_limit_exceeded';
  end if;
  end if;


  insert into approval_request (
  insert into approval_request (
    request_id,
    request_id,
    company_id,
    company_id,
    order_id,
    order_id,
    policy_id,
    policy_id,
    reason,
    reason,
    status,
    status,
    detected_at
    detected_at
  ) values (
  ) values (
    gen_random_uuid()::text,
    gen_random_uuid()::text,
    p_company_id,
    p_company_id,
    p_order_id,
    p_order_id,
    p_policy_id,
    p_policy_id,
    p_reason,
    p_reason,
    'pending',
    'pending',
    now()
    now()
  );
  );
end;
end;
$$;
$$;




--
--
-- Name: set_policy_and_severity(); Type: FUNCTION; Schema: approval; Owner: -
-- Name: set_policy_and_severity(); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.set_policy_and_severity() RETURNS trigger
CREATE FUNCTION approval.set_policy_and_severity() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  -- policy_id が未指定ならデフォルト
  -- policy_id が未指定ならデフォルト
  if new.policy_id is null then
  if new.policy_id is null then
    new.policy_id := 'p_default';
    new.policy_id := 'p_default';
  end if;
  end if;


  -- severity が未指定なら policy_id から決定
  -- severity が未指定なら policy_id から決定
  if new.severity is null then
  if new.severity is null then
    new.severity :=
    new.severity :=
      case
      case
        when new.policy_id like '%external_impact%' then 'high'
        when new.policy_id like '%external_impact%' then 'high'
        when new.policy_id like '%amount%'          then 'medium'
        when new.policy_id like '%amount%'          then 'medium'
        else 'low'
        else 'low'
      end;
      end;
  end if;
  end if;


  return new;
  return new;
end;
end;
$$;
$$;




--
--
-- Name: touch_updated_at(); Type: FUNCTION; Schema: approval; Owner: -
-- Name: touch_updated_at(); Type: FUNCTION; Schema: approval; Owner: -
--
--


CREATE FUNCTION approval.touch_updated_at() RETURNS trigger
CREATE FUNCTION approval.touch_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  new.updated_at := now();
  new.updated_at := now();
  return new;
  return new;
end; $$;
end; $$;




--
--
-- Name: apply_audit_triggers(); Type: FUNCTION; Schema: audit; Owner: -
-- Name: apply_audit_triggers(); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.apply_audit_triggers() RETURNS void
CREATE FUNCTION audit.apply_audit_triggers() RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $_$
    AS $_$
DECLARE
DECLARE
  r record;
  r record;
  v_trg_name text;
  v_trg_name text;
  v_sql text;
  v_sql text;
BEGIN
BEGIN
  FOR r IN
  FOR r IN
    SELECT table_schema, table_name
    SELECT table_schema, table_name
    FROM audit.audit_target_table
    FROM audit.audit_target_table
    WHERE is_enabled = true
    WHERE is_enabled = true
      AND audit_level IN ('FULL','PARTIAL')
      AND audit_level IN ('FULL','PARTIAL')
      AND table_schema NOT IN ('pg_catalog','information_schema')
      AND table_schema NOT IN ('pg_catalog','information_schema')
  LOOP
  LOOP
    v_trg_name := 'trg_audit_generic__' || r.table_schema || '__' || r.table_name;
    v_trg_name := 'trg_audit_generic__' || r.table_schema || '__' || r.table_name;


    -- 既存チェック
    -- 既存チェック
    IF EXISTS (
    IF EXISTS (
      SELECT 1
      SELECT 1
      FROM pg_trigger t
      FROM pg_trigger t
      JOIN pg_class c ON c.oid = t.tgrelid
      JOIN pg_class c ON c.oid = t.tgrelid
      JOIN pg_namespace n ON n.oid = c.relnamespace
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE t.tgname = v_trg_name
      WHERE t.tgname = v_trg_name
        AND n.nspname = r.table_schema
        AND n.nspname = r.table_schema
        AND c.relname = r.table_name
        AND c.relname = r.table_name
        AND NOT t.tgisinternal
        AND NOT t.tgisinternal
    ) THEN
    ) THEN
      CONTINUE;
      CONTINUE;
    END IF;
    END IF;


    v_sql := format($f$
    v_sql := format($f$
      CREATE TRIGGER %I
      CREATE TRIGGER %I
      AFTER INSERT OR UPDATE OR DELETE ON %I.%I
      AFTER INSERT OR UPDATE OR DELETE ON %I.%I
      FOR EACH ROW
      FOR EACH ROW
      EXECUTE FUNCTION audit.trg_audit_generic();
      EXECUTE FUNCTION audit.trg_audit_generic();
    $f$, v_trg_name, r.table_schema, r.table_name);
    $f$, v_trg_name, r.table_schema, r.table_name);


    EXECUTE v_sql;
    EXECUTE v_sql;
  END LOOP;
  END LOOP;
END;
END;
$_$;
$_$;




--
--
-- Name: current_company_id(); Type: FUNCTION; Schema: audit; Owner: -
-- Name: current_company_id(); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.current_company_id() RETURNS uuid
CREATE FUNCTION audit.current_company_id() RETURNS uuid
    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  SELECT NULLIF(current_setting('request.jwt.claim.company_id', true), '')::uuid;
  SELECT NULLIF(current_setting('request.jwt.claim.company_id', true), '')::uuid;
$$;
$$;




--
--
-- Name: f_apply_partial_filter(jsonb, jsonb); Type: FUNCTION; Schema: audit; Owner: -
-- Name: f_apply_partial_filter(jsonb, jsonb); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.f_apply_partial_filter(p_changed jsonb, p_audited_cols jsonb) RETURNS boolean
CREATE FUNCTION audit.f_apply_partial_filter(p_changed jsonb, p_audited_cols jsonb) RETURNS boolean
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  -- changed_columns と audited_columns が交差していれば true（監査する）
  -- changed_columns と audited_columns が交差していれば true（監査する）
  SELECT EXISTS (
  SELECT EXISTS (
    SELECT 1
    SELECT 1
    FROM jsonb_array_elements_text(COALESCE(p_changed,'[]'::jsonb)) ch(col)
    FROM jsonb_array_elements_text(COALESCE(p_changed,'[]'::jsonb)) ch(col)
    JOIN jsonb_array_elements_text(COALESCE(p_audited_cols,'[]'::jsonb)) ac(col)
    JOIN jsonb_array_elements_text(COALESCE(p_audited_cols,'[]'::jsonb)) ac(col)
      ON ac.col = ch.col
      ON ac.col = ch.col
  );
  );
$$;
$$;




--
--
-- Name: f_changed_columns(jsonb, jsonb); Type: FUNCTION; Schema: audit; Owner: -
-- Name: f_changed_columns(jsonb, jsonb); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.f_changed_columns(before_row jsonb, after_row jsonb) RETURNS jsonb
CREATE FUNCTION audit.f_changed_columns(before_row jsonb, after_row jsonb) RETURNS jsonb
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  SELECT COALESCE(
  SELECT COALESCE(
    (
    (
      SELECT jsonb_agg(k)
      SELECT jsonb_agg(k)
      FROM (
      FROM (
        SELECT k
        SELECT k
        FROM (
        FROM (
          SELECT jsonb_object_keys(COALESCE(after_row, '{}'::jsonb)) AS k
          SELECT jsonb_object_keys(COALESCE(after_row, '{}'::jsonb)) AS k
          UNION
          UNION
          SELECT jsonb_object_keys(COALESCE(before_row,'{}'::jsonb)) AS k
          SELECT jsonb_object_keys(COALESCE(before_row,'{}'::jsonb)) AS k
        ) u
        ) u
        WHERE COALESCE(before_row->u.k, 'null'::jsonb) IS DISTINCT FROM COALESCE(after_row->u.k, 'null'::jsonb)
        WHERE COALESCE(before_row->u.k, 'null'::jsonb) IS DISTINCT FROM COALESCE(after_row->u.k, 'null'::jsonb)
      ) diff
      ) diff
    ),
    ),
    '[]'::jsonb
    '[]'::jsonb
  );
  );
$$;
$$;




--
--
-- Name: f_extract_pk_jsonb(text, text, jsonb); Type: FUNCTION; Schema: audit; Owner: -
-- Name: f_extract_pk_jsonb(text, text, jsonb); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.f_extract_pk_jsonb(p_schema text, p_table text, p_row jsonb) RETURNS jsonb
CREATE FUNCTION audit.f_extract_pk_jsonb(p_schema text, p_table text, p_row jsonb) RETURNS jsonb
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  SELECT CASE
  SELECT CASE
    WHEN EXISTS (
    WHEN EXISTS (
      SELECT 1
      SELECT 1
      FROM information_schema.table_constraints tc
      FROM information_schema.table_constraints tc
      JOIN information_schema.key_column_usage kcu
      JOIN information_schema.key_column_usage kcu
        ON kcu.constraint_name = tc.constraint_name
        ON kcu.constraint_name = tc.constraint_name
       AND kcu.table_schema = tc.table_schema
       AND kcu.table_schema = tc.table_schema
       AND kcu.table_name = tc.table_name
       AND kcu.table_name = tc.table_name
      WHERE tc.constraint_type = 'PRIMARY KEY'
      WHERE tc.constraint_type = 'PRIMARY KEY'
        AND tc.table_schema = p_schema
        AND tc.table_schema = p_schema
        AND tc.table_name = p_table
        AND tc.table_name = p_table
    )
    )
    THEN (
    THEN (
      SELECT jsonb_object_agg(kcu.column_name, p_row -> kcu.column_name)
      SELECT jsonb_object_agg(kcu.column_name, p_row -> kcu.column_name)
      FROM information_schema.table_constraints tc
      FROM information_schema.table_constraints tc
      JOIN information_schema.key_column_usage kcu
      JOIN information_schema.key_column_usage kcu
        ON kcu.constraint_name = tc.constraint_name
        ON kcu.constraint_name = tc.constraint_name
       AND kcu.table_schema = tc.table_schema
       AND kcu.table_schema = tc.table_schema
       AND kcu.table_name = tc.table_name
       AND kcu.table_name = tc.table_name
      WHERE tc.constraint_type = 'PRIMARY KEY'
      WHERE tc.constraint_type = 'PRIMARY KEY'
        AND tc.table_schema = p_schema
        AND tc.table_schema = p_schema
        AND tc.table_name = p_table
        AND tc.table_name = p_table
    )
    )
    ELSE NULL
    ELSE NULL
  END;
  END;
$$;
$$;




--
--
-- Name: f_get_company_id_from_row(jsonb); Type: FUNCTION; Schema: audit; Owner: -
-- Name: f_get_company_id_from_row(jsonb); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.f_get_company_id_from_row(p_row jsonb) RETURNS uuid
CREATE FUNCTION audit.f_get_company_id_from_row(p_row jsonb) RETURNS uuid
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE v text;
DECLARE v text;
BEGIN
BEGIN
  IF p_row ? 'company_id' THEN
  IF p_row ? 'company_id' THEN
    v := p_row->>'company_id';
    v := p_row->>'company_id';
    IF v IS NULL OR v = '' THEN
    IF v IS NULL OR v = '' THEN
      RETURN NULL;
      RETURN NULL;
    END IF;
    END IF;
    RETURN v::uuid;
    RETURN v::uuid;
  END IF;
  END IF;
  RETURN NULL;
  RETURN NULL;
EXCEPTION WHEN others THEN
EXCEPTION WHEN others THEN
  RETURN NULL;
  RETURN NULL;
END;
END;
$$;
$$;




--
--
-- Name: f_get_setting_uuid(text); Type: FUNCTION; Schema: audit; Owner: -
-- Name: f_get_setting_uuid(text); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.f_get_setting_uuid(p_key text) RETURNS uuid
CREATE FUNCTION audit.f_get_setting_uuid(p_key text) RETURNS uuid
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE v text;
DECLARE v text;
BEGIN
BEGIN
  v := current_setting(p_key, true);
  v := current_setting(p_key, true);
  IF v IS NULL OR v = '' THEN
  IF v IS NULL OR v = '' THEN
    RETURN NULL;
    RETURN NULL;
  END IF;
  END IF;
  RETURN v::uuid;
  RETURN v::uuid;
EXCEPTION WHEN others THEN
EXCEPTION WHEN others THEN
  RETURN NULL;
  RETURN NULL;
END;
END;
$$;
$$;




--
--
-- Name: tg_exec_request_ins(); Type: FUNCTION; Schema: audit; Owner: -
-- Name: tg_exec_request_ins(); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.tg_exec_request_ins() RETURNS trigger
CREATE FUNCTION audit.tg_exec_request_ins() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
    begin
    begin
      insert into audit.exec_audit_event(request_id, event_type, detail, created_by)
      insert into audit.exec_audit_event(request_id, event_type, detail, created_by)
      values (new.request_id, 'ENQUEUE',
      values (new.request_id, 'ENQUEUE',
              jsonb_build_object('command_code', new.command_code, 'priority', new.priority, 'worker_tag', new.worker_tag),
              jsonb_build_object('command_code', new.command_code, 'priority', new.priority, 'worker_tag', new.worker_tag),
              auth.uid());
              auth.uid());
      return new;
      return new;
    end;
    end;
    $$;
    $$;




--
--
-- Name: tg_exec_request_upd(); Type: FUNCTION; Schema: audit; Owner: -
-- Name: tg_exec_request_upd(); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.tg_exec_request_upd() RETURNS trigger
CREATE FUNCTION audit.tg_exec_request_upd() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
    begin
    begin
      if new.status is distinct from old.status then
      if new.status is distinct from old.status then
        insert into audit.exec_audit_event(request_id, event_type, detail, created_by)
        insert into audit.exec_audit_event(request_id, event_type, detail, created_by)
        values (
        values (
          new.request_id,
          new.request_id,
          case
          case
            when new.status='RUNNING' then 'PICK'
            when new.status='RUNNING' then 'PICK'
            when new.status='DONE' then 'DONE'
            when new.status='DONE' then 'DONE'
            when new.status='FAILED' then 'FAILED'
            when new.status='FAILED' then 'FAILED'
            else 'ENQUEUE'
            else 'ENQUEUE'
          end,
          end,
          jsonb_build_object('from', old.status, 'to', new.status, 'exit_code', new.exit_code),
          jsonb_build_object('from', old.status, 'to', new.status, 'exit_code', new.exit_code),
          auth.uid()
          auth.uid()
        );
        );
      end if;
      end if;
      return new;
      return new;
    end;
    end;
    $$;
    $$;




--
--
-- Name: trg_audit_generic(); Type: FUNCTION; Schema: audit; Owner: -
-- Name: trg_audit_generic(); Type: FUNCTION; Schema: audit; Owner: -
--
--


CREATE FUNCTION audit.trg_audit_generic() RETURNS trigger
CREATE FUNCTION audit.trg_audit_generic() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  v_level text;
  v_level text;
  v_cols  jsonb;
  v_cols  jsonb;
  v_before jsonb;
  v_before jsonb;
  v_after  jsonb;
  v_after  jsonb;
  v_changed jsonb;
  v_changed jsonb;
  v_company uuid;
  v_company uuid;
  v_req uuid;
  v_req uuid;
  v_pk jsonb;
  v_pk jsonb;
BEGIN
BEGIN
  SELECT at.audit_level, at.audited_columns
  SELECT at.audit_level, at.audited_columns
    INTO v_level, v_cols
    INTO v_level, v_cols
  FROM audit.audit_target_table at
  FROM audit.audit_target_table at
  WHERE at.table_schema = TG_TABLE_SCHEMA
  WHERE at.table_schema = TG_TABLE_SCHEMA
    AND at.table_name   = TG_TABLE_NAME
    AND at.table_name   = TG_TABLE_NAME
    AND at.is_enabled   = true
    AND at.is_enabled   = true
  LIMIT 1;
  LIMIT 1;


  IF v_level IS NULL OR v_level = 'NONE' THEN
  IF v_level IS NULL OR v_level = 'NONE' THEN
    RETURN COALESCE(NEW, OLD);
    RETURN COALESCE(NEW, OLD);
  END IF;
  END IF;


  IF TG_OP = 'INSERT' THEN
  IF TG_OP = 'INSERT' THEN
    v_before := NULL;
    v_before := NULL;
    v_after  := to_jsonb(NEW);
    v_after  := to_jsonb(NEW);
  ELSIF TG_OP = 'UPDATE' THEN
  ELSIF TG_OP = 'UPDATE' THEN
    v_before := to_jsonb(OLD);
    v_before := to_jsonb(OLD);
    v_after  := to_jsonb(NEW);
    v_after  := to_jsonb(NEW);
  ELSIF TG_OP = 'DELETE' THEN
  ELSIF TG_OP = 'DELETE' THEN
    v_before := to_jsonb(OLD);
    v_before := to_jsonb(OLD);
    v_after  := NULL;
    v_after  := NULL;
  ELSE
  ELSE
    RETURN COALESCE(NEW, OLD);
    RETURN COALESCE(NEW, OLD);
  END IF;
  END IF;


  v_changed := audit.f_changed_columns(v_before, v_after);
  v_changed := audit.f_changed_columns(v_before, v_after);


  -- UPDATE で差分が無いならスキップ（無駄ログ防止）
  -- UPDATE で差分が無いならスキップ（無駄ログ防止）
  IF TG_OP = 'UPDATE' AND jsonb_array_length(COALESCE(v_changed,'[]'::jsonb)) = 0 THEN
  IF TG_OP = 'UPDATE' AND jsonb_array_length(COALESCE(v_changed,'[]'::jsonb)) = 0 THEN
    RETURN NEW;
    RETURN NEW;
  END IF;
  END IF;


  -- PARTIAL：対象カラムに関係ない変更ならスキップ
  -- PARTIAL：対象カラムに関係ない変更ならスキップ
  IF v_level = 'PARTIAL' THEN
  IF v_level = 'PARTIAL' THEN
    IF NOT audit.f_apply_partial_filter(v_changed, v_cols) THEN
    IF NOT audit.f_apply_partial_filter(v_changed, v_cols) THEN
      RETURN COALESCE(NEW, OLD);
      RETURN COALESCE(NEW, OLD);
    END IF;
    END IF;
  END IF;
  END IF;


  v_company := audit.f_get_company_id_from_row(COALESCE(v_after, v_before));
  v_company := audit.f_get_company_id_from_row(COALESCE(v_after, v_before));
  v_req := audit.f_get_setting_uuid('audit.request_id');
  v_req := audit.f_get_setting_uuid('audit.request_id');
  v_pk  := audit.f_extract_pk_jsonb(TG_TABLE_SCHEMA, TG_TABLE_NAME, COALESCE(v_after, v_before));
  v_pk  := audit.f_extract_pk_jsonb(TG_TABLE_SCHEMA, TG_TABLE_NAME, COALESCE(v_after, v_before));


  INSERT INTO audit.audit_trail_db(
  INSERT INTO audit.audit_trail_db(
    company_id,
    company_id,
    table_schema,
    table_schema,
    table_name,
    table_name,
    action,
    action,
    pk,
    pk,
    row_before,
    row_before,
    row_after,
    row_after,
    changed_columns,
    changed_columns,
    actor,
    actor,
    request_id
    request_id
  )
  )
  VALUES (
  VALUES (
    v_company,
    v_company,
    TG_TABLE_SCHEMA,
    TG_TABLE_SCHEMA,
    TG_TABLE_NAME,
    TG_TABLE_NAME,
    TG_OP,
    TG_OP,
    v_pk,
    v_pk,
    v_before,
    v_before,
    v_after,
    v_after,
    v_changed,
    v_changed,
    current_user,
    current_user,
    v_req
    v_req
  );
  );


  RETURN COALESCE(NEW, OLD);
  RETURN COALESCE(NEW, OLD);
END;
END;
$$;
$$;




--
--
-- Name: email(); Type: FUNCTION; Schema: auth; Owner: -
-- Name: email(); Type: FUNCTION; Schema: auth; Owner: -
--
--


    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select 
  select 
  coalesce(
  coalesce(
    nullif(current_setting('request.jwt.claim.email', true), ''),
    nullif(current_setting('request.jwt.claim.email', true), ''),
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'email')
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'email')
  )::text
  )::text
$$;
$$;




--
--
-- Name: FUNCTION email(); Type: COMMENT; Schema: auth; Owner: -
-- Name: FUNCTION email(); Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON FUNCTION auth.email() IS 'Deprecated. Use auth.jwt() -> ''email'' instead.';
COMMENT ON FUNCTION auth.email() IS 'Deprecated. Use auth.jwt() -> ''email'' instead.';




--
--
-- Name: jwt(); Type: FUNCTION; Schema: auth; Owner: -
-- Name: jwt(); Type: FUNCTION; Schema: auth; Owner: -
--
--


    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select 
  select 
    coalesce(
    coalesce(
        nullif(current_setting('request.jwt.claim', true), ''),
        nullif(current_setting('request.jwt.claim', true), ''),
        nullif(current_setting('request.jwt.claims', true), '')
        nullif(current_setting('request.jwt.claims', true), '')
    )::jsonb
    )::jsonb
$$;
$$;




--
--
-- Name: role(); Type: FUNCTION; Schema: auth; Owner: -
-- Name: role(); Type: FUNCTION; Schema: auth; Owner: -
--
--


    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select 
  select 
  coalesce(
  coalesce(
    nullif(current_setting('request.jwt.claim.role', true), ''),
    nullif(current_setting('request.jwt.claim.role', true), ''),
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'role')
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'role')
  )::text
  )::text
$$;
$$;




--
--
-- Name: FUNCTION role(); Type: COMMENT; Schema: auth; Owner: -
-- Name: FUNCTION role(); Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON FUNCTION auth.role() IS 'Deprecated. Use auth.jwt() -> ''role'' instead.';
COMMENT ON FUNCTION auth.role() IS 'Deprecated. Use auth.jwt() -> ''role'' instead.';




--
--
-- Name: uid(); Type: FUNCTION; Schema: auth; Owner: -
-- Name: uid(); Type: FUNCTION; Schema: auth; Owner: -
--
--


    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select 
  select 
  coalesce(
  coalesce(
    nullif(current_setting('request.jwt.claim.sub', true), ''),
    nullif(current_setting('request.jwt.claim.sub', true), ''),
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'sub')
    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'sub')
  )::uuid
  )::uuid
$$;
$$;




--
--
-- Name: FUNCTION uid(); Type: COMMENT; Schema: auth; Owner: -
-- Name: FUNCTION uid(); Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON FUNCTION auth.uid() IS 'Deprecated. Use auth.jwt() -> ''sub'' instead.';
COMMENT ON FUNCTION auth.uid() IS 'Deprecated. Use auth.jwt() -> ''sub'' instead.';




--
--
-- Name: approve_schema_change(uuid, text); Type: FUNCTION; Schema: ci; Owner: -
-- Name: approve_schema_change(uuid, text); Type: FUNCTION; Schema: ci; Owner: -
--
--


CREATE FUNCTION ci.approve_schema_change(p_request_id uuid, p_approved_by text) RETURNS void
CREATE FUNCTION ci.approve_schema_change(p_request_id uuid, p_approved_by text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  UPDATE ci.schema_change_request
  UPDATE ci.schema_change_request
     SET status = 'approved',
     SET status = 'approved',
         approved_by = p_approved_by,
         approved_by = p_approved_by,
         approved_at = now()
         approved_at = now()
   WHERE request_id = p_request_id
   WHERE request_id = p_request_id
     AND status = 'pending'
     AND status = 'pending'
     AND review_status = 'ok';
     AND review_status = 'ok';


  -- 監査（存在する場合のみ）
  -- 監査（存在する場合のみ）
  IF to_regclass('audit.audit_trail') IS NOT NULL THEN
  IF to_regclass('audit.audit_trail') IS NOT NULL THEN
    INSERT INTO audit.audit_trail
    INSERT INTO audit.audit_trail
      (company_id, entity_type, entity_id, action, detail, performed_by, performed_at)
      (company_id, entity_type, entity_id, action, detail, performed_by, performed_at)
    VALUES
    VALUES
      (NULL, 'schema', p_request_id, 'approve',
      (NULL, 'schema', p_request_id, 'approve',
       jsonb_build_object('by', p_approved_by),
       jsonb_build_object('by', p_approved_by),
       p_approved_by, now());
       p_approved_by, now());
  END IF;
  END IF;
END;
END;
$$;
$$;




--
--
-- Name: audit_schema_change_transitions(); Type: FUNCTION; Schema: ci; Owner: -
-- Name: audit_schema_change_transitions(); Type: FUNCTION; Schema: ci; Owner: -
--
--


CREATE FUNCTION ci.audit_schema_change_transitions() RETURNS trigger
CREATE FUNCTION ci.audit_schema_change_transitions() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  d jsonb;
  d jsonb;
BEGIN
BEGIN
  -- review_status が変わった
  -- review_status が変わった
  IF (TG_OP = 'UPDATE') AND (NEW.review_status IS DISTINCT FROM OLD.review_status) THEN
  IF (TG_OP = 'UPDATE') AND (NEW.review_status IS DISTINCT FROM OLD.review_status) THEN
    d := jsonb_build_object(
    d := jsonb_build_object(
      'schema_name', NEW.schema_name,
      'schema_name', NEW.schema_name,
      'review_status', NEW.review_status,
      'review_status', NEW.review_status,
      'review_summary', NEW.review_summary
      'review_summary', NEW.review_summary
    );
    );
    PERFORM ci.try_write_audit_trail(NEW.request_id, 'review', d);
    PERFORM ci.try_write_audit_trail(NEW.request_id, 'review', d);
  END IF;
  END IF;


  -- status が変わった（approve/reject）
  -- status が変わった（approve/reject）
  IF (TG_OP = 'UPDATE') AND (NEW.status IS DISTINCT FROM OLD.status) THEN
  IF (TG_OP = 'UPDATE') AND (NEW.status IS DISTINCT FROM OLD.status) THEN
    d := jsonb_build_object(
    d := jsonb_build_object(
      'schema_name', NEW.schema_name,
      'schema_name', NEW.schema_name,
      'status', NEW.status,
      'status', NEW.status,
      'approved_by', NEW.approved_by,
      'approved_by', NEW.approved_by,
      'diff_summary', NEW.diff_summary
      'diff_summary', NEW.diff_summary
    );
    );
    PERFORM ci.try_write_audit_trail(NEW.request_id, NEW.status, d);
    PERFORM ci.try_write_audit_trail(NEW.request_id, NEW.status, d);
  END IF;
  END IF;


  RETURN NEW;
  RETURN NEW;
END;
END;
$$;
$$;




--
--
-- Name: build_schema_review_prompt(text, text, text); Type: FUNCTION; Schema: ci; Owner: -
-- Name: build_schema_review_prompt(text, text, text); Type: FUNCTION; Schema: ci; Owner: -
--
--


CREATE FUNCTION ci.build_schema_review_prompt(p_domain text, p_schema_name text, p_diff_summary text) RETURNS text
CREATE FUNCTION ci.build_schema_review_prompt(p_domain text, p_schema_name text, p_diff_summary text) RETURNS text
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  prefix text;
  prefix text;
BEGIN
BEGIN
  SELECT t.prompt_prefix
  SELECT t.prompt_prefix
    INTO prefix
    INTO prefix
  FROM ci.schema_review_prompt_template t
  FROM ci.schema_review_prompt_template t
  WHERE t.is_enabled = true
  WHERE t.is_enabled = true
    AND t.domain = COALESCE(p_domain, t.domain)
    AND t.domain = COALESCE(p_domain, t.domain)
    AND t.schema_name = p_schema_name
    AND t.schema_name = p_schema_name
  ORDER BY (t.domain = p_domain) DESC, t.updated_at DESC
  ORDER BY (t.domain = p_domain) DESC, t.updated_at DESC
  LIMIT 1;
  LIMIT 1;


  IF prefix IS NULL THEN
  IF prefix IS NULL THEN
    prefix := 'You are a strict reviewer for schema changes. Evaluate risk and compatibility.';
    prefix := 'You are a strict reviewer for schema changes. Evaluate risk and compatibility.';
  END IF;
  END IF;


  RETURN concat(
  RETURN concat(
    prefix, E'\n',
    prefix, E'\n',
    '必ず JSON で返答する：{judgement:"ok|ng", reasons:[...], recommended_actions:[...]}', E'\n',
    '必ず JSON で返答する：{judgement:"ok|ng", reasons:[...], recommended_actions:[...]}', E'\n',
    '--- domain --- ', COALESCE(p_domain, 'unknown'), E'\n',
    '--- domain --- ', COALESCE(p_domain, 'unknown'), E'\n',
    '--- schema_name --- ', p_schema_name, E'\n',
    '--- schema_name --- ', p_schema_name, E'\n',
    '--- diff_summary --- ', p_diff_summary
    '--- diff_summary --- ', p_diff_summary
  );
  );
END;
END;
$$;
$$;




--
--
-- Name: enqueue_schema_ai_review(); Type: FUNCTION; Schema: ci; Owner: -
-- Name: enqueue_schema_ai_review(); Type: FUNCTION; Schema: ci; Owner: -
--
--


CREATE FUNCTION ci.enqueue_schema_ai_review() RETURNS trigger
CREATE FUNCTION ci.enqueue_schema_ai_review() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  p text;
  p text;
BEGIN
BEGIN
  p := ci.build_schema_review_prompt(NEW.domain, NEW.schema_name, NEW.diff_summary);
  p := ci.build_schema_review_prompt(NEW.domain, NEW.schema_name, NEW.diff_summary);


  INSERT INTO ci.schema_ai_review_job (request_id, prompt)
  INSERT INTO ci.schema_ai_review_job (request_id, prompt)
  VALUES (NEW.request_id, p)
  VALUES (NEW.request_id, p)
  ON CONFLICT (request_id) DO NOTHING;
  ON CONFLICT (request_id) DO NOTHING;


  RETURN NEW;
  RETURN NEW;
END;
END;
$$;
$$;




--
--
-- Name: reject_schema_change(uuid, text, text); Type: FUNCTION; Schema: ci; Owner: -
-- Name: reject_schema_change(uuid, text, text); Type: FUNCTION; Schema: ci; Owner: -
--
--


CREATE FUNCTION ci.reject_schema_change(p_request_id uuid, p_rejected_by text, p_reason text) RETURNS void
CREATE FUNCTION ci.reject_schema_change(p_request_id uuid, p_rejected_by text, p_reason text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  UPDATE ci.schema_change_request
  UPDATE ci.schema_change_request
     SET status = 'rejected',
     SET status = 'rejected',
         approved_by = p_rejected_by,
         approved_by = p_rejected_by,
         approved_at = now()
         approved_at = now()
   WHERE request_id = p_request_id
   WHERE request_id = p_request_id
     AND status = 'pending';
     AND status = 'pending';


  IF to_regclass('audit.audit_trail') IS NOT NULL THEN
  IF to_regclass('audit.audit_trail') IS NOT NULL THEN
    INSERT INTO audit.audit_trail
    INSERT INTO audit.audit_trail
      (company_id, entity_type, entity_id, action, detail, performed_by, performed_at)
      (company_id, entity_type, entity_id, action, detail, performed_by, performed_at)
    VALUES
    VALUES
      (NULL, 'schema', p_request_id, 'reject',
      (NULL, 'schema', p_request_id, 'reject',
       jsonb_build_object('by', p_rejected_by, 'reason', p_reason),
       jsonb_build_object('by', p_rejected_by, 'reason', p_reason),
       p_rejected_by, now());
       p_rejected_by, now());
  END IF;
  END IF;
END;
END;
$$;
$$;




--
--
-- Name: try_write_audit_trail(uuid, text, jsonb); Type: FUNCTION; Schema: ci; Owner: -
-- Name: try_write_audit_trail(uuid, text, jsonb); Type: FUNCTION; Schema: ci; Owner: -
--
--


CREATE FUNCTION ci.try_write_audit_trail(p_entity_id uuid, p_action text, p_detail jsonb) RETURNS void
CREATE FUNCTION ci.try_write_audit_trail(p_entity_id uuid, p_action text, p_detail jsonb) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $_$
    AS $_$
BEGIN
BEGIN
  IF to_regclass('audit.audit_trail') IS NOT NULL THEN
  IF to_regclass('audit.audit_trail') IS NOT NULL THEN
    EXECUTE $SQL$
    EXECUTE $SQL$
      INSERT INTO audit.audit_trail
      INSERT INTO audit.audit_trail
      (company_id, entity_type, entity_id, action, detail, performed_by, performed_at)
      (company_id, entity_type, entity_id, action, detail, performed_by, performed_at)
      VALUES
      VALUES
      (NULL, 'schema', $1, $2, $3, 'system', now())
      (NULL, 'schema', $1, $2, $3, 'system', now())
    $SQL$ USING p_entity_id, p_action, p_detail;
    $SQL$ USING p_entity_id, p_action, p_detail;
  END IF;
  END IF;
END;
END;
$_$;
$_$;




--
--
-- Name: fn_audit_entity_id_order_detail(bigint); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_audit_entity_id_order_detail(bigint); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_audit_entity_id_order_detail(p_order_detail_id bigint) RETURNS text
CREATE FUNCTION core.fn_audit_entity_id_order_detail(p_order_detail_id bigint) RETURNS text
    LANGUAGE sql IMMUTABLE
    LANGUAGE sql IMMUTABLE
    AS $$
    AS $$
  SELECT p_order_detail_id::text
  SELECT p_order_detail_id::text
$$;
$$;




--
--
-- Name: fn_audit_entity_id_order_header(bigint); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_audit_entity_id_order_header(bigint); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_audit_entity_id_order_header(p_order_id bigint) RETURNS text
CREATE FUNCTION core.fn_audit_entity_id_order_header(p_order_id bigint) RETURNS text
    LANGUAGE sql IMMUTABLE
    LANGUAGE sql IMMUTABLE
    AS $$
    AS $$
  SELECT p_order_id::text
  SELECT p_order_id::text
$$;
$$;




--
--
-- Name: fn_audit_trail(); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_audit_trail(); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_audit_trail() RETURNS trigger
CREATE FUNCTION core.fn_audit_trail() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
DECLARE
DECLARE
  v_action text;
  v_action text;
  v_entity_id text;
  v_entity_id text;
  v_detail jsonb;
  v_detail jsonb;
BEGIN
BEGIN
  IF TG_OP = 'INSERT' THEN
  IF TG_OP = 'INSERT' THEN
    v_action := 'INSERT';
    v_action := 'INSERT';
    v_entity_id := NEW.*::jsonb ->> (TG_TABLE_NAME || '_id');
    v_entity_id := NEW.*::jsonb ->> (TG_TABLE_NAME || '_id');
    v_detail := jsonb_build_object(
    v_detail := jsonb_build_object(
      'after', to_jsonb(NEW)
      'after', to_jsonb(NEW)
    );
    );


  ELSIF TG_OP = 'UPDATE' THEN
  ELSIF TG_OP = 'UPDATE' THEN
    v_action := 'UPDATE';
    v_action := 'UPDATE';
    v_entity_id := NEW.*::jsonb ->> (TG_TABLE_NAME || '_id');
    v_entity_id := NEW.*::jsonb ->> (TG_TABLE_NAME || '_id');
    v_detail := jsonb_build_object(
    v_detail := jsonb_build_object(
      'before', to_jsonb(OLD),
      'before', to_jsonb(OLD),
      'after',  to_jsonb(NEW)
      'after',  to_jsonb(NEW)
    );
    );


  ELSIF TG_OP = 'DELETE' THEN
  ELSIF TG_OP = 'DELETE' THEN
    v_action := 'DELETE';
    v_action := 'DELETE';
    v_entity_id := OLD.*::jsonb ->> (TG_TABLE_NAME || '_id');
    v_entity_id := OLD.*::jsonb ->> (TG_TABLE_NAME || '_id');
    v_detail := jsonb_build_object(
    v_detail := jsonb_build_object(
      'before', to_jsonb(OLD)
      'before', to_jsonb(OLD)
    );
    );
  END IF;
  END IF;


  INSERT INTO core.audit_trail (
  INSERT INTO core.audit_trail (
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
  )
  )
  VALUES (
  VALUES (
    COALESCE(
    COALESCE(
      (NEW.*::jsonb ->> 'company_id')::uuid,
      (NEW.*::jsonb ->> 'company_id')::uuid,
      (OLD.*::jsonb ->> 'company_id')::uuid
      (OLD.*::jsonb ->> 'company_id')::uuid
    ),
    ),
    TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME,
    TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME,
    v_entity_id,
    v_entity_id,
    v_action,
    v_action,
    v_detail,
    v_detail,
    auth.uid(),
    auth.uid(),
    now()
    now()
  );
  );


  RETURN NULL;
  RETURN NULL;
END;
END;
$$;
$$;




--
--
-- Name: fn_calc_audit_impact(uuid, text, text, jsonb); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_calc_audit_impact(uuid, text, text, jsonb); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_calc_audit_impact(p_company_id uuid, p_entity_type text, p_action text, p_detail jsonb) RETURNS numeric
CREATE FUNCTION core.fn_calc_audit_impact(p_company_id uuid, p_entity_type text, p_action text, p_detail jsonb) RETURNS numeric
    LANGUAGE plpgsql STABLE
    LANGUAGE plpgsql STABLE
    AS $$
    AS $$
DECLARE
DECLARE
  v_base numeric := 1.0;
  v_base numeric := 1.0;
  v_col_count int := 0;
  v_col_count int := 0;
  v_size_factor numeric := 1.0;
  v_size_factor numeric := 1.0;
  v_before jsonb;
  v_before jsonb;
  v_after jsonb;
  v_after jsonb;
BEGIN
BEGIN
  SELECT r.base_weight
  SELECT r.base_weight
  INTO v_base
  INTO v_base
  FROM core.audit_impact_rule r
  FROM core.audit_impact_rule r
  WHERE r.is_active
  WHERE r.is_active
    AND r.action = p_action
    AND r.action = p_action
    AND p_entity_type LIKE r.entity_type_like
    AND p_entity_type LIKE r.entity_type_like
    AND (r.company_id IS NULL OR r.company_id = p_company_id)
    AND (r.company_id IS NULL OR r.company_id = p_company_id)
  ORDER BY (r.company_id IS NULL), r.priority
  ORDER BY (r.company_id IS NULL), r.priority
  LIMIT 1;
  LIMIT 1;


  v_before := COALESCE(p_detail->'before','{}'::jsonb);
  v_before := COALESCE(p_detail->'before','{}'::jsonb);
  v_after  := COALESCE(p_detail->'after','{}'::jsonb);
  v_after  := COALESCE(p_detail->'after','{}'::jsonb);


  IF p_action = 'UPDATE' THEN
  IF p_action = 'UPDATE' THEN
    SELECT count(*) INTO v_col_count
    SELECT count(*) INTO v_col_count
    FROM jsonb_object_keys(v_after) k
    FROM jsonb_object_keys(v_after) k
    WHERE (v_before->k) IS DISTINCT FROM (v_after->k);
    WHERE (v_before->k) IS DISTINCT FROM (v_after->k);
  ELSE
  ELSE
    v_col_count := GREATEST(
    v_col_count := GREATEST(
      jsonb_object_length(v_before),
      jsonb_object_length(v_before),
      jsonb_object_length(v_after)
      jsonb_object_length(v_after)
    );
    );
  END IF;
  END IF;


  v_size_factor :=
  v_size_factor :=
    1.0 + LEAST(5.0, octet_length(p_detail::text)::numeric / 2000.0);
    1.0 + LEAST(5.0, octet_length(p_detail::text)::numeric / 2000.0);


  RETURN round(
  RETURN round(
    COALESCE(v_base,1.0)
    COALESCE(v_base,1.0)
    * (1.0 + 0.15 * v_col_count)
    * (1.0 + 0.15 * v_col_count)
    * v_size_factor
    * v_size_factor
  ,4);
  ,4);
END;
END;
$$;
$$;




--
--
-- Name: fn_drop_old_audit_partitions(interval); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_drop_old_audit_partitions(interval); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_drop_old_audit_partitions(p_keep_interval interval DEFAULT '7 years'::interval) RETURNS void
CREATE FUNCTION core.fn_drop_old_audit_partitions(p_keep_interval interval DEFAULT '7 years'::interval) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  r record;
  r record;
BEGIN
BEGIN
  FOR r IN
  FOR r IN
    SELECT inhrelid::regclass AS partition_name
    SELECT inhrelid::regclass AS partition_name
    FROM pg_inherits
    FROM pg_inherits
    JOIN pg_class parent ON pg_inherits.inhparent = parent.oid
    JOIN pg_class parent ON pg_inherits.inhparent = parent.oid
    WHERE parent.relname = 'audit_trail'
    WHERE parent.relname = 'audit_trail'
  LOOP
  LOOP
    IF r.partition_name::text <
    IF r.partition_name::text <
       format('core.audit_trail_%s',
       format('core.audit_trail_%s',
              to_char(now() - p_keep_interval, 'YYYY_MM')) THEN
              to_char(now() - p_keep_interval, 'YYYY_MM')) THEN
      EXECUTE format('DROP TABLE IF EXISTS %s', r.partition_name);
      EXECUTE format('DROP TABLE IF EXISTS %s', r.partition_name);
    END IF;
    END IF;
  END LOOP;
  END LOOP;
END;
END;
$$;
$$;




--
--
-- Name: fn_ensure_audit_trail_monthly_partitions(integer, integer); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_ensure_audit_trail_monthly_partitions(integer, integer); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_ensure_audit_trail_monthly_partitions(p_months_back integer DEFAULT 1, p_months_ahead integer DEFAULT 6) RETURNS void
CREATE FUNCTION core.fn_ensure_audit_trail_monthly_partitions(p_months_back integer DEFAULT 1, p_months_ahead integer DEFAULT 6) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  d date;
  d date;
  d_start date;
  d_start date;
  d_end date;
  d_end date;
  part_name text;
  part_name text;
BEGIN
BEGIN
  d_start := date_trunc('month', now())::date
  d_start := date_trunc('month', now())::date
             - make_interval(months => p_months_back);
             - make_interval(months => p_months_back);
  d_end   := date_trunc('month', now())::date
  d_end   := date_trunc('month', now())::date
             + make_interval(months => p_months_ahead);
             + make_interval(months => p_months_ahead);


  d := d_start;
  d := d_start;


  WHILE d <= d_end LOOP
  WHILE d <= d_end LOOP
    part_name := format('audit_trail_%s', to_char(d, 'YYYY_MM'));
    part_name := format('audit_trail_%s', to_char(d, 'YYYY_MM'));


    IF to_regclass(format('core.%I', part_name)) IS NULL THEN
    IF to_regclass(format('core.%I', part_name)) IS NULL THEN
      EXECUTE format(
      EXECUTE format(
        'CREATE TABLE core.%I PARTITION OF core.audit_trail
        'CREATE TABLE core.%I PARTITION OF core.audit_trail
         FOR VALUES FROM (%L) TO (%L);',
         FOR VALUES FROM (%L) TO (%L);',
        part_name,
        part_name,
        d,
        d,
        (d + interval '1 month')
        (d + interval '1 month')
      );
      );
    END IF;
    END IF;


    d := (d + interval '1 month')::date;
    d := (d + interval '1 month')::date;
  END LOOP;
  END LOOP;
END;
END;
$$;
$$;




--
--
-- Name: fn_insert_audit_trail(uuid, text, text, text, text, jsonb, uuid); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_insert_audit_trail(uuid, text, text, text, text, jsonb, uuid); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_insert_audit_trail(p_company_id uuid, p_entity_type text, p_entity_id text, p_action text, p_action_category text, p_detail jsonb, p_performed_by uuid) RETURNS void
CREATE FUNCTION core.fn_insert_audit_trail(p_company_id uuid, p_entity_type text, p_entity_id text, p_action text, p_action_category text, p_detail jsonb, p_performed_by uuid) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
BEGIN
BEGIN
  INSERT INTO core.audit_trail (
  INSERT INTO core.audit_trail (
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
  )
  )
  VALUES (
  VALUES (
    p_company_id,
    p_company_id,
    p_entity_type,
    p_entity_type,
    p_entity_id,
    p_entity_id,
    p_action,
    p_action,
    p_action_category,
    p_action_category,
    COALESCE(p_detail, '{}'::jsonb),
    COALESCE(p_detail, '{}'::jsonb),
    p_performed_by,
    p_performed_by,
    now()
    now()
  );
  );
END;
END;
$$;
$$;




--
--
-- Name: fn_jsonb_changed_pairs(jsonb, jsonb); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_jsonb_changed_pairs(jsonb, jsonb); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_jsonb_changed_pairs(old_j jsonb, new_j jsonb) RETURNS jsonb
CREATE FUNCTION core.fn_jsonb_changed_pairs(old_j jsonb, new_j jsonb) RETURNS jsonb
    LANGUAGE sql IMMUTABLE
    LANGUAGE sql IMMUTABLE
    AS $$
    AS $$
  SELECT COALESCE(
  SELECT COALESCE(
    jsonb_object_agg(
    jsonb_object_agg(
      k,
      k,
      jsonb_build_object('before', v_old, 'after', v_new)
      jsonb_build_object('before', v_old, 'after', v_new)
    ),
    ),
    '{}'::jsonb
    '{}'::jsonb
  )
  )
  FROM (
  FROM (
    SELECT
    SELECT
      COALESCE(n.key, o.key) AS k,
      COALESCE(n.key, o.key) AS k,
      o.value AS v_old,
      o.value AS v_old,
      n.value AS v_new
      n.value AS v_new
    FROM jsonb_each(COALESCE(old_j,'{}')) o
    FROM jsonb_each(COALESCE(old_j,'{}')) o
    FULL JOIN jsonb_each(COALESCE(new_j,'{}')) n
    FULL JOIN jsonb_each(COALESCE(new_j,'{}')) n
      ON n.key = o.key
      ON n.key = o.key
  ) s
  ) s
  WHERE v_old IS DISTINCT FROM v_new
  WHERE v_old IS DISTINCT FROM v_new
$$;
$$;




--
--
-- Name: fn_jsonb_diff(jsonb, jsonb); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_jsonb_diff(jsonb, jsonb); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_jsonb_diff(old_j jsonb, new_j jsonb) RETURNS jsonb
CREATE FUNCTION core.fn_jsonb_diff(old_j jsonb, new_j jsonb) RETURNS jsonb
    LANGUAGE sql IMMUTABLE
    LANGUAGE sql IMMUTABLE
    AS $$
    AS $$
  SELECT COALESCE(
  SELECT COALESCE(
    jsonb_object_agg(k, v_new),
    jsonb_object_agg(k, v_new),
    '{}'::jsonb
    '{}'::jsonb
  )
  )
  FROM (
  FROM (
    SELECT
    SELECT
      COALESCE(n.key, o.key) AS k,
      COALESCE(n.key, o.key) AS k,
      o.value AS v_old,
      o.value AS v_old,
      n.value AS v_new
      n.value AS v_new
    FROM jsonb_each(COALESCE(old_j,'{}')) o
    FROM jsonb_each(COALESCE(old_j,'{}')) o
    FULL JOIN jsonb_each(COALESCE(new_j,'{}')) n
    FULL JOIN jsonb_each(COALESCE(new_j,'{}')) n
      ON n.key = o.key
      ON n.key = o.key
  ) s
  ) s
  WHERE v_old IS DISTINCT FROM v_new
  WHERE v_old IS DISTINCT FROM v_new
$$;
$$;




--
--
-- Name: fn_log_read_event(uuid, text, text, jsonb); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_log_read_event(uuid, text, text, jsonb); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_log_read_event(p_company_id uuid, p_entity_type text, p_entity_id text, p_context jsonb DEFAULT '{}'::jsonb) RETURNS void
CREATE FUNCTION core.fn_log_read_event(p_company_id uuid, p_entity_type text, p_entity_id text, p_context jsonb DEFAULT '{}'::jsonb) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
BEGIN
BEGIN
  -- READ を audit_trail に記録
  -- READ を audit_trail に記録
  PERFORM core.fn_insert_audit_trail(
  PERFORM core.fn_insert_audit_trail(
    p_company_id,
    p_company_id,
    p_entity_type,
    p_entity_type,
    p_entity_id,
    p_entity_id,
    'SELECT',
    'SELECT',
    'READ',
    'READ',
    COALESCE(p_context, '{}'::jsonb),
    COALESCE(p_context, '{}'::jsonb),
    auth.uid()
    auth.uid()
  );
  );
END;
END;
$$;
$$;




--
--
-- Name: fn_resolve_entity_ref(text, text); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_resolve_entity_ref(text, text); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_resolve_entity_ref(p_entity_type text, p_entity_id text) RETURNS TABLE(schema_name text, table_name text, pk_value text)
CREATE FUNCTION core.fn_resolve_entity_ref(p_entity_type text, p_entity_id text) RETURNS TABLE(schema_name text, table_name text, pk_value text)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  schema_name := split_part(p_entity_type, '.', 1);
  schema_name := split_part(p_entity_type, '.', 1);
  table_name  := split_part(p_entity_type, '.', 2);
  table_name  := split_part(p_entity_type, '.', 2);
  pk_value    := p_entity_id;
  pk_value    := p_entity_id;
  RETURN NEXT;
  RETURN NEXT;
END;
END;
$$;
$$;




--
--
-- Name: fn_retention_audit_trail_partitions(integer); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_retention_audit_trail_partitions(integer); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_retention_audit_trail_partitions(p_keep_months integer DEFAULT 24) RETURNS void
CREATE FUNCTION core.fn_retention_audit_trail_partitions(p_keep_months integer DEFAULT 24) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $_$
    AS $_$
DECLARE
DECLARE
  r record;
  r record;
  part_month date;
  part_month date;
  cutoff date;
  cutoff date;
BEGIN
BEGIN
  cutoff :=
  cutoff :=
    (date_trunc('month', now())::date
    (date_trunc('month', now())::date
     - (p_keep_months || ' months')::interval)::date;
     - (p_keep_months || ' months')::interval)::date;


  FOR r IN
  FOR r IN
    SELECT relname
    SELECT relname
    FROM pg_class c
    FROM pg_class c
    JOIN pg_namespace n ON n.oid = c.relnamespace
    JOIN pg_namespace n ON n.oid = c.relnamespace
    WHERE n.nspname = 'core'
    WHERE n.nspname = 'core'
      AND c.relkind = 'r'
      AND c.relkind = 'r'
      AND relname ~ '^audit_trail_[0-9]{4}_[0-9]{2}$'
      AND relname ~ '^audit_trail_[0-9]{4}_[0-9]{2}$'
  LOOP
  LOOP
    part_month := to_date(substr(r.relname, 12, 7), 'YYYY_MM');
    part_month := to_date(substr(r.relname, 12, 7), 'YYYY_MM');


    IF part_month < cutoff THEN
    IF part_month < cutoff THEN
      EXECUTE format('DROP TABLE IF EXISTS core.%I;', r.relname);
      EXECUTE format('DROP TABLE IF EXISTS core.%I;', r.relname);
    END IF;
    END IF;
  END LOOP;
  END LOOP;
END;
END;
$_$;
$_$;




--
--
-- Name: fn_validate_reason_code(text, text); Type: FUNCTION; Schema: core; Owner: -
-- Name: fn_validate_reason_code(text, text); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.fn_validate_reason_code(p_reason_code text, p_op text) RETURNS void
CREATE FUNCTION core.fn_validate_reason_code(p_reason_code text, p_op text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  IF p_reason_code IS NULL THEN
  IF p_reason_code IS NULL THEN
    RAISE EXCEPTION 'reason_code is required';
    RAISE EXCEPTION 'reason_code is required';
  END IF;
  END IF;


  IF NOT EXISTS (
  IF NOT EXISTS (
    SELECT 1
    SELECT 1
    FROM core.reason_code_master r
    FROM core.reason_code_master r
    WHERE r.reason_code = p_reason_code
    WHERE r.reason_code = p_reason_code
      AND r.is_active
      AND r.is_active
      AND p_op = ANY (r.target_ops)
      AND p_op = ANY (r.target_ops)
      AND CURRENT_DATE BETWEEN r.valid_from
      AND CURRENT_DATE BETWEEN r.valid_from
                          AND COALESCE(r.valid_to, CURRENT_DATE)
                          AND COALESCE(r.valid_to, CURRENT_DATE)
  ) THEN
  ) THEN
    RAISE EXCEPTION
    RAISE EXCEPTION
      'invalid reason_code: %, operation: %',
      'invalid reason_code: %, operation: %',
      p_reason_code, p_op;
      p_reason_code, p_op;
  END IF;
  END IF;
END;
END;
$$;
$$;




--
--
-- Name: trg_audit_iud(); Type: FUNCTION; Schema: core; Owner: -
-- Name: trg_audit_iud(); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.trg_audit_iud() RETURNS trigger
CREATE FUNCTION core.trg_audit_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $_$
    AS $_$
DECLARE
DECLARE
  v_company_id uuid;
  v_company_id uuid;
  v_entity_type text;
  v_entity_type text;
  v_entity_id text := '';
  v_entity_id text := '';
  v_detail jsonb;
  v_detail jsonb;
  v_pk_column text;
  v_pk_column text;
  v_row record;
  v_row record;
BEGIN
BEGIN
  v_entity_type := TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME;
  v_entity_type := TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME;
  v_row := COALESCE(NEW, OLD);
  v_row := COALESCE(NEW, OLD);


  -- company_id 解決
  -- company_id 解決
  v_company_id := COALESCE(
  v_company_id := COALESCE(
    (v_row).company_id,
    (v_row).company_id,
    my_company_id()
    my_company_id()
  );
  );


  -- ===============================
  -- ===============================
  -- entity_id 解決（pk_map 優先）
  -- entity_id 解決（pk_map 優先）
  -- ===============================
  -- ===============================
  SELECT pk_column
  SELECT pk_column
  INTO v_pk_column
  INTO v_pk_column
  FROM core.audit_entity_pk_map
  FROM core.audit_entity_pk_map
  WHERE schema_name = TG_TABLE_SCHEMA
  WHERE schema_name = TG_TABLE_SCHEMA
    AND table_name  = TG_TABLE_NAME;
    AND table_name  = TG_TABLE_NAME;


  IF v_pk_column IS NOT NULL THEN
  IF v_pk_column IS NOT NULL THEN
    EXECUTE format(
    EXECUTE format(
      'SELECT ($1).%I::text',
      'SELECT ($1).%I::text',
      v_pk_column
      v_pk_column
    )
    )
    INTO v_entity_id
    INTO v_entity_id
    USING v_row;
    USING v_row;
  END IF;
  END IF;


  -- fallback: <table>_id → id
  -- fallback: <table>_id → id
  IF v_entity_id IS NULL OR v_entity_id = '' THEN
  IF v_entity_id IS NULL OR v_entity_id = '' THEN
    BEGIN
    BEGIN
      EXECUTE format(
      EXECUTE format(
        'SELECT ($1).%I::text',
        'SELECT ($1).%I::text',
        TG_TABLE_NAME || '_id'
        TG_TABLE_NAME || '_id'
      )
      )
      INTO v_entity_id
      INTO v_entity_id
      USING v_row;
      USING v_row;
    EXCEPTION WHEN undefined_column THEN
    EXCEPTION WHEN undefined_column THEN
      BEGIN
      BEGIN
        EXECUTE 'SELECT ($1).id::text'
        EXECUTE 'SELECT ($1).id::text'
        INTO v_entity_id
        INTO v_entity_id
        USING v_row;
        USING v_row;
      EXCEPTION WHEN undefined_column THEN
      EXCEPTION WHEN undefined_column THEN
        v_entity_id := '';
        v_entity_id := '';
      END;
      END;
    END;
    END;
  END IF;
  END IF;


  -- before / after
  -- before / after
  IF TG_OP = 'INSERT' THEN
  IF TG_OP = 'INSERT' THEN
    v_detail := jsonb_build_object('after', to_jsonb(NEW));
    v_detail := jsonb_build_object('after', to_jsonb(NEW));
  ELSIF TG_OP = 'UPDATE' THEN
  ELSIF TG_OP = 'UPDATE' THEN
    v_detail := jsonb_build_object('before', to_jsonb(OLD), 'after', to_jsonb(NEW));
    v_detail := jsonb_build_object('before', to_jsonb(OLD), 'after', to_jsonb(NEW));
  ELSE
  ELSE
    v_detail := jsonb_build_object('before', to_jsonb(OLD));
    v_detail := jsonb_build_object('before', to_jsonb(OLD));
  END IF;
  END IF;


  -- audit_trail 書き込み
  -- audit_trail 書き込み
  PERFORM core.fn_insert_audit_trail(
  PERFORM core.fn_insert_audit_trail(
    v_company_id,
    v_company_id,
    v_entity_type,
    v_entity_type,
    v_entity_id,
    v_entity_id,
    TG_OP,
    TG_OP,
    v_detail,
    v_detail,
    auth.uid()
    auth.uid()
  );
  );


  RETURN COALESCE(NEW, OLD);
  RETURN COALESCE(NEW, OLD);
END;
END;
$_$;
$_$;




--
--
-- Name: trg_audit_iud_compact(); Type: FUNCTION; Schema: core; Owner: -
-- Name: trg_audit_iud_compact(); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.trg_audit_iud_compact() RETURNS trigger
CREATE FUNCTION core.trg_audit_iud_compact() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  v_company_id uuid;
  v_company_id uuid;
  v_detail jsonb;
  v_detail jsonb;
BEGIN
BEGIN
  IF TG_OP = 'INSERT' THEN
  IF TG_OP = 'INSERT' THEN
    v_company_id := COALESCE(NEW.company_id, public.my_company_id());
    v_company_id := COALESCE(NEW.company_id, public.my_company_id());
    v_detail := jsonb_build_object('after', to_jsonb(NEW));
    v_detail := jsonb_build_object('after', to_jsonb(NEW));


  ELSIF TG_OP = 'UPDATE' THEN
  ELSIF TG_OP = 'UPDATE' THEN
    v_company_id := COALESCE(NEW.company_id, OLD.company_id, public.my_company_id());
    v_company_id := COALESCE(NEW.company_id, OLD.company_id, public.my_company_id());
    v_detail := core.fn_jsonb_changed_pairs(to_jsonb(OLD), to_jsonb(NEW));
    v_detail := core.fn_jsonb_changed_pairs(to_jsonb(OLD), to_jsonb(NEW));
    IF v_detail = '{}'::jsonb THEN
    IF v_detail = '{}'::jsonb THEN
      RETURN NEW;
      RETURN NEW;
    END IF;
    END IF;


  ELSE
  ELSE
    v_company_id := COALESCE(OLD.company_id, public.my_company_id());
    v_company_id := COALESCE(OLD.company_id, public.my_company_id());
    v_detail := jsonb_build_object('before', to_jsonb(OLD));
    v_detail := jsonb_build_object('before', to_jsonb(OLD));
  END IF;
  END IF;


  PERFORM core.fn_insert_audit_trail(
  PERFORM core.fn_insert_audit_trail(
    v_company_id,
    v_company_id,
    TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME,
    TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME,
    '',
    '',
    TG_OP,
    TG_OP,
    'WRITE',
    'WRITE',
    v_detail,
    v_detail,
    auth.uid()
    auth.uid()
  );
  );


  RETURN COALESCE(NEW, OLD);
  RETURN COALESCE(NEW, OLD);
END;
END;
$$;
$$;




--
--
-- Name: trg_audit_iud_compact_with_entity(); Type: FUNCTION; Schema: core; Owner: -
-- Name: trg_audit_iud_compact_with_entity(); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.trg_audit_iud_compact_with_entity() RETURNS trigger
CREATE FUNCTION core.trg_audit_iud_compact_with_entity() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  v_company_id uuid;
  v_company_id uuid;
  v_detail jsonb;
  v_detail jsonb;
  v_entity_id text := '';
  v_entity_id text := '';
BEGIN
BEGIN
  -- entity_id をテーブル別に決める（代表テーブルのみ）
  -- entity_id をテーブル別に決める（代表テーブルのみ）
  IF TG_TABLE_SCHEMA = 'sales' AND TG_TABLE_NAME = 'order_header' THEN
  IF TG_TABLE_SCHEMA = 'sales' AND TG_TABLE_NAME = 'order_header' THEN
    IF TG_OP = 'DELETE' THEN
    IF TG_OP = 'DELETE' THEN
      v_entity_id := core.fn_audit_entity_id_order_header(OLD.order_id);
      v_entity_id := core.fn_audit_entity_id_order_header(OLD.order_id);
    ELSE
    ELSE
      v_entity_id := core.fn_audit_entity_id_order_header(NEW.order_id);
      v_entity_id := core.fn_audit_entity_id_order_header(NEW.order_id);
    END IF;
    END IF;


  ELSIF TG_TABLE_SCHEMA = 'sales' AND TG_TABLE_NAME = 'order_detail' THEN
  ELSIF TG_TABLE_SCHEMA = 'sales' AND TG_TABLE_NAME = 'order_detail' THEN
    IF TG_OP = 'DELETE' THEN
    IF TG_OP = 'DELETE' THEN
      v_entity_id := core.fn_audit_entity_id_order_detail(OLD.order_detail_id);
      v_entity_id := core.fn_audit_entity_id_order_detail(OLD.order_detail_id);
    ELSE
    ELSE
      v_entity_id := core.fn_audit_entity_id_order_detail(NEW.order_detail_id);
      v_entity_id := core.fn_audit_entity_id_order_detail(NEW.order_detail_id);
    END IF;
    END IF;
  END IF;
  END IF;


  IF TG_OP = 'INSERT' THEN
  IF TG_OP = 'INSERT' THEN
    v_company_id := COALESCE(NEW.company_id, public.my_company_id());
    v_company_id := COALESCE(NEW.company_id, public.my_company_id());
    v_detail := jsonb_build_object('after', to_jsonb(NEW));
    v_detail := jsonb_build_object('after', to_jsonb(NEW));


  ELSIF TG_OP = 'UPDATE' THEN
  ELSIF TG_OP = 'UPDATE' THEN
    v_company_id := COALESCE(NEW.company_id, OLD.company_id, public.my_company_id());
    v_company_id := COALESCE(NEW.company_id, OLD.company_id, public.my_company_id());
    v_detail := core.fn_jsonb_changed_pairs(to_jsonb(OLD), to_jsonb(NEW));
    v_detail := core.fn_jsonb_changed_pairs(to_jsonb(OLD), to_jsonb(NEW));
    IF v_detail = '{}'::jsonb THEN
    IF v_detail = '{}'::jsonb THEN
      RETURN NEW;
      RETURN NEW;
    END IF;
    END IF;


  ELSE
  ELSE
    v_company_id := COALESCE(OLD.company_id, public.my_company_id());
    v_company_id := COALESCE(OLD.company_id, public.my_company_id());
    v_detail := jsonb_build_object('before', to_jsonb(OLD));
    v_detail := jsonb_build_object('before', to_jsonb(OLD));
  END IF;
  END IF;


  PERFORM core.fn_insert_audit_trail(
  PERFORM core.fn_insert_audit_trail(
    v_company_id,
    v_company_id,
    TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME,
    TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME,
    v_entity_id,
    v_entity_id,
    TG_OP,
    TG_OP,
    'WRITE',
    'WRITE',
    v_detail,
    v_detail,
    auth.uid()
    auth.uid()
  );
  );


  RETURN COALESCE(NEW, OLD);
  RETURN COALESCE(NEW, OLD);
END;
END;
$$;
$$;




--
--
-- Name: trg_audit_stmt(); Type: FUNCTION; Schema: core; Owner: -
-- Name: trg_audit_stmt(); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.trg_audit_stmt() RETURNS trigger
CREATE FUNCTION core.trg_audit_stmt() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  v_company_id uuid;
  v_company_id uuid;
  v_detail jsonb;
  v_detail jsonb;
BEGIN
BEGIN
  SELECT COALESCE(company_id, public.my_company_id())
  SELECT COALESCE(company_id, public.my_company_id())
    INTO v_company_id
    INTO v_company_id
    FROM new_rows LIMIT 1;
    FROM new_rows LIMIT 1;


  v_detail := jsonb_build_object(
  v_detail := jsonb_build_object(
    'before', (SELECT jsonb_agg(to_jsonb(t)) FROM old_rows t),
    'before', (SELECT jsonb_agg(to_jsonb(t)) FROM old_rows t),
    'after',  (SELECT jsonb_agg(to_jsonb(t)) FROM new_rows t)
    'after',  (SELECT jsonb_agg(to_jsonb(t)) FROM new_rows t)
  );
  );


  PERFORM core.fn_insert_audit_trail(
  PERFORM core.fn_insert_audit_trail(
    v_company_id,
    v_company_id,
    TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME,
    TG_TABLE_SCHEMA || '.' || TG_TABLE_NAME,
    '',
    '',
    TG_OP || '_STMT',
    TG_OP || '_STMT',
    'WRITE',
    'WRITE',
    v_detail,
    v_detail,
    auth.uid()
    auth.uid()
  );
  );


  RETURN NULL;
  RETURN NULL;
END;
END;
$$;
$$;




--
--
-- Name: trg_require_reason_code(); Type: FUNCTION; Schema: core; Owner: -
-- Name: trg_require_reason_code(); Type: FUNCTION; Schema: core; Owner: -
--
--


CREATE FUNCTION core.trg_require_reason_code() RETURNS trigger
CREATE FUNCTION core.trg_require_reason_code() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  v_reason text;
  v_reason text;
BEGIN
BEGIN
  IF TG_OP IN ('UPDATE','DELETE') THEN
  IF TG_OP IN ('UPDATE','DELETE') THEN
    v_reason := current_setting('app.reason_code', true);
    v_reason := current_setting('app.reason_code', true);
    PERFORM core.fn_validate_reason_code(v_reason, TG_OP);
    PERFORM core.fn_validate_reason_code(v_reason, TG_OP);
  END IF;
  END IF;


  RETURN COALESCE(NEW, OLD);
  RETURN COALESCE(NEW, OLD);
END;
END;
$$;
$$;




--
--
-- Name: grant_pg_cron_access(); Type: FUNCTION; Schema: extensions; Owner: -
-- Name: grant_pg_cron_access(); Type: FUNCTION; Schema: extensions; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  IF EXISTS (
  IF EXISTS (
    SELECT
    SELECT
    FROM pg_event_trigger_ddl_commands() AS ev
    FROM pg_event_trigger_ddl_commands() AS ev
    JOIN pg_extension AS ext
    JOIN pg_extension AS ext
    ON ev.objid = ext.oid
    ON ev.objid = ext.oid
    WHERE ext.extname = 'pg_cron'
    WHERE ext.extname = 'pg_cron'
  )
  )
  THEN
  THEN
    grant usage on schema cron to postgres with grant option;
    grant usage on schema cron to postgres with grant option;


    alter default privileges in schema cron grant all on tables to postgres with grant option;
    alter default privileges in schema cron grant all on tables to postgres with grant option;
    alter default privileges in schema cron grant all on functions to postgres with grant option;
    alter default privileges in schema cron grant all on functions to postgres with grant option;
    alter default privileges in schema cron grant all on sequences to postgres with grant option;
    alter default privileges in schema cron grant all on sequences to postgres with grant option;


    alter default privileges for user supabase_admin in schema cron grant all
    alter default privileges for user supabase_admin in schema cron grant all
        on sequences to postgres with grant option;
        on sequences to postgres with grant option;
    alter default privileges for user supabase_admin in schema cron grant all
    alter default privileges for user supabase_admin in schema cron grant all
        on tables to postgres with grant option;
        on tables to postgres with grant option;
    alter default privileges for user supabase_admin in schema cron grant all
    alter default privileges for user supabase_admin in schema cron grant all
        on functions to postgres with grant option;
        on functions to postgres with grant option;


    grant all privileges on all tables in schema cron to postgres with grant option;
    grant all privileges on all tables in schema cron to postgres with grant option;
    revoke all on table cron.job from postgres;
    revoke all on table cron.job from postgres;
    grant select on table cron.job to postgres with grant option;
    grant select on table cron.job to postgres with grant option;
  END IF;
  END IF;
END;
END;
$$;
$$;




--
--
-- Name: FUNCTION grant_pg_cron_access(); Type: COMMENT; Schema: extensions; Owner: -
-- Name: FUNCTION grant_pg_cron_access(); Type: COMMENT; Schema: extensions; Owner: -
--
--


COMMENT ON FUNCTION extensions.grant_pg_cron_access() IS 'Grants access to pg_cron';
COMMENT ON FUNCTION extensions.grant_pg_cron_access() IS 'Grants access to pg_cron';




--
--
-- Name: grant_pg_graphql_access(); Type: FUNCTION; Schema: extensions; Owner: -
-- Name: grant_pg_graphql_access(); Type: FUNCTION; Schema: extensions; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $_$
    AS $_$
DECLARE
DECLARE
    func_is_graphql_resolve bool;
    func_is_graphql_resolve bool;
BEGIN
BEGIN
    func_is_graphql_resolve = (
    func_is_graphql_resolve = (
        SELECT n.proname = 'resolve'
        SELECT n.proname = 'resolve'
        FROM pg_event_trigger_ddl_commands() AS ev
        FROM pg_event_trigger_ddl_commands() AS ev
        LEFT JOIN pg_catalog.pg_proc AS n
        LEFT JOIN pg_catalog.pg_proc AS n
        ON ev.objid = n.oid
        ON ev.objid = n.oid
    );
    );


    IF func_is_graphql_resolve
    IF func_is_graphql_resolve
    THEN
    THEN
        -- Update public wrapper to pass all arguments through to the pg_graphql resolve func
        -- Update public wrapper to pass all arguments through to the pg_graphql resolve func
        DROP FUNCTION IF EXISTS graphql_public.graphql;
        DROP FUNCTION IF EXISTS graphql_public.graphql;
        create or replace function graphql_public.graphql(
        create or replace function graphql_public.graphql(
            "operationName" text default null,
            "operationName" text default null,
            query text default null,
            query text default null,
            variables jsonb default null,
            variables jsonb default null,
            extensions jsonb default null
            extensions jsonb default null
        )
        )
            returns jsonb
            returns jsonb
            language sql
            language sql
        as $$
        as $$
            select graphql.resolve(
            select graphql.resolve(
                query := query,
                query := query,
                variables := coalesce(variables, '{}'),
                variables := coalesce(variables, '{}'),
                "operationName" := "operationName",
                "operationName" := "operationName",
                extensions := extensions
                extensions := extensions
            );
            );
        $$;
        $$;


        -- This hook executes when `graphql.resolve` is created. That is not necessarily the last
        -- This hook executes when `graphql.resolve` is created. That is not necessarily the last
        -- function in the extension so we need to grant permissions on existing entities AND
        -- function in the extension so we need to grant permissions on existing entities AND
        -- update default permissions to any others that are created after `graphql.resolve`
        -- update default permissions to any others that are created after `graphql.resolve`
        grant usage on schema graphql to postgres, anon, authenticated, service_role;
        grant usage on schema graphql to postgres, anon, authenticated, service_role;
        grant select on all tables in schema graphql to postgres, anon, authenticated, service_role;
        grant select on all tables in schema graphql to postgres, anon, authenticated, service_role;
        grant execute on all functions in schema graphql to postgres, anon, authenticated, service_role;
        grant execute on all functions in schema graphql to postgres, anon, authenticated, service_role;
        grant all on all sequences in schema graphql to postgres, anon, authenticated, service_role;
        grant all on all sequences in schema graphql to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on tables to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on tables to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on functions to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on functions to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on sequences to postgres, anon, authenticated, service_role;
        alter default privileges in schema graphql grant all on sequences to postgres, anon, authenticated, service_role;


        -- Allow postgres role to allow granting usage on graphql and graphql_public schemas to custom roles
        -- Allow postgres role to allow granting usage on graphql and graphql_public schemas to custom roles
        grant usage on schema graphql_public to postgres with grant option;
        grant usage on schema graphql_public to postgres with grant option;
        grant usage on schema graphql to postgres with grant option;
        grant usage on schema graphql to postgres with grant option;
    END IF;
    END IF;


END;
END;
$_$;
$_$;




--
--
-- Name: FUNCTION grant_pg_graphql_access(); Type: COMMENT; Schema: extensions; Owner: -
-- Name: FUNCTION grant_pg_graphql_access(); Type: COMMENT; Schema: extensions; Owner: -
--
--


COMMENT ON FUNCTION extensions.grant_pg_graphql_access() IS 'Grants access to pg_graphql';
COMMENT ON FUNCTION extensions.grant_pg_graphql_access() IS 'Grants access to pg_graphql';




--
--
-- Name: grant_pg_net_access(); Type: FUNCTION; Schema: extensions; Owner: -
-- Name: grant_pg_net_access(); Type: FUNCTION; Schema: extensions; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  IF EXISTS (
  IF EXISTS (
    SELECT 1
    SELECT 1
    FROM pg_event_trigger_ddl_commands() AS ev
    FROM pg_event_trigger_ddl_commands() AS ev
    JOIN pg_extension AS ext
    JOIN pg_extension AS ext
    ON ev.objid = ext.oid
    ON ev.objid = ext.oid
    WHERE ext.extname = 'pg_net'
    WHERE ext.extname = 'pg_net'
  )
  )
  THEN
  THEN
    IF NOT EXISTS (
    IF NOT EXISTS (
      SELECT 1
      SELECT 1
      FROM pg_roles
      FROM pg_roles
      WHERE rolname = 'supabase_functions_admin'
      WHERE rolname = 'supabase_functions_admin'
    )
    )
    THEN
    THEN
      CREATE USER supabase_functions_admin NOINHERIT CREATEROLE LOGIN NOREPLICATION;
      CREATE USER supabase_functions_admin NOINHERIT CREATEROLE LOGIN NOREPLICATION;
    END IF;
    END IF;


    GRANT USAGE ON SCHEMA net TO supabase_functions_admin, postgres, anon, authenticated, service_role;
    GRANT USAGE ON SCHEMA net TO supabase_functions_admin, postgres, anon, authenticated, service_role;


    IF EXISTS (
    IF EXISTS (
      SELECT FROM pg_extension
      SELECT FROM pg_extension
      WHERE extname = 'pg_net'
      WHERE extname = 'pg_net'
      -- all versions in use on existing projects as of 2025-02-20
      -- all versions in use on existing projects as of 2025-02-20
      -- version 0.12.0 onwards don't need these applied
      -- version 0.12.0 onwards don't need these applied
      AND extversion IN ('0.2', '0.6', '0.7', '0.7.1', '0.8', '0.10.0', '0.11.0')
      AND extversion IN ('0.2', '0.6', '0.7', '0.7.1', '0.8', '0.10.0', '0.11.0')
    ) THEN
    ) THEN
      ALTER function net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) SECURITY DEFINER;
      ALTER function net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) SECURITY DEFINER;
      ALTER function net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) SECURITY DEFINER;
      ALTER function net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) SECURITY DEFINER;


      ALTER function net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) SET search_path = net;
      ALTER function net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) SET search_path = net;
      ALTER function net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) SET search_path = net;
      ALTER function net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) SET search_path = net;


      REVOKE ALL ON FUNCTION net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) FROM PUBLIC;
      REVOKE ALL ON FUNCTION net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) FROM PUBLIC;
      REVOKE ALL ON FUNCTION net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) FROM PUBLIC;
      REVOKE ALL ON FUNCTION net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) FROM PUBLIC;


      GRANT EXECUTE ON FUNCTION net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) TO supabase_functions_admin, postgres, anon, authenticated, service_role;
      GRANT EXECUTE ON FUNCTION net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) TO supabase_functions_admin, postgres, anon, authenticated, service_role;
      GRANT EXECUTE ON FUNCTION net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) TO supabase_functions_admin, postgres, anon, authenticated, service_role;
      GRANT EXECUTE ON FUNCTION net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) TO supabase_functions_admin, postgres, anon, authenticated, service_role;
    END IF;
    END IF;
  END IF;
  END IF;
END;
END;
$$;
$$;




--
--
-- Name: FUNCTION grant_pg_net_access(); Type: COMMENT; Schema: extensions; Owner: -
-- Name: FUNCTION grant_pg_net_access(); Type: COMMENT; Schema: extensions; Owner: -
--
--


COMMENT ON FUNCTION extensions.grant_pg_net_access() IS 'Grants access to pg_net';
COMMENT ON FUNCTION extensions.grant_pg_net_access() IS 'Grants access to pg_net';




--
--
-- Name: pgrst_ddl_watch(); Type: FUNCTION; Schema: extensions; Owner: -
-- Name: pgrst_ddl_watch(); Type: FUNCTION; Schema: extensions; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  cmd record;
  cmd record;
BEGIN
BEGIN
  FOR cmd IN SELECT * FROM pg_event_trigger_ddl_commands()
  FOR cmd IN SELECT * FROM pg_event_trigger_ddl_commands()
  LOOP
  LOOP
    IF cmd.command_tag IN (
    IF cmd.command_tag IN (
      'CREATE SCHEMA', 'ALTER SCHEMA'
      'CREATE SCHEMA', 'ALTER SCHEMA'
    , 'CREATE TABLE', 'CREATE TABLE AS', 'SELECT INTO', 'ALTER TABLE'
    , 'CREATE TABLE', 'CREATE TABLE AS', 'SELECT INTO', 'ALTER TABLE'
    , 'CREATE FOREIGN TABLE', 'ALTER FOREIGN TABLE'
    , 'CREATE FOREIGN TABLE', 'ALTER FOREIGN TABLE'
    , 'CREATE VIEW', 'ALTER VIEW'
    , 'CREATE VIEW', 'ALTER VIEW'
    , 'CREATE MATERIALIZED VIEW', 'ALTER MATERIALIZED VIEW'
    , 'CREATE MATERIALIZED VIEW', 'ALTER MATERIALIZED VIEW'
    , 'CREATE FUNCTION', 'ALTER FUNCTION'
    , 'CREATE FUNCTION', 'ALTER FUNCTION'
    , 'CREATE TRIGGER'
    , 'CREATE TRIGGER'
    , 'CREATE TYPE', 'ALTER TYPE'
    , 'CREATE TYPE', 'ALTER TYPE'
    , 'CREATE RULE'
    , 'CREATE RULE'
    , 'COMMENT'
    , 'COMMENT'
    )
    )
    -- don't notify in case of CREATE TEMP table or other objects created on pg_temp
    -- don't notify in case of CREATE TEMP table or other objects created on pg_temp
    AND cmd.schema_name is distinct from 'pg_temp'
    AND cmd.schema_name is distinct from 'pg_temp'
    THEN
    THEN
      NOTIFY pgrst, 'reload schema';
      NOTIFY pgrst, 'reload schema';
    END IF;
    END IF;
  END LOOP;
  END LOOP;
END; $$;
END; $$;




--
--
-- Name: pgrst_drop_watch(); Type: FUNCTION; Schema: extensions; Owner: -
-- Name: pgrst_drop_watch(); Type: FUNCTION; Schema: extensions; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  obj record;
  obj record;
BEGIN
BEGIN
  FOR obj IN SELECT * FROM pg_event_trigger_dropped_objects()
  FOR obj IN SELECT * FROM pg_event_trigger_dropped_objects()
  LOOP
  LOOP
    IF obj.object_type IN (
    IF obj.object_type IN (
      'schema'
      'schema'
    , 'table'
    , 'table'
    , 'foreign table'
    , 'foreign table'
    , 'view'
    , 'view'
    , 'materialized view'
    , 'materialized view'
    , 'function'
    , 'function'
    , 'trigger'
    , 'trigger'
    , 'type'
    , 'type'
    , 'rule'
    , 'rule'
    )
    )
    AND obj.is_temporary IS false -- no pg_temp objects
    AND obj.is_temporary IS false -- no pg_temp objects
    THEN
    THEN
      NOTIFY pgrst, 'reload schema';
      NOTIFY pgrst, 'reload schema';
    END IF;
    END IF;
  END LOOP;
  END LOOP;
END; $$;
END; $$;




--
--
-- Name: set_graphql_placeholder(); Type: FUNCTION; Schema: extensions; Owner: -
-- Name: set_graphql_placeholder(); Type: FUNCTION; Schema: extensions; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $_$
    AS $_$
    DECLARE
    DECLARE
    graphql_is_dropped bool;
    graphql_is_dropped bool;
    BEGIN
    BEGIN
    graphql_is_dropped = (
    graphql_is_dropped = (
        SELECT ev.schema_name = 'graphql_public'
        SELECT ev.schema_name = 'graphql_public'
        FROM pg_event_trigger_dropped_objects() AS ev
        FROM pg_event_trigger_dropped_objects() AS ev
        WHERE ev.schema_name = 'graphql_public'
        WHERE ev.schema_name = 'graphql_public'
    );
    );


    IF graphql_is_dropped
    IF graphql_is_dropped
    THEN
    THEN
        create or replace function graphql_public.graphql(
        create or replace function graphql_public.graphql(
            "operationName" text default null,
            "operationName" text default null,
            query text default null,
            query text default null,
            variables jsonb default null,
            variables jsonb default null,
            extensions jsonb default null
            extensions jsonb default null
        )
        )
            returns jsonb
            returns jsonb
            language plpgsql
            language plpgsql
        as $$
        as $$
            DECLARE
            DECLARE
                server_version float;
                server_version float;
            BEGIN
            BEGIN
                server_version = (SELECT (SPLIT_PART((select version()), ' ', 2))::float);
                server_version = (SELECT (SPLIT_PART((select version()), ' ', 2))::float);


                IF server_version >= 14 THEN
                IF server_version >= 14 THEN
                    RETURN jsonb_build_object(
                    RETURN jsonb_build_object(
                        'errors', jsonb_build_array(
                        'errors', jsonb_build_array(
                            jsonb_build_object(
                            jsonb_build_object(
                                'message', 'pg_graphql extension is not enabled.'
                                'message', 'pg_graphql extension is not enabled.'
                            )
                            )
                        )
                        )
                    );
                    );
                ELSE
                ELSE
                    RETURN jsonb_build_object(
                    RETURN jsonb_build_object(
                        'errors', jsonb_build_array(
                        'errors', jsonb_build_array(
                            jsonb_build_object(
                            jsonb_build_object(
                                'message', 'pg_graphql is only available on projects running Postgres 14 onwards.'
                                'message', 'pg_graphql is only available on projects running Postgres 14 onwards.'
                            )
                            )
                        )
                        )
                    );
                    );
                END IF;
                END IF;
            END;
            END;
        $$;
        $$;
    END IF;
    END IF;


    END;
    END;
$_$;
$_$;




--
--
-- Name: FUNCTION set_graphql_placeholder(); Type: COMMENT; Schema: extensions; Owner: -
-- Name: FUNCTION set_graphql_placeholder(); Type: COMMENT; Schema: extensions; Owner: -
--
--


COMMENT ON FUNCTION extensions.set_graphql_placeholder() IS 'Reintroduces placeholder function for graphql_public.graphql';
COMMENT ON FUNCTION extensions.set_graphql_placeholder() IS 'Reintroduces placeholder function for graphql_public.graphql';




--
--
-- Name: fn_enqueue_audit_export(interval); Type: FUNCTION; Schema: integration; Owner: -
-- Name: fn_enqueue_audit_export(interval); Type: FUNCTION; Schema: integration; Owner: -
--
--


CREATE FUNCTION integration.fn_enqueue_audit_export(p_range interval DEFAULT '1 day'::interval) RETURNS void
CREATE FUNCTION integration.fn_enqueue_audit_export(p_range interval DEFAULT '1 day'::interval) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  v_to   timestamptz := date_trunc('hour', now());
  v_to   timestamptz := date_trunc('hour', now());
  v_from timestamptz := v_to - p_range;
  v_from timestamptz := v_to - p_range;
  v_company_id uuid := public.my_company_id();
  v_company_id uuid := public.my_company_id();
BEGIN
BEGIN
  INSERT INTO integration.audit_export_queue(company_id, from_time, to_time)
  INSERT INTO integration.audit_export_queue(company_id, from_time, to_time)
  VALUES (v_company_id, v_from, v_to);
  VALUES (v_company_id, v_from, v_to);
END;
END;
$$;
$$;




--
--
-- Name: fn_enqueue_siem_audit(timestamp with time zone, timestamp with time zone, bigint); Type: FUNCTION; Schema: integration; Owner: -
-- Name: fn_enqueue_siem_audit(timestamp with time zone, timestamp with time zone, bigint); Type: FUNCTION; Schema: integration; Owner: -
--
--


CREATE FUNCTION integration.fn_enqueue_siem_audit(p_from timestamp with time zone, p_to timestamp with time zone, p_endpoint_id bigint) RETURNS void
CREATE FUNCTION integration.fn_enqueue_siem_audit(p_from timestamp with time zone, p_to timestamp with time zone, p_endpoint_id bigint) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  v_company_id uuid := my_company_id();
  v_company_id uuid := my_company_id();
BEGIN
BEGIN
  INSERT INTO integration.siem_delivery_queue(endpoint_id, company_id, audit_trail_id)
  INSERT INTO integration.siem_delivery_queue(endpoint_id, company_id, audit_trail_id)
  SELECT
  SELECT
    p_endpoint_id,
    p_endpoint_id,
    v_company_id,
    v_company_id,
    at.audit_trail_id
    at.audit_trail_id
  FROM core.audit_trail at
  FROM core.audit_trail at
  WHERE at.company_id = v_company_id
  WHERE at.company_id = v_company_id
    AND at.performed_at >= p_from
    AND at.performed_at >= p_from
    AND at.performed_at <  p_to
    AND at.performed_at <  p_to
  ON CONFLICT (endpoint_id, audit_trail_id) DO NOTHING;
  ON CONFLICT (endpoint_id, audit_trail_id) DO NOTHING;
END;
END;
$$;
$$;




--
--
-- Name: fn_enqueue_siem_recent(bigint, integer); Type: FUNCTION; Schema: integration; Owner: -
-- Name: fn_enqueue_siem_recent(bigint, integer); Type: FUNCTION; Schema: integration; Owner: -
--
--


CREATE FUNCTION integration.fn_enqueue_siem_recent(p_endpoint_id bigint, p_minutes integer DEFAULT 15) RETURNS void
CREATE FUNCTION integration.fn_enqueue_siem_recent(p_endpoint_id bigint, p_minutes integer DEFAULT 15) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  v_to   timestamptz := date_trunc('minute', now());
  v_to   timestamptz := date_trunc('minute', now());
  v_from timestamptz := v_to - make_interval(mins => p_minutes);
  v_from timestamptz := v_to - make_interval(mins => p_minutes);
BEGIN
BEGIN
  PERFORM integration.fn_enqueue_siem_audit(v_from, v_to, p_endpoint_id);
  PERFORM integration.fn_enqueue_siem_audit(v_from, v_to, p_endpoint_id);
END;
END;
$$;
$$;




--
--
-- Name: fn_siem_mark_failed(bigint, text); Type: FUNCTION; Schema: integration; Owner: -
-- Name: fn_siem_mark_failed(bigint, text); Type: FUNCTION; Schema: integration; Owner: -
--
--


CREATE FUNCTION integration.fn_siem_mark_failed(p_delivery_id bigint, p_error text) RETURNS void
CREATE FUNCTION integration.fn_siem_mark_failed(p_delivery_id bigint, p_error text) RETURNS void
    LANGUAGE sql SECURITY DEFINER
    LANGUAGE sql SECURITY DEFINER
    AS $$
    AS $$
  UPDATE integration.siem_delivery_queue
  UPDATE integration.siem_delivery_queue
  SET status='FAILED',
  SET status='FAILED',
      retry_count = retry_count + 1,
      retry_count = retry_count + 1,
      last_error = left(p_error, 2000)
      last_error = left(p_error, 2000)
  WHERE delivery_id = p_delivery_id;
  WHERE delivery_id = p_delivery_id;
$$;
$$;




--
--
-- Name: fn_siem_mark_sent(bigint); Type: FUNCTION; Schema: integration; Owner: -
-- Name: fn_siem_mark_sent(bigint); Type: FUNCTION; Schema: integration; Owner: -
--
--


CREATE FUNCTION integration.fn_siem_mark_sent(p_delivery_id bigint) RETURNS void
CREATE FUNCTION integration.fn_siem_mark_sent(p_delivery_id bigint) RETURNS void
    LANGUAGE sql SECURITY DEFINER
    LANGUAGE sql SECURITY DEFINER
    AS $$
    AS $$
  UPDATE integration.siem_delivery_queue
  UPDATE integration.siem_delivery_queue
  SET status='SENT', sent_at=now(), last_error=NULL
  SET status='SENT', sent_at=now(), last_error=NULL
  WHERE delivery_id = p_delivery_id;
  WHERE delivery_id = p_delivery_id;
$$;
$$;




--
--
-- Name: add_item_image(text, bigint, bigint, boolean, integer); Type: FUNCTION; Schema: media; Owner: -
-- Name: add_item_image(text, bigint, bigint, boolean, integer); Type: FUNCTION; Schema: media; Owner: -
--
--


CREATE FUNCTION media.add_item_image(p_item_entity_table text, p_item_id bigint, p_asset_id bigint, p_is_primary boolean DEFAULT false, p_sort_order integer DEFAULT 1) RETURNS void
CREATE FUNCTION media.add_item_image(p_item_entity_table text, p_item_id bigint, p_asset_id bigint, p_is_primary boolean DEFAULT false, p_sort_order integer DEFAULT 1) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  if coalesce(p_is_primary,false) then
  if coalesce(p_is_primary,false) then
    perform media.unset_primary(p_item_entity_table, p_item_id, 'ITEM_IMAGE');
    perform media.unset_primary(p_item_entity_table, p_item_id, 'ITEM_IMAGE');
  end if;
  end if;


  perform media.link_asset(
  perform media.link_asset(
    p_asset_id,
    p_asset_id,
    p_item_entity_table,
    p_item_entity_table,
    p_item_id,
    p_item_id,
    'ITEM_IMAGE',
    'ITEM_IMAGE',
    coalesce(p_is_primary,false),
    coalesce(p_is_primary,false),
    coalesce(p_sort_order,1)
    coalesce(p_sort_order,1)
  );
  );
end;
end;
$$;
$$;




--
--
-- Name: link_asset(bigint, text, bigint, text, boolean, integer); Type: FUNCTION; Schema: media; Owner: -
-- Name: link_asset(bigint, text, bigint, text, boolean, integer); Type: FUNCTION; Schema: media; Owner: -
--
--


CREATE FUNCTION media.link_asset(p_asset_id bigint, p_entity_table text, p_entity_id bigint, p_role text, p_is_primary boolean DEFAULT false, p_sort_order integer DEFAULT 1) RETURNS void
CREATE FUNCTION media.link_asset(p_asset_id bigint, p_entity_table text, p_entity_id bigint, p_role text, p_is_primary boolean DEFAULT false, p_sort_order integer DEFAULT 1) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  insert into media.asset_link(asset_id, entity_table, entity_id, role, is_primary, sort_order, created_by)
  insert into media.asset_link(asset_id, entity_table, entity_id, role, is_primary, sort_order, created_by)
  values (p_asset_id, p_entity_table, p_entity_id, p_role, coalesce(p_is_primary,false), coalesce(p_sort_order,1), auth.uid())
  values (p_asset_id, p_entity_table, p_entity_id, p_role, coalesce(p_is_primary,false), coalesce(p_sort_order,1), auth.uid())
  on conflict (asset_id, entity_table, entity_id, role) do update
  on conflict (asset_id, entity_table, entity_id, role) do update
    set is_primary = excluded.is_primary,
    set is_primary = excluded.is_primary,
        sort_order = excluded.sort_order;
        sort_order = excluded.sort_order;
end;
end;
$$;
$$;




--
--
-- Name: unset_primary(text, bigint, text); Type: FUNCTION; Schema: media; Owner: -
-- Name: unset_primary(text, bigint, text); Type: FUNCTION; Schema: media; Owner: -
--
--


CREATE FUNCTION media.unset_primary(p_entity_table text, p_entity_id bigint, p_role text) RETURNS void
CREATE FUNCTION media.unset_primary(p_entity_table text, p_entity_id bigint, p_role text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update media.asset_link
  update media.asset_link
     set is_primary = false
     set is_primary = false
   where entity_table = p_entity_table
   where entity_table = p_entity_table
     and entity_id   = p_entity_id
     and entity_id   = p_entity_id
     and role        = p_role
     and role        = p_role
     and is_primary  = true;
     and is_primary  = true;
end;
end;
$$;
$$;




--
--
-- Name: rpc_decide_approval(uuid, bigint, text, text, text, jsonb); Type: FUNCTION; Schema: notify; Owner: -
-- Name: rpc_decide_approval(uuid, bigint, text, text, text, jsonb); Type: FUNCTION; Schema: notify; Owner: -
--
--


CREATE FUNCTION notify.rpc_decide_approval(p_company_id uuid, p_approval_request_id bigint, p_line_user_id text, p_action text, p_note text DEFAULT NULL::text, p_payload jsonb DEFAULT '{}'::jsonb) RETURNS jsonb
CREATE FUNCTION notify.rpc_decide_approval(p_company_id uuid, p_approval_request_id bigint, p_line_user_id text, p_action text, p_note text DEFAULT NULL::text, p_payload jsonb DEFAULT '{}'::jsonb) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
declare
declare
  v_new_status text;
  v_new_status text;
begin
begin
  if p_action not in ('approve','reject') then
  if p_action not in ('approve','reject') then
    raise exception 'invalid action: %', p_action;
    raise exception 'invalid action: %', p_action;
  end if;
  end if;


  v_new_status := case
  v_new_status := case
    when p_action='approve' then 'approved'
    when p_action='approve' then 'approved'
    else 'rejected'
    else 'rejected'
  end;
  end;


  update notify.approval_request
  update notify.approval_request
     set status = v_new_status,
     set status = v_new_status,
         decided_by_line_user_id = p_line_user_id,
         decided_by_line_user_id = p_line_user_id,
         decided_at = now(),
         decided_at = now(),
         decision_note = p_note
         decision_note = p_note
   where approval_request_id = p_approval_request_id
   where approval_request_id = p_approval_request_id
     and company_id = p_company_id
     and company_id = p_company_id
     and status = 'pending';
     and status = 'pending';


  if not found then
  if not found then
    return jsonb_build_object('ok', false, 'reason', 'not_pending');
    return jsonb_build_object('ok', false, 'reason', 'not_pending');
  end if;
  end if;


  insert into notify.approval_action_log(
  insert into notify.approval_action_log(
    company_id, approval_request_id, line_user_id, action, payload
    company_id, approval_request_id, line_user_id, action, payload
  ) values (
  ) values (
    p_company_id, p_approval_request_id, p_line_user_id, p_action,
    p_company_id, p_approval_request_id, p_line_user_id, p_action,
    coalesce(p_payload,'{}'::jsonb)
    coalesce(p_payload,'{}'::jsonb)
  );
  );


  insert into notify.audit_trail(
  insert into notify.audit_trail(
    company_id, actor_line_user_id, actor, action,
    company_id, actor_line_user_id, actor, action,
    entity_type, entity_id, detail
    entity_type, entity_id, detail
  ) values (
  ) values (
    p_company_id, p_line_user_id, 'user', p_action,
    p_company_id, p_line_user_id, 'user', p_action,
    'approval_request', p_approval_request_id::text,
    'approval_request', p_approval_request_id::text,
    jsonb_build_object('note', p_note)
    jsonb_build_object('note', p_note)
  );
  );


  return jsonb_build_object('ok', true, 'status', v_new_status);
  return jsonb_build_object('ok', true, 'status', v_new_status);
end$$;
end$$;




--
--
-- Name: rpc_mark_ai_event_notified(uuid, bigint); Type: FUNCTION; Schema: notify; Owner: -
-- Name: rpc_mark_ai_event_notified(uuid, bigint); Type: FUNCTION; Schema: notify; Owner: -
--
--


CREATE FUNCTION notify.rpc_mark_ai_event_notified(p_company_id uuid, p_ai_event_id bigint) RETURNS jsonb
CREATE FUNCTION notify.rpc_mark_ai_event_notified(p_company_id uuid, p_ai_event_id bigint) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
begin
begin
  update notify.ai_event
  update notify.ai_event
     set status = 'notified'
     set status = 'notified'
   where ai_event_id = p_ai_event_id
   where ai_event_id = p_ai_event_id
     and company_id = p_company_id
     and company_id = p_company_id
     and status = 'open';
     and status = 'open';


  if not found then
  if not found then
    return jsonb_build_object('ok', false, 'reason', 'not_open');
    return jsonb_build_object('ok', false, 'reason', 'not_open');
  end if;
  end if;


  return jsonb_build_object('ok', true);
  return jsonb_build_object('ok', true);
end$$;
end$$;




--
--
-- Name: rpc_register_line_user(uuid, text, text); Type: FUNCTION; Schema: notify; Owner: -
-- Name: rpc_register_line_user(uuid, text, text); Type: FUNCTION; Schema: notify; Owner: -
--
--


CREATE FUNCTION notify.rpc_register_line_user(p_company_id uuid, p_route_key text, p_line_user_id text) RETURNS jsonb
CREATE FUNCTION notify.rpc_register_line_user(p_company_id uuid, p_route_key text, p_line_user_id text) RETURNS jsonb
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
begin
begin
  insert into notify.notification_route(
  insert into notify.notification_route(
    company_id, route_key, line_user_id, is_active
    company_id, route_key, line_user_id, is_active
  ) values (
  ) values (
    p_company_id, p_route_key, p_line_user_id, true
    p_company_id, p_route_key, p_line_user_id, true
  )
  )
  on conflict (company_id, route_key, line_user_id)
  on conflict (company_id, route_key, line_user_id)
  do update set is_active = true;
  do update set is_active = true;


  insert into notify.audit_trail(
  insert into notify.audit_trail(
    company_id, actor_line_user_id, actor, action,
    company_id, actor_line_user_id, actor, action,
    entity_type, entity_id, detail
    entity_type, entity_id, detail
  ) values (
  ) values (
    p_company_id, p_line_user_id, 'user', 'route_register',
    p_company_id, p_line_user_id, 'user', 'route_register',
    'route', p_route_key,
    'route', p_route_key,
    jsonb_build_object('line_user_id', p_line_user_id)
    jsonb_build_object('line_user_id', p_line_user_id)
  );
  );


  return jsonb_build_object('ok', true);
  return jsonb_build_object('ok', true);
end$$;
end$$;




--
--
-- Name: add_shipping_package_photo(bigint, bigint, boolean, integer); Type: FUNCTION; Schema: ops; Owner: -
-- Name: add_shipping_package_photo(bigint, bigint, boolean, integer); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.add_shipping_package_photo(p_shipping_id bigint, p_asset_id bigint, p_is_primary boolean DEFAULT false, p_sort_order integer DEFAULT 1) RETURNS void
CREATE FUNCTION ops.add_shipping_package_photo(p_shipping_id bigint, p_asset_id bigint, p_is_primary boolean DEFAULT false, p_sort_order integer DEFAULT 1) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  if coalesce(p_is_primary,false) then
  if coalesce(p_is_primary,false) then
    perform media.unset_primary('sales.shipping_header', p_shipping_id, 'PACKAGE_PHOTO');
    perform media.unset_primary('sales.shipping_header', p_shipping_id, 'PACKAGE_PHOTO');
  end if;
  end if;


  perform media.link_asset(
  perform media.link_asset(
    p_asset_id,
    p_asset_id,
    'sales.shipping_header',
    'sales.shipping_header',
    p_shipping_id,
    p_shipping_id,
    'PACKAGE_PHOTO',
    'PACKAGE_PHOTO',
    coalesce(p_is_primary,false),
    coalesce(p_is_primary,false),
    coalesce(p_sort_order,1)
    coalesce(p_sort_order,1)
  );
  );
end;
end;
$$;
$$;




--
--
-- Name: cancel_job(bigint, text); Type: FUNCTION; Schema: ops; Owner: -
-- Name: cancel_job(bigint, text); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.cancel_job(p_job_id bigint, p_reason text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION ops.cancel_job(p_job_id bigint, p_reason text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update ops.ops_job_queue
  update ops.ops_job_queue
     set status = 'CANCELLED',
     set status = 'CANCELLED',
         last_error = coalesce(p_reason, last_error),
         last_error = coalesce(p_reason, last_error),
         locked_at = null,
         locked_at = null,
         locked_by = null
         locked_by = null
   where job_id = p_job_id;
   where job_id = p_job_id;


  insert into ops.ops_job_result(job_id, result_status, result)
  insert into ops.ops_job_result(job_id, result_status, result)
  values (p_job_id, 'CANCELLED', jsonb_build_object('reason', p_reason));
  values (p_job_id, 'CANCELLED', jsonb_build_object('reason', p_reason));
end;
end;
$$;
$$;




--
--
-- Name: complete_job(bigint, jsonb); Type: FUNCTION; Schema: ops; Owner: -
-- Name: complete_job(bigint, jsonb); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.complete_job(p_job_id bigint, p_result jsonb) RETURNS void
CREATE FUNCTION ops.complete_job(p_job_id bigint, p_result jsonb) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  INSERT INTO ops.ops_job_result (
  INSERT INTO ops.ops_job_result (
    job_id,
    job_id,
    result_payload,
    result_payload,
    status,
    status,
    created_at
    created_at
  )
  )
  VALUES (
  VALUES (
    p_job_id,
    p_job_id,
    p_result,
    p_result,
    'SUCCESS',
    'SUCCESS',
    now()
    now()
  );
  );


  UPDATE ops.ops_job_queue
  UPDATE ops.ops_job_queue
     SET status      = 'SUCCESS',
     SET status      = 'SUCCESS',
         finished_at = now()
         finished_at = now()
   WHERE job_id = p_job_id;
   WHERE job_id = p_job_id;
END;
END;
$$;
$$;




--
--
-- Name: complete_job(bigint, text, jsonb); Type: FUNCTION; Schema: ops; Owner: -
-- Name: complete_job(bigint, text, jsonb); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.complete_job(p_job_id bigint, p_result_status text, p_result_detail jsonb DEFAULT '{}'::jsonb) RETURNS void
CREATE FUNCTION ops.complete_job(p_job_id bigint, p_result_status text, p_result_detail jsonb DEFAULT '{}'::jsonb) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_job ops.ops_job_queue%rowtype;
  v_job ops.ops_job_queue%rowtype;
begin
begin
  select * into v_job
  select * into v_job
    from ops.ops_job_queue
    from ops.ops_job_queue
   where job_id = p_job_id
   where job_id = p_job_id
   for update;
   for update;


  if not found then
  if not found then
    raise exception 'job_id % not found', p_job_id;
    raise exception 'job_id % not found', p_job_id;
  end if;
  end if;


  insert into ops.ops_job_result(job_id, result_status, result_detail, completed_at)
  insert into ops.ops_job_result(job_id, result_status, result_detail, completed_at)
  values (p_job_id, p_result_status, coalesce(p_result_detail,'{}'::jsonb), now())
  values (p_job_id, p_result_status, coalesce(p_result_detail,'{}'::jsonb), now())
  on conflict (job_id) do update
  on conflict (job_id) do update
    set result_status = excluded.result_status,
    set result_status = excluded.result_status,
        result_detail = excluded.result_detail,
        result_detail = excluded.result_detail,
        completed_at  = excluded.completed_at;
        completed_at  = excluded.completed_at;


  update ops.ops_job_queue
  update ops.ops_job_queue
     set status = p_result_status,
     set status = p_result_status,
         locked_at = null,
         locked_at = null,
         updated_at = now()
         updated_at = now()
   where job_id = p_job_id;
   where job_id = p_job_id;
end;
end;
$$;
$$;




--
--
-- Name: complete_notification(bigint, boolean, text); Type: FUNCTION; Schema: ops; Owner: -
-- Name: complete_notification(bigint, boolean, text); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.complete_notification(p_outbox_id bigint, p_ok boolean, p_error text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION ops.complete_notification(p_outbox_id bigint, p_ok boolean, p_error text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  if coalesce(p_ok,false) then
  if coalesce(p_ok,false) then
    update ops.notification_outbox
    update ops.notification_outbox
       set status='SENT',
       set status='SENT',
           sent_at=now(),
           sent_at=now(),
           last_error=null
           last_error=null
     where outbox_id=p_outbox_id;
     where outbox_id=p_outbox_id;
  else
  else
    update ops.notification_outbox
    update ops.notification_outbox
       set status='PENDING',
       set status='PENDING',
           retry_count=retry_count+1,
           retry_count=retry_count+1,
           last_error=left(coalesce(p_error,'unknown'), 2000)
           last_error=left(coalesce(p_error,'unknown'), 2000)
     where outbox_id=p_outbox_id;
     where outbox_id=p_outbox_id;
    -- 失敗が上限に達したら FAILED に固定
    -- 失敗が上限に達したら FAILED に固定
    update ops.notification_outbox
    update ops.notification_outbox
       set status='FAILED'
       set status='FAILED'
     where outbox_id=p_outbox_id
     where outbox_id=p_outbox_id
       and retry_count >= max_retry;
       and retry_count >= max_retry;
  end if;
  end if;
end;
end;
$$;
$$;




--
--
-- Name: dequeue_jobs(text, integer); Type: FUNCTION; Schema: ops; Owner: -
-- Name: dequeue_jobs(text, integer); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.dequeue_jobs(p_worker text, p_limit integer DEFAULT 1) RETURNS TABLE(job_id bigint, job_type text, payload jsonb, attempts integer, max_attempts integer)
CREATE FUNCTION ops.dequeue_jobs(p_worker text, p_limit integer DEFAULT 1) RETURNS TABLE(job_id bigint, job_type text, payload jsonb, attempts integer, max_attempts integer)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  return query
  return query
  with picked as (
  with picked as (
    select q.job_id
    select q.job_id
    from ops.ops_job_queue q
    from ops.ops_job_queue q
    where q.status = 'PENDING'
    where q.status = 'PENDING'
      and q.run_after <= now()
      and q.run_after <= now()
      and q.locked_at is null
      and q.locked_at is null
    order by q.priority asc, q.job_id asc
    order by q.priority asc, q.job_id asc
    for update skip locked
    for update skip locked
    limit greatest(p_limit, 1)
    limit greatest(p_limit, 1)
  )
  )
  update ops.ops_job_queue q
  update ops.ops_job_queue q
     set status   = 'RUNNING',
     set status   = 'RUNNING',
         locked_at = now(),
         locked_at = now(),
         locked_by = p_worker
         locked_by = p_worker
    from picked
    from picked
   where q.job_id = picked.job_id
   where q.job_id = picked.job_id
  returning q.job_id, q.job_type, q.payload, q.attempts, q.max_attempts;
  returning q.job_id, q.job_type, q.payload, q.attempts, q.max_attempts;
end;
end;
$$;
$$;




--
--
-- Name: dequeue_ops_job(); Type: FUNCTION; Schema: ops; Owner: -
-- Name: dequeue_ops_job(); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.dequeue_ops_job() RETURNS TABLE(job_id bigint, job_type text, function_code text, payload jsonb)
CREATE FUNCTION ops.dequeue_ops_job() RETURNS TABLE(job_id bigint, job_type text, function_code text, payload jsonb)
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  update ops.ops_job_queue
  update ops.ops_job_queue
     set locked_at = now()
     set locked_at = now()
   where job_id = (
   where job_id = (
     select job_id
     select job_id
       from ops.ops_job_queue
       from ops.ops_job_queue
      where locked_at is null
      where locked_at is null
      order by created_at
      order by created_at
      limit 1
      limit 1
      for update skip locked
      for update skip locked
   )
   )
   returning job_id, job_type, function_code, payload;
   returning job_id, job_type, function_code, payload;
$$;
$$;




--
--
-- Name: enqueue_business_approval(); Type: FUNCTION; Schema: ops; Owner: -
-- Name: enqueue_business_approval(); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.enqueue_business_approval() RETURNS trigger
CREATE FUNCTION ops.enqueue_business_approval() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  need_approval boolean := false;
  need_approval boolean := false;
  th numeric;
  th numeric;
BEGIN
BEGIN
  SELECT threshold_amount
  SELECT threshold_amount
    INTO th
    INTO th
  FROM ops.approval_rule
  FROM ops.approval_rule
  WHERE domain = NEW.domain
  WHERE domain = NEW.domain
    AND event_type = NEW.event_type
    AND event_type = NEW.event_type
    AND is_enabled = true;
    AND is_enabled = true;


  IF th IS NULL THEN
  IF th IS NULL THEN
    need_approval := true;
    need_approval := true;
  ELSIF NEW.amount IS NOT NULL AND NEW.amount >= th THEN
  ELSIF NEW.amount IS NOT NULL AND NEW.amount >= th THEN
    need_approval := true;
    need_approval := true;
  END IF;
  END IF;


  IF need_approval THEN
  IF need_approval THEN
    INSERT INTO ci.schema_change_request
    INSERT INTO ci.schema_change_request
      (domain, schema_name, diff_summary, requested_by)
      (domain, schema_name, diff_summary, requested_by)
    VALUES
    VALUES
      (NEW.domain,
      (NEW.domain,
       NEW.entity_type,
       NEW.entity_type,
       jsonb_build_object(
       jsonb_build_object(
         'entity_id', NEW.entity_id,
         'entity_id', NEW.entity_id,
         'event_type', NEW.event_type,
         'event_type', NEW.event_type,
         'amount', NEW.amount
         'amount', NEW.amount
       )::text,
       )::text,
       NEW.created_by);
       NEW.created_by);
  END IF;
  END IF;


  RETURN NEW;
  RETURN NEW;
END;
END;
$$;
$$;




--
--
-- Name: enqueue_generate_pdf(text, text, text, bigint, jsonb, integer); Type: FUNCTION; Schema: ops; Owner: -
-- Name: enqueue_generate_pdf(text, text, text, bigint, jsonb, integer); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.enqueue_generate_pdf(p_function_code text, p_document_type_code text, p_business_table text, p_business_id bigint, p_payload jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 100) RETURNS bigint
CREATE FUNCTION ops.enqueue_generate_pdf(p_function_code text, p_document_type_code text, p_business_table text, p_business_id bigint, p_payload jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 100) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  v_job_id bigint;
  v_job_id bigint;
BEGIN
BEGIN
  INSERT INTO ops.ops_job_queue(
  INSERT INTO ops.ops_job_queue(
    job_type, function_code, document_type_code,
    job_type, function_code, document_type_code,
    business_table, business_id,
    business_table, business_id,
    status, payload, priority, retry_count, max_retry,
    status, payload, priority, retry_count, max_retry,
    created_at
    created_at
  )
  )
  VALUES (
  VALUES (
    'GENERATE_PDF', p_function_code, p_document_type_code,
    'GENERATE_PDF', p_function_code, p_document_type_code,
    p_business_table, p_business_id,
    p_business_table, p_business_id,
    'PENDING', COALESCE(p_payload,'{}'::jsonb), COALESCE(p_priority,100), 0, 3,
    'PENDING', COALESCE(p_payload,'{}'::jsonb), COALESCE(p_priority,100), 0, 3,
    now()
    now()
  )
  )
  RETURNING job_id INTO v_job_id;
  RETURNING job_id INTO v_job_id;


  RETURN v_job_id;
  RETURN v_job_id;
END;
END;
$$;
$$;




--
--
-- Name: enqueue_job(text, jsonb, timestamp with time zone, integer, integer, uuid); Type: FUNCTION; Schema: ops; Owner: -
-- Name: enqueue_job(text, jsonb, timestamp with time zone, integer, integer, uuid); Type: FUNCTION; Schema: ops; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_job_id bigint;
  v_job_id bigint;
begin
begin
  insert into ops.ops_job_queue(job_type, payload, run_after, priority, max_attempts, created_by)
  insert into ops.ops_job_queue(job_type, payload, run_after, priority, max_attempts, created_by)
  values (p_job_type, coalesce(p_payload,'{}'::jsonb), coalesce(p_run_after, now()), coalesce(p_priority,100), coalesce(p_max_attempts,3), p_created_by)
  values (p_job_type, coalesce(p_payload,'{}'::jsonb), coalesce(p_run_after, now()), coalesce(p_priority,100), coalesce(p_max_attempts,3), p_created_by)
  returning job_id into v_job_id;
  returning job_id into v_job_id;


  return v_job_id;
  return v_job_id;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_job(text, text, text, text, bigint, jsonb, integer); Type: FUNCTION; Schema: ops; Owner: -
-- Name: enqueue_job(text, text, text, text, bigint, jsonb, integer); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.enqueue_job(p_job_type text, p_function_code text, p_document_type_code text, p_business_table text, p_business_id bigint, p_payload jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 100) RETURNS bigint
CREATE FUNCTION ops.enqueue_job(p_job_type text, p_function_code text, p_document_type_code text, p_business_table text, p_business_id bigint, p_payload jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 100) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_job_id bigint;
  v_job_id bigint;
begin
begin
  insert into ops.ops_job_queue(
  insert into ops.ops_job_queue(
    job_type,
    job_type,
    function_code,
    function_code,
    document_type_code,
    document_type_code,
    business_table,
    business_table,
    business_id,
    business_id,
    status,
    status,
    payload,
    payload,
    priority,
    priority,
    retry_count,
    retry_count,
    max_retry,
    max_retry,
    locked_at,
    locked_at,
    picked_at,
    picked_at,
    last_error,
    last_error,
    updated_at
    updated_at
  ) values (
  ) values (
    p_job_type,
    p_job_type,
    p_function_code,
    p_function_code,
    p_document_type_code,
    p_document_type_code,
    p_business_table,
    p_business_table,
    p_business_id,
    p_business_id,
    'PENDING',
    'PENDING',
    coalesce(p_payload, '{}'::jsonb),
    coalesce(p_payload, '{}'::jsonb),
    coalesce(p_priority, 100),
    coalesce(p_priority, 100),
    0,
    0,
    3,
    3,
    null,
    null,
    null,
    null,
    null,
    null,
    now()
    now()
  )
  )
  returning job_id into v_job_id;
  returning job_id into v_job_id;


  return v_job_id;
  return v_job_id;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_notification(text, text, text, jsonb, timestamp with time zone, uuid); Type: FUNCTION; Schema: ops; Owner: -
-- Name: enqueue_notification(text, text, text, jsonb, timestamp with time zone, uuid); Type: FUNCTION; Schema: ops; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_id bigint;
  v_id bigint;
begin
begin
  insert into ops.notification_outbox(channel_code, destination, message, payload, run_after, created_by)
  insert into ops.notification_outbox(channel_code, destination, message, payload, run_after, created_by)
  values (p_channel_code, p_destination, p_message, coalesce(p_payload,'{}'::jsonb), coalesce(p_run_after, now()), p_created_by)
  values (p_channel_code, p_destination, p_message, coalesce(p_payload,'{}'::jsonb), coalesce(p_run_after, now()), p_created_by)
  returning notification_id into v_id;
  returning notification_id into v_id;
  return v_id;
  return v_id;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_notify_job_for_failed_job(bigint); Type: FUNCTION; Schema: ops; Owner: -
-- Name: enqueue_notify_job_for_failed_job(bigint); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.enqueue_notify_job_for_failed_job(p_job_id bigint) RETURNS bigint
CREATE FUNCTION ops.enqueue_notify_job_for_failed_job(p_job_id bigint) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_payload jsonb;
  v_payload jsonb;
begin
begin
  select jsonb_build_object(
  select jsonb_build_object(
    'job_id', q.job_id,
    'job_id', q.job_id,
    'job_type', q.job_type,
    'job_type', q.job_type,
    'attempts', q.attempts,
    'attempts', q.attempts,
    'max_attempts', q.max_attempts,
    'max_attempts', q.max_attempts,
    'last_error', q.last_error
    'last_error', q.last_error
  ) into v_payload
  ) into v_payload
  from ops.ops_job_queue q
  from ops.ops_job_queue q
  where q.job_id = p_job_id;
  where q.job_id = p_job_id;


  return ops.enqueue_job('NOTIFY', v_payload, now(), 10, 3, auth.uid());
  return ops.enqueue_job('NOTIFY', v_payload, now(), 10, 3, auth.uid());
end;
end;
$$;
$$;




--
--
-- Name: enqueue_ops_job(text, text, text, text, bigint); Type: FUNCTION; Schema: ops; Owner: -
-- Name: enqueue_ops_job(text, text, text, text, bigint); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.enqueue_ops_job(p_job_type text, p_function_code text, p_document_type_code text, p_business_table text, p_business_id bigint) RETURNS bigint
CREATE FUNCTION ops.enqueue_ops_job(p_job_type text, p_function_code text, p_document_type_code text, p_business_table text, p_business_id bigint) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  jid bigint;
  jid bigint;
  ikey text;
  ikey text;
begin
begin
  ikey := p_job_type || ':' || p_business_table || ':' || p_business_id;
  ikey := p_job_type || ':' || p_business_table || ':' || p_business_id;


  -- 冪等チェック
  -- 冪等チェック
  if exists (
  if exists (
    select 1 from ops.ops_idempotency where idempotency_key = ikey
    select 1 from ops.ops_idempotency where idempotency_key = ikey
  ) then
  ) then
    return null;
    return null;
  end if;
  end if;


  insert into ops.ops_job_queue(
  insert into ops.ops_job_queue(
    job_type, function_code, document_type_code,
    job_type, function_code, document_type_code,
    business_table, business_id
    business_table, business_id
  )
  )
  values (
  values (
    p_job_type, p_function_code, p_document_type_code,
    p_job_type, p_function_code, p_document_type_code,
    p_business_table, p_business_id
    p_business_table, p_business_id
  )
  )
  returning job_id into jid;
  returning job_id into jid;


  insert into ops.ops_idempotency(
  insert into ops.ops_idempotency(
    idempotency_key, job_type, business_table, business_id
    idempotency_key, job_type, business_table, business_id
  )
  )
  values (ikey, p_job_type, p_business_table, p_business_id);
  values (ikey, p_job_type, p_business_table, p_business_id);


  insert into audit.ops_audit_log(
  insert into audit.ops_audit_log(
    job_id, event_type, detail
    job_id, event_type, detail
  )
  )
  values (
  values (
    jid,
    jid,
    'ENQUEUED',
    'ENQUEUED',
    jsonb_build_object(
    jsonb_build_object(
      'job_type', p_job_type,
      'job_type', p_job_type,
      'function_code', p_function_code
      'function_code', p_function_code
    )
    )
  );
  );


  return jid;
  return jid;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_send_document(text, text, text, bigint, jsonb, integer); Type: FUNCTION; Schema: ops; Owner: -
-- Name: enqueue_send_document(text, text, text, bigint, jsonb, integer); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.enqueue_send_document(p_function_code text, p_document_type_code text, p_business_table text, p_business_id bigint, p_payload jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 90) RETURNS bigint
CREATE FUNCTION ops.enqueue_send_document(p_function_code text, p_document_type_code text, p_business_table text, p_business_id bigint, p_payload jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 90) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  v_job_id bigint;
  v_job_id bigint;
BEGIN
BEGIN
  INSERT INTO ops.ops_job_queue(
  INSERT INTO ops.ops_job_queue(
    job_type, function_code, document_type_code,
    job_type, function_code, document_type_code,
    business_table, business_id,
    business_table, business_id,
    status, payload, priority, retry_count, max_retry,
    status, payload, priority, retry_count, max_retry,
    created_at
    created_at
  )
  )
  VALUES (
  VALUES (
    'SEND_DOCUMENT', p_function_code, p_document_type_code,
    'SEND_DOCUMENT', p_function_code, p_document_type_code,
    p_business_table, p_business_id,
    p_business_table, p_business_id,
    'PENDING', COALESCE(p_payload,'{}'::jsonb), COALESCE(p_priority,90), 0, 3,
    'PENDING', COALESCE(p_payload,'{}'::jsonb), COALESCE(p_priority,90), 0, 3,
    now()
    now()
  )
  )
  RETURNING job_id INTO v_job_id;
  RETURNING job_id INTO v_job_id;


  RETURN v_job_id;
  RETURN v_job_id;
END;
END;
$$;
$$;




--
--
-- Name: fail_job(bigint, text); Type: FUNCTION; Schema: ops; Owner: -
-- Name: fail_job(bigint, text); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.fail_job(p_job_id bigint, p_error text) RETURNS void
CREATE FUNCTION ops.fail_job(p_job_id bigint, p_error text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  v_retry int;
  v_retry int;
BEGIN
BEGIN
  SELECT retry_count
  SELECT retry_count
    INTO v_retry
    INTO v_retry
    FROM ops.ops_job_queue
    FROM ops.ops_job_queue
   WHERE job_id = p_job_id;
   WHERE job_id = p_job_id;


  IF v_retry < 3 THEN
  IF v_retry < 3 THEN
    UPDATE ops.ops_job_queue
    UPDATE ops.ops_job_queue
       SET retry_count = retry_count + 1,
       SET retry_count = retry_count + 1,
           status      = 'PENDING',
           status      = 'PENDING',
           locked_at   = NULL,
           locked_at   = NULL,
           picked_at   = NULL
           picked_at   = NULL
     WHERE job_id = p_job_id;
     WHERE job_id = p_job_id;
  ELSE
  ELSE
    INSERT INTO ops.ops_job_result (
    INSERT INTO ops.ops_job_result (
      job_id,
      job_id,
      result_payload,
      result_payload,
      status,
      status,
      created_at
      created_at
    )
    )
    VALUES (
    VALUES (
      p_job_id,
      p_job_id,
      jsonb_build_object('error', p_error),
      jsonb_build_object('error', p_error),
      'FAILED',
      'FAILED',
      now()
      now()
    );
    );


    UPDATE ops.ops_job_queue
    UPDATE ops.ops_job_queue
       SET status      = 'FAILED',
       SET status      = 'FAILED',
           finished_at = now()
           finished_at = now()
     WHERE job_id = p_job_id;
     WHERE job_id = p_job_id;
  END IF;
  END IF;
END;
END;
$$;
$$;




--
--
-- Name: fail_job(bigint, text, jsonb); Type: FUNCTION; Schema: ops; Owner: -
-- Name: fail_job(bigint, text, jsonb); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.fail_job(p_job_id bigint, p_error text, p_detail jsonb DEFAULT '{}'::jsonb) RETURNS void
CREATE FUNCTION ops.fail_job(p_job_id bigint, p_error text, p_detail jsonb DEFAULT '{}'::jsonb) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_retry int;
  v_retry int;
  v_max int;
  v_max int;
  v_next_status text;
  v_next_status text;
begin
begin
  select retry_count, max_retry into v_retry, v_max
  select retry_count, max_retry into v_retry, v_max
    from ops.ops_job_queue
    from ops.ops_job_queue
   where job_id = p_job_id
   where job_id = p_job_id
   for update;
   for update;


  if not found then
  if not found then
    raise exception 'job_id % not found', p_job_id;
    raise exception 'job_id % not found', p_job_id;
  end if;
  end if;


  v_retry := coalesce(v_retry,0) + 1;
  v_retry := coalesce(v_retry,0) + 1;


  if v_retry < coalesce(v_max,3) then
  if v_retry < coalesce(v_max,3) then
    v_next_status := 'PENDING';
    v_next_status := 'PENDING';
  else
  else
    v_next_status := 'FAILED';
    v_next_status := 'FAILED';
  end if;
  end if;


  update ops.ops_job_queue
  update ops.ops_job_queue
     set retry_count = v_retry,
     set retry_count = v_retry,
         status = v_next_status,
         status = v_next_status,
         locked_at = null,
         locked_at = null,
         last_error = left(coalesce(p_error,''), 4000),
         last_error = left(coalesce(p_error,''), 4000),
         updated_at = now()
         updated_at = now()
   where job_id = p_job_id;
   where job_id = p_job_id;


  -- store latest failure snapshot
  -- store latest failure snapshot
  insert into ops.ops_job_result(job_id, result_status, result_detail, completed_at)
  insert into ops.ops_job_result(job_id, result_status, result_detail, completed_at)
  values (p_job_id, 'FAILED', jsonb_build_object('error', p_error, 'detail', coalesce(p_detail,'{}'::jsonb)), now())
  values (p_job_id, 'FAILED', jsonb_build_object('error', p_error, 'detail', coalesce(p_detail,'{}'::jsonb)), now())
  on conflict (job_id) do update
  on conflict (job_id) do update
    set result_status = excluded.result_status,
    set result_status = excluded.result_status,
        result_detail = excluded.result_detail,
        result_detail = excluded.result_detail,
        completed_at  = excluded.completed_at;
        completed_at  = excluded.completed_at;
end;
end;
$$;
$$;




--
--
-- Name: ops_send_dispatch(bigint); Type: FUNCTION; Schema: ops; Owner: -
-- Name: ops_send_dispatch(bigint); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.ops_send_dispatch(p_send_history_id bigint) RETURNS text
CREATE FUNCTION ops.ops_send_dispatch(p_send_history_id bigint) RETURNS text
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_channel text;
  v_channel text;
  v_status text;
  v_status text;
begin
begin
  select channel_code into v_channel
  select channel_code into v_channel
    from ops.document_send_history
    from ops.document_send_history
   where send_history_id = p_send_history_id;
   where send_history_id = p_send_history_id;


  if v_channel in ('EMAIL','FAX','PAPER') then
  if v_channel in ('EMAIL','FAX','PAPER') then
    v_status := 'SUCCESS';
    v_status := 'SUCCESS';
  else
  else
    v_status := 'FAILED';
    v_status := 'FAILED';
  end if;
  end if;


  update ops.document_send_history
  update ops.document_send_history
     set send_status = v_status,
     set send_status = v_status,
         sent_at = now()
         sent_at = now()
   where send_history_id = p_send_history_id;
   where send_history_id = p_send_history_id;


  return v_status;
  return v_status;
end;
end;
$$;
$$;




--
--
-- Name: FUNCTION ops_send_dispatch(p_send_history_id bigint); Type: COMMENT; Schema: ops; Owner: -
-- Name: FUNCTION ops_send_dispatch(p_send_history_id bigint); Type: COMMENT; Schema: ops; Owner: -
--
--


COMMENT ON FUNCTION ops.ops_send_dispatch(p_send_history_id bigint) IS '送付実行（模擬）: チャネル別に送付結果を更新';
COMMENT ON FUNCTION ops.ops_send_dispatch(p_send_history_id bigint) IS '送付実行（模擬）: チャネル別に送付結果を更新';




SET default_tablespace = '';
SET default_tablespace = '';


SET default_table_access_method = heap;
SET default_table_access_method = heap;


--
--
-- Name: ops_job_queue; Type: TABLE; Schema: ops; Owner: -
-- Name: ops_job_queue; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.ops_job_queue (
CREATE TABLE ops.ops_job_queue (
    job_id bigint NOT NULL,
    job_id bigint NOT NULL,
    job_type text NOT NULL,
    job_type text NOT NULL,
    function_code text NOT NULL,
    function_code text NOT NULL,
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    business_table text NOT NULL,
    business_table text NOT NULL,
    business_id bigint NOT NULL,
    business_id bigint NOT NULL,
    job_status text DEFAULT 'PENDING'::text NOT NULL,
    job_status text DEFAULT 'PENDING'::text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    max_retry integer DEFAULT 3 NOT NULL,
    max_retry integer DEFAULT 3 NOT NULL,
    locked_at timestamp with time zone,
    locked_at timestamp with time zone,
    locked_by text,
    locked_by text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    executed_at timestamp with time zone,
    executed_at timestamp with time zone,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    run_after timestamp with time zone DEFAULT now() NOT NULL,
    run_after timestamp with time zone DEFAULT now() NOT NULL,
    attempts integer DEFAULT 0 NOT NULL,
    attempts integer DEFAULT 0 NOT NULL,
    max_attempts integer DEFAULT 3 NOT NULL,
    max_attempts integer DEFAULT 3 NOT NULL,
    last_error text,
    last_error text,
    created_by uuid,
    created_by uuid,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    picked_at timestamp with time zone,
    picked_at timestamp with time zone,
    finished_at timestamp with time zone,
    finished_at timestamp with time zone,
    CONSTRAINT ops_job_queue_job_type_check CHECK ((job_type = ANY (ARRAY['GENERATE_PDF'::text, 'SEND_DOCUMENT'::text]))),
    CONSTRAINT ops_job_queue_job_type_check CHECK ((job_type = ANY (ARRAY['GENERATE_PDF'::text, 'SEND_DOCUMENT'::text]))),
    CONSTRAINT ops_job_queue_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'PROCESSING'::text, 'SUCCESS'::text, 'FAILED'::text, 'CANCELLED'::text])))
    CONSTRAINT ops_job_queue_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'PROCESSING'::text, 'SUCCESS'::text, 'FAILED'::text, 'CANCELLED'::text])))
);
);




--
--
-- Name: pick_next_job(); Type: FUNCTION; Schema: ops; Owner: -
-- Name: pick_next_job(); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.pick_next_job() RETURNS ops.ops_job_queue
CREATE FUNCTION ops.pick_next_job() RETURNS ops.ops_job_queue
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  v_job ops.ops_job_queue;
  v_job ops.ops_job_queue;
BEGIN
BEGIN
  SELECT *
  SELECT *
    INTO v_job
    INTO v_job
    FROM ops.ops_job_queue
    FROM ops.ops_job_queue
   WHERE status = 'PENDING'
   WHERE status = 'PENDING'
     AND locked_at IS NULL
     AND locked_at IS NULL
   ORDER BY priority DESC, created_at
   ORDER BY priority DESC, created_at
   FOR UPDATE SKIP LOCKED
   FOR UPDATE SKIP LOCKED
   LIMIT 1;
   LIMIT 1;


  IF NOT FOUND THEN
  IF NOT FOUND THEN
    RETURN NULL;
    RETURN NULL;
  END IF;
  END IF;


  UPDATE ops.ops_job_queue
  UPDATE ops.ops_job_queue
     SET locked_at = now(),
     SET locked_at = now(),
         picked_at = now(),
         picked_at = now(),
         status    = 'PROCESSING'
         status    = 'PROCESSING'
   WHERE job_id = v_job.job_id;
   WHERE job_id = v_job.job_id;


  RETURN v_job;
  RETURN v_job;
END;
END;
$$;
$$;




--
--
-- Name: pick_next_job(text, text); Type: FUNCTION; Schema: ops; Owner: -
-- Name: pick_next_job(text, text); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.pick_next_job(p_job_type text DEFAULT NULL::text, p_function_code text DEFAULT NULL::text) RETURNS TABLE(job_id bigint, job_type text, function_code text, document_type_code text, business_table text, business_id bigint, status text, priority integer, retry_count integer, max_retry integer, locked_at timestamp with time zone, picked_at timestamp with time zone, payload jsonb, last_error text, created_at timestamp with time zone, updated_at timestamp with time zone)
CREATE FUNCTION ops.pick_next_job(p_job_type text DEFAULT NULL::text, p_function_code text DEFAULT NULL::text) RETURNS TABLE(job_id bigint, job_type text, function_code text, document_type_code text, business_table text, business_id bigint, status text, priority integer, retry_count integer, max_retry integer, locked_at timestamp with time zone, picked_at timestamp with time zone, payload jsonb, last_error text, created_at timestamp with time zone, updated_at timestamp with time zone)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  return query
  return query
  with picked as (
  with picked as (
    select q.job_id
    select q.job_id
    from ops.ops_job_queue q
    from ops.ops_job_queue q
    where q.status = 'PENDING'
    where q.status = 'PENDING'
      and (p_job_type is null or q.job_type = p_job_type)
      and (p_job_type is null or q.job_type = p_job_type)
      and (p_function_code is null or q.function_code = p_function_code)
      and (p_function_code is null or q.function_code = p_function_code)
      and (q.locked_at is null)  -- free
      and (q.locked_at is null)  -- free
    order by q.priority desc, q.job_id asc
    order by q.priority desc, q.job_id asc
    for update skip locked
    for update skip locked
    limit 1
    limit 1
  )
  )
  update ops.ops_job_queue q
  update ops.ops_job_queue q
     set status   = 'PROCESSING',
     set status   = 'PROCESSING',
         locked_at = now(),
         locked_at = now(),
         picked_at = now(),
         picked_at = now(),
         updated_at = now()
         updated_at = now()
    from picked
    from picked
   where q.job_id = picked.job_id
   where q.job_id = picked.job_id
  returning
  returning
    q.job_id, q.job_type, q.function_code, q.document_type_code,
    q.job_id, q.job_type, q.function_code, q.document_type_code,
    q.business_table, q.business_id, q.status, q.priority,
    q.business_table, q.business_id, q.status, q.priority,
    q.retry_count, q.max_retry, q.locked_at, q.picked_at,
    q.retry_count, q.max_retry, q.locked_at, q.picked_at,
    q.payload, q.last_error, q.created_at, q.updated_at;
    q.payload, q.last_error, q.created_at, q.updated_at;
end;
end;
$$;
$$;




--
--
-- Name: pick_next_notification(); Type: FUNCTION; Schema: ops; Owner: -
-- Name: pick_next_notification(); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.pick_next_notification() RETURNS TABLE(outbox_id bigint, channel_type text, destination text, payload_text text, retry_count integer, max_retry integer)
CREATE FUNCTION ops.pick_next_notification() RETURNS TABLE(outbox_id bigint, channel_type text, destination text, payload_text text, retry_count integer, max_retry integer)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  return query
  return query
  with picked as (
  with picked as (
    select o.outbox_id
    select o.outbox_id
      from ops.notification_outbox o
      from ops.notification_outbox o
     where o.status = 'PENDING'
     where o.status = 'PENDING'
       and o.retry_count < o.max_retry
       and o.retry_count < o.max_retry
     order by o.created_at asc
     order by o.created_at asc
     for update skip locked
     for update skip locked
     limit 1
     limit 1
  )
  )
  update ops.notification_outbox o
  update ops.notification_outbox o
     set status = 'PENDING' -- keep
     set status = 'PENDING' -- keep
    from picked
    from picked
   where o.outbox_id = picked.outbox_id
   where o.outbox_id = picked.outbox_id
  returning
  returning
    o.outbox_id, o.channel_type, o.destination, o.payload::text, o.retry_count, o.max_retry;
    o.outbox_id, o.channel_type, o.destination, o.payload::text, o.retry_count, o.max_retry;
end;
end;
$$;
$$;




--
--
-- Name: retry_failed_document_send(); Type: FUNCTION; Schema: ops; Owner: -
-- Name: retry_failed_document_send(); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.retry_failed_document_send() RETURNS integer
CREATE FUNCTION ops.retry_failed_document_send() RETURNS integer
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  r record;
  r record;
  retried int := 0;
  retried int := 0;
begin
begin
  for r in
  for r in
    select send_history_id
    select send_history_id
      from ops.document_send_history
      from ops.document_send_history
     where send_status = 'FAILED'
     where send_status = 'FAILED'
       and retry_count < 3
       and retry_count < 3
  loop
  loop
    update ops.document_send_history
    update ops.document_send_history
       set retry_count = retry_count + 1
       set retry_count = retry_count + 1
     where send_history_id = r.send_history_id;
     where send_history_id = r.send_history_id;
    retried := retried + 1;
    retried := retried + 1;
  end loop;
  end loop;
  return retried;
  return retried;
end;
end;
$$;
$$;




--
--
-- Name: snapshot_ops_structure(); Type: FUNCTION; Schema: ops; Owner: -
-- Name: snapshot_ops_structure(); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.snapshot_ops_structure() RETURNS void
CREATE FUNCTION ops.snapshot_ops_structure() RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  insert into ops.document_type_master
  insert into ops.document_type_master
  select * from ops.document_type_master on conflict do nothing;
  select * from ops.document_type_master on conflict do nothing;
  insert into ops.send_channel_master
  insert into ops.send_channel_master
  select * from ops.send_channel_master on conflict do nothing;
  select * from ops.send_channel_master on conflict do nothing;
  insert into ops.resend_type_master
  insert into ops.resend_type_master
  select * from ops.resend_type_master on conflict do nothing;
  select * from ops.resend_type_master on conflict do nothing;
  insert into ops.send_fee_master
  insert into ops.send_fee_master
  select * from ops.send_fee_master on conflict do nothing;
  select * from ops.send_fee_master on conflict do nothing;
end;
end;
$$;
$$;




--
--
-- Name: FUNCTION snapshot_ops_structure(); Type: COMMENT; Schema: ops; Owner: -
-- Name: FUNCTION snapshot_ops_structure(); Type: COMMENT; Schema: ops; Owner: -
--
--


COMMENT ON FUNCTION ops.snapshot_ops_structure() IS 'OPSスキーマの静的マスタ再挿入（冪等）';
COMMENT ON FUNCTION ops.snapshot_ops_structure() IS 'OPSスキーマの静的マスタ再挿入（冪等）';




--
--
-- Name: tg_touch_updated_at(); Type: FUNCTION; Schema: ops; Owner: -
-- Name: tg_touch_updated_at(); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.tg_touch_updated_at() RETURNS trigger
CREATE FUNCTION ops.tg_touch_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  new.updated_at := now();
  new.updated_at := now();
  return new;
  return new;
end;
end;
$$;
$$;




--
--
-- Name: trg_after_job_result(); Type: FUNCTION; Schema: ops; Owner: -
-- Name: trg_after_job_result(); Type: FUNCTION; Schema: ops; Owner: -
--
--


CREATE FUNCTION ops.trg_after_job_result() RETURNS trigger
CREATE FUNCTION ops.trg_after_job_result() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  vq ops.ops_job_queue%rowtype;
  vq ops.ops_job_queue%rowtype;
  v_new_job_id bigint;
  v_new_job_id bigint;
begin
begin
  select * into vq
  select * into vq
    from ops.ops_job_queue
    from ops.ops_job_queue
   where job_id = new.job_id;
   where job_id = new.job_id;


  if not found then
  if not found then
    return new;
    return new;
  end if;
  end if;


  -- SUCCESS chain: GENERATE_PDF -> SEND_DOCUMENT
  -- SUCCESS chain: GENERATE_PDF -> SEND_DOCUMENT
  if new.result_status = 'SUCCESS' and vq.job_type = 'GENERATE_PDF' then
  if new.result_status = 'SUCCESS' and vq.job_type = 'GENERATE_PDF' then
    v_new_job_id := ops.enqueue_job(
    v_new_job_id := ops.enqueue_job(
      'SEND_DOCUMENT',
      'SEND_DOCUMENT',
      vq.function_code,
      vq.function_code,
      vq.document_type_code,
      vq.document_type_code,
      vq.business_table,
      vq.business_table,
      vq.business_id,
      vq.business_id,
      jsonb_build_object(
      jsonb_build_object(
        'from_job_id', vq.job_id,
        'from_job_id', vq.job_id,
        'doc', vq.document_type_code
        'doc', vq.document_type_code
      ),
      ),
      greatest(coalesce(vq.priority,100), 100)
      greatest(coalesce(vq.priority,100), 100)
    );
    );
    return new;
    return new;
  end if;
  end if;


  -- FAILED notify
  -- FAILED notify
  if new.result_status = 'FAILED' then
  if new.result_status = 'FAILED' then
    insert into ops.notification_outbox(job_id, channel, destination, payload, status)
    insert into ops.notification_outbox(job_id, channel, destination, payload, status)
    values (
    values (
      new.job_id,
      new.job_id,
      'WEBHOOK',
      'WEBHOOK',
      null,
      null,
      jsonb_build_object(
      jsonb_build_object(
        'job_id', new.job_id,
        'job_id', new.job_id,
        'job_type', vq.job_type,
        'job_type', vq.job_type,
        'function_code', vq.function_code,
        'function_code', vq.function_code,
        'document_type_code', vq.document_type_code,
        'document_type_code', vq.document_type_code,
        'business_table', vq.business_table,
        'business_table', vq.business_table,
        'business_id', vq.business_id,
        'business_id', vq.business_id,
        'result_detail', new.result_detail
        'result_detail', new.result_detail
      ),
      ),
      'PENDING'
      'PENDING'
    );
    );
    return new;
    return new;
  end if;
  end if;


  return new;
  return new;
end;
end;
$$;
$$;




--
--
-- Name: get_auth(text); Type: FUNCTION; Schema: pgbouncer; Owner: -
-- Name: get_auth(text); Type: FUNCTION; Schema: pgbouncer; Owner: -
--
--


CREATE FUNCTION pgbouncer.get_auth(p_usename text) RETURNS TABLE(username text, password text)
CREATE FUNCTION pgbouncer.get_auth(p_usename text) RETURNS TABLE(username text, password text)
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO ''
    SET search_path TO ''
    AS $_$
    AS $_$
  BEGIN
  BEGIN
      RAISE DEBUG 'PgBouncer auth request: %', p_usename;
      RAISE DEBUG 'PgBouncer auth request: %', p_usename;


      RETURN QUERY
      RETURN QUERY
      SELECT
      SELECT
          rolname::text,
          rolname::text,
          CASE WHEN rolvaliduntil < now()
          CASE WHEN rolvaliduntil < now()
              THEN null
              THEN null
              ELSE rolpassword::text
              ELSE rolpassword::text
          END
          END
      FROM pg_authid
      FROM pg_authid
      WHERE rolname=$1 and rolcanlogin;
      WHERE rolname=$1 and rolcanlogin;
  END;
  END;
  $_$;
  $_$;




--
--
-- Name: act_approval(uuid, text, text); Type: FUNCTION; Schema: public; Owner: -
-- Name: act_approval(uuid, text, text); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.act_approval(p_request_id uuid, p_action text, p_note text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION public.act_approval(p_request_id uuid, p_action text, p_note text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'audit', 'public'
    SET search_path TO 'audit', 'public'
    AS $$
    AS $$
BEGIN
BEGIN
  UPDATE audit.approval_request
  UPDATE audit.approval_request
  SET
  SET
    status =
    status =
      CASE
      CASE
        WHEN p_action = 'approve' THEN 'approved'
        WHEN p_action = 'approve' THEN 'approved'
        WHEN p_action = 'reject'  THEN 'rejected'
        WHEN p_action = 'reject'  THEN 'rejected'
        ELSE status
        ELSE status
      END,
      END,
    decided_by   = current_user,
    decided_by   = current_user,
    decided_at   = now(),
    decided_at   = now(),
    decision_note = p_note
    decision_note = p_note
  WHERE request_id = p_request_id;
  WHERE request_id = p_request_id;


  INSERT INTO audit.approval_log (
  INSERT INTO audit.approval_log (
    approval_request_id,
    approval_request_id,
    action,
    action,
    actor,
    actor,
    note,
    note,
    acted_at
    acted_at
  )
  )
  VALUES (
  VALUES (
    p_request_id,
    p_request_id,
    p_action,
    p_action,
    current_user,
    current_user,
    p_note,
    p_note,
    now()
    now()
  );
  );
END;
END;
$$;
$$;




--
--
-- Name: create_ai_job(uuid, text, jsonb, text); Type: FUNCTION; Schema: public; Owner: -
-- Name: create_ai_job(uuid, text, jsonb, text); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.create_ai_job(p_company_id uuid, p_job_type text, p_params jsonb, p_decided_by text) RETURNS bigint
CREATE FUNCTION public.create_ai_job(p_company_id uuid, p_job_type text, p_params jsonb, p_decided_by text) RETURNS bigint
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  insert into analytics.ai_job (company_id, job_type, params, decided_by)
  insert into analytics.ai_job (company_id, job_type, params, decided_by)
  values (p_company_id, p_job_type, coalesce(p_params,'{}'::jsonb), p_decided_by)
  values (p_company_id, p_job_type, coalesce(p_params,'{}'::jsonb), p_decided_by)
  returning ai_job_id;
  returning ai_job_id;
$$;
$$;




--
--
-- Name: create_approval_request(text, text, text, text, text, text); Type: FUNCTION; Schema: public; Owner: -
-- Name: create_approval_request(text, text, text, text, text, text); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.create_approval_request(p_domain text, p_entity_type text, p_entity_id text, p_reason text, p_severity text DEFAULT NULL::text, p_policy_id text DEFAULT NULL::text) RETURNS uuid
CREATE FUNCTION public.create_approval_request(p_domain text, p_entity_type text, p_entity_id text, p_reason text, p_severity text DEFAULT NULL::text, p_policy_id text DEFAULT NULL::text) RETURNS uuid
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'audit', 'public'
    SET search_path TO 'audit', 'public'
    AS $$
    AS $$
DECLARE
DECLARE
  v_id uuid;
  v_id uuid;
BEGIN
BEGIN
  INSERT INTO audit.approval_request (
  INSERT INTO audit.approval_request (
    company_id,
    company_id,
    domain,
    domain,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    reason,
    reason,
    severity,
    severity,
    policy_id,
    policy_id,
    detected_at,
    detected_at,
    status
    status
  )
  )
  VALUES (
  VALUES (
    audit.current_company_id(),
    audit.current_company_id(),
    p_domain,
    p_domain,
    p_entity_type,
    p_entity_type,
    p_entity_id,
    p_entity_id,
    p_reason,
    p_reason,
    p_severity,
    p_severity,
    p_policy_id,
    p_policy_id,
    now(),
    now(),
    'pending'
    'pending'
  )
  )
  RETURNING request_id INTO v_id;
  RETURNING request_id INTO v_id;


  RETURN v_id;
  RETURN v_id;
END;
END;
$$;
$$;




--
--
-- Name: enqueue_notification(uuid, text, text, jsonb); Type: FUNCTION; Schema: public; Owner: -
-- Name: enqueue_notification(uuid, text, text, jsonb); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.enqueue_notification(p_company_id uuid, p_channel text, p_destination text, p_payload jsonb) RETURNS void
CREATE FUNCTION public.enqueue_notification(p_company_id uuid, p_channel text, p_destination text, p_payload jsonb) RETURNS void
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  insert into analytics.notification_queue
  insert into analytics.notification_queue
    (company_id, channel, destination, payload)
    (company_id, channel, destination, payload)
  values
  values
    (p_company_id, p_channel, p_destination, coalesce(p_payload,'{}'::jsonb));
    (p_company_id, p_channel, p_destination, coalesce(p_payload,'{}'::jsonb));
$$;
$$;




--
--
-- Name: approval_request; Type: TABLE; Schema: audit; Owner: -
-- Name: approval_request; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.approval_request (
CREATE TABLE audit.approval_request (
    request_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    domain text NOT NULL,
    domain text NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    order_id bigint,
    order_id bigint,
    reason text NOT NULL,
    reason text NOT NULL,
    detected_at timestamp with time zone DEFAULT now() NOT NULL,
    detected_at timestamp with time zone DEFAULT now() NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    decided_at timestamp with time zone,
    decided_at timestamp with time zone,
    decided_by uuid,
    decided_by uuid,
    decision_note text,
    decision_note text,
    policy_id text,
    policy_id text,
    severity text,
    severity text,
    CONSTRAINT approval_request_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text])))
    CONSTRAINT approval_request_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text])))
);
);




--
--
-- Name: get_approval_requests(integer); Type: FUNCTION; Schema: public; Owner: -
-- Name: get_approval_requests(integer); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.get_approval_requests(p_limit integer DEFAULT 100) RETURNS SETOF audit.approval_request
CREATE FUNCTION public.get_approval_requests(p_limit integer DEFAULT 100) RETURNS SETOF audit.approval_request
    LANGUAGE sql STABLE SECURITY DEFINER
    LANGUAGE sql STABLE SECURITY DEFINER
    SET search_path TO 'audit', 'public'
    SET search_path TO 'audit', 'public'
    AS $$
    AS $$
  SELECT *
  SELECT *
  FROM audit.approval_request
  FROM audit.approval_request
  ORDER BY detected_at DESC
  ORDER BY detected_at DESC
  LIMIT p_limit;
  LIMIT p_limit;
$$;
$$;




--
--
-- Name: ng_event; Type: TABLE; Schema: audit; Owner: -
-- Name: ng_event; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.ng_event (
CREATE TABLE audit.ng_event (
    ng_event_id bigint NOT NULL,
    ng_event_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    occurred_at timestamp with time zone DEFAULT now() NOT NULL,
    occurred_at timestamp with time zone DEFAULT now() NOT NULL,
    event_key text NOT NULL,
    event_key text NOT NULL,
    task_name text,
    task_name text,
    audit_scope text NOT NULL,
    audit_scope text NOT NULL,
    severity text NOT NULL,
    severity text NOT NULL,
    reason_code text NOT NULL,
    reason_code text NOT NULL,
    phase text,
    phase text,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    auto_fixed boolean DEFAULT false NOT NULL,
    auto_fixed boolean DEFAULT false NOT NULL,
    quarantined boolean DEFAULT false NOT NULL,
    quarantined boolean DEFAULT false NOT NULL,
    approval_required boolean DEFAULT false NOT NULL,
    approval_required boolean DEFAULT false NOT NULL,
    approved_by uuid,
    approved_by uuid,
    approved_at timestamp with time zone,
    approved_at timestamp with time zone,
    business_domain text,
    business_domain text,
    context jsonb DEFAULT '{}'::jsonb NOT NULL,
    context jsonb DEFAULT '{}'::jsonb NOT NULL,
    CONSTRAINT ng_event_audit_scope_check CHECK ((audit_scope = ANY (ARRAY['internal'::text, 'external'::text, 'both'::text]))),
    CONSTRAINT ng_event_audit_scope_check CHECK ((audit_scope = ANY (ARRAY['internal'::text, 'external'::text, 'both'::text]))),
    CONSTRAINT ng_event_severity_check CHECK ((severity = ANY (ARRAY['ok'::text, 'warn'::text, 'ng'::text, 'critical'::text])))
    CONSTRAINT ng_event_severity_check CHECK ((severity = ANY (ARRAY['ok'::text, 'warn'::text, 'ng'::text, 'critical'::text])))
);
);




--
--
-- Name: TABLE ng_event; Type: COMMENT; Schema: audit; Owner: -
-- Name: TABLE ng_event; Type: COMMENT; Schema: audit; Owner: -
--
--


COMMENT ON TABLE audit.ng_event IS 'Internal audit & runtime control canonical table (event_key enabled).';
COMMENT ON TABLE audit.ng_event IS 'Internal audit & runtime control canonical table (event_key enabled).';




--
--
-- Name: get_ng_events(integer); Type: FUNCTION; Schema: public; Owner: -
-- Name: get_ng_events(integer); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.get_ng_events(p_limit integer DEFAULT 100) RETURNS SETOF audit.ng_event
CREATE FUNCTION public.get_ng_events(p_limit integer DEFAULT 100) RETURNS SETOF audit.ng_event
    LANGUAGE sql STABLE SECURITY DEFINER
    LANGUAGE sql STABLE SECURITY DEFINER
    SET search_path TO 'audit', 'public'
    SET search_path TO 'audit', 'public'
    AS $$
    AS $$
  SELECT *
  SELECT *
  FROM audit.ng_event
  FROM audit.ng_event
  ORDER BY occurred_at DESC
  ORDER BY occurred_at DESC
  LIMIT p_limit;
  LIMIT p_limit;
$$;
$$;




--
--
-- Name: ai_event; Type: TABLE; Schema: analytics; Owner: -
-- Name: ai_event; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.ai_event (
CREATE TABLE analytics.ai_event (
    ai_event_id bigint NOT NULL,
    ai_event_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    source_table text NOT NULL,
    source_table text NOT NULL,
    source_id bigint NOT NULL,
    source_id bigint NOT NULL,
    event_type text NOT NULL,
    event_type text NOT NULL,
    severity text DEFAULT 'info'::text NOT NULL,
    severity text DEFAULT 'info'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    swept_at timestamp with time zone,
    swept_at timestamp with time zone,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: get_ng_events(uuid); Type: FUNCTION; Schema: public; Owner: -
-- Name: get_ng_events(uuid); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.get_ng_events(p_company_id uuid) RETURNS SETOF analytics.ai_event
CREATE FUNCTION public.get_ng_events(p_company_id uuid) RETURNS SETOF analytics.ai_event
    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select *
  select *
    from analytics.ai_event
    from analytics.ai_event
   where company_id = p_company_id
   where company_id = p_company_id
     and status = 'pending'
     and status = 'pending'
   order by created_at
   order by created_at
   limit 100;
   limit 100;
$$;
$$;




--
--
-- Name: get_ng_events_all(); Type: FUNCTION; Schema: public; Owner: -
-- Name: get_ng_events_all(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.get_ng_events_all() RETURNS SETOF analytics.ai_event
CREATE FUNCTION public.get_ng_events_all() RETURNS SETOF analytics.ai_event
    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select *
  select *
  from analytics.ai_event
  from analytics.ai_event
  where status = 'pending'
  where status = 'pending'
  order by created_at
  order by created_at
  limit 100;
  limit 100;
$$;
$$;




--
--
-- Name: ai_job; Type: TABLE; Schema: analytics; Owner: -
-- Name: ai_job; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.ai_job (
CREATE TABLE analytics.ai_job (
    ai_job_id bigint NOT NULL,
    ai_job_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    job_type text NOT NULL,
    job_type text NOT NULL,
    params jsonb DEFAULT '{}'::jsonb NOT NULL,
    params jsonb DEFAULT '{}'::jsonb NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    decided_by text NOT NULL,
    decided_by text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    started_at timestamp with time zone,
    started_at timestamp with time zone,
    finished_at timestamp with time zone,
    finished_at timestamp with time zone,
    last_error text,
    last_error text,
    requires_approval boolean DEFAULT false NOT NULL
    requires_approval boolean DEFAULT false NOT NULL
);
);




--
--
-- Name: get_pending_ai_jobs(uuid); Type: FUNCTION; Schema: public; Owner: -
-- Name: get_pending_ai_jobs(uuid); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.get_pending_ai_jobs(p_company_id uuid) RETURNS SETOF analytics.ai_job
CREATE FUNCTION public.get_pending_ai_jobs(p_company_id uuid) RETURNS SETOF analytics.ai_job
    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select * from analytics.ai_job
  select * from analytics.ai_job
   where company_id = p_company_id
   where company_id = p_company_id
     and status = 'pending'
     and status = 'pending'
   order by created_at
   order by created_at
   limit 50;
   limit 50;
$$;
$$;




--
--
-- Name: get_pending_ai_jobs_all(); Type: FUNCTION; Schema: public; Owner: -
-- Name: get_pending_ai_jobs_all(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.get_pending_ai_jobs_all() RETURNS SETOF analytics.ai_job
CREATE FUNCTION public.get_pending_ai_jobs_all() RETURNS SETOF analytics.ai_job
    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select *
  select *
  from analytics.ai_job
  from analytics.ai_job
  where status='pending'
  where status='pending'
  order by created_at
  order by created_at
  limit 100;
  limit 100;
$$;
$$;




--
--
-- Name: notification_queue; Type: TABLE; Schema: analytics; Owner: -
-- Name: notification_queue; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.notification_queue (
CREATE TABLE analytics.notification_queue (
    notification_id bigint NOT NULL,
    notification_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    channel text NOT NULL,
    channel text NOT NULL,
    destination text NOT NULL,
    destination text NOT NULL,
    payload jsonb NOT NULL,
    payload jsonb NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    sent_at timestamp with time zone,
    sent_at timestamp with time zone,
    last_error text
    last_error text
);
);




--
--
-- Name: get_pending_notifications(); Type: FUNCTION; Schema: public; Owner: -
-- Name: get_pending_notifications(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.get_pending_notifications() RETURNS SETOF analytics.notification_queue
CREATE FUNCTION public.get_pending_notifications() RETURNS SETOF analytics.notification_queue
    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select *
  select *
  from analytics.notification_queue
  from analytics.notification_queue
  where status='pending'
  where status='pending'
  order by created_at
  order by created_at
  limit 100;
  limit 100;
$$;
$$;




--
--
-- Name: is_admin(); Type: FUNCTION; Schema: public; Owner: -
-- Name: is_admin(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.is_admin() RETURNS boolean
CREATE FUNCTION public.is_admin() RETURNS boolean
    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select coalesce(
  select coalesce(
    (auth.jwt() -> 'app_metadata' ->> 'role') = 'admin',
    (auth.jwt() -> 'app_metadata' ->> 'role') = 'admin',
    false
    false
  );
  );
$$;
$$;




--
--
-- Name: is_ai_enabled(text); Type: FUNCTION; Schema: public; Owner: -
-- Name: is_ai_enabled(text); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.is_ai_enabled(p_scope text) RETURNS boolean
CREATE FUNCTION public.is_ai_enabled(p_scope text) RETURNS boolean
    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
  select coalesce(
  select coalesce(
    (select is_enabled from analytics.ai_kill_switch where scope=p_scope),
    (select is_enabled from analytics.ai_kill_switch where scope=p_scope),
    true
    true
  );
  );
$$;
$$;




--
--
-- Name: mark_ai_event_swept(bigint); Type: FUNCTION; Schema: public; Owner: -
-- Name: mark_ai_event_swept(bigint); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.mark_ai_event_swept(p_ai_event_id bigint) RETURNS void
CREATE FUNCTION public.mark_ai_event_swept(p_ai_event_id bigint) RETURNS void
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  update analytics.ai_event
  update analytics.ai_event
     set status='swept', swept_at=now()
     set status='swept', swept_at=now()
   where ai_event_id=p_ai_event_id;
   where ai_event_id=p_ai_event_id;
$$;
$$;




--
--
-- Name: mark_ai_job_done(bigint); Type: FUNCTION; Schema: public; Owner: -
-- Name: mark_ai_job_done(bigint); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.mark_ai_job_done(p_ai_job_id bigint) RETURNS void
CREATE FUNCTION public.mark_ai_job_done(p_ai_job_id bigint) RETURNS void
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  update analytics.ai_job
  update analytics.ai_job
     set status='done', finished_at=now()
     set status='done', finished_at=now()
   where ai_job_id=p_ai_job_id;
   where ai_job_id=p_ai_job_id;
$$;
$$;




--
--
-- Name: mark_ai_job_failed(bigint, text); Type: FUNCTION; Schema: public; Owner: -
-- Name: mark_ai_job_failed(bigint, text); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.mark_ai_job_failed(p_ai_job_id bigint, p_err text) RETURNS void
CREATE FUNCTION public.mark_ai_job_failed(p_ai_job_id bigint, p_err text) RETURNS void
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  update analytics.ai_job
  update analytics.ai_job
     set status='failed', finished_at=now(), last_error=p_err
     set status='failed', finished_at=now(), last_error=p_err
   where ai_job_id=p_ai_job_id;
   where ai_job_id=p_ai_job_id;
$$;
$$;




--
--
-- Name: mark_ai_job_running(bigint); Type: FUNCTION; Schema: public; Owner: -
-- Name: mark_ai_job_running(bigint); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.mark_ai_job_running(p_ai_job_id bigint) RETURNS void
CREATE FUNCTION public.mark_ai_job_running(p_ai_job_id bigint) RETURNS void
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  update analytics.ai_job
  update analytics.ai_job
     set status='running', started_at=now()
     set status='running', started_at=now()
   where ai_job_id=p_ai_job_id and status='pending';
   where ai_job_id=p_ai_job_id and status='pending';
$$;
$$;




--
--
-- Name: mark_notification_failed(bigint, text); Type: FUNCTION; Schema: public; Owner: -
-- Name: mark_notification_failed(bigint, text); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.mark_notification_failed(p_id bigint, p_err text) RETURNS void
CREATE FUNCTION public.mark_notification_failed(p_id bigint, p_err text) RETURNS void
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  update analytics.notification_queue
  update analytics.notification_queue
     set status='failed', last_error=p_err
     set status='failed', last_error=p_err
   where notification_id=p_id;
   where notification_id=p_id;
$$;
$$;




--
--
-- Name: mark_notification_sent(bigint); Type: FUNCTION; Schema: public; Owner: -
-- Name: mark_notification_sent(bigint); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.mark_notification_sent(p_id bigint) RETURNS void
CREATE FUNCTION public.mark_notification_sent(p_id bigint) RETURNS void
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  update analytics.notification_queue
  update analytics.notification_queue
     set status='sent', sent_at=now()
     set status='sent', sent_at=now()
   where notification_id=p_id;
   where notification_id=p_id;
$$;
$$;




--
--
-- Name: my_company_id(); Type: FUNCTION; Schema: public; Owner: -
-- Name: my_company_id(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.my_company_id() RETURNS uuid
CREATE FUNCTION public.my_company_id() RETURNS uuid
    LANGUAGE sql STABLE SECURITY DEFINER
    LANGUAGE sql STABLE SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
  SELECT cu.company_id
  SELECT cu.company_id
  FROM core.company_users cu
  FROM core.company_users cu
  WHERE cu.user_id = auth.uid()
  WHERE cu.user_id = auth.uid()
  LIMIT 1;
  LIMIT 1;
$$;
$$;




--
--
-- Name: sweep_ai_event(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
-- Name: sweep_ai_event(uuid, integer); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.sweep_ai_event(p_company_id uuid, p_keep_days integer DEFAULT 30) RETURNS integer
CREATE FUNCTION public.sweep_ai_event(p_company_id uuid, p_keep_days integer DEFAULT 30) RETURNS integer
    LANGUAGE sql SECURITY DEFINER
    LANGUAGE sql SECURITY DEFINER
    AS $$
    AS $$
  select analytics.sweep_ai_event(p_company_id, p_keep_days);
  select analytics.sweep_ai_event(p_company_id, p_keep_days);
$$;
$$;




--
--
-- Name: FUNCTION sweep_ai_event(p_company_id uuid, p_keep_days integer); Type: COMMENT; Schema: public; Owner: -
-- Name: FUNCTION sweep_ai_event(p_company_id uuid, p_keep_days integer); Type: COMMENT; Schema: public; Owner: -
--
--


COMMENT ON FUNCTION public.sweep_ai_event(p_company_id uuid, p_keep_days integer) IS 'RPC bridge: public -> analytics.sweep_ai_event';
COMMENT ON FUNCTION public.sweep_ai_event(p_company_id uuid, p_keep_days integer) IS 'RPC bridge: public -> analytics.sweep_ai_event';




--
--
-- Name: trg_v_core_audit_trail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_core_audit_trail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_core_audit_trail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_core_audit_trail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO core.audit_trail (company_id, entity_type, entity_id, action, action_category, detail, performed_by, performed_at)
           INSERT INTO core.audit_trail (company_id, entity_type, entity_id, action, action_category, detail, performed_by, performed_at)
           VALUES (my_company_id(), NEW.entity_type, NEW.entity_id, NEW.action, NEW.action_category, NEW.detail, NEW.performed_by, NEW.performed_at)
           VALUES (my_company_id(), NEW.entity_type, NEW.entity_id, NEW.action, NEW.action_category, NEW.detail, NEW.performed_by, NEW.performed_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE core.audit_trail
           UPDATE core.audit_trail
              SET entity_type = NEW.entity_type, entity_id = NEW.entity_id, action = NEW.action, action_category = NEW.action_category, detail = NEW.detail, performed_by = NEW.performed_by, performed_at = NEW.performed_at
              SET entity_type = NEW.entity_type, entity_id = NEW.entity_id, action = NEW.action, action_category = NEW.action_category, detail = NEW.detail, performed_by = NEW.performed_by, performed_at = NEW.performed_at
            WHERE audit_trail_id = OLD.audit_trail_id;
            WHERE audit_trail_id = OLD.audit_trail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM core.audit_trail
           DELETE FROM core.audit_trail
            WHERE audit_trail_id = OLD.audit_trail_id;
            WHERE audit_trail_id = OLD.audit_trail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_core_company_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_core_company_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_core_company_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_core_company_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO core.company (company_code, company_name, currency_code, timezone, is_active, created_at, updated_at)
           INSERT INTO core.company (company_code, company_name, currency_code, timezone, is_active, created_at, updated_at)
           VALUES (NEW.company_code, NEW.company_name, NEW.currency_code, NEW.timezone, NEW.is_active, NEW.created_at, NEW.updated_at)
           VALUES (NEW.company_code, NEW.company_name, NEW.currency_code, NEW.timezone, NEW.is_active, NEW.created_at, NEW.updated_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE core.company
           UPDATE core.company
              SET company_code = NEW.company_code, company_name = NEW.company_name, currency_code = NEW.currency_code, timezone = NEW.timezone, is_active = NEW.is_active, created_at = NEW.created_at, updated_at = NEW.updated_at
              SET company_code = NEW.company_code, company_name = NEW.company_name, currency_code = NEW.currency_code, timezone = NEW.timezone, is_active = NEW.is_active, created_at = NEW.created_at, updated_at = NEW.updated_at
            WHERE company_id = OLD.company_id;
            WHERE company_id = OLD.company_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM core.company
           DELETE FROM core.company
            WHERE company_id = OLD.company_id;
            WHERE company_id = OLD.company_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_core_company_license_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_core_company_license_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_core_company_license_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_core_company_license_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO core.company_license (company_id, license_code, purchased_at, expires_at, is_active)
           INSERT INTO core.company_license (company_id, license_code, purchased_at, expires_at, is_active)
           VALUES (my_company_id(), NEW.license_code, NEW.purchased_at, NEW.expires_at, NEW.is_active)
           VALUES (my_company_id(), NEW.license_code, NEW.purchased_at, NEW.expires_at, NEW.is_active)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE core.company_license
           UPDATE core.company_license
              SET license_code = NEW.license_code, purchased_at = NEW.purchased_at, expires_at = NEW.expires_at, is_active = NEW.is_active
              SET license_code = NEW.license_code, purchased_at = NEW.purchased_at, expires_at = NEW.expires_at, is_active = NEW.is_active
            WHERE company_license_id = OLD.company_license_id;
            WHERE company_license_id = OLD.company_license_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM core.company_license
           DELETE FROM core.company_license
            WHERE company_license_id = OLD.company_license_id;
            WHERE company_license_id = OLD.company_license_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_core_company_permission_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_core_company_permission_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_core_company_permission_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_core_company_permission_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO core.company_permission (company_id, permission_code, enabled, created_at)
           INSERT INTO core.company_permission (company_id, permission_code, enabled, created_at)
           VALUES (my_company_id(), NEW.permission_code, NEW.enabled, NEW.created_at)
           VALUES (my_company_id(), NEW.permission_code, NEW.enabled, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE core.company_permission
           UPDATE core.company_permission
              SET permission_code = NEW.permission_code, enabled = NEW.enabled, created_at = NEW.created_at
              SET permission_code = NEW.permission_code, enabled = NEW.enabled, created_at = NEW.created_at
            WHERE company_permission_id = OLD.company_permission_id;
            WHERE company_permission_id = OLD.company_permission_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM core.company_permission
           DELETE FROM core.company_permission
            WHERE company_permission_id = OLD.company_permission_id;
            WHERE company_permission_id = OLD.company_permission_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_core_journal_source_link_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_core_journal_source_link_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_core_journal_source_link_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_core_journal_source_link_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO core.journal_source_link (journal_id, source_type, source_id, created_at)
           INSERT INTO core.journal_source_link (journal_id, source_type, source_id, created_at)
           VALUES (NEW.journal_id, NEW.source_type, NEW.source_id, NEW.created_at)
           VALUES (NEW.journal_id, NEW.source_type, NEW.source_id, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE core.journal_source_link
           UPDATE core.journal_source_link
              SET journal_id = NEW.journal_id, source_type = NEW.source_type, source_id = NEW.source_id, created_at = NEW.created_at
              SET journal_id = NEW.journal_id, source_type = NEW.source_type, source_id = NEW.source_id, created_at = NEW.created_at
            WHERE journal_source_link_id = OLD.journal_source_link_id;
            WHERE journal_source_link_id = OLD.journal_source_link_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM core.journal_source_link
           DELETE FROM core.journal_source_link
            WHERE journal_source_link_id = OLD.journal_source_link_id;
            WHERE journal_source_link_id = OLD.journal_source_link_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_core_payment_term_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_core_payment_term_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_core_payment_term_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_core_payment_term_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO core.payment_term (term_code, term_name, closing_day, payment_offset_month, payment_day, description, is_active)
           INSERT INTO core.payment_term (term_code, term_name, closing_day, payment_offset_month, payment_day, description, is_active)
           VALUES (NEW.term_code, NEW.term_name, NEW.closing_day, NEW.payment_offset_month, NEW.payment_day, NEW.description, NEW.is_active)
           VALUES (NEW.term_code, NEW.term_name, NEW.closing_day, NEW.payment_offset_month, NEW.payment_day, NEW.description, NEW.is_active)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE core.payment_term
           UPDATE core.payment_term
              SET term_code = NEW.term_code, term_name = NEW.term_name, closing_day = NEW.closing_day, payment_offset_month = NEW.payment_offset_month, payment_day = NEW.payment_day, description = NEW.description, is_active = NEW.is_active
              SET term_code = NEW.term_code, term_name = NEW.term_name, closing_day = NEW.closing_day, payment_offset_month = NEW.payment_offset_month, payment_day = NEW.payment_day, description = NEW.description, is_active = NEW.is_active
            WHERE payment_term_id = OLD.payment_term_id;
            WHERE payment_term_id = OLD.payment_term_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM core.payment_term
           DELETE FROM core.payment_term
            WHERE payment_term_id = OLD.payment_term_id;
            WHERE payment_term_id = OLD.payment_term_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_core_posting_profile_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_core_posting_profile_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_core_posting_profile_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_core_posting_profile_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO core.posting_profile (company_id, profile_code, source_type, debit_account_id, credit_account_id, description, is_active)
           INSERT INTO core.posting_profile (company_id, profile_code, source_type, debit_account_id, credit_account_id, description, is_active)
           VALUES (my_company_id(), NEW.profile_code, NEW.source_type, NEW.debit_account_id, NEW.credit_account_id, NEW.description, NEW.is_active)
           VALUES (my_company_id(), NEW.profile_code, NEW.source_type, NEW.debit_account_id, NEW.credit_account_id, NEW.description, NEW.is_active)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE core.posting_profile
           UPDATE core.posting_profile
              SET profile_code = NEW.profile_code, source_type = NEW.source_type, debit_account_id = NEW.debit_account_id, credit_account_id = NEW.credit_account_id, description = NEW.description, is_active = NEW.is_active
              SET profile_code = NEW.profile_code, source_type = NEW.source_type, debit_account_id = NEW.debit_account_id, credit_account_id = NEW.credit_account_id, description = NEW.description, is_active = NEW.is_active
            WHERE posting_profile_id = OLD.posting_profile_id;
            WHERE posting_profile_id = OLD.posting_profile_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM core.posting_profile
           DELETE FROM core.posting_profile
            WHERE posting_profile_id = OLD.posting_profile_id;
            WHERE posting_profile_id = OLD.posting_profile_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_core_status_history_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_core_status_history_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_core_status_history_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_core_status_history_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'core', 'public'
    SET search_path TO 'core', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO core.status_history (company_id, entity_type, entity_id, from_status_code, to_status_code, changed_by, changed_at, reason)
           INSERT INTO core.status_history (company_id, entity_type, entity_id, from_status_code, to_status_code, changed_by, changed_at, reason)
           VALUES (my_company_id(), NEW.entity_type, NEW.entity_id, NEW.from_status_code, NEW.to_status_code, NEW.changed_by, NEW.changed_at, NEW.reason)
           VALUES (my_company_id(), NEW.entity_type, NEW.entity_id, NEW.from_status_code, NEW.to_status_code, NEW.changed_by, NEW.changed_at, NEW.reason)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE core.status_history
           UPDATE core.status_history
              SET entity_type = NEW.entity_type, entity_id = NEW.entity_id, from_status_code = NEW.from_status_code, to_status_code = NEW.to_status_code, changed_by = NEW.changed_by, changed_at = NEW.changed_at, reason = NEW.reason
              SET entity_type = NEW.entity_type, entity_id = NEW.entity_id, from_status_code = NEW.from_status_code, to_status_code = NEW.to_status_code, changed_by = NEW.changed_by, changed_at = NEW.changed_at, reason = NEW.reason
            WHERE status_history_id = OLD.status_history_id;
            WHERE status_history_id = OLD.status_history_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM core.status_history
           DELETE FROM core.status_history
            WHERE status_history_id = OLD.status_history_id;
            WHERE status_history_id = OLD.status_history_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_finance_bank_account_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_finance_bank_account_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_finance_bank_account_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_finance_bank_account_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'finance', 'public'
    SET search_path TO 'finance', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO finance.bank_account (company_id, bank_name, branch_name, account_type, account_number, account_name, currency_code, is_active)
           INSERT INTO finance.bank_account (company_id, bank_name, branch_name, account_type, account_number, account_name, currency_code, is_active)
           VALUES (my_company_id(), NEW.bank_name, NEW.branch_name, NEW.account_type, NEW.account_number, NEW.account_name, NEW.currency_code, NEW.is_active)
           VALUES (my_company_id(), NEW.bank_name, NEW.branch_name, NEW.account_type, NEW.account_number, NEW.account_name, NEW.currency_code, NEW.is_active)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE finance.bank_account
           UPDATE finance.bank_account
              SET bank_name = NEW.bank_name, branch_name = NEW.branch_name, account_type = NEW.account_type, account_number = NEW.account_number, account_name = NEW.account_name, currency_code = NEW.currency_code, is_active = NEW.is_active
              SET bank_name = NEW.bank_name, branch_name = NEW.branch_name, account_type = NEW.account_type, account_number = NEW.account_number, account_name = NEW.account_name, currency_code = NEW.currency_code, is_active = NEW.is_active
            WHERE bank_account_id = OLD.bank_account_id;
            WHERE bank_account_id = OLD.bank_account_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM finance.bank_account
           DELETE FROM finance.bank_account
            WHERE bank_account_id = OLD.bank_account_id;
            WHERE bank_account_id = OLD.bank_account_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_finance_bank_statement_line_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_finance_bank_statement_line_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_finance_bank_statement_line_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_finance_bank_statement_line_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'finance', 'public'
    SET search_path TO 'finance', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO finance.bank_statement_line (bank_statement_id, line_no, transaction_date, description, debit_amount, credit_amount, balance_amount)
           INSERT INTO finance.bank_statement_line (bank_statement_id, line_no, transaction_date, description, debit_amount, credit_amount, balance_amount)
           VALUES (NEW.bank_statement_id, NEW.line_no, NEW.transaction_date, NEW.description, NEW.debit_amount, NEW.credit_amount, NEW.balance_amount)
           VALUES (NEW.bank_statement_id, NEW.line_no, NEW.transaction_date, NEW.description, NEW.debit_amount, NEW.credit_amount, NEW.balance_amount)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE finance.bank_statement_line
           UPDATE finance.bank_statement_line
              SET bank_statement_id = NEW.bank_statement_id, line_no = NEW.line_no, transaction_date = NEW.transaction_date, description = NEW.description, debit_amount = NEW.debit_amount, credit_amount = NEW.credit_amount, balance_amount = NEW.balance_amount
              SET bank_statement_id = NEW.bank_statement_id, line_no = NEW.line_no, transaction_date = NEW.transaction_date, description = NEW.description, debit_amount = NEW.debit_amount, credit_amount = NEW.credit_amount, balance_amount = NEW.balance_amount
            WHERE bank_statement_line_id = OLD.bank_statement_line_id;
            WHERE bank_statement_line_id = OLD.bank_statement_line_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM finance.bank_statement_line
           DELETE FROM finance.bank_statement_line
            WHERE bank_statement_line_id = OLD.bank_statement_line_id;
            WHERE bank_statement_line_id = OLD.bank_statement_line_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_finance_payment_allocation_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_finance_payment_allocation_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_finance_payment_allocation_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_finance_payment_allocation_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'finance', 'public'
    SET search_path TO 'finance', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO finance.payment_allocation (payment_id, source_type, source_id, allocated_amount, allocated_at)
           INSERT INTO finance.payment_allocation (payment_id, source_type, source_id, allocated_amount, allocated_at)
           VALUES (NEW.payment_id, NEW.source_type, NEW.source_id, NEW.allocated_amount, NEW.allocated_at)
           VALUES (NEW.payment_id, NEW.source_type, NEW.source_id, NEW.allocated_amount, NEW.allocated_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE finance.payment_allocation
           UPDATE finance.payment_allocation
              SET payment_id = NEW.payment_id, source_type = NEW.source_type, source_id = NEW.source_id, allocated_amount = NEW.allocated_amount, allocated_at = NEW.allocated_at
              SET payment_id = NEW.payment_id, source_type = NEW.source_type, source_id = NEW.source_id, allocated_amount = NEW.allocated_amount, allocated_at = NEW.allocated_at
            WHERE payment_allocation_id = OLD.payment_allocation_id;
            WHERE payment_allocation_id = OLD.payment_allocation_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM finance.payment_allocation
           DELETE FROM finance.payment_allocation
            WHERE payment_allocation_id = OLD.payment_allocation_id;
            WHERE payment_allocation_id = OLD.payment_allocation_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_finance_payment_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_finance_payment_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_finance_payment_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_finance_payment_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'finance', 'public'
    SET search_path TO 'finance', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO finance.payment (company_id, payment_type, partner_type, partner_id, payment_date, amount, bank_account_id, status_code, created_at)
           INSERT INTO finance.payment (company_id, payment_type, partner_type, partner_id, payment_date, amount, bank_account_id, status_code, created_at)
           VALUES (my_company_id(), NEW.payment_type, NEW.partner_type, NEW.partner_id, NEW.payment_date, NEW.amount, NEW.bank_account_id, NEW.status_code, NEW.created_at)
           VALUES (my_company_id(), NEW.payment_type, NEW.partner_type, NEW.partner_id, NEW.payment_date, NEW.amount, NEW.bank_account_id, NEW.status_code, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE finance.payment
           UPDATE finance.payment
              SET payment_type = NEW.payment_type, partner_type = NEW.partner_type, partner_id = NEW.partner_id, payment_date = NEW.payment_date, amount = NEW.amount, bank_account_id = NEW.bank_account_id, status_code = NEW.status_code, created_at = NEW.created_at
              SET payment_type = NEW.payment_type, partner_type = NEW.partner_type, partner_id = NEW.partner_id, payment_date = NEW.payment_date, amount = NEW.amount, bank_account_id = NEW.bank_account_id, status_code = NEW.status_code, created_at = NEW.created_at
            WHERE payment_id = OLD.payment_id;
            WHERE payment_id = OLD.payment_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM finance.payment
           DELETE FROM finance.payment
            WHERE payment_id = OLD.payment_id;
            WHERE payment_id = OLD.payment_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_hr_attendance_log_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_hr_attendance_log_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_hr_attendance_log_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_hr_attendance_log_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'hr', 'public'
    SET search_path TO 'hr', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO hr.attendance_log (company_id, employee_id, work_date, clock_in, clock_out, work_minutes)
           INSERT INTO hr.attendance_log (company_id, employee_id, work_date, clock_in, clock_out, work_minutes)
           VALUES (my_company_id(), NEW.employee_id, NEW.work_date, NEW.clock_in, NEW.clock_out, NEW.work_minutes)
           VALUES (my_company_id(), NEW.employee_id, NEW.work_date, NEW.clock_in, NEW.clock_out, NEW.work_minutes)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE hr.attendance_log
           UPDATE hr.attendance_log
              SET employee_id = NEW.employee_id, work_date = NEW.work_date, clock_in = NEW.clock_in, clock_out = NEW.clock_out, work_minutes = NEW.work_minutes
              SET employee_id = NEW.employee_id, work_date = NEW.work_date, clock_in = NEW.clock_in, clock_out = NEW.clock_out, work_minutes = NEW.work_minutes
            WHERE attendance_log_id = OLD.attendance_log_id;
            WHERE attendance_log_id = OLD.attendance_log_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM hr.attendance_log
           DELETE FROM hr.attendance_log
            WHERE attendance_log_id = OLD.attendance_log_id;
            WHERE attendance_log_id = OLD.attendance_log_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_hr_employee_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_hr_employee_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_hr_employee_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_hr_employee_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'hr', 'public'
    SET search_path TO 'hr', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO hr.employee (company_id, employee_code, employee_name, department_id, position_id, hired_date, is_active)
           INSERT INTO hr.employee (company_id, employee_code, employee_name, department_id, position_id, hired_date, is_active)
           VALUES (my_company_id(), NEW.employee_code, NEW.employee_name, NEW.department_id, NEW.position_id, NEW.hired_date, NEW.is_active)
           VALUES (my_company_id(), NEW.employee_code, NEW.employee_name, NEW.department_id, NEW.position_id, NEW.hired_date, NEW.is_active)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE hr.employee
           UPDATE hr.employee
              SET employee_code = NEW.employee_code, employee_name = NEW.employee_name, department_id = NEW.department_id, position_id = NEW.position_id, hired_date = NEW.hired_date, is_active = NEW.is_active
              SET employee_code = NEW.employee_code, employee_name = NEW.employee_name, department_id = NEW.department_id, position_id = NEW.position_id, hired_date = NEW.hired_date, is_active = NEW.is_active
            WHERE employee_id = OLD.employee_id;
            WHERE employee_id = OLD.employee_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM hr.employee
           DELETE FROM hr.employee
            WHERE employee_id = OLD.employee_id;
            WHERE employee_id = OLD.employee_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_hr_employment_contract_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_hr_employment_contract_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_hr_employment_contract_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_hr_employment_contract_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'hr', 'public'
    SET search_path TO 'hr', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO hr.employment_contract (company_id, employee_id, employment_type, start_date, end_date, base_salary, created_at)
           INSERT INTO hr.employment_contract (company_id, employee_id, employment_type, start_date, end_date, base_salary, created_at)
           VALUES (my_company_id(), NEW.employee_id, NEW.employment_type, NEW.start_date, NEW.end_date, NEW.base_salary, NEW.created_at)
           VALUES (my_company_id(), NEW.employee_id, NEW.employment_type, NEW.start_date, NEW.end_date, NEW.base_salary, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE hr.employment_contract
           UPDATE hr.employment_contract
              SET employee_id = NEW.employee_id, employment_type = NEW.employment_type, start_date = NEW.start_date, end_date = NEW.end_date, base_salary = NEW.base_salary, created_at = NEW.created_at
              SET employee_id = NEW.employee_id, employment_type = NEW.employment_type, start_date = NEW.start_date, end_date = NEW.end_date, base_salary = NEW.base_salary, created_at = NEW.created_at
            WHERE employment_contract_id = OLD.employment_contract_id;
            WHERE employment_contract_id = OLD.employment_contract_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM hr.employment_contract
           DELETE FROM hr.employment_contract
            WHERE employment_contract_id = OLD.employment_contract_id;
            WHERE employment_contract_id = OLD.employment_contract_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_hr_leave_request_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_hr_leave_request_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_hr_leave_request_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_hr_leave_request_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'hr', 'public'
    SET search_path TO 'hr', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO hr.leave_request (company_id, employee_id, leave_type_code, start_date, end_date, status_code, approved_by, created_at)
           INSERT INTO hr.leave_request (company_id, employee_id, leave_type_code, start_date, end_date, status_code, approved_by, created_at)
           VALUES (my_company_id(), NEW.employee_id, NEW.leave_type_code, NEW.start_date, NEW.end_date, NEW.status_code, NEW.approved_by, NEW.created_at)
           VALUES (my_company_id(), NEW.employee_id, NEW.leave_type_code, NEW.start_date, NEW.end_date, NEW.status_code, NEW.approved_by, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE hr.leave_request
           UPDATE hr.leave_request
              SET employee_id = NEW.employee_id, leave_type_code = NEW.leave_type_code, start_date = NEW.start_date, end_date = NEW.end_date, status_code = NEW.status_code, approved_by = NEW.approved_by, created_at = NEW.created_at
              SET employee_id = NEW.employee_id, leave_type_code = NEW.leave_type_code, start_date = NEW.start_date, end_date = NEW.end_date, status_code = NEW.status_code, approved_by = NEW.approved_by, created_at = NEW.created_at
            WHERE leave_request_id = OLD.leave_request_id;
            WHERE leave_request_id = OLD.leave_request_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM hr.leave_request
           DELETE FROM hr.leave_request
            WHERE leave_request_id = OLD.leave_request_id;
            WHERE leave_request_id = OLD.leave_request_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_hr_payroll_run_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_hr_payroll_run_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_hr_payroll_run_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_hr_payroll_run_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'hr', 'public'
    SET search_path TO 'hr', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO hr.payroll_run (company_id, pay_month, status_code, created_at)
           INSERT INTO hr.payroll_run (company_id, pay_month, status_code, created_at)
           VALUES (my_company_id(), NEW.pay_month, NEW.status_code, NEW.created_at)
           VALUES (my_company_id(), NEW.pay_month, NEW.status_code, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE hr.payroll_run
           UPDATE hr.payroll_run
              SET pay_month = NEW.pay_month, status_code = NEW.status_code, created_at = NEW.created_at
              SET pay_month = NEW.pay_month, status_code = NEW.status_code, created_at = NEW.created_at
            WHERE payroll_run_id = OLD.payroll_run_id;
            WHERE payroll_run_id = OLD.payroll_run_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM hr.payroll_run
           DELETE FROM hr.payroll_run
            WHERE payroll_run_id = OLD.payroll_run_id;
            WHERE payroll_run_id = OLD.payroll_run_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_hr_payroll_slip_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_hr_payroll_slip_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_hr_payroll_slip_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_hr_payroll_slip_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'hr', 'public'
    SET search_path TO 'hr', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO hr.payroll_slip (payroll_run_id, employee_id, gross_pay, net_pay, created_at)
           INSERT INTO hr.payroll_slip (payroll_run_id, employee_id, gross_pay, net_pay, created_at)
           VALUES (NEW.payroll_run_id, NEW.employee_id, NEW.gross_pay, NEW.net_pay, NEW.created_at)
           VALUES (NEW.payroll_run_id, NEW.employee_id, NEW.gross_pay, NEW.net_pay, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE hr.payroll_slip
           UPDATE hr.payroll_slip
              SET payroll_run_id = NEW.payroll_run_id, employee_id = NEW.employee_id, gross_pay = NEW.gross_pay, net_pay = NEW.net_pay, created_at = NEW.created_at
              SET payroll_run_id = NEW.payroll_run_id, employee_id = NEW.employee_id, gross_pay = NEW.gross_pay, net_pay = NEW.net_pay, created_at = NEW.created_at
            WHERE payroll_slip_id = OLD.payroll_slip_id;
            WHERE payroll_slip_id = OLD.payroll_slip_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM hr.payroll_slip
           DELETE FROM hr.payroll_slip
            WHERE payroll_slip_id = OLD.payroll_slip_id;
            WHERE payroll_slip_id = OLD.payroll_slip_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_inventory_valuation_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_inventory_valuation_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_inventory_valuation_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_inventory_valuation_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.inventory_valuation (company_id, item_id, valuation_date, method, unit_cost, created_at)
           INSERT INTO inventory.inventory_valuation (company_id, item_id, valuation_date, method, unit_cost, created_at)
           VALUES (my_company_id(), NEW.item_id, NEW.valuation_date, NEW.method, NEW.unit_cost, NEW.created_at)
           VALUES (my_company_id(), NEW.item_id, NEW.valuation_date, NEW.method, NEW.unit_cost, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.inventory_valuation
           UPDATE inventory.inventory_valuation
              SET item_id = NEW.item_id, valuation_date = NEW.valuation_date, method = NEW.method, unit_cost = NEW.unit_cost, created_at = NEW.created_at
              SET item_id = NEW.item_id, valuation_date = NEW.valuation_date, method = NEW.method, unit_cost = NEW.unit_cost, created_at = NEW.created_at
            WHERE inventory_valuation_id = OLD.inventory_valuation_id;
            WHERE inventory_valuation_id = OLD.inventory_valuation_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.inventory_valuation
           DELETE FROM inventory.inventory_valuation
            WHERE inventory_valuation_id = OLD.inventory_valuation_id;
            WHERE inventory_valuation_id = OLD.inventory_valuation_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_stock_balance_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_stock_balance_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_stock_balance_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_stock_balance_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.stock_balance (company_id, warehouse_id, location_id, bin_id, item_id, qty_on_hand, qty_reserved, updated_at)
           INSERT INTO inventory.stock_balance (company_id, warehouse_id, location_id, bin_id, item_id, qty_on_hand, qty_reserved, updated_at)
           VALUES (my_company_id(), NEW.warehouse_id, NEW.location_id, NEW.bin_id, NEW.item_id, NEW.qty_on_hand, NEW.qty_reserved, NEW.updated_at)
           VALUES (my_company_id(), NEW.warehouse_id, NEW.location_id, NEW.bin_id, NEW.item_id, NEW.qty_on_hand, NEW.qty_reserved, NEW.updated_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.stock_balance
           UPDATE inventory.stock_balance
              SET warehouse_id = NEW.warehouse_id, location_id = NEW.location_id, bin_id = NEW.bin_id, item_id = NEW.item_id, qty_on_hand = NEW.qty_on_hand, qty_reserved = NEW.qty_reserved, updated_at = NEW.updated_at
              SET warehouse_id = NEW.warehouse_id, location_id = NEW.location_id, bin_id = NEW.bin_id, item_id = NEW.item_id, qty_on_hand = NEW.qty_on_hand, qty_reserved = NEW.qty_reserved, updated_at = NEW.updated_at
            WHERE stock_balance_id = OLD.stock_balance_id;
            WHERE stock_balance_id = OLD.stock_balance_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.stock_balance
           DELETE FROM inventory.stock_balance
            WHERE stock_balance_id = OLD.stock_balance_id;
            WHERE stock_balance_id = OLD.stock_balance_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_stock_lot_balance_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_stock_lot_balance_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_stock_lot_balance_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_stock_lot_balance_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.stock_lot_balance (company_id, warehouse_id, location_id, bin_id, item_id, stock_lot_id, qty_on_hand, qty_reserved, updated_at)
           INSERT INTO inventory.stock_lot_balance (company_id, warehouse_id, location_id, bin_id, item_id, stock_lot_id, qty_on_hand, qty_reserved, updated_at)
           VALUES (my_company_id(), NEW.warehouse_id, NEW.location_id, NEW.bin_id, NEW.item_id, NEW.stock_lot_id, NEW.qty_on_hand, NEW.qty_reserved, NEW.updated_at)
           VALUES (my_company_id(), NEW.warehouse_id, NEW.location_id, NEW.bin_id, NEW.item_id, NEW.stock_lot_id, NEW.qty_on_hand, NEW.qty_reserved, NEW.updated_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.stock_lot_balance
           UPDATE inventory.stock_lot_balance
              SET warehouse_id = NEW.warehouse_id, location_id = NEW.location_id, bin_id = NEW.bin_id, item_id = NEW.item_id, stock_lot_id = NEW.stock_lot_id, qty_on_hand = NEW.qty_on_hand, qty_reserved = NEW.qty_reserved, updated_at = NEW.updated_at
              SET warehouse_id = NEW.warehouse_id, location_id = NEW.location_id, bin_id = NEW.bin_id, item_id = NEW.item_id, stock_lot_id = NEW.stock_lot_id, qty_on_hand = NEW.qty_on_hand, qty_reserved = NEW.qty_reserved, updated_at = NEW.updated_at
            WHERE stock_lot_balance_id = OLD.stock_lot_balance_id;
            WHERE stock_lot_balance_id = OLD.stock_lot_balance_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.stock_lot_balance
           DELETE FROM inventory.stock_lot_balance
            WHERE stock_lot_balance_id = OLD.stock_lot_balance_id;
            WHERE stock_lot_balance_id = OLD.stock_lot_balance_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_stock_lot_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_stock_lot_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_stock_lot_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_stock_lot_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.stock_lot (company_id, item_id, lot_no, serial_no, expiry_date)
           INSERT INTO inventory.stock_lot (company_id, item_id, lot_no, serial_no, expiry_date)
           VALUES (my_company_id(), NEW.item_id, NEW.lot_no, NEW.serial_no, NEW.expiry_date)
           VALUES (my_company_id(), NEW.item_id, NEW.lot_no, NEW.serial_no, NEW.expiry_date)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.stock_lot
           UPDATE inventory.stock_lot
              SET item_id = NEW.item_id, lot_no = NEW.lot_no, serial_no = NEW.serial_no, expiry_date = NEW.expiry_date
              SET item_id = NEW.item_id, lot_no = NEW.lot_no, serial_no = NEW.serial_no, expiry_date = NEW.expiry_date
            WHERE stock_lot_id = OLD.stock_lot_id;
            WHERE stock_lot_id = OLD.stock_lot_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.stock_lot
           DELETE FROM inventory.stock_lot
            WHERE stock_lot_id = OLD.stock_lot_id;
            WHERE stock_lot_id = OLD.stock_lot_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_stock_reservation_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_stock_reservation_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_stock_reservation_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_stock_reservation_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.stock_reservation (company_id, entity_type, entity_id, item_id, stock_lot_id, qty_reserved, reserved_at)
           INSERT INTO inventory.stock_reservation (company_id, entity_type, entity_id, item_id, stock_lot_id, qty_reserved, reserved_at)
           VALUES (my_company_id(), NEW.entity_type, NEW.entity_id, NEW.item_id, NEW.stock_lot_id, NEW.qty_reserved, NEW.reserved_at)
           VALUES (my_company_id(), NEW.entity_type, NEW.entity_id, NEW.item_id, NEW.stock_lot_id, NEW.qty_reserved, NEW.reserved_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.stock_reservation
           UPDATE inventory.stock_reservation
              SET entity_type = NEW.entity_type, entity_id = NEW.entity_id, item_id = NEW.item_id, stock_lot_id = NEW.stock_lot_id, qty_reserved = NEW.qty_reserved, reserved_at = NEW.reserved_at
              SET entity_type = NEW.entity_type, entity_id = NEW.entity_id, item_id = NEW.item_id, stock_lot_id = NEW.stock_lot_id, qty_reserved = NEW.qty_reserved, reserved_at = NEW.reserved_at
            WHERE stock_reservation_id = OLD.stock_reservation_id;
            WHERE stock_reservation_id = OLD.stock_reservation_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.stock_reservation
           DELETE FROM inventory.stock_reservation
            WHERE stock_reservation_id = OLD.stock_reservation_id;
            WHERE stock_reservation_id = OLD.stock_reservation_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_stock_transfer_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_stock_transfer_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_stock_transfer_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_stock_transfer_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.stock_transfer_detail (stock_transfer_id, line_no, item_id, qty, from_location_id, to_location_id, from_bin_id, to_bin_id, stock_lot_id)
           INSERT INTO inventory.stock_transfer_detail (stock_transfer_id, line_no, item_id, qty, from_location_id, to_location_id, from_bin_id, to_bin_id, stock_lot_id)
           VALUES (NEW.stock_transfer_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.from_location_id, NEW.to_location_id, NEW.from_bin_id, NEW.to_bin_id, NEW.stock_lot_id)
           VALUES (NEW.stock_transfer_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.from_location_id, NEW.to_location_id, NEW.from_bin_id, NEW.to_bin_id, NEW.stock_lot_id)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.stock_transfer_detail
           UPDATE inventory.stock_transfer_detail
              SET stock_transfer_id = NEW.stock_transfer_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, from_location_id = NEW.from_location_id, to_location_id = NEW.to_location_id, from_bin_id = NEW.from_bin_id, to_bin_id = NEW.to_bin_id, stock_lot_id = NEW.stock_lot_id
              SET stock_transfer_id = NEW.stock_transfer_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, from_location_id = NEW.from_location_id, to_location_id = NEW.to_location_id, from_bin_id = NEW.from_bin_id, to_bin_id = NEW.to_bin_id, stock_lot_id = NEW.stock_lot_id
            WHERE stock_transfer_detail_id = OLD.stock_transfer_detail_id;
            WHERE stock_transfer_detail_id = OLD.stock_transfer_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.stock_transfer_detail
           DELETE FROM inventory.stock_transfer_detail
            WHERE stock_transfer_detail_id = OLD.stock_transfer_detail_id;
            WHERE stock_transfer_detail_id = OLD.stock_transfer_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_stocktaking_plan_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_stocktaking_plan_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_stocktaking_plan_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_stocktaking_plan_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.stocktaking_plan (company_id, warehouse_id, plan_date, status_code, created_at)
           INSERT INTO inventory.stocktaking_plan (company_id, warehouse_id, plan_date, status_code, created_at)
           VALUES (my_company_id(), NEW.warehouse_id, NEW.plan_date, NEW.status_code, NEW.created_at)
           VALUES (my_company_id(), NEW.warehouse_id, NEW.plan_date, NEW.status_code, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.stocktaking_plan
           UPDATE inventory.stocktaking_plan
              SET warehouse_id = NEW.warehouse_id, plan_date = NEW.plan_date, status_code = NEW.status_code, created_at = NEW.created_at
              SET warehouse_id = NEW.warehouse_id, plan_date = NEW.plan_date, status_code = NEW.status_code, created_at = NEW.created_at
            WHERE stocktaking_plan_id = OLD.stocktaking_plan_id;
            WHERE stocktaking_plan_id = OLD.stocktaking_plan_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.stocktaking_plan
           DELETE FROM inventory.stocktaking_plan
            WHERE stocktaking_plan_id = OLD.stocktaking_plan_id;
            WHERE stocktaking_plan_id = OLD.stocktaking_plan_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_stocktaking_result_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_stocktaking_result_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_stocktaking_result_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_stocktaking_result_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.stocktaking_result (stocktaking_plan_id, company_id, bin_id, item_id, counted_qty, system_qty, difference_qty, created_at)
           INSERT INTO inventory.stocktaking_result (stocktaking_plan_id, company_id, bin_id, item_id, counted_qty, system_qty, difference_qty, created_at)
           VALUES (NEW.stocktaking_plan_id, my_company_id(), NEW.bin_id, NEW.item_id, NEW.counted_qty, NEW.system_qty, NEW.difference_qty, NEW.created_at)
           VALUES (NEW.stocktaking_plan_id, my_company_id(), NEW.bin_id, NEW.item_id, NEW.counted_qty, NEW.system_qty, NEW.difference_qty, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.stocktaking_result
           UPDATE inventory.stocktaking_result
              SET stocktaking_plan_id = NEW.stocktaking_plan_id, bin_id = NEW.bin_id, item_id = NEW.item_id, counted_qty = NEW.counted_qty, system_qty = NEW.system_qty, difference_qty = NEW.difference_qty, created_at = NEW.created_at
              SET stocktaking_plan_id = NEW.stocktaking_plan_id, bin_id = NEW.bin_id, item_id = NEW.item_id, counted_qty = NEW.counted_qty, system_qty = NEW.system_qty, difference_qty = NEW.difference_qty, created_at = NEW.created_at
            WHERE stocktaking_result_id = OLD.stocktaking_result_id;
            WHERE stocktaking_result_id = OLD.stocktaking_result_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.stocktaking_result
           DELETE FROM inventory.stocktaking_result
            WHERE stocktaking_result_id = OLD.stocktaking_result_id;
            WHERE stocktaking_result_id = OLD.stocktaking_result_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_inventory_warehouse_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_inventory_warehouse_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_inventory_warehouse_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_inventory_warehouse_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'inventory', 'public'
    SET search_path TO 'inventory', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO inventory.warehouse (company_id, warehouse_code, warehouse_name, is_active, created_at)
           INSERT INTO inventory.warehouse (company_id, warehouse_code, warehouse_name, is_active, created_at)
           VALUES (my_company_id(), NEW.warehouse_code, NEW.warehouse_name, NEW.is_active, NEW.created_at)
           VALUES (my_company_id(), NEW.warehouse_code, NEW.warehouse_name, NEW.is_active, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE inventory.warehouse
           UPDATE inventory.warehouse
              SET warehouse_code = NEW.warehouse_code, warehouse_name = NEW.warehouse_name, is_active = NEW.is_active, created_at = NEW.created_at
              SET warehouse_code = NEW.warehouse_code, warehouse_name = NEW.warehouse_name, is_active = NEW.is_active, created_at = NEW.created_at
            WHERE warehouse_id = OLD.warehouse_id;
            WHERE warehouse_id = OLD.warehouse_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM inventory.warehouse
           DELETE FROM inventory.warehouse
            WHERE warehouse_id = OLD.warehouse_id;
            WHERE warehouse_id = OLD.warehouse_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_bom_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_bom_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_bom_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_bom_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.bom_detail (bom_id, component_item_id, qty_per, issue_method, created_at)
           INSERT INTO manufacturing.bom_detail (bom_id, component_item_id, qty_per, issue_method, created_at)
           VALUES (NEW.bom_id, NEW.component_item_id, NEW.qty_per, NEW.issue_method, NEW.created_at)
           VALUES (NEW.bom_id, NEW.component_item_id, NEW.qty_per, NEW.issue_method, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.bom_detail
           UPDATE manufacturing.bom_detail
              SET bom_id = NEW.bom_id, component_item_id = NEW.component_item_id, qty_per = NEW.qty_per, issue_method = NEW.issue_method, created_at = NEW.created_at
              SET bom_id = NEW.bom_id, component_item_id = NEW.component_item_id, qty_per = NEW.qty_per, issue_method = NEW.issue_method, created_at = NEW.created_at
            WHERE bom_detail_id = OLD.bom_detail_id;
            WHERE bom_detail_id = OLD.bom_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.bom_detail
           DELETE FROM manufacturing.bom_detail
            WHERE bom_detail_id = OLD.bom_detail_id;
            WHERE bom_detail_id = OLD.bom_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_manufacturing_cost_snapshot_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_manufacturing_cost_snapshot_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_manufacturing_cost_snapshot_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_manufacturing_cost_snapshot_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.manufacturing_cost_snapshot (company_id, work_order_id, total_cost, snapshot_at)
           INSERT INTO manufacturing.manufacturing_cost_snapshot (company_id, work_order_id, total_cost, snapshot_at)
           VALUES (my_company_id(), NEW.work_order_id, NEW.total_cost, NEW.snapshot_at)
           VALUES (my_company_id(), NEW.work_order_id, NEW.total_cost, NEW.snapshot_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.manufacturing_cost_snapshot
           UPDATE manufacturing.manufacturing_cost_snapshot
              SET work_order_id = NEW.work_order_id, total_cost = NEW.total_cost, snapshot_at = NEW.snapshot_at
              SET work_order_id = NEW.work_order_id, total_cost = NEW.total_cost, snapshot_at = NEW.snapshot_at
            WHERE manufacturing_cost_snapshot_id = OLD.manufacturing_cost_snapshot_id;
            WHERE manufacturing_cost_snapshot_id = OLD.manufacturing_cost_snapshot_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.manufacturing_cost_snapshot
           DELETE FROM manufacturing.manufacturing_cost_snapshot
            WHERE manufacturing_cost_snapshot_id = OLD.manufacturing_cost_snapshot_id;
            WHERE manufacturing_cost_snapshot_id = OLD.manufacturing_cost_snapshot_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_mps_plan_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_mps_plan_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_mps_plan_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_mps_plan_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.mps_plan (mps_run_id, item_id, plan_date, plan_qty)
           INSERT INTO manufacturing.mps_plan (mps_run_id, item_id, plan_date, plan_qty)
           VALUES (NEW.mps_run_id, NEW.item_id, NEW.plan_date, NEW.plan_qty)
           VALUES (NEW.mps_run_id, NEW.item_id, NEW.plan_date, NEW.plan_qty)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.mps_plan
           UPDATE manufacturing.mps_plan
              SET mps_run_id = NEW.mps_run_id, item_id = NEW.item_id, plan_date = NEW.plan_date, plan_qty = NEW.plan_qty
              SET mps_run_id = NEW.mps_run_id, item_id = NEW.item_id, plan_date = NEW.plan_date, plan_qty = NEW.plan_qty
            WHERE mps_plan_id = OLD.mps_plan_id;
            WHERE mps_plan_id = OLD.mps_plan_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.mps_plan
           DELETE FROM manufacturing.mps_plan
            WHERE mps_plan_id = OLD.mps_plan_id;
            WHERE mps_plan_id = OLD.mps_plan_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_mps_run_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_mps_run_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_mps_run_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_mps_run_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.mps_run (company_id, run_type, run_at)
           INSERT INTO manufacturing.mps_run (company_id, run_type, run_at)
           VALUES (my_company_id(), NEW.run_type, NEW.run_at)
           VALUES (my_company_id(), NEW.run_type, NEW.run_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.mps_run
           UPDATE manufacturing.mps_run
              SET run_type = NEW.run_type, run_at = NEW.run_at
              SET run_type = NEW.run_type, run_at = NEW.run_at
            WHERE mps_run_id = OLD.mps_run_id;
            WHERE mps_run_id = OLD.mps_run_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.mps_run
           DELETE FROM manufacturing.mps_run
            WHERE mps_run_id = OLD.mps_run_id;
            WHERE mps_run_id = OLD.mps_run_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_mrp_allocation_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_mrp_allocation_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_mrp_allocation_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_mrp_allocation_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.mrp_allocation (mrp_requirement_id, source_type, source_id, qty_allocated)
           INSERT INTO manufacturing.mrp_allocation (mrp_requirement_id, source_type, source_id, qty_allocated)
           VALUES (NEW.mrp_requirement_id, NEW.source_type, NEW.source_id, NEW.qty_allocated)
           VALUES (NEW.mrp_requirement_id, NEW.source_type, NEW.source_id, NEW.qty_allocated)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.mrp_allocation
           UPDATE manufacturing.mrp_allocation
              SET mrp_requirement_id = NEW.mrp_requirement_id, source_type = NEW.source_type, source_id = NEW.source_id, qty_allocated = NEW.qty_allocated
              SET mrp_requirement_id = NEW.mrp_requirement_id, source_type = NEW.source_type, source_id = NEW.source_id, qty_allocated = NEW.qty_allocated
            WHERE mrp_allocation_id = OLD.mrp_allocation_id;
            WHERE mrp_allocation_id = OLD.mrp_allocation_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.mrp_allocation
           DELETE FROM manufacturing.mrp_allocation
            WHERE mrp_allocation_id = OLD.mrp_allocation_id;
            WHERE mrp_allocation_id = OLD.mrp_allocation_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_mrp_requirement_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_mrp_requirement_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_mrp_requirement_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_mrp_requirement_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.mrp_requirement (mrp_run_id, item_id, requirement_date, qty_required, supply_type)
           INSERT INTO manufacturing.mrp_requirement (mrp_run_id, item_id, requirement_date, qty_required, supply_type)
           VALUES (NEW.mrp_run_id, NEW.item_id, NEW.requirement_date, NEW.qty_required, NEW.supply_type)
           VALUES (NEW.mrp_run_id, NEW.item_id, NEW.requirement_date, NEW.qty_required, NEW.supply_type)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.mrp_requirement
           UPDATE manufacturing.mrp_requirement
              SET mrp_run_id = NEW.mrp_run_id, item_id = NEW.item_id, requirement_date = NEW.requirement_date, qty_required = NEW.qty_required, supply_type = NEW.supply_type
              SET mrp_run_id = NEW.mrp_run_id, item_id = NEW.item_id, requirement_date = NEW.requirement_date, qty_required = NEW.qty_required, supply_type = NEW.supply_type
            WHERE mrp_requirement_id = OLD.mrp_requirement_id;
            WHERE mrp_requirement_id = OLD.mrp_requirement_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.mrp_requirement
           DELETE FROM manufacturing.mrp_requirement
            WHERE mrp_requirement_id = OLD.mrp_requirement_id;
            WHERE mrp_requirement_id = OLD.mrp_requirement_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_mrp_run_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_mrp_run_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_mrp_run_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_mrp_run_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.mrp_run (company_id, run_type, run_at)
           INSERT INTO manufacturing.mrp_run (company_id, run_type, run_at)
           VALUES (my_company_id(), NEW.run_type, NEW.run_at)
           VALUES (my_company_id(), NEW.run_type, NEW.run_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.mrp_run
           UPDATE manufacturing.mrp_run
              SET run_type = NEW.run_type, run_at = NEW.run_at
              SET run_type = NEW.run_type, run_at = NEW.run_at
            WHERE mrp_run_id = OLD.mrp_run_id;
            WHERE mrp_run_id = OLD.mrp_run_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.mrp_run
           DELETE FROM manufacturing.mrp_run
            WHERE mrp_run_id = OLD.mrp_run_id;
            WHERE mrp_run_id = OLD.mrp_run_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_routing_operation_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_routing_operation_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_routing_operation_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_routing_operation_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.routing_operation (routing_id, operation_no, process_id, std_time_minutes)
           INSERT INTO manufacturing.routing_operation (routing_id, operation_no, process_id, std_time_minutes)
           VALUES (NEW.routing_id, NEW.operation_no, NEW.process_id, NEW.std_time_minutes)
           VALUES (NEW.routing_id, NEW.operation_no, NEW.process_id, NEW.std_time_minutes)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.routing_operation
           UPDATE manufacturing.routing_operation
              SET routing_id = NEW.routing_id, operation_no = NEW.operation_no, process_id = NEW.process_id, std_time_minutes = NEW.std_time_minutes
              SET routing_id = NEW.routing_id, operation_no = NEW.operation_no, process_id = NEW.process_id, std_time_minutes = NEW.std_time_minutes
            WHERE routing_operation_id = OLD.routing_operation_id;
            WHERE routing_operation_id = OLD.routing_operation_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.routing_operation
           DELETE FROM manufacturing.routing_operation
            WHERE routing_operation_id = OLD.routing_operation_id;
            WHERE routing_operation_id = OLD.routing_operation_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_work_order_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_work_order_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_work_order_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_work_order_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.work_order (company_id, wo_no, item_id, bom_id, routing_id, warehouse_id, plan_qty, plan_start_date, plan_end_date, status_code, created_at)
           INSERT INTO manufacturing.work_order (company_id, wo_no, item_id, bom_id, routing_id, warehouse_id, plan_qty, plan_start_date, plan_end_date, status_code, created_at)
           VALUES (my_company_id(), NEW.wo_no, NEW.item_id, NEW.bom_id, NEW.routing_id, NEW.warehouse_id, NEW.plan_qty, NEW.plan_start_date, NEW.plan_end_date, NEW.status_code, NEW.created_at)
           VALUES (my_company_id(), NEW.wo_no, NEW.item_id, NEW.bom_id, NEW.routing_id, NEW.warehouse_id, NEW.plan_qty, NEW.plan_start_date, NEW.plan_end_date, NEW.status_code, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.work_order
           UPDATE manufacturing.work_order
              SET wo_no = NEW.wo_no, item_id = NEW.item_id, bom_id = NEW.bom_id, routing_id = NEW.routing_id, warehouse_id = NEW.warehouse_id, plan_qty = NEW.plan_qty, plan_start_date = NEW.plan_start_date, plan_end_date = NEW.plan_end_date, status_code = NEW.status_code, created_at = NEW.created_at
              SET wo_no = NEW.wo_no, item_id = NEW.item_id, bom_id = NEW.bom_id, routing_id = NEW.routing_id, warehouse_id = NEW.warehouse_id, plan_qty = NEW.plan_qty, plan_start_date = NEW.plan_start_date, plan_end_date = NEW.plan_end_date, status_code = NEW.status_code, created_at = NEW.created_at
            WHERE work_order_id = OLD.work_order_id;
            WHERE work_order_id = OLD.work_order_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.work_order
           DELETE FROM manufacturing.work_order
            WHERE work_order_id = OLD.work_order_id;
            WHERE work_order_id = OLD.work_order_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_manufacturing_yield_metric_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_manufacturing_yield_metric_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_manufacturing_yield_metric_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_manufacturing_yield_metric_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'manufacturing', 'public'
    SET search_path TO 'manufacturing', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO manufacturing.yield_metric (company_id, process_id, metric_date, yield_rate)
           INSERT INTO manufacturing.yield_metric (company_id, process_id, metric_date, yield_rate)
           VALUES (my_company_id(), NEW.process_id, NEW.metric_date, NEW.yield_rate)
           VALUES (my_company_id(), NEW.process_id, NEW.metric_date, NEW.yield_rate)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE manufacturing.yield_metric
           UPDATE manufacturing.yield_metric
              SET process_id = NEW.process_id, metric_date = NEW.metric_date, yield_rate = NEW.yield_rate
              SET process_id = NEW.process_id, metric_date = NEW.metric_date, yield_rate = NEW.yield_rate
            WHERE yield_metric_id = OLD.yield_metric_id;
            WHERE yield_metric_id = OLD.yield_metric_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM manufacturing.yield_metric
           DELETE FROM manufacturing.yield_metric
            WHERE yield_metric_id = OLD.yield_metric_id;
            WHERE yield_metric_id = OLD.yield_metric_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_purchase_invoice_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_purchase_invoice_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_purchase_invoice_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_purchase_invoice_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.purchase_invoice_detail (purchase_invoice_id, line_no, item_id, qty, unit_price, amount, receipt_detail_id, purchase_order_detail_id)
           INSERT INTO purchase.purchase_invoice_detail (purchase_invoice_id, line_no, item_id, qty, unit_price, amount, receipt_detail_id, purchase_order_detail_id)
           VALUES (NEW.purchase_invoice_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.receipt_detail_id, NEW.purchase_order_detail_id)
           VALUES (NEW.purchase_invoice_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.receipt_detail_id, NEW.purchase_order_detail_id)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.purchase_invoice_detail
           UPDATE purchase.purchase_invoice_detail
              SET purchase_invoice_id = NEW.purchase_invoice_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, receipt_detail_id = NEW.receipt_detail_id, purchase_order_detail_id = NEW.purchase_order_detail_id
              SET purchase_invoice_id = NEW.purchase_invoice_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, receipt_detail_id = NEW.receipt_detail_id, purchase_order_detail_id = NEW.purchase_order_detail_id
            WHERE purchase_invoice_detail_id = OLD.purchase_invoice_detail_id;
            WHERE purchase_invoice_detail_id = OLD.purchase_invoice_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.purchase_invoice_detail
           DELETE FROM purchase.purchase_invoice_detail
            WHERE purchase_invoice_detail_id = OLD.purchase_invoice_detail_id;
            WHERE purchase_invoice_detail_id = OLD.purchase_invoice_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_purchase_invoice_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_purchase_invoice_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_purchase_invoice_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_purchase_invoice_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.purchase_invoice (company_id, supplier_id, invoice_no, invoice_date, status_code, total_amount, created_at)
           INSERT INTO purchase.purchase_invoice (company_id, supplier_id, invoice_no, invoice_date, status_code, total_amount, created_at)
           VALUES (my_company_id(), NEW.supplier_id, NEW.invoice_no, NEW.invoice_date, NEW.status_code, NEW.total_amount, NEW.created_at)
           VALUES (my_company_id(), NEW.supplier_id, NEW.invoice_no, NEW.invoice_date, NEW.status_code, NEW.total_amount, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.purchase_invoice
           UPDATE purchase.purchase_invoice
              SET supplier_id = NEW.supplier_id, invoice_no = NEW.invoice_no, invoice_date = NEW.invoice_date, status_code = NEW.status_code, total_amount = NEW.total_amount, created_at = NEW.created_at
              SET supplier_id = NEW.supplier_id, invoice_no = NEW.invoice_no, invoice_date = NEW.invoice_date, status_code = NEW.status_code, total_amount = NEW.total_amount, created_at = NEW.created_at
            WHERE purchase_invoice_id = OLD.purchase_invoice_id;
            WHERE purchase_invoice_id = OLD.purchase_invoice_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.purchase_invoice
           DELETE FROM purchase.purchase_invoice
            WHERE purchase_invoice_id = OLD.purchase_invoice_id;
            WHERE purchase_invoice_id = OLD.purchase_invoice_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_purchase_order_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_purchase_order_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_purchase_order_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_purchase_order_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.purchase_order_detail (purchase_order_id, line_no, item_id, qty, unit_price, amount, promised_date)
           INSERT INTO purchase.purchase_order_detail (purchase_order_id, line_no, item_id, qty, unit_price, amount, promised_date)
           VALUES (NEW.purchase_order_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.promised_date)
           VALUES (NEW.purchase_order_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.promised_date)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.purchase_order_detail
           UPDATE purchase.purchase_order_detail
              SET purchase_order_id = NEW.purchase_order_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, promised_date = NEW.promised_date
              SET purchase_order_id = NEW.purchase_order_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, promised_date = NEW.promised_date
            WHERE purchase_order_detail_id = OLD.purchase_order_detail_id;
            WHERE purchase_order_detail_id = OLD.purchase_order_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.purchase_order_detail
           DELETE FROM purchase.purchase_order_detail
            WHERE purchase_order_detail_id = OLD.purchase_order_detail_id;
            WHERE purchase_order_detail_id = OLD.purchase_order_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_purchase_quotation_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_purchase_quotation_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_purchase_quotation_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_purchase_quotation_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.purchase_quotation_detail (purchase_quotation_id, line_no, item_id, qty, unit_price, amount)
           INSERT INTO purchase.purchase_quotation_detail (purchase_quotation_id, line_no, item_id, qty, unit_price, amount)
           VALUES (NEW.purchase_quotation_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount)
           VALUES (NEW.purchase_quotation_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.purchase_quotation_detail
           UPDATE purchase.purchase_quotation_detail
              SET purchase_quotation_id = NEW.purchase_quotation_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount
              SET purchase_quotation_id = NEW.purchase_quotation_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount
            WHERE purchase_quotation_detail_id = OLD.purchase_quotation_detail_id;
            WHERE purchase_quotation_detail_id = OLD.purchase_quotation_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.purchase_quotation_detail
           DELETE FROM purchase.purchase_quotation_detail
            WHERE purchase_quotation_detail_id = OLD.purchase_quotation_detail_id;
            WHERE purchase_quotation_detail_id = OLD.purchase_quotation_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_purchase_quotation_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_purchase_quotation_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_purchase_quotation_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_purchase_quotation_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.purchase_quotation (company_id, supplier_id, quotation_no, quotation_date, status_code, created_at)
           INSERT INTO purchase.purchase_quotation (company_id, supplier_id, quotation_no, quotation_date, status_code, created_at)
           VALUES (my_company_id(), NEW.supplier_id, NEW.quotation_no, NEW.quotation_date, NEW.status_code, NEW.created_at)
           VALUES (my_company_id(), NEW.supplier_id, NEW.quotation_no, NEW.quotation_date, NEW.status_code, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.purchase_quotation
           UPDATE purchase.purchase_quotation
              SET supplier_id = NEW.supplier_id, quotation_no = NEW.quotation_no, quotation_date = NEW.quotation_date, status_code = NEW.status_code, created_at = NEW.created_at
              SET supplier_id = NEW.supplier_id, quotation_no = NEW.quotation_no, quotation_date = NEW.quotation_date, status_code = NEW.status_code, created_at = NEW.created_at
            WHERE purchase_quotation_id = OLD.purchase_quotation_id;
            WHERE purchase_quotation_id = OLD.purchase_quotation_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.purchase_quotation
           DELETE FROM purchase.purchase_quotation
            WHERE purchase_quotation_id = OLD.purchase_quotation_id;
            WHERE purchase_quotation_id = OLD.purchase_quotation_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_purchase_requisition_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_purchase_requisition_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_purchase_requisition_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_purchase_requisition_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.purchase_requisition_detail (purchase_requisition_id, line_no, item_id, qty, required_date)
           INSERT INTO purchase.purchase_requisition_detail (purchase_requisition_id, line_no, item_id, qty, required_date)
           VALUES (NEW.purchase_requisition_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.required_date)
           VALUES (NEW.purchase_requisition_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.required_date)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.purchase_requisition_detail
           UPDATE purchase.purchase_requisition_detail
              SET purchase_requisition_id = NEW.purchase_requisition_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, required_date = NEW.required_date
              SET purchase_requisition_id = NEW.purchase_requisition_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, required_date = NEW.required_date
            WHERE purchase_requisition_detail_id = OLD.purchase_requisition_detail_id;
            WHERE purchase_requisition_detail_id = OLD.purchase_requisition_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.purchase_requisition_detail
           DELETE FROM purchase.purchase_requisition_detail
            WHERE purchase_requisition_detail_id = OLD.purchase_requisition_detail_id;
            WHERE purchase_requisition_detail_id = OLD.purchase_requisition_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_purchase_requisition_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_purchase_requisition_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_purchase_requisition_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_purchase_requisition_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.purchase_requisition (company_id, requisition_no, requester_id, requisition_date, status_code, created_at)
           INSERT INTO purchase.purchase_requisition (company_id, requisition_no, requester_id, requisition_date, status_code, created_at)
           VALUES (my_company_id(), NEW.requisition_no, NEW.requester_id, NEW.requisition_date, NEW.status_code, NEW.created_at)
           VALUES (my_company_id(), NEW.requisition_no, NEW.requester_id, NEW.requisition_date, NEW.status_code, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.purchase_requisition
           UPDATE purchase.purchase_requisition
              SET requisition_no = NEW.requisition_no, requester_id = NEW.requester_id, requisition_date = NEW.requisition_date, status_code = NEW.status_code, created_at = NEW.created_at
              SET requisition_no = NEW.requisition_no, requester_id = NEW.requester_id, requisition_date = NEW.requisition_date, status_code = NEW.status_code, created_at = NEW.created_at
            WHERE purchase_requisition_id = OLD.purchase_requisition_id;
            WHERE purchase_requisition_id = OLD.purchase_requisition_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.purchase_requisition
           DELETE FROM purchase.purchase_requisition
            WHERE purchase_requisition_id = OLD.purchase_requisition_id;
            WHERE purchase_requisition_id = OLD.purchase_requisition_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_purchase_three_way_match_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_purchase_three_way_match_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_purchase_three_way_match_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_purchase_three_way_match_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.purchase_three_way_match (company_id, purchase_order_detail_id, receipt_detail_id, purchase_invoice_detail_id, matched_at, status_code)
           INSERT INTO purchase.purchase_three_way_match (company_id, purchase_order_detail_id, receipt_detail_id, purchase_invoice_detail_id, matched_at, status_code)
           VALUES (my_company_id(), NEW.purchase_order_detail_id, NEW.receipt_detail_id, NEW.purchase_invoice_detail_id, NEW.matched_at, NEW.status_code)
           VALUES (my_company_id(), NEW.purchase_order_detail_id, NEW.receipt_detail_id, NEW.purchase_invoice_detail_id, NEW.matched_at, NEW.status_code)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.purchase_three_way_match
           UPDATE purchase.purchase_three_way_match
              SET purchase_order_detail_id = NEW.purchase_order_detail_id, receipt_detail_id = NEW.receipt_detail_id, purchase_invoice_detail_id = NEW.purchase_invoice_detail_id, matched_at = NEW.matched_at, status_code = NEW.status_code
              SET purchase_order_detail_id = NEW.purchase_order_detail_id, receipt_detail_id = NEW.receipt_detail_id, purchase_invoice_detail_id = NEW.purchase_invoice_detail_id, matched_at = NEW.matched_at, status_code = NEW.status_code
            WHERE purchase_three_way_match_id = OLD.purchase_three_way_match_id;
            WHERE purchase_three_way_match_id = OLD.purchase_three_way_match_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.purchase_three_way_match
           DELETE FROM purchase.purchase_three_way_match
            WHERE purchase_three_way_match_id = OLD.purchase_three_way_match_id;
            WHERE purchase_three_way_match_id = OLD.purchase_three_way_match_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_supplier_address_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_supplier_address_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_supplier_address_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_supplier_address_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.supplier_address (supplier_id, address_type, postal_code, country_code, prefecture, city, address_line1, address_line2, is_default, created_at)
           INSERT INTO purchase.supplier_address (supplier_id, address_type, postal_code, country_code, prefecture, city, address_line1, address_line2, is_default, created_at)
           VALUES (NEW.supplier_id, NEW.address_type, NEW.postal_code, NEW.country_code, NEW.prefecture, NEW.city, NEW.address_line1, NEW.address_line2, NEW.is_default, NEW.created_at)
           VALUES (NEW.supplier_id, NEW.address_type, NEW.postal_code, NEW.country_code, NEW.prefecture, NEW.city, NEW.address_line1, NEW.address_line2, NEW.is_default, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.supplier_address
           UPDATE purchase.supplier_address
              SET supplier_id = NEW.supplier_id, address_type = NEW.address_type, postal_code = NEW.postal_code, country_code = NEW.country_code, prefecture = NEW.prefecture, city = NEW.city, address_line1 = NEW.address_line1, address_line2 = NEW.address_line2, is_default = NEW.is_default, created_at = NEW.created_at
              SET supplier_id = NEW.supplier_id, address_type = NEW.address_type, postal_code = NEW.postal_code, country_code = NEW.country_code, prefecture = NEW.prefecture, city = NEW.city, address_line1 = NEW.address_line1, address_line2 = NEW.address_line2, is_default = NEW.is_default, created_at = NEW.created_at
            WHERE supplier_address_id = OLD.supplier_address_id;
            WHERE supplier_address_id = OLD.supplier_address_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.supplier_address
           DELETE FROM purchase.supplier_address
            WHERE supplier_address_id = OLD.supplier_address_id;
            WHERE supplier_address_id = OLD.supplier_address_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_supplier_contact_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_supplier_contact_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_supplier_contact_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_supplier_contact_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.supplier_contact (supplier_id, contact_name, department_name, email, phone, mobile, is_primary, is_active, created_at)
           INSERT INTO purchase.supplier_contact (supplier_id, contact_name, department_name, email, phone, mobile, is_primary, is_active, created_at)
           VALUES (NEW.supplier_id, NEW.contact_name, NEW.department_name, NEW.email, NEW.phone, NEW.mobile, NEW.is_primary, NEW.is_active, NEW.created_at)
           VALUES (NEW.supplier_id, NEW.contact_name, NEW.department_name, NEW.email, NEW.phone, NEW.mobile, NEW.is_primary, NEW.is_active, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.supplier_contact
           UPDATE purchase.supplier_contact
              SET supplier_id = NEW.supplier_id, contact_name = NEW.contact_name, department_name = NEW.department_name, email = NEW.email, phone = NEW.phone, mobile = NEW.mobile, is_primary = NEW.is_primary, is_active = NEW.is_active, created_at = NEW.created_at
              SET supplier_id = NEW.supplier_id, contact_name = NEW.contact_name, department_name = NEW.department_name, email = NEW.email, phone = NEW.phone, mobile = NEW.mobile, is_primary = NEW.is_primary, is_active = NEW.is_active, created_at = NEW.created_at
            WHERE supplier_contact_id = OLD.supplier_contact_id;
            WHERE supplier_contact_id = OLD.supplier_contact_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.supplier_contact
           DELETE FROM purchase.supplier_contact
            WHERE supplier_contact_id = OLD.supplier_contact_id;
            WHERE supplier_contact_id = OLD.supplier_contact_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_supplier_item_price_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_supplier_item_price_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_supplier_item_price_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_supplier_item_price_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.supplier_item_price (company_id, supplier_id, item_id, price, currency_code, valid_from, valid_to, is_active)
           INSERT INTO purchase.supplier_item_price (company_id, supplier_id, item_id, price, currency_code, valid_from, valid_to, is_active)
           VALUES (my_company_id(), NEW.supplier_id, NEW.item_id, NEW.price, NEW.currency_code, NEW.valid_from, NEW.valid_to, NEW.is_active)
           VALUES (my_company_id(), NEW.supplier_id, NEW.item_id, NEW.price, NEW.currency_code, NEW.valid_from, NEW.valid_to, NEW.is_active)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.supplier_item_price
           UPDATE purchase.supplier_item_price
              SET supplier_id = NEW.supplier_id, item_id = NEW.item_id, price = NEW.price, currency_code = NEW.currency_code, valid_from = NEW.valid_from, valid_to = NEW.valid_to, is_active = NEW.is_active
              SET supplier_id = NEW.supplier_id, item_id = NEW.item_id, price = NEW.price, currency_code = NEW.currency_code, valid_from = NEW.valid_from, valid_to = NEW.valid_to, is_active = NEW.is_active
            WHERE supplier_item_price_id = OLD.supplier_item_price_id;
            WHERE supplier_item_price_id = OLD.supplier_item_price_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.supplier_item_price
           DELETE FROM purchase.supplier_item_price
            WHERE supplier_item_price_id = OLD.supplier_item_price_id;
            WHERE supplier_item_price_id = OLD.supplier_item_price_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_purchase_supplier_payment_term_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_purchase_supplier_payment_term_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_purchase_supplier_payment_term_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_purchase_supplier_payment_term_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'purchase', 'public'
    SET search_path TO 'purchase', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO purchase.supplier_payment_term (supplier_id, payment_term_id, payment_method_code, valid_from, valid_to, is_active)
           INSERT INTO purchase.supplier_payment_term (supplier_id, payment_term_id, payment_method_code, valid_from, valid_to, is_active)
           VALUES (NEW.supplier_id, NEW.payment_term_id, NEW.payment_method_code, NEW.valid_from, NEW.valid_to, NEW.is_active)
           VALUES (NEW.supplier_id, NEW.payment_term_id, NEW.payment_method_code, NEW.valid_from, NEW.valid_to, NEW.is_active)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE purchase.supplier_payment_term
           UPDATE purchase.supplier_payment_term
              SET supplier_id = NEW.supplier_id, payment_term_id = NEW.payment_term_id, payment_method_code = NEW.payment_method_code, valid_from = NEW.valid_from, valid_to = NEW.valid_to, is_active = NEW.is_active
              SET supplier_id = NEW.supplier_id, payment_term_id = NEW.payment_term_id, payment_method_code = NEW.payment_method_code, valid_from = NEW.valid_from, valid_to = NEW.valid_to, is_active = NEW.is_active
            WHERE supplier_payment_term_id = OLD.supplier_payment_term_id;
            WHERE supplier_payment_term_id = OLD.supplier_payment_term_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM purchase.supplier_payment_term
           DELETE FROM purchase.supplier_payment_term
            WHERE supplier_payment_term_id = OLD.supplier_payment_term_id;
            WHERE supplier_payment_term_id = OLD.supplier_payment_term_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_billing_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_billing_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_billing_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_billing_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.billing_detail (billing_id, line_no, item_id, qty, unit_price, amount, tax_category_code)
           INSERT INTO sales.billing_detail (billing_id, line_no, item_id, qty, unit_price, amount, tax_category_code)
           VALUES (NEW.billing_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.tax_category_code)
           VALUES (NEW.billing_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.tax_category_code)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.billing_detail
           UPDATE sales.billing_detail
              SET billing_id = NEW.billing_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, tax_category_code = NEW.tax_category_code
              SET billing_id = NEW.billing_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, tax_category_code = NEW.tax_category_code
            WHERE billing_detail_id = OLD.billing_detail_id;
            WHERE billing_detail_id = OLD.billing_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.billing_detail
           DELETE FROM sales.billing_detail
            WHERE billing_detail_id = OLD.billing_detail_id;
            WHERE billing_detail_id = OLD.billing_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_customer_address_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_customer_address_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_customer_address_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_customer_address_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.customer_address (customer_id, address_type, postal_code, country_code, prefecture, city, address_line1, address_line2, is_default, created_at)
           INSERT INTO sales.customer_address (customer_id, address_type, postal_code, country_code, prefecture, city, address_line1, address_line2, is_default, created_at)
           VALUES (NEW.customer_id, NEW.address_type, NEW.postal_code, NEW.country_code, NEW.prefecture, NEW.city, NEW.address_line1, NEW.address_line2, NEW.is_default, NEW.created_at)
           VALUES (NEW.customer_id, NEW.address_type, NEW.postal_code, NEW.country_code, NEW.prefecture, NEW.city, NEW.address_line1, NEW.address_line2, NEW.is_default, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.customer_address
           UPDATE sales.customer_address
              SET customer_id = NEW.customer_id, address_type = NEW.address_type, postal_code = NEW.postal_code, country_code = NEW.country_code, prefecture = NEW.prefecture, city = NEW.city, address_line1 = NEW.address_line1, address_line2 = NEW.address_line2, is_default = NEW.is_default, created_at = NEW.created_at
              SET customer_id = NEW.customer_id, address_type = NEW.address_type, postal_code = NEW.postal_code, country_code = NEW.country_code, prefecture = NEW.prefecture, city = NEW.city, address_line1 = NEW.address_line1, address_line2 = NEW.address_line2, is_default = NEW.is_default, created_at = NEW.created_at
            WHERE customer_address_id = OLD.customer_address_id;
            WHERE customer_address_id = OLD.customer_address_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.customer_address
           DELETE FROM sales.customer_address
            WHERE customer_address_id = OLD.customer_address_id;
            WHERE customer_address_id = OLD.customer_address_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_customer_contact_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_customer_contact_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_customer_contact_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_customer_contact_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.customer_contact (customer_id, contact_name, department_name, email, phone, mobile, is_primary, is_active, created_at)
           INSERT INTO sales.customer_contact (customer_id, contact_name, department_name, email, phone, mobile, is_primary, is_active, created_at)
           VALUES (NEW.customer_id, NEW.contact_name, NEW.department_name, NEW.email, NEW.phone, NEW.mobile, NEW.is_primary, NEW.is_active, NEW.created_at)
           VALUES (NEW.customer_id, NEW.contact_name, NEW.department_name, NEW.email, NEW.phone, NEW.mobile, NEW.is_primary, NEW.is_active, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.customer_contact
           UPDATE sales.customer_contact
              SET customer_id = NEW.customer_id, contact_name = NEW.contact_name, department_name = NEW.department_name, email = NEW.email, phone = NEW.phone, mobile = NEW.mobile, is_primary = NEW.is_primary, is_active = NEW.is_active, created_at = NEW.created_at
              SET customer_id = NEW.customer_id, contact_name = NEW.contact_name, department_name = NEW.department_name, email = NEW.email, phone = NEW.phone, mobile = NEW.mobile, is_primary = NEW.is_primary, is_active = NEW.is_active, created_at = NEW.created_at
            WHERE customer_contact_id = OLD.customer_contact_id;
            WHERE customer_contact_id = OLD.customer_contact_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.customer_contact
           DELETE FROM sales.customer_contact
            WHERE customer_contact_id = OLD.customer_contact_id;
            WHERE customer_contact_id = OLD.customer_contact_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_customer_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_customer_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_customer_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_customer_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.customer (company_id, customer_code, customer_name, billing_address, shipping_address, payment_term, credit_limit, is_active, created_at)
           INSERT INTO sales.customer (company_id, customer_code, customer_name, billing_address, shipping_address, payment_term, credit_limit, is_active, created_at)
           VALUES (my_company_id(), NEW.customer_code, NEW.customer_name, NEW.billing_address, NEW.shipping_address, NEW.payment_term, NEW.credit_limit, NEW.is_active, NEW.created_at)
           VALUES (my_company_id(), NEW.customer_code, NEW.customer_name, NEW.billing_address, NEW.shipping_address, NEW.payment_term, NEW.credit_limit, NEW.is_active, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.customer
           UPDATE sales.customer
              SET customer_code = NEW.customer_code, customer_name = NEW.customer_name, billing_address = NEW.billing_address, shipping_address = NEW.shipping_address, payment_term = NEW.payment_term, credit_limit = NEW.credit_limit, is_active = NEW.is_active, created_at = NEW.created_at
              SET customer_code = NEW.customer_code, customer_name = NEW.customer_name, billing_address = NEW.billing_address, shipping_address = NEW.shipping_address, payment_term = NEW.payment_term, credit_limit = NEW.credit_limit, is_active = NEW.is_active, created_at = NEW.created_at
            WHERE customer_id = OLD.customer_id;
            WHERE customer_id = OLD.customer_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.customer
           DELETE FROM sales.customer
            WHERE customer_id = OLD.customer_id;
            WHERE customer_id = OLD.customer_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_customer_payment_term_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_customer_payment_term_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_customer_payment_term_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_customer_payment_term_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.customer_payment_term (customer_id, payment_term_id, payment_method_code, valid_from, valid_to, is_active)
           INSERT INTO sales.customer_payment_term (customer_id, payment_term_id, payment_method_code, valid_from, valid_to, is_active)
           VALUES (NEW.customer_id, NEW.payment_term_id, NEW.payment_method_code, NEW.valid_from, NEW.valid_to, NEW.is_active)
           VALUES (NEW.customer_id, NEW.payment_term_id, NEW.payment_method_code, NEW.valid_from, NEW.valid_to, NEW.is_active)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.customer_payment_term
           UPDATE sales.customer_payment_term
              SET customer_id = NEW.customer_id, payment_term_id = NEW.payment_term_id, payment_method_code = NEW.payment_method_code, valid_from = NEW.valid_from, valid_to = NEW.valid_to, is_active = NEW.is_active
              SET customer_id = NEW.customer_id, payment_term_id = NEW.payment_term_id, payment_method_code = NEW.payment_method_code, valid_from = NEW.valid_from, valid_to = NEW.valid_to, is_active = NEW.is_active
            WHERE customer_payment_term_id = OLD.customer_payment_term_id;
            WHERE customer_payment_term_id = OLD.customer_payment_term_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.customer_payment_term
           DELETE FROM sales.customer_payment_term
            WHERE customer_payment_term_id = OLD.customer_payment_term_id;
            WHERE customer_payment_term_id = OLD.customer_payment_term_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_invoice_pdf_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_invoice_pdf_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_invoice_pdf_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_invoice_pdf_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.invoice_pdf (company_id, billing_id, file_path, created_at)
           INSERT INTO sales.invoice_pdf (company_id, billing_id, file_path, created_at)
           VALUES (my_company_id(), NEW.billing_id, NEW.file_path, NEW.created_at)
           VALUES (my_company_id(), NEW.billing_id, NEW.file_path, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.invoice_pdf
           UPDATE sales.invoice_pdf
              SET billing_id = NEW.billing_id, file_path = NEW.file_path, created_at = NEW.created_at
              SET billing_id = NEW.billing_id, file_path = NEW.file_path, created_at = NEW.created_at
            WHERE invoice_pdf_id = OLD.invoice_pdf_id;
            WHERE invoice_pdf_id = OLD.invoice_pdf_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.invoice_pdf
           DELETE FROM sales.invoice_pdf
            WHERE invoice_pdf_id = OLD.invoice_pdf_id;
            WHERE invoice_pdf_id = OLD.invoice_pdf_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_item_category_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_item_category_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_item_category_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_item_category_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.item_category (company_id, category_code, category_name, parent_category_id, category_level)
           INSERT INTO sales.item_category (company_id, category_code, category_name, parent_category_id, category_level)
           VALUES (my_company_id(), NEW.category_code, NEW.category_name, NEW.parent_category_id, NEW.category_level)
           VALUES (my_company_id(), NEW.category_code, NEW.category_name, NEW.parent_category_id, NEW.category_level)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.item_category
           UPDATE sales.item_category
              SET category_code = NEW.category_code, category_name = NEW.category_name, parent_category_id = NEW.parent_category_id, category_level = NEW.category_level
              SET category_code = NEW.category_code, category_name = NEW.category_name, parent_category_id = NEW.parent_category_id, category_level = NEW.category_level
            WHERE item_category_id = OLD.item_category_id;
            WHERE item_category_id = OLD.item_category_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.item_category
           DELETE FROM sales.item_category
            WHERE item_category_id = OLD.item_category_id;
            WHERE item_category_id = OLD.item_category_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_item_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_item_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_item_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_item_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.item (company_id, item_code, item_name, item_category_id, uom, is_active, created_at)
           INSERT INTO sales.item (company_id, item_code, item_name, item_category_id, uom, is_active, created_at)
           VALUES (my_company_id(), NEW.item_code, NEW.item_name, NEW.item_category_id, NEW.uom, NEW.is_active, NEW.created_at)
           VALUES (my_company_id(), NEW.item_code, NEW.item_name, NEW.item_category_id, NEW.uom, NEW.is_active, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.item
           UPDATE sales.item
              SET item_code = NEW.item_code, item_name = NEW.item_name, item_category_id = NEW.item_category_id, uom = NEW.uom, is_active = NEW.is_active, created_at = NEW.created_at
              SET item_code = NEW.item_code, item_name = NEW.item_name, item_category_id = NEW.item_category_id, uom = NEW.uom, is_active = NEW.is_active, created_at = NEW.created_at
            WHERE item_id = OLD.item_id;
            WHERE item_id = OLD.item_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.item
           DELETE FROM sales.item
            WHERE item_id = OLD.item_id;
            WHERE item_id = OLD.item_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_item_uom_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_item_uom_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_item_uom_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_item_uom_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.item_uom (item_id, uom_code, usage_type, is_primary)
           INSERT INTO sales.item_uom (item_id, uom_code, usage_type, is_primary)
           VALUES (NEW.item_id, NEW.uom_code, NEW.usage_type, NEW.is_primary)
           VALUES (NEW.item_id, NEW.uom_code, NEW.usage_type, NEW.is_primary)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.item_uom
           UPDATE sales.item_uom
              SET item_id = NEW.item_id, uom_code = NEW.uom_code, usage_type = NEW.usage_type, is_primary = NEW.is_primary
              SET item_id = NEW.item_id, uom_code = NEW.uom_code, usage_type = NEW.usage_type, is_primary = NEW.is_primary
            WHERE item_uom_id = OLD.item_uom_id;
            WHERE item_uom_id = OLD.item_uom_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.item_uom
           DELETE FROM sales.item_uom
            WHERE item_uom_id = OLD.item_uom_id;
            WHERE item_uom_id = OLD.item_uom_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_order_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_order_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_order_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_order_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.order_detail (order_id, line_no, item_id, qty, unit_price, amount, requested_ship_date)
           INSERT INTO sales.order_detail (order_id, line_no, item_id, qty, unit_price, amount, requested_ship_date)
           VALUES (NEW.order_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.requested_ship_date)
           VALUES (NEW.order_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.requested_ship_date)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.order_detail
           UPDATE sales.order_detail
              SET order_id = NEW.order_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, requested_ship_date = NEW.requested_ship_date
              SET order_id = NEW.order_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, requested_ship_date = NEW.requested_ship_date
            WHERE order_detail_id = OLD.order_detail_id;
            WHERE order_detail_id = OLD.order_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.order_detail
           DELETE FROM sales.order_detail
            WHERE order_detail_id = OLD.order_detail_id;
            WHERE order_detail_id = OLD.order_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_return_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_return_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_return_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_return_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.return_detail (return_id, line_no, item_id, qty, reason_code)
           INSERT INTO sales.return_detail (return_id, line_no, item_id, qty, reason_code)
           VALUES (NEW.return_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.reason_code)
           VALUES (NEW.return_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.reason_code)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.return_detail
           UPDATE sales.return_detail
              SET return_id = NEW.return_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, reason_code = NEW.reason_code
              SET return_id = NEW.return_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, reason_code = NEW.reason_code
            WHERE return_detail_id = OLD.return_detail_id;
            WHERE return_detail_id = OLD.return_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.return_detail
           DELETE FROM sales.return_detail
            WHERE return_detail_id = OLD.return_detail_id;
            WHERE return_detail_id = OLD.return_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_sales_quotation_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_sales_quotation_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_sales_quotation_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_sales_quotation_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.sales_quotation_detail (sales_quotation_id, line_no, item_id, qty, unit_price, amount, tax_category_code)
           INSERT INTO sales.sales_quotation_detail (sales_quotation_id, line_no, item_id, qty, unit_price, amount, tax_category_code)
           VALUES (NEW.sales_quotation_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.tax_category_code)
           VALUES (NEW.sales_quotation_id, NEW.line_no, NEW.item_id, NEW.qty, NEW.unit_price, NEW.amount, NEW.tax_category_code)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.sales_quotation_detail
           UPDATE sales.sales_quotation_detail
              SET sales_quotation_id = NEW.sales_quotation_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, tax_category_code = NEW.tax_category_code
              SET sales_quotation_id = NEW.sales_quotation_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty, unit_price = NEW.unit_price, amount = NEW.amount, tax_category_code = NEW.tax_category_code
            WHERE sales_quotation_detail_id = OLD.sales_quotation_detail_id;
            WHERE sales_quotation_detail_id = OLD.sales_quotation_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.sales_quotation_detail
           DELETE FROM sales.sales_quotation_detail
            WHERE sales_quotation_detail_id = OLD.sales_quotation_detail_id;
            WHERE sales_quotation_detail_id = OLD.sales_quotation_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_sales_quotation_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_sales_quotation_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_sales_quotation_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_sales_quotation_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.sales_quotation (company_id, quotation_no, customer_id, quotation_date, status_code, created_by, created_at)
           INSERT INTO sales.sales_quotation (company_id, quotation_no, customer_id, quotation_date, status_code, created_by, created_at)
           VALUES (my_company_id(), NEW.quotation_no, NEW.customer_id, NEW.quotation_date, NEW.status_code, NEW.created_by, NEW.created_at)
           VALUES (my_company_id(), NEW.quotation_no, NEW.customer_id, NEW.quotation_date, NEW.status_code, NEW.created_by, NEW.created_at)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.sales_quotation
           UPDATE sales.sales_quotation
              SET quotation_no = NEW.quotation_no, customer_id = NEW.customer_id, quotation_date = NEW.quotation_date, status_code = NEW.status_code, created_by = NEW.created_by, created_at = NEW.created_at
              SET quotation_no = NEW.quotation_no, customer_id = NEW.customer_id, quotation_date = NEW.quotation_date, status_code = NEW.status_code, created_by = NEW.created_by, created_at = NEW.created_at
            WHERE sales_quotation_id = OLD.sales_quotation_id;
            WHERE sales_quotation_id = OLD.sales_quotation_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.sales_quotation
           DELETE FROM sales.sales_quotation
            WHERE sales_quotation_id = OLD.sales_quotation_id;
            WHERE sales_quotation_id = OLD.sales_quotation_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: trg_v_sales_shipping_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
-- Name: trg_v_sales_shipping_detail_iud(); Type: FUNCTION; Schema: public; Owner: -
--
--


CREATE FUNCTION public.trg_v_sales_shipping_detail_iud() RETURNS trigger
CREATE FUNCTION public.trg_v_sales_shipping_detail_iud() RETURNS trigger
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    SET search_path TO 'sales', 'public'
    SET search_path TO 'sales', 'public'
    AS $$
    AS $$
       BEGIN
       BEGIN
         IF TG_OP = 'INSERT' THEN
         IF TG_OP = 'INSERT' THEN
           INSERT INTO sales.shipping_detail (shipping_id, order_detail_id, line_no, item_id, qty)
           INSERT INTO sales.shipping_detail (shipping_id, order_detail_id, line_no, item_id, qty)
           VALUES (NEW.shipping_id, NEW.order_detail_id, NEW.line_no, NEW.item_id, NEW.qty)
           VALUES (NEW.shipping_id, NEW.order_detail_id, NEW.line_no, NEW.item_id, NEW.qty)
           RETURNING * INTO NEW;
           RETURNING * INTO NEW;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'UPDATE' THEN
         ELSIF TG_OP = 'UPDATE' THEN
           UPDATE sales.shipping_detail
           UPDATE sales.shipping_detail
              SET shipping_id = NEW.shipping_id, order_detail_id = NEW.order_detail_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty
              SET shipping_id = NEW.shipping_id, order_detail_id = NEW.order_detail_id, line_no = NEW.line_no, item_id = NEW.item_id, qty = NEW.qty
            WHERE shipping_detail_id = OLD.shipping_detail_id;
            WHERE shipping_detail_id = OLD.shipping_detail_id;
           RETURN NEW;
           RETURN NEW;


         ELSIF TG_OP = 'DELETE' THEN
         ELSIF TG_OP = 'DELETE' THEN
           DELETE FROM sales.shipping_detail
           DELETE FROM sales.shipping_detail
            WHERE shipping_detail_id = OLD.shipping_detail_id;
            WHERE shipping_detail_id = OLD.shipping_detail_id;
           RETURN OLD;
           RETURN OLD;
         END IF;
         END IF;


         RETURN NULL;
         RETURN NULL;
       END;
       END;
       $$;
       $$;




--
--
-- Name: apply_rls(jsonb, integer); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: apply_rls(jsonb, integer); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
-- Regclass of the table e.g. public.notes
-- Regclass of the table e.g. public.notes
entity_ regclass = (quote_ident(wal ->> 'schema') || '.' || quote_ident(wal ->> 'table'))::regclass;
entity_ regclass = (quote_ident(wal ->> 'schema') || '.' || quote_ident(wal ->> 'table'))::regclass;


-- I, U, D, T: insert, update ...
-- I, U, D, T: insert, update ...
action realtime.action = (
action realtime.action = (
    case wal ->> 'action'
    case wal ->> 'action'
        when 'I' then 'INSERT'
        when 'I' then 'INSERT'
        when 'U' then 'UPDATE'
        when 'U' then 'UPDATE'
        when 'D' then 'DELETE'
        when 'D' then 'DELETE'
        else 'ERROR'
        else 'ERROR'
    end
    end
);
);


-- Is row level security enabled for the table
-- Is row level security enabled for the table
is_rls_enabled bool = relrowsecurity from pg_class where oid = entity_;
is_rls_enabled bool = relrowsecurity from pg_class where oid = entity_;


subscriptions realtime.subscription[] = array_agg(subs)
subscriptions realtime.subscription[] = array_agg(subs)
    from
    from
        realtime.subscription subs
        realtime.subscription subs
    where
    where
        subs.entity = entity_;
        subs.entity = entity_;


-- Subscription vars
-- Subscription vars
roles regrole[] = array_agg(distinct us.claims_role::text)
roles regrole[] = array_agg(distinct us.claims_role::text)
    from
    from
        unnest(subscriptions) us;
        unnest(subscriptions) us;


working_role regrole;
working_role regrole;
claimed_role regrole;
claimed_role regrole;
claims jsonb;
claims jsonb;


subscription_id uuid;
subscription_id uuid;
subscription_has_access bool;
subscription_has_access bool;
visible_to_subscription_ids uuid[] = '{}';
visible_to_subscription_ids uuid[] = '{}';


-- structured info for wal's columns
-- structured info for wal's columns
columns realtime.wal_column[];
columns realtime.wal_column[];
-- previous identity values for update/delete
-- previous identity values for update/delete
old_columns realtime.wal_column[];
old_columns realtime.wal_column[];


error_record_exceeds_max_size boolean = octet_length(wal::text) > max_record_bytes;
error_record_exceeds_max_size boolean = octet_length(wal::text) > max_record_bytes;


-- Primary jsonb output for record
-- Primary jsonb output for record
output jsonb;
output jsonb;


begin
begin
perform set_config('role', null, true);
perform set_config('role', null, true);


columns =
columns =
    array_agg(
    array_agg(
        (
        (
            x->>'name',
            x->>'name',
            x->>'type',
            x->>'type',
            x->>'typeoid',
            x->>'typeoid',
            realtime.cast(
            realtime.cast(
                (x->'value') #>> '{}',
                (x->'value') #>> '{}',
                coalesce(
                coalesce(
                    (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4
                    (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4
                    (x->>'type')::regtype
                    (x->>'type')::regtype
                )
                )
            ),
            ),
            (pks ->> 'name') is not null,
            (pks ->> 'name') is not null,
            true
            true
        )::realtime.wal_column
        )::realtime.wal_column
    )
    )
    from
    from
        jsonb_array_elements(wal -> 'columns') x
        jsonb_array_elements(wal -> 'columns') x
        left join jsonb_array_elements(wal -> 'pk') pks
        left join jsonb_array_elements(wal -> 'pk') pks
            on (x ->> 'name') = (pks ->> 'name');
            on (x ->> 'name') = (pks ->> 'name');


old_columns =
old_columns =
    array_agg(
    array_agg(
        (
        (
            x->>'name',
            x->>'name',
            x->>'type',
            x->>'type',
            x->>'typeoid',
            x->>'typeoid',
            realtime.cast(
            realtime.cast(
                (x->'value') #>> '{}',
                (x->'value') #>> '{}',
                coalesce(
                coalesce(
                    (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4
                    (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4
                    (x->>'type')::regtype
                    (x->>'type')::regtype
                )
                )
            ),
            ),
            (pks ->> 'name') is not null,
            (pks ->> 'name') is not null,
            true
            true
        )::realtime.wal_column
        )::realtime.wal_column
    )
    )
    from
    from
        jsonb_array_elements(wal -> 'identity') x
        jsonb_array_elements(wal -> 'identity') x
        left join jsonb_array_elements(wal -> 'pk') pks
        left join jsonb_array_elements(wal -> 'pk') pks
            on (x ->> 'name') = (pks ->> 'name');
            on (x ->> 'name') = (pks ->> 'name');


for working_role in select * from unnest(roles) loop
for working_role in select * from unnest(roles) loop


    -- Update `is_selectable` for columns and old_columns
    -- Update `is_selectable` for columns and old_columns
    columns =
    columns =
        array_agg(
        array_agg(
            (
            (
                c.name,
                c.name,
                c.type_name,
                c.type_name,
                c.type_oid,
                c.type_oid,
                c.value,
                c.value,
                c.is_pkey,
                c.is_pkey,
                pg_catalog.has_column_privilege(working_role, entity_, c.name, 'SELECT')
                pg_catalog.has_column_privilege(working_role, entity_, c.name, 'SELECT')
            )::realtime.wal_column
            )::realtime.wal_column
        )
        )
        from
        from
            unnest(columns) c;
            unnest(columns) c;


    old_columns =
    old_columns =
            array_agg(
            array_agg(
                (
                (
                    c.name,
                    c.name,
                    c.type_name,
                    c.type_name,
                    c.type_oid,
                    c.type_oid,
                    c.value,
                    c.value,
                    c.is_pkey,
                    c.is_pkey,
                    pg_catalog.has_column_privilege(working_role, entity_, c.name, 'SELECT')
                    pg_catalog.has_column_privilege(working_role, entity_, c.name, 'SELECT')
                )::realtime.wal_column
                )::realtime.wal_column
            )
            )
            from
            from
                unnest(old_columns) c;
                unnest(old_columns) c;


    if action <> 'DELETE' and count(1) = 0 from unnest(columns) c where c.is_pkey then
    if action <> 'DELETE' and count(1) = 0 from unnest(columns) c where c.is_pkey then
        return next (
        return next (
            jsonb_build_object(
            jsonb_build_object(
                'schema', wal ->> 'schema',
                'schema', wal ->> 'schema',
                'table', wal ->> 'table',
                'table', wal ->> 'table',
                'type', action
                'type', action
            ),
            ),
            is_rls_enabled,
            is_rls_enabled,
            -- subscriptions is already filtered by entity
            -- subscriptions is already filtered by entity
            (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),
            (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),
            array['Error 400: Bad Request, no primary key']
            array['Error 400: Bad Request, no primary key']
        )::realtime.wal_rls;
        )::realtime.wal_rls;


    -- The claims role does not have SELECT permission to the primary key of entity
    -- The claims role does not have SELECT permission to the primary key of entity
    elsif action <> 'DELETE' and sum(c.is_selectable::int) <> count(1) from unnest(columns) c where c.is_pkey then
    elsif action <> 'DELETE' and sum(c.is_selectable::int) <> count(1) from unnest(columns) c where c.is_pkey then
        return next (
        return next (
            jsonb_build_object(
            jsonb_build_object(
                'schema', wal ->> 'schema',
                'schema', wal ->> 'schema',
                'table', wal ->> 'table',
                'table', wal ->> 'table',
                'type', action
                'type', action
            ),
            ),
            is_rls_enabled,
            is_rls_enabled,
            (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),
            (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),
            array['Error 401: Unauthorized']
            array['Error 401: Unauthorized']
        )::realtime.wal_rls;
        )::realtime.wal_rls;


    else
    else
        output = jsonb_build_object(
        output = jsonb_build_object(
            'schema', wal ->> 'schema',
            'schema', wal ->> 'schema',
            'table', wal ->> 'table',
            'table', wal ->> 'table',
            'type', action,
            'type', action,
            'commit_timestamp', to_char(
            'commit_timestamp', to_char(
                ((wal ->> 'timestamp')::timestamptz at time zone 'utc'),
                ((wal ->> 'timestamp')::timestamptz at time zone 'utc'),
                'YYYY-MM-DD"T"HH24:MI:SS.MS"Z"'
                'YYYY-MM-DD"T"HH24:MI:SS.MS"Z"'
            ),
            ),
            'columns', (
            'columns', (
                select
                select
                    jsonb_agg(
                    jsonb_agg(
                        jsonb_build_object(
                        jsonb_build_object(
                            'name', pa.attname,
                            'name', pa.attname,
                            'type', pt.typname
                            'type', pt.typname
                        )
                        )
                        order by pa.attnum asc
                        order by pa.attnum asc
                    )
                    )
                from
                from
                    pg_attribute pa
                    pg_attribute pa
                    join pg_type pt
                    join pg_type pt
                        on pa.atttypid = pt.oid
                        on pa.atttypid = pt.oid
                where
                where
                    attrelid = entity_
                    attrelid = entity_
                    and attnum > 0
                    and attnum > 0
                    and pg_catalog.has_column_privilege(working_role, entity_, pa.attname, 'SELECT')
                    and pg_catalog.has_column_privilege(working_role, entity_, pa.attname, 'SELECT')
            )
            )
        )
        )
        -- Add "record" key for insert and update
        -- Add "record" key for insert and update
        || case
        || case
            when action in ('INSERT', 'UPDATE') then
            when action in ('INSERT', 'UPDATE') then
                jsonb_build_object(
                jsonb_build_object(
                    'record',
                    'record',
                    (
                    (
                        select
                        select
                            jsonb_object_agg(
                            jsonb_object_agg(
                                -- if unchanged toast, get column name and value from old record
                                -- if unchanged toast, get column name and value from old record
                                coalesce((c).name, (oc).name),
                                coalesce((c).name, (oc).name),
                                case
                                case
                                    when (c).name is null then (oc).value
                                    when (c).name is null then (oc).value
                                    else (c).value
                                    else (c).value
                                end
                                end
                            )
                            )
                        from
                        from
                            unnest(columns) c
                            unnest(columns) c
                            full outer join unnest(old_columns) oc
                            full outer join unnest(old_columns) oc
                                on (c).name = (oc).name
                                on (c).name = (oc).name
                        where
                        where
                            coalesce((c).is_selectable, (oc).is_selectable)
                            coalesce((c).is_selectable, (oc).is_selectable)
                            and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                            and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                    )
                    )
                )
                )
            else '{}'::jsonb
            else '{}'::jsonb
        end
        end
        -- Add "old_record" key for update and delete
        -- Add "old_record" key for update and delete
        || case
        || case
            when action = 'UPDATE' then
            when action = 'UPDATE' then
                jsonb_build_object(
                jsonb_build_object(
                        'old_record',
                        'old_record',
                        (
                        (
                            select jsonb_object_agg((c).name, (c).value)
                            select jsonb_object_agg((c).name, (c).value)
                            from unnest(old_columns) c
                            from unnest(old_columns) c
                            where
                            where
                                (c).is_selectable
                                (c).is_selectable
                                and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                                and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                        )
                        )
                    )
                    )
            when action = 'DELETE' then
            when action = 'DELETE' then
                jsonb_build_object(
                jsonb_build_object(
                    'old_record',
                    'old_record',
                    (
                    (
                        select jsonb_object_agg((c).name, (c).value)
                        select jsonb_object_agg((c).name, (c).value)
                        from unnest(old_columns) c
                        from unnest(old_columns) c
                        where
                        where
                            (c).is_selectable
                            (c).is_selectable
                            and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                            and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))
                            and ( not is_rls_enabled or (c).is_pkey ) -- if RLS enabled, we can't secure deletes so filter to pkey
                            and ( not is_rls_enabled or (c).is_pkey ) -- if RLS enabled, we can't secure deletes so filter to pkey
                    )
                    )
                )
                )
            else '{}'::jsonb
            else '{}'::jsonb
        end;
        end;


        -- Create the prepared statement
        -- Create the prepared statement
        if is_rls_enabled and action <> 'DELETE' then
        if is_rls_enabled and action <> 'DELETE' then
            if (select 1 from pg_prepared_statements where name = 'walrus_rls_stmt' limit 1) > 0 then
            if (select 1 from pg_prepared_statements where name = 'walrus_rls_stmt' limit 1) > 0 then
                deallocate walrus_rls_stmt;
                deallocate walrus_rls_stmt;
            end if;
            end if;
            execute realtime.build_prepared_statement_sql('walrus_rls_stmt', entity_, columns);
            execute realtime.build_prepared_statement_sql('walrus_rls_stmt', entity_, columns);
        end if;
        end if;


        visible_to_subscription_ids = '{}';
        visible_to_subscription_ids = '{}';


        for subscription_id, claims in (
        for subscription_id, claims in (
                select
                select
                    subs.subscription_id,
                    subs.subscription_id,
                    subs.claims
                    subs.claims
                from
                from
                    unnest(subscriptions) subs
                    unnest(subscriptions) subs
                where
                where
                    subs.entity = entity_
                    subs.entity = entity_
                    and subs.claims_role = working_role
                    and subs.claims_role = working_role
                    and (
                    and (
                        realtime.is_visible_through_filters(columns, subs.filters)
                        realtime.is_visible_through_filters(columns, subs.filters)
                        or (
                        or (
                          action = 'DELETE'
                          action = 'DELETE'
                          and realtime.is_visible_through_filters(old_columns, subs.filters)
                          and realtime.is_visible_through_filters(old_columns, subs.filters)
                        )
                        )
                    )
                    )
        ) loop
        ) loop


            if not is_rls_enabled or action = 'DELETE' then
            if not is_rls_enabled or action = 'DELETE' then
                visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;
                visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;
            else
            else
                -- Check if RLS allows the role to see the record
                -- Check if RLS allows the role to see the record
                perform
                perform
                    -- Trim leading and trailing quotes from working_role because set_config
                    -- Trim leading and trailing quotes from working_role because set_config
                    -- doesn't recognize the role as valid if they are included
                    -- doesn't recognize the role as valid if they are included
                    set_config('role', trim(both '"' from working_role::text), true),
                    set_config('role', trim(both '"' from working_role::text), true),
                    set_config('request.jwt.claims', claims::text, true);
                    set_config('request.jwt.claims', claims::text, true);


                execute 'execute walrus_rls_stmt' into subscription_has_access;
                execute 'execute walrus_rls_stmt' into subscription_has_access;


                if subscription_has_access then
                if subscription_has_access then
                    visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;
                    visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;
                end if;
                end if;
            end if;
            end if;
        end loop;
        end loop;


        perform set_config('role', null, true);
        perform set_config('role', null, true);


        return next (
        return next (
            output,
            output,
            is_rls_enabled,
            is_rls_enabled,
            visible_to_subscription_ids,
            visible_to_subscription_ids,
            case
            case
                when error_record_exceeds_max_size then array['Error 413: Payload Too Large']
                when error_record_exceeds_max_size then array['Error 413: Payload Too Large']
                else '{}'
                else '{}'
            end
            end
        )::realtime.wal_rls;
        )::realtime.wal_rls;


    end if;
    end if;
end loop;
end loop;


perform set_config('role', null, true);
perform set_config('role', null, true);
end;
end;
$$;
$$;




--
--
-- Name: broadcast_changes(text, text, text, text, text, record, record, text); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: broadcast_changes(text, text, text, text, text, record, record, text); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
    -- Declare a variable to hold the JSONB representation of the row
    -- Declare a variable to hold the JSONB representation of the row
    row_data jsonb := '{}'::jsonb;
    row_data jsonb := '{}'::jsonb;
BEGIN
BEGIN
    IF level = 'STATEMENT' THEN
    IF level = 'STATEMENT' THEN
        RAISE EXCEPTION 'function can only be triggered for each row, not for each statement';
        RAISE EXCEPTION 'function can only be triggered for each row, not for each statement';
    END IF;
    END IF;
    -- Check the operation type and handle accordingly
    -- Check the operation type and handle accordingly
    IF operation = 'INSERT' OR operation = 'UPDATE' OR operation = 'DELETE' THEN
    IF operation = 'INSERT' OR operation = 'UPDATE' OR operation = 'DELETE' THEN
        row_data := jsonb_build_object('old_record', OLD, 'record', NEW, 'operation', operation, 'table', table_name, 'schema', table_schema);
        row_data := jsonb_build_object('old_record', OLD, 'record', NEW, 'operation', operation, 'table', table_name, 'schema', table_schema);
        PERFORM realtime.send (row_data, event_name, topic_name);
        PERFORM realtime.send (row_data, event_name, topic_name);
    ELSE
    ELSE
        RAISE EXCEPTION 'Unexpected operation type: %', operation;
        RAISE EXCEPTION 'Unexpected operation type: %', operation;
    END IF;
    END IF;
EXCEPTION
EXCEPTION
    WHEN OTHERS THEN
    WHEN OTHERS THEN
        RAISE EXCEPTION 'Failed to process the row: %', SQLERRM;
        RAISE EXCEPTION 'Failed to process the row: %', SQLERRM;
END;
END;


$$;
$$;




--
--
-- Name: build_prepared_statement_sql(text, regclass, realtime.wal_column[]); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: build_prepared_statement_sql(text, regclass, realtime.wal_column[]); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
      /*
      /*
      Builds a sql string that, if executed, creates a prepared statement to
      Builds a sql string that, if executed, creates a prepared statement to
      tests retrive a row from *entity* by its primary key columns.
      tests retrive a row from *entity* by its primary key columns.
      Example
      Example
          select realtime.build_prepared_statement_sql('public.notes', '{"id"}'::text[], '{"bigint"}'::text[])
          select realtime.build_prepared_statement_sql('public.notes', '{"id"}'::text[], '{"bigint"}'::text[])
      */
      */
          select
          select
      'prepare ' || prepared_statement_name || ' as
      'prepare ' || prepared_statement_name || ' as
          select
          select
              exists(
              exists(
                  select
                  select
                      1
                      1
                  from
                  from
                      ' || entity || '
                      ' || entity || '
                  where
                  where
                      ' || string_agg(quote_ident(pkc.name) || '=' || quote_nullable(pkc.value #>> '{}') , ' and ') || '
                      ' || string_agg(quote_ident(pkc.name) || '=' || quote_nullable(pkc.value #>> '{}') , ' and ') || '
              )'
              )'
          from
          from
              unnest(columns) pkc
              unnest(columns) pkc
          where
          where
              pkc.is_pkey
              pkc.is_pkey
          group by
          group by
              entity
              entity
      $$;
      $$;




--
--
-- Name: cast(text, regtype); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: cast(text, regtype); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE plpgsql IMMUTABLE
    LANGUAGE plpgsql IMMUTABLE
    AS $$
    AS $$
    declare
    declare
      res jsonb;
      res jsonb;
    begin
    begin
      execute format('select to_jsonb(%L::'|| type_::text || ')', val)  into res;
      execute format('select to_jsonb(%L::'|| type_::text || ')', val)  into res;
      return res;
      return res;
    end
    end
    $$;
    $$;




--
--
-- Name: check_equality_op(realtime.equality_op, regtype, text, text); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: check_equality_op(realtime.equality_op, regtype, text, text); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE plpgsql IMMUTABLE
    LANGUAGE plpgsql IMMUTABLE
    AS $$
    AS $$
      /*
      /*
      Casts *val_1* and *val_2* as type *type_* and check the *op* condition for truthiness
      Casts *val_1* and *val_2* as type *type_* and check the *op* condition for truthiness
      */
      */
      declare
      declare
          op_symbol text = (
          op_symbol text = (
              case
              case
                  when op = 'eq' then '='
                  when op = 'eq' then '='
                  when op = 'neq' then '!='
                  when op = 'neq' then '!='
                  when op = 'lt' then '<'
                  when op = 'lt' then '<'
                  when op = 'lte' then '<='
                  when op = 'lte' then '<='
                  when op = 'gt' then '>'
                  when op = 'gt' then '>'
                  when op = 'gte' then '>='
                  when op = 'gte' then '>='
                  when op = 'in' then '= any'
                  when op = 'in' then '= any'
                  else 'UNKNOWN OP'
                  else 'UNKNOWN OP'
              end
              end
          );
          );
          res boolean;
          res boolean;
      begin
      begin
          execute format(
          execute format(
              'select %L::'|| type_::text || ' ' || op_symbol
              'select %L::'|| type_::text || ' ' || op_symbol
              || ' ( %L::'
              || ' ( %L::'
              || (
              || (
                  case
                  case
                      when op = 'in' then type_::text || '[]'
                      when op = 'in' then type_::text || '[]'
                      else type_::text end
                      else type_::text end
              )
              )
              || ')', val_1, val_2) into res;
              || ')', val_1, val_2) into res;
          return res;
          return res;
      end;
      end;
      $$;
      $$;




--
--
-- Name: is_visible_through_filters(realtime.wal_column[], realtime.user_defined_filter[]); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: is_visible_through_filters(realtime.wal_column[], realtime.user_defined_filter[]); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE sql IMMUTABLE
    LANGUAGE sql IMMUTABLE
    AS $_$
    AS $_$
    /*
    /*
    Should the record be visible (true) or filtered out (false) after *filters* are applied
    Should the record be visible (true) or filtered out (false) after *filters* are applied
    */
    */
        select
        select
            -- Default to allowed when no filters present
            -- Default to allowed when no filters present
            $2 is null -- no filters. this should not happen because subscriptions has a default
            $2 is null -- no filters. this should not happen because subscriptions has a default
            or array_length($2, 1) is null -- array length of an empty array is null
            or array_length($2, 1) is null -- array length of an empty array is null
            or bool_and(
            or bool_and(
                coalesce(
                coalesce(
                    realtime.check_equality_op(
                    realtime.check_equality_op(
                        op:=f.op,
                        op:=f.op,
                        type_:=coalesce(
                        type_:=coalesce(
                            col.type_oid::regtype, -- null when wal2json version <= 2.4
                            col.type_oid::regtype, -- null when wal2json version <= 2.4
                            col.type_name::regtype
                            col.type_name::regtype
                        ),
                        ),
                        -- cast jsonb to text
                        -- cast jsonb to text
                        val_1:=col.value #>> '{}',
                        val_1:=col.value #>> '{}',
                        val_2:=f.value
                        val_2:=f.value
                    ),
                    ),
                    false -- if null, filter does not match
                    false -- if null, filter does not match
                )
                )
            )
            )
        from
        from
            unnest(filters) f
            unnest(filters) f
            join unnest(columns) col
            join unnest(columns) col
                on f.column_name = col.name;
                on f.column_name = col.name;
    $_$;
    $_$;




--
--
-- Name: list_changes(name, name, integer, integer); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: list_changes(name, name, integer, integer); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE sql
    LANGUAGE sql
    SET log_min_messages TO 'fatal'
    SET log_min_messages TO 'fatal'
    AS $$
    AS $$
      with pub as (
      with pub as (
        select
        select
          concat_ws(
          concat_ws(
            ',',
            ',',
            case when bool_or(pubinsert) then 'insert' else null end,
            case when bool_or(pubinsert) then 'insert' else null end,
            case when bool_or(pubupdate) then 'update' else null end,
            case when bool_or(pubupdate) then 'update' else null end,
            case when bool_or(pubdelete) then 'delete' else null end
            case when bool_or(pubdelete) then 'delete' else null end
          ) as w2j_actions,
          ) as w2j_actions,
          coalesce(
          coalesce(
            string_agg(
            string_agg(
              realtime.quote_wal2json(format('%I.%I', schemaname, tablename)::regclass),
              realtime.quote_wal2json(format('%I.%I', schemaname, tablename)::regclass),
              ','
              ','
            ) filter (where ppt.tablename is not null and ppt.tablename not like '% %'),
            ) filter (where ppt.tablename is not null and ppt.tablename not like '% %'),
            ''
            ''
          ) w2j_add_tables
          ) w2j_add_tables
        from
        from
          pg_publication pp
          pg_publication pp
          left join pg_publication_tables ppt
          left join pg_publication_tables ppt
            on pp.pubname = ppt.pubname
            on pp.pubname = ppt.pubname
        where
        where
          pp.pubname = publication
          pp.pubname = publication
        group by
        group by
          pp.pubname
          pp.pubname
        limit 1
        limit 1
      ),
      ),
      w2j as (
      w2j as (
        select
        select
          x.*, pub.w2j_add_tables
          x.*, pub.w2j_add_tables
        from
        from
          pub,
          pub,
          pg_logical_slot_get_changes(
          pg_logical_slot_get_changes(
            slot_name, null, max_changes,
            slot_name, null, max_changes,
            'include-pk', 'true',
            'include-pk', 'true',
            'include-transaction', 'false',
            'include-transaction', 'false',
            'include-timestamp', 'true',
            'include-timestamp', 'true',
            'include-type-oids', 'true',
            'include-type-oids', 'true',
            'format-version', '2',
            'format-version', '2',
            'actions', pub.w2j_actions,
            'actions', pub.w2j_actions,
            'add-tables', pub.w2j_add_tables
            'add-tables', pub.w2j_add_tables
          ) x
          ) x
      )
      )
      select
      select
        xyz.wal,
        xyz.wal,
        xyz.is_rls_enabled,
        xyz.is_rls_enabled,
        xyz.subscription_ids,
        xyz.subscription_ids,
        xyz.errors
        xyz.errors
      from
      from
        w2j,
        w2j,
        realtime.apply_rls(
        realtime.apply_rls(
          wal := w2j.data::jsonb,
          wal := w2j.data::jsonb,
          max_record_bytes := max_record_bytes
          max_record_bytes := max_record_bytes
        ) xyz(wal, is_rls_enabled, subscription_ids, errors)
        ) xyz(wal, is_rls_enabled, subscription_ids, errors)
      where
      where
        w2j.w2j_add_tables <> ''
        w2j.w2j_add_tables <> ''
        and xyz.subscription_ids[1] is not null
        and xyz.subscription_ids[1] is not null
    $$;
    $$;




--
--
-- Name: quote_wal2json(regclass); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: quote_wal2json(regclass); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE sql IMMUTABLE STRICT
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
    AS $$
      select
      select
        (
        (
          select string_agg('' || ch,'')
          select string_agg('' || ch,'')
          from unnest(string_to_array(nsp.nspname::text, null)) with ordinality x(ch, idx)
          from unnest(string_to_array(nsp.nspname::text, null)) with ordinality x(ch, idx)
          where
          where
            not (x.idx = 1 and x.ch = '"')
            not (x.idx = 1 and x.ch = '"')
            and not (
            and not (
              x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)
              x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)
              and x.ch = '"'
              and x.ch = '"'
            )
            )
        )
        )
        || '.'
        || '.'
        || (
        || (
          select string_agg('' || ch,'')
          select string_agg('' || ch,'')
          from unnest(string_to_array(pc.relname::text, null)) with ordinality x(ch, idx)
          from unnest(string_to_array(pc.relname::text, null)) with ordinality x(ch, idx)
          where
          where
            not (x.idx = 1 and x.ch = '"')
            not (x.idx = 1 and x.ch = '"')
            and not (
            and not (
              x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)
              x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)
              and x.ch = '"'
              and x.ch = '"'
            )
            )
          )
          )
      from
      from
        pg_class pc
        pg_class pc
        join pg_namespace nsp
        join pg_namespace nsp
          on pc.relnamespace = nsp.oid
          on pc.relnamespace = nsp.oid
      where
      where
        pc.oid = entity
        pc.oid = entity
    $$;
    $$;




--
--
-- Name: send(jsonb, text, text, boolean); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: send(jsonb, text, text, boolean); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  generated_id uuid;
  generated_id uuid;
  final_payload jsonb;
  final_payload jsonb;
BEGIN
BEGIN
  BEGIN
  BEGIN
    -- Generate a new UUID for the id
    -- Generate a new UUID for the id
    generated_id := gen_random_uuid();
    generated_id := gen_random_uuid();


    -- Check if payload has an 'id' key, if not, add the generated UUID
    -- Check if payload has an 'id' key, if not, add the generated UUID
    IF payload ? 'id' THEN
    IF payload ? 'id' THEN
      final_payload := payload;
      final_payload := payload;
    ELSE
    ELSE
      final_payload := jsonb_set(payload, '{id}', to_jsonb(generated_id));
      final_payload := jsonb_set(payload, '{id}', to_jsonb(generated_id));
    END IF;
    END IF;


    -- Set the topic configuration
    -- Set the topic configuration
    EXECUTE format('SET LOCAL realtime.topic TO %L', topic);
    EXECUTE format('SET LOCAL realtime.topic TO %L', topic);


    -- Attempt to insert the message
    -- Attempt to insert the message
    INSERT INTO realtime.messages (id, payload, event, topic, private, extension)
    INSERT INTO realtime.messages (id, payload, event, topic, private, extension)
    VALUES (generated_id, final_payload, event, topic, private, 'broadcast');
    VALUES (generated_id, final_payload, event, topic, private, 'broadcast');
  EXCEPTION
  EXCEPTION
    WHEN OTHERS THEN
    WHEN OTHERS THEN
      -- Capture and notify the error
      -- Capture and notify the error
      RAISE WARNING 'ErrorSendingBroadcastMessage: %', SQLERRM;
      RAISE WARNING 'ErrorSendingBroadcastMessage: %', SQLERRM;
  END;
  END;
END;
END;
$$;
$$;




--
--
-- Name: subscription_check_filters(); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: subscription_check_filters(); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
    /*
    /*
    Validates that the user defined filters for a subscription:
    Validates that the user defined filters for a subscription:
    - refer to valid columns that the claimed role may access
    - refer to valid columns that the claimed role may access
    - values are coercable to the correct column type
    - values are coercable to the correct column type
    */
    */
    declare
    declare
        col_names text[] = coalesce(
        col_names text[] = coalesce(
                array_agg(c.column_name order by c.ordinal_position),
                array_agg(c.column_name order by c.ordinal_position),
                '{}'::text[]
                '{}'::text[]
            )
            )
            from
            from
                information_schema.columns c
                information_schema.columns c
            where
            where
                format('%I.%I', c.table_schema, c.table_name)::regclass = new.entity
                format('%I.%I', c.table_schema, c.table_name)::regclass = new.entity
                and pg_catalog.has_column_privilege(
                and pg_catalog.has_column_privilege(
                    (new.claims ->> 'role'),
                    (new.claims ->> 'role'),
                    format('%I.%I', c.table_schema, c.table_name)::regclass,
                    format('%I.%I', c.table_schema, c.table_name)::regclass,
                    c.column_name,
                    c.column_name,
                    'SELECT'
                    'SELECT'
                );
                );
        filter realtime.user_defined_filter;
        filter realtime.user_defined_filter;
        col_type regtype;
        col_type regtype;


        in_val jsonb;
        in_val jsonb;
    begin
    begin
        for filter in select * from unnest(new.filters) loop
        for filter in select * from unnest(new.filters) loop
            -- Filtered column is valid
            -- Filtered column is valid
            if not filter.column_name = any(col_names) then
            if not filter.column_name = any(col_names) then
                raise exception 'invalid column for filter %', filter.column_name;
                raise exception 'invalid column for filter %', filter.column_name;
            end if;
            end if;


            -- Type is sanitized and safe for string interpolation
            -- Type is sanitized and safe for string interpolation
            col_type = (
            col_type = (
                select atttypid::regtype
                select atttypid::regtype
                from pg_catalog.pg_attribute
                from pg_catalog.pg_attribute
                where attrelid = new.entity
                where attrelid = new.entity
                      and attname = filter.column_name
                      and attname = filter.column_name
            );
            );
            if col_type is null then
            if col_type is null then
                raise exception 'failed to lookup type for column %', filter.column_name;
                raise exception 'failed to lookup type for column %', filter.column_name;
            end if;
            end if;


            -- Set maximum number of entries for in filter
            -- Set maximum number of entries for in filter
            if filter.op = 'in'::realtime.equality_op then
            if filter.op = 'in'::realtime.equality_op then
                in_val = realtime.cast(filter.value, (col_type::text || '[]')::regtype);
                in_val = realtime.cast(filter.value, (col_type::text || '[]')::regtype);
                if coalesce(jsonb_array_length(in_val), 0) > 100 then
                if coalesce(jsonb_array_length(in_val), 0) > 100 then
                    raise exception 'too many values for `in` filter. Maximum 100';
                    raise exception 'too many values for `in` filter. Maximum 100';
                end if;
                end if;
            else
            else
                -- raises an exception if value is not coercable to type
                -- raises an exception if value is not coercable to type
                perform realtime.cast(filter.value, col_type);
                perform realtime.cast(filter.value, col_type);
            end if;
            end if;


        end loop;
        end loop;


        -- Apply consistent order to filters so the unique constraint on
        -- Apply consistent order to filters so the unique constraint on
        -- (subscription_id, entity, filters) can't be tricked by a different filter order
        -- (subscription_id, entity, filters) can't be tricked by a different filter order
        new.filters = coalesce(
        new.filters = coalesce(
            array_agg(f order by f.column_name, f.op, f.value),
            array_agg(f order by f.column_name, f.op, f.value),
            '{}'
            '{}'
        ) from unnest(new.filters) f;
        ) from unnest(new.filters) f;


        return new;
        return new;
    end;
    end;
    $$;
    $$;




--
--
-- Name: to_regrole(text); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: to_regrole(text); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE sql IMMUTABLE
    LANGUAGE sql IMMUTABLE
    AS $$ select role_name::regrole $$;
    AS $$ select role_name::regrole $$;




--
--
-- Name: topic(); Type: FUNCTION; Schema: realtime; Owner: -
-- Name: topic(); Type: FUNCTION; Schema: realtime; Owner: -
--
--


    LANGUAGE sql STABLE
    LANGUAGE sql STABLE
    AS $$
    AS $$
select nullif(current_setting('realtime.topic', true), '')::text;
select nullif(current_setting('realtime.topic', true), '')::text;
$$;
$$;




--
--
-- Name: request_order_approval(uuid, bigint, text, text, text); Type: FUNCTION; Schema: sales; Owner: -
-- Name: request_order_approval(uuid, bigint, text, text, text); Type: FUNCTION; Schema: sales; Owner: -
--
--


CREATE FUNCTION sales.request_order_approval(p_company_id uuid, p_order_id bigint, p_order_no text, p_policy_id text, p_reason text) RETURNS void
CREATE FUNCTION sales.request_order_approval(p_company_id uuid, p_order_id bigint, p_order_no text, p_policy_id text, p_reason text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update sales.order_header
  update sales.order_header
     set status_code = 'pending_approval'
     set status_code = 'pending_approval'
   where order_id = p_order_id;
   where order_id = p_order_id;


  insert into approval_request (
  insert into approval_request (
    company_id,
    company_id,
    domain,
    domain,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    order_id,
    order_id,
    reason,
    reason,
    status
    status
  ) values (
  ) values (
    p_company_id,
    p_company_id,
    'sales',
    'sales',
    'order',
    'order',
    p_order_no,
    p_order_no,
    p_order_id,
    p_order_id,
    p_reason,
    p_reason,
    'pending'
    'pending'
  );
  );
end;
end;
$$;
$$;




--
--
-- Name: request_order_approval_safe(uuid, bigint, text, text, text); Type: FUNCTION; Schema: sales; Owner: -
-- Name: request_order_approval_safe(uuid, bigint, text, text, text); Type: FUNCTION; Schema: sales; Owner: -
--
--


CREATE FUNCTION sales.request_order_approval_safe(p_company_id uuid, p_order_id bigint, p_order_no text, p_policy_id text, p_reason text) RETURNS void
CREATE FUNCTION sales.request_order_approval_safe(p_company_id uuid, p_order_id bigint, p_order_no text, p_policy_id text, p_reason text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  if exists (
  if exists (
    select 1 from approval_request
    select 1 from approval_request
     where domain='sales'
     where domain='sales'
       and entity_type='order'
       and entity_type='order'
       and order_id = p_order_id
       and order_id = p_order_id
       and status='pending'
       and status='pending'
  ) then
  ) then
    return;
    return;
  end if;
  end if;


  update sales.order_header
  update sales.order_header
     set status_code = 'pending_approval'
     set status_code = 'pending_approval'
   where order_id = p_order_id;
   where order_id = p_order_id;


  insert into approval_request (
  insert into approval_request (
    company_id, domain, entity_type, entity_id,
    company_id, domain, entity_type, entity_id,
    order_id, reason, status
    order_id, reason, status
  ) values (
  ) values (
    p_company_id, 'sales', 'order', p_order_no,
    p_company_id, 'sales', 'order', p_order_no,
    p_order_id, p_reason, 'pending'
    p_order_id, p_reason, 'pending'
  );
  );
end;
end;
$$;
$$;




--
--
-- Name: order_header; Type: TABLE; Schema: sales; Owner: -
-- Name: order_header; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.order_header (
CREATE TABLE sales.order_header (
    order_id bigint NOT NULL,
    order_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    order_no text NOT NULL,
    order_no text NOT NULL,
    customer_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    order_date date DEFAULT CURRENT_DATE NOT NULL,
    order_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'OPEN'::text NOT NULL,
    status_code text DEFAULT 'OPEN'::text NOT NULL,
    remarks text,
    remarks text,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT chk_order_status CHECK ((status_code = ANY (ARRAY['draft'::text, 'confirmed'::text, 'pending_approval'::text, 'approved'::text, 'rejected'::text, 'cancelled'::text])))
    CONSTRAINT chk_order_status CHECK ((status_code = ANY (ARRAY['draft'::text, 'confirmed'::text, 'pending_approval'::text, 'approved'::text, 'rejected'::text, 'cancelled'::text])))
);
);






--
--
-- Name: rpc_list_orders(date, date); Type: FUNCTION; Schema: sales; Owner: -
-- Name: rpc_list_orders(date, date); Type: FUNCTION; Schema: sales; Owner: -
--
--


CREATE FUNCTION sales.rpc_list_orders(p_from date DEFAULT NULL::date, p_to date DEFAULT NULL::date) RETURNS SETOF sales.order_header
CREATE FUNCTION sales.rpc_list_orders(p_from date DEFAULT NULL::date, p_to date DEFAULT NULL::date) RETURNS SETOF sales.order_header
    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
  v_company_id uuid := public.my_company_id();
  v_company_id uuid := public.my_company_id();
BEGIN
BEGIN
  PERFORM core.fn_log_read_event(
  PERFORM core.fn_log_read_event(
    v_company_id,
    v_company_id,
    'sales.order_header',
    'sales.order_header',
    '',
    '',
    jsonb_build_object('from', p_from, 'to', p_to)
    jsonb_build_object('from', p_from, 'to', p_to)
  );
  );


  RETURN QUERY
  RETURN QUERY
  SELECT *
  SELECT *
  FROM sales.order_header
  FROM sales.order_header
  WHERE company_id = v_company_id
  WHERE company_id = v_company_id
    AND (p_from IS NULL OR order_date >= p_from)
    AND (p_from IS NULL OR order_date >= p_from)
    AND (p_to   IS NULL OR order_date <= p_to)
    AND (p_to   IS NULL OR order_date <= p_to)
  ORDER BY order_date DESC, order_id DESC;
  ORDER BY order_date DESC, order_id DESC;
END;
END;
$$;
$$;




--
--
-- Name: add_prefixes(text, text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: add_prefixes(text, text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
    prefixes text[];
    prefixes text[];
BEGIN
BEGIN
    prefixes := "storage"."get_prefixes"("_name");
    prefixes := "storage"."get_prefixes"("_name");


    IF array_length(prefixes, 1) > 0 THEN
    IF array_length(prefixes, 1) > 0 THEN
        INSERT INTO storage.prefixes (name, bucket_id)
        INSERT INTO storage.prefixes (name, bucket_id)
        SELECT UNNEST(prefixes) as name, "_bucket_id" ON CONFLICT DO NOTHING;
        SELECT UNNEST(prefixes) as name, "_bucket_id" ON CONFLICT DO NOTHING;
    END IF;
    END IF;
END;
END;
$$;
$$;




--
--
-- Name: can_insert_object(text, text, uuid, jsonb); Type: FUNCTION; Schema: storage; Owner: -
-- Name: can_insert_object(text, text, uuid, jsonb); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
  INSERT INTO "storage"."objects" ("bucket_id", "name", "owner", "metadata") VALUES (bucketid, name, owner, metadata);
  INSERT INTO "storage"."objects" ("bucket_id", "name", "owner", "metadata") VALUES (bucketid, name, owner, metadata);
  -- hack to rollback the successful insert
  -- hack to rollback the successful insert
  RAISE sqlstate 'PT200' using
  RAISE sqlstate 'PT200' using
  message = 'ROLLBACK',
  message = 'ROLLBACK',
  detail = 'rollback successful insert';
  detail = 'rollback successful insert';
END
END
$$;
$$;




--
--
-- Name: delete_leaf_prefixes(text[], text[]); Type: FUNCTION; Schema: storage; Owner: -
-- Name: delete_leaf_prefixes(text[], text[]); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
    v_rows_deleted integer;
    v_rows_deleted integer;
BEGIN
BEGIN
    LOOP
    LOOP
        WITH candidates AS (
        WITH candidates AS (
            SELECT DISTINCT
            SELECT DISTINCT
                t.bucket_id,
                t.bucket_id,
                unnest(storage.get_prefixes(t.name)) AS name
                unnest(storage.get_prefixes(t.name)) AS name
            FROM unnest(bucket_ids, names) AS t(bucket_id, name)
            FROM unnest(bucket_ids, names) AS t(bucket_id, name)
        ),
        ),
        uniq AS (
        uniq AS (
             SELECT
             SELECT
                 bucket_id,
                 bucket_id,
                 name,
                 name,
                 storage.get_level(name) AS level
                 storage.get_level(name) AS level
             FROM candidates
             FROM candidates
             WHERE name <> ''
             WHERE name <> ''
             GROUP BY bucket_id, name
             GROUP BY bucket_id, name
        ),
        ),
        leaf AS (
        leaf AS (
             SELECT
             SELECT
                 p.bucket_id,
                 p.bucket_id,
                 p.name,
                 p.name,
                 p.level
                 p.level
             FROM storage.prefixes AS p
             FROM storage.prefixes AS p
                  JOIN uniq AS u
                  JOIN uniq AS u
                       ON u.bucket_id = p.bucket_id
                       ON u.bucket_id = p.bucket_id
                           AND u.name = p.name
                           AND u.name = p.name
                           AND u.level = p.level
                           AND u.level = p.level
             WHERE NOT EXISTS (
             WHERE NOT EXISTS (
                 SELECT 1
                 SELECT 1
                 FROM storage.objects AS o
                 FROM storage.objects AS o
                 WHERE o.bucket_id = p.bucket_id
                 WHERE o.bucket_id = p.bucket_id
                   AND o.level = p.level + 1
                   AND o.level = p.level + 1
                   AND o.name COLLATE "C" LIKE p.name || '/%'
                   AND o.name COLLATE "C" LIKE p.name || '/%'
             )
             )
             AND NOT EXISTS (
             AND NOT EXISTS (
                 SELECT 1
                 SELECT 1
                 FROM storage.prefixes AS c
                 FROM storage.prefixes AS c
                 WHERE c.bucket_id = p.bucket_id
                 WHERE c.bucket_id = p.bucket_id
                   AND c.level = p.level + 1
                   AND c.level = p.level + 1
                   AND c.name COLLATE "C" LIKE p.name || '/%'
                   AND c.name COLLATE "C" LIKE p.name || '/%'
             )
             )
        )
        )
        DELETE
        DELETE
        FROM storage.prefixes AS p
        FROM storage.prefixes AS p
            USING leaf AS l
            USING leaf AS l
        WHERE p.bucket_id = l.bucket_id
        WHERE p.bucket_id = l.bucket_id
          AND p.name = l.name
          AND p.name = l.name
          AND p.level = l.level;
          AND p.level = l.level;


        GET DIAGNOSTICS v_rows_deleted = ROW_COUNT;
        GET DIAGNOSTICS v_rows_deleted = ROW_COUNT;
        EXIT WHEN v_rows_deleted = 0;
        EXIT WHEN v_rows_deleted = 0;
    END LOOP;
    END LOOP;
END;
END;
$$;
$$;




--
--
-- Name: delete_prefix(text, text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: delete_prefix(text, text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
BEGIN
BEGIN
    -- Check if we can delete the prefix
    -- Check if we can delete the prefix
    IF EXISTS(
    IF EXISTS(
        SELECT FROM "storage"."prefixes"
        SELECT FROM "storage"."prefixes"
        WHERE "prefixes"."bucket_id" = "_bucket_id"
        WHERE "prefixes"."bucket_id" = "_bucket_id"
          AND level = "storage"."get_level"("_name") + 1
          AND level = "storage"."get_level"("_name") + 1
          AND "prefixes"."name" COLLATE "C" LIKE "_name" || '/%'
          AND "prefixes"."name" COLLATE "C" LIKE "_name" || '/%'
        LIMIT 1
        LIMIT 1
    )
    )
    OR EXISTS(
    OR EXISTS(
        SELECT FROM "storage"."objects"
        SELECT FROM "storage"."objects"
        WHERE "objects"."bucket_id" = "_bucket_id"
        WHERE "objects"."bucket_id" = "_bucket_id"
          AND "storage"."get_level"("objects"."name") = "storage"."get_level"("_name") + 1
          AND "storage"."get_level"("objects"."name") = "storage"."get_level"("_name") + 1
          AND "objects"."name" COLLATE "C" LIKE "_name" || '/%'
          AND "objects"."name" COLLATE "C" LIKE "_name" || '/%'
        LIMIT 1
        LIMIT 1
    ) THEN
    ) THEN
    -- There are sub-objects, skip deletion
    -- There are sub-objects, skip deletion
    RETURN false;
    RETURN false;
    ELSE
    ELSE
        DELETE FROM "storage"."prefixes"
        DELETE FROM "storage"."prefixes"
        WHERE "prefixes"."bucket_id" = "_bucket_id"
        WHERE "prefixes"."bucket_id" = "_bucket_id"
          AND level = "storage"."get_level"("_name")
          AND level = "storage"."get_level"("_name")
          AND "prefixes"."name" = "_name";
          AND "prefixes"."name" = "_name";
        RETURN true;
        RETURN true;
    END IF;
    END IF;
END;
END;
$$;
$$;




--
--
-- Name: delete_prefix_hierarchy_trigger(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: delete_prefix_hierarchy_trigger(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
    prefix text;
    prefix text;
BEGIN
BEGIN
    prefix := "storage"."get_prefix"(OLD."name");
    prefix := "storage"."get_prefix"(OLD."name");


    IF coalesce(prefix, '') != '' THEN
    IF coalesce(prefix, '') != '' THEN
        PERFORM "storage"."delete_prefix"(OLD."bucket_id", prefix);
        PERFORM "storage"."delete_prefix"(OLD."bucket_id", prefix);
    END IF;
    END IF;


    RETURN OLD;
    RETURN OLD;
END;
END;
$$;
$$;




--
--
-- Name: enforce_bucket_name_length(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: enforce_bucket_name_length(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
    if length(new.name) > 100 then
    if length(new.name) > 100 then
        raise exception 'bucket name "%" is too long (% characters). Max is 100.', new.name, length(new.name);
        raise exception 'bucket name "%" is too long (% characters). Max is 100.', new.name, length(new.name);
    end if;
    end if;
    return new;
    return new;
end;
end;
$$;
$$;




--
--
-- Name: extension(text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: extension(text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql IMMUTABLE
    LANGUAGE plpgsql IMMUTABLE
    AS $$
    AS $$
DECLARE
DECLARE
    _parts text[];
    _parts text[];
    _filename text;
    _filename text;
BEGIN
BEGIN
    SELECT string_to_array(name, '/') INTO _parts;
    SELECT string_to_array(name, '/') INTO _parts;
    SELECT _parts[array_length(_parts,1)] INTO _filename;
    SELECT _parts[array_length(_parts,1)] INTO _filename;
    RETURN reverse(split_part(reverse(_filename), '.', 1));
    RETURN reverse(split_part(reverse(_filename), '.', 1));
END
END
$$;
$$;




--
--
-- Name: filename(text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: filename(text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
_parts text[];
_parts text[];
BEGIN
BEGIN
	select string_to_array(name, '/') into _parts;
	select string_to_array(name, '/') into _parts;
	return _parts[array_length(_parts,1)];
	return _parts[array_length(_parts,1)];
END
END
$$;
$$;




--
--
-- Name: foldername(text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: foldername(text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql IMMUTABLE
    LANGUAGE plpgsql IMMUTABLE
    AS $$
    AS $$
DECLARE
DECLARE
    _parts text[];
    _parts text[];
BEGIN
BEGIN
    -- Split on "/" to get path segments
    -- Split on "/" to get path segments
    SELECT string_to_array(name, '/') INTO _parts;
    SELECT string_to_array(name, '/') INTO _parts;
    -- Return everything except the last segment
    -- Return everything except the last segment
    RETURN _parts[1 : array_length(_parts,1) - 1];
    RETURN _parts[1 : array_length(_parts,1) - 1];
END
END
$$;
$$;




--
--
-- Name: get_level(text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: get_level(text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE sql IMMUTABLE STRICT
    LANGUAGE sql IMMUTABLE STRICT
    AS $$
    AS $$
SELECT array_length(string_to_array("name", '/'), 1);
SELECT array_length(string_to_array("name", '/'), 1);
$$;
$$;




--
--
-- Name: get_prefix(text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: get_prefix(text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE sql IMMUTABLE STRICT
    LANGUAGE sql IMMUTABLE STRICT
    AS $_$
    AS $_$
SELECT
SELECT
    CASE WHEN strpos("name", '/') > 0 THEN
    CASE WHEN strpos("name", '/') > 0 THEN
             regexp_replace("name", '[\/]{1}[^\/]+\/?$', '')
             regexp_replace("name", '[\/]{1}[^\/]+\/?$', '')
         ELSE
         ELSE
             ''
             ''
        END;
        END;
$_$;
$_$;




--
--
-- Name: get_prefixes(text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: get_prefixes(text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql IMMUTABLE STRICT
    LANGUAGE plpgsql IMMUTABLE STRICT
    AS $$
    AS $$
DECLARE
DECLARE
    parts text[];
    parts text[];
    prefixes text[];
    prefixes text[];
    prefix text;
    prefix text;
BEGIN
BEGIN
    -- Split the name into parts by '/'
    -- Split the name into parts by '/'
    parts := string_to_array("name", '/');
    parts := string_to_array("name", '/');
    prefixes := '{}';
    prefixes := '{}';


    -- Construct the prefixes, stopping one level below the last part
    -- Construct the prefixes, stopping one level below the last part
    FOR i IN 1..array_length(parts, 1) - 1 LOOP
    FOR i IN 1..array_length(parts, 1) - 1 LOOP
            prefix := array_to_string(parts[1:i], '/');
            prefix := array_to_string(parts[1:i], '/');
            prefixes := array_append(prefixes, prefix);
            prefixes := array_append(prefixes, prefix);
    END LOOP;
    END LOOP;


    RETURN prefixes;
    RETURN prefixes;
END;
END;
$$;
$$;




--
--
-- Name: get_size_by_bucket(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: get_size_by_bucket(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql STABLE
    LANGUAGE plpgsql STABLE
    AS $$
    AS $$
BEGIN
BEGIN
    return query
    return query
        select sum((metadata->>'size')::bigint) as size, obj.bucket_id
        select sum((metadata->>'size')::bigint) as size, obj.bucket_id
        from "storage".objects as obj
        from "storage".objects as obj
        group by obj.bucket_id;
        group by obj.bucket_id;
END
END
$$;
$$;




--
--
-- Name: list_multipart_uploads_with_delimiter(text, text, text, integer, text, text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: list_multipart_uploads_with_delimiter(text, text, text, integer, text, text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $_$
    AS $_$
BEGIN
BEGIN
    RETURN QUERY EXECUTE
    RETURN QUERY EXECUTE
        'SELECT DISTINCT ON(key COLLATE "C") * from (
        'SELECT DISTINCT ON(key COLLATE "C") * from (
            SELECT
            SELECT
                CASE
                CASE
                    WHEN position($2 IN substring(key from length($1) + 1)) > 0 THEN
                    WHEN position($2 IN substring(key from length($1) + 1)) > 0 THEN
                        substring(key from 1 for length($1) + position($2 IN substring(key from length($1) + 1)))
                        substring(key from 1 for length($1) + position($2 IN substring(key from length($1) + 1)))
                    ELSE
                    ELSE
                        key
                        key
                END AS key, id, created_at
                END AS key, id, created_at
            FROM
            FROM
                storage.s3_multipart_uploads
                storage.s3_multipart_uploads
            WHERE
            WHERE
                bucket_id = $5 AND
                bucket_id = $5 AND
                key ILIKE $1 || ''%'' AND
                key ILIKE $1 || ''%'' AND
                CASE
                CASE
                    WHEN $4 != '''' AND $6 = '''' THEN
                    WHEN $4 != '''' AND $6 = '''' THEN
                        CASE
                        CASE
                            WHEN position($2 IN substring(key from length($1) + 1)) > 0 THEN
                            WHEN position($2 IN substring(key from length($1) + 1)) > 0 THEN
                                substring(key from 1 for length($1) + position($2 IN substring(key from length($1) + 1))) COLLATE "C" > $4
                                substring(key from 1 for length($1) + position($2 IN substring(key from length($1) + 1))) COLLATE "C" > $4
                            ELSE
                            ELSE
                                key COLLATE "C" > $4
                                key COLLATE "C" > $4
                            END
                            END
                    ELSE
                    ELSE
                        true
                        true
                END AND
                END AND
                CASE
                CASE
                    WHEN $6 != '''' THEN
                    WHEN $6 != '''' THEN
                        id COLLATE "C" > $6
                        id COLLATE "C" > $6
                    ELSE
                    ELSE
                        true
                        true
                    END
                    END
            ORDER BY
            ORDER BY
                key COLLATE "C" ASC, created_at ASC) as e order by key COLLATE "C" LIMIT $3'
                key COLLATE "C" ASC, created_at ASC) as e order by key COLLATE "C" LIMIT $3'
        USING prefix_param, delimiter_param, max_keys, next_key_token, bucket_id, next_upload_token;
        USING prefix_param, delimiter_param, max_keys, next_key_token, bucket_id, next_upload_token;
END;
END;
$_$;
$_$;




--
--
-- Name: list_objects_with_delimiter(text, text, text, integer, text, text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: list_objects_with_delimiter(text, text, text, integer, text, text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $_$
    AS $_$
BEGIN
BEGIN
    RETURN QUERY EXECUTE
    RETURN QUERY EXECUTE
        'SELECT DISTINCT ON(name COLLATE "C") * from (
        'SELECT DISTINCT ON(name COLLATE "C") * from (
            SELECT
            SELECT
                CASE
                CASE
                    WHEN position($2 IN substring(name from length($1) + 1)) > 0 THEN
                    WHEN position($2 IN substring(name from length($1) + 1)) > 0 THEN
                        substring(name from 1 for length($1) + position($2 IN substring(name from length($1) + 1)))
                        substring(name from 1 for length($1) + position($2 IN substring(name from length($1) + 1)))
                    ELSE
                    ELSE
                        name
                        name
                END AS name, id, metadata, updated_at
                END AS name, id, metadata, updated_at
            FROM
            FROM
                storage.objects
                storage.objects
            WHERE
            WHERE
                bucket_id = $5 AND
                bucket_id = $5 AND
                name ILIKE $1 || ''%'' AND
                name ILIKE $1 || ''%'' AND
                CASE
                CASE
                    WHEN $6 != '''' THEN
                    WHEN $6 != '''' THEN
                    name COLLATE "C" > $6
                    name COLLATE "C" > $6
                ELSE true END
                ELSE true END
                AND CASE
                AND CASE
                    WHEN $4 != '''' THEN
                    WHEN $4 != '''' THEN
                        CASE
                        CASE
                            WHEN position($2 IN substring(name from length($1) + 1)) > 0 THEN
                            WHEN position($2 IN substring(name from length($1) + 1)) > 0 THEN
                                substring(name from 1 for length($1) + position($2 IN substring(name from length($1) + 1))) COLLATE "C" > $4
                                substring(name from 1 for length($1) + position($2 IN substring(name from length($1) + 1))) COLLATE "C" > $4
                            ELSE
                            ELSE
                                name COLLATE "C" > $4
                                name COLLATE "C" > $4
                            END
                            END
                    ELSE
                    ELSE
                        true
                        true
                END
                END
            ORDER BY
            ORDER BY
                name COLLATE "C" ASC) as e order by name COLLATE "C" LIMIT $3'
                name COLLATE "C" ASC) as e order by name COLLATE "C" LIMIT $3'
        USING prefix_param, delimiter_param, max_keys, next_token, bucket_id, start_after;
        USING prefix_param, delimiter_param, max_keys, next_token, bucket_id, start_after;
END;
END;
$_$;
$_$;




--
--
-- Name: lock_top_prefixes(text[], text[]); Type: FUNCTION; Schema: storage; Owner: -
-- Name: lock_top_prefixes(text[], text[]); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
    v_bucket text;
    v_bucket text;
    v_top text;
    v_top text;
BEGIN
BEGIN
    FOR v_bucket, v_top IN
    FOR v_bucket, v_top IN
        SELECT DISTINCT t.bucket_id,
        SELECT DISTINCT t.bucket_id,
            split_part(t.name, '/', 1) AS top
            split_part(t.name, '/', 1) AS top
        FROM unnest(bucket_ids, names) AS t(bucket_id, name)
        FROM unnest(bucket_ids, names) AS t(bucket_id, name)
        WHERE t.name <> ''
        WHERE t.name <> ''
        ORDER BY 1, 2
        ORDER BY 1, 2
        LOOP
        LOOP
            PERFORM pg_advisory_xact_lock(hashtextextended(v_bucket || '/' || v_top, 0));
            PERFORM pg_advisory_xact_lock(hashtextextended(v_bucket || '/' || v_top, 0));
        END LOOP;
        END LOOP;
END;
END;
$$;
$$;




--
--
-- Name: objects_delete_cleanup(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: objects_delete_cleanup(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
    v_bucket_ids text[];
    v_bucket_ids text[];
    v_names      text[];
    v_names      text[];
BEGIN
BEGIN
    IF current_setting('storage.gc.prefixes', true) = '1' THEN
    IF current_setting('storage.gc.prefixes', true) = '1' THEN
        RETURN NULL;
        RETURN NULL;
    END IF;
    END IF;


    PERFORM set_config('storage.gc.prefixes', '1', true);
    PERFORM set_config('storage.gc.prefixes', '1', true);


    SELECT COALESCE(array_agg(d.bucket_id), '{}'),
    SELECT COALESCE(array_agg(d.bucket_id), '{}'),
           COALESCE(array_agg(d.name), '{}')
           COALESCE(array_agg(d.name), '{}')
    INTO v_bucket_ids, v_names
    INTO v_bucket_ids, v_names
    FROM deleted AS d
    FROM deleted AS d
    WHERE d.name <> '';
    WHERE d.name <> '';


    PERFORM storage.lock_top_prefixes(v_bucket_ids, v_names);
    PERFORM storage.lock_top_prefixes(v_bucket_ids, v_names);
    PERFORM storage.delete_leaf_prefixes(v_bucket_ids, v_names);
    PERFORM storage.delete_leaf_prefixes(v_bucket_ids, v_names);


    RETURN NULL;
    RETURN NULL;
END;
END;
$$;
$$;




--
--
-- Name: objects_insert_prefix_trigger(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: objects_insert_prefix_trigger(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
    PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
    PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
    NEW.level := "storage"."get_level"(NEW."name");
    NEW.level := "storage"."get_level"(NEW."name");


    RETURN NEW;
    RETURN NEW;
END;
END;
$$;
$$;




--
--
-- Name: objects_update_cleanup(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: objects_update_cleanup(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
    -- NEW - OLD (destinations to create prefixes for)
    -- NEW - OLD (destinations to create prefixes for)
    v_add_bucket_ids text[];
    v_add_bucket_ids text[];
    v_add_names      text[];
    v_add_names      text[];


    -- OLD - NEW (sources to prune)
    -- OLD - NEW (sources to prune)
    v_src_bucket_ids text[];
    v_src_bucket_ids text[];
    v_src_names      text[];
    v_src_names      text[];
BEGIN
BEGIN
    IF TG_OP <> 'UPDATE' THEN
    IF TG_OP <> 'UPDATE' THEN
        RETURN NULL;
        RETURN NULL;
    END IF;
    END IF;


    -- 1) Compute NEW−OLD (added paths) and OLD−NEW (moved-away paths)
    -- 1) Compute NEW−OLD (added paths) and OLD−NEW (moved-away paths)
    WITH added AS (
    WITH added AS (
        SELECT n.bucket_id, n.name
        SELECT n.bucket_id, n.name
        FROM new_rows n
        FROM new_rows n
        WHERE n.name <> '' AND position('/' in n.name) > 0
        WHERE n.name <> '' AND position('/' in n.name) > 0
        EXCEPT
        EXCEPT
        SELECT o.bucket_id, o.name FROM old_rows o WHERE o.name <> ''
        SELECT o.bucket_id, o.name FROM old_rows o WHERE o.name <> ''
    ),
    ),
    moved AS (
    moved AS (
         SELECT o.bucket_id, o.name
         SELECT o.bucket_id, o.name
         FROM old_rows o
         FROM old_rows o
         WHERE o.name <> ''
         WHERE o.name <> ''
         EXCEPT
         EXCEPT
         SELECT n.bucket_id, n.name FROM new_rows n WHERE n.name <> ''
         SELECT n.bucket_id, n.name FROM new_rows n WHERE n.name <> ''
    )
    )
    SELECT
    SELECT
        -- arrays for ADDED (dest) in stable order
        -- arrays for ADDED (dest) in stable order
        COALESCE( (SELECT array_agg(a.bucket_id ORDER BY a.bucket_id, a.name) FROM added a), '{}' ),
        COALESCE( (SELECT array_agg(a.bucket_id ORDER BY a.bucket_id, a.name) FROM added a), '{}' ),
        COALESCE( (SELECT array_agg(a.name      ORDER BY a.bucket_id, a.name) FROM added a), '{}' ),
        COALESCE( (SELECT array_agg(a.name      ORDER BY a.bucket_id, a.name) FROM added a), '{}' ),
        -- arrays for MOVED (src) in stable order
        -- arrays for MOVED (src) in stable order
        COALESCE( (SELECT array_agg(m.bucket_id ORDER BY m.bucket_id, m.name) FROM moved m), '{}' ),
        COALESCE( (SELECT array_agg(m.bucket_id ORDER BY m.bucket_id, m.name) FROM moved m), '{}' ),
        COALESCE( (SELECT array_agg(m.name      ORDER BY m.bucket_id, m.name) FROM moved m), '{}' )
        COALESCE( (SELECT array_agg(m.name      ORDER BY m.bucket_id, m.name) FROM moved m), '{}' )
    INTO v_add_bucket_ids, v_add_names, v_src_bucket_ids, v_src_names;
    INTO v_add_bucket_ids, v_add_names, v_src_bucket_ids, v_src_names;


    -- Nothing to do?
    -- Nothing to do?
    IF (array_length(v_add_bucket_ids, 1) IS NULL) AND (array_length(v_src_bucket_ids, 1) IS NULL) THEN
    IF (array_length(v_add_bucket_ids, 1) IS NULL) AND (array_length(v_src_bucket_ids, 1) IS NULL) THEN
        RETURN NULL;
        RETURN NULL;
    END IF;
    END IF;


    -- 2) Take per-(bucket, top) locks: ALL prefixes in consistent global order to prevent deadlocks
    -- 2) Take per-(bucket, top) locks: ALL prefixes in consistent global order to prevent deadlocks
    DECLARE
    DECLARE
        v_all_bucket_ids text[];
        v_all_bucket_ids text[];
        v_all_names text[];
        v_all_names text[];
    BEGIN
    BEGIN
        -- Combine source and destination arrays for consistent lock ordering
        -- Combine source and destination arrays for consistent lock ordering
        v_all_bucket_ids := COALESCE(v_src_bucket_ids, '{}') || COALESCE(v_add_bucket_ids, '{}');
        v_all_bucket_ids := COALESCE(v_src_bucket_ids, '{}') || COALESCE(v_add_bucket_ids, '{}');
        v_all_names := COALESCE(v_src_names, '{}') || COALESCE(v_add_names, '{}');
        v_all_names := COALESCE(v_src_names, '{}') || COALESCE(v_add_names, '{}');


        -- Single lock call ensures consistent global ordering across all transactions
        -- Single lock call ensures consistent global ordering across all transactions
        IF array_length(v_all_bucket_ids, 1) IS NOT NULL THEN
        IF array_length(v_all_bucket_ids, 1) IS NOT NULL THEN
            PERFORM storage.lock_top_prefixes(v_all_bucket_ids, v_all_names);
            PERFORM storage.lock_top_prefixes(v_all_bucket_ids, v_all_names);
        END IF;
        END IF;
    END;
    END;


    -- 3) Create destination prefixes (NEW−OLD) BEFORE pruning sources
    -- 3) Create destination prefixes (NEW−OLD) BEFORE pruning sources
    IF array_length(v_add_bucket_ids, 1) IS NOT NULL THEN
    IF array_length(v_add_bucket_ids, 1) IS NOT NULL THEN
        WITH candidates AS (
        WITH candidates AS (
            SELECT DISTINCT t.bucket_id, unnest(storage.get_prefixes(t.name)) AS name
            SELECT DISTINCT t.bucket_id, unnest(storage.get_prefixes(t.name)) AS name
            FROM unnest(v_add_bucket_ids, v_add_names) AS t(bucket_id, name)
            FROM unnest(v_add_bucket_ids, v_add_names) AS t(bucket_id, name)
            WHERE name <> ''
            WHERE name <> ''
        )
        )
        INSERT INTO storage.prefixes (bucket_id, name)
        INSERT INTO storage.prefixes (bucket_id, name)
        SELECT c.bucket_id, c.name
        SELECT c.bucket_id, c.name
        FROM candidates c
        FROM candidates c
        ON CONFLICT DO NOTHING;
        ON CONFLICT DO NOTHING;
    END IF;
    END IF;


    -- 4) Prune source prefixes bottom-up for OLD−NEW
    -- 4) Prune source prefixes bottom-up for OLD−NEW
    IF array_length(v_src_bucket_ids, 1) IS NOT NULL THEN
    IF array_length(v_src_bucket_ids, 1) IS NOT NULL THEN
        -- re-entrancy guard so DELETE on prefixes won't recurse
        -- re-entrancy guard so DELETE on prefixes won't recurse
        IF current_setting('storage.gc.prefixes', true) <> '1' THEN
        IF current_setting('storage.gc.prefixes', true) <> '1' THEN
            PERFORM set_config('storage.gc.prefixes', '1', true);
            PERFORM set_config('storage.gc.prefixes', '1', true);
        END IF;
        END IF;


        PERFORM storage.delete_leaf_prefixes(v_src_bucket_ids, v_src_names);
        PERFORM storage.delete_leaf_prefixes(v_src_bucket_ids, v_src_names);
    END IF;
    END IF;


    RETURN NULL;
    RETURN NULL;
END;
END;
$$;
$$;




--
--
-- Name: objects_update_level_trigger(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: objects_update_level_trigger(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
    -- Ensure this is an update operation and the name has changed
    -- Ensure this is an update operation and the name has changed
    IF TG_OP = 'UPDATE' AND (NEW."name" <> OLD."name" OR NEW."bucket_id" <> OLD."bucket_id") THEN
    IF TG_OP = 'UPDATE' AND (NEW."name" <> OLD."name" OR NEW."bucket_id" <> OLD."bucket_id") THEN
        -- Set the new level
        -- Set the new level
        NEW."level" := "storage"."get_level"(NEW."name");
        NEW."level" := "storage"."get_level"(NEW."name");
    END IF;
    END IF;
    RETURN NEW;
    RETURN NEW;
END;
END;
$$;
$$;




--
--
-- Name: objects_update_prefix_trigger(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: objects_update_prefix_trigger(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
    old_prefixes TEXT[];
    old_prefixes TEXT[];
BEGIN
BEGIN
    -- Ensure this is an update operation and the name has changed
    -- Ensure this is an update operation and the name has changed
    IF TG_OP = 'UPDATE' AND (NEW."name" <> OLD."name" OR NEW."bucket_id" <> OLD."bucket_id") THEN
    IF TG_OP = 'UPDATE' AND (NEW."name" <> OLD."name" OR NEW."bucket_id" <> OLD."bucket_id") THEN
        -- Retrieve old prefixes
        -- Retrieve old prefixes
        old_prefixes := "storage"."get_prefixes"(OLD."name");
        old_prefixes := "storage"."get_prefixes"(OLD."name");


        -- Remove old prefixes that are only used by this object
        -- Remove old prefixes that are only used by this object
        WITH all_prefixes as (
        WITH all_prefixes as (
            SELECT unnest(old_prefixes) as prefix
            SELECT unnest(old_prefixes) as prefix
        ),
        ),
        can_delete_prefixes as (
        can_delete_prefixes as (
             SELECT prefix
             SELECT prefix
             FROM all_prefixes
             FROM all_prefixes
             WHERE NOT EXISTS (
             WHERE NOT EXISTS (
                 SELECT 1 FROM "storage"."objects"
                 SELECT 1 FROM "storage"."objects"
                 WHERE "bucket_id" = OLD."bucket_id"
                 WHERE "bucket_id" = OLD."bucket_id"
                   AND "name" <> OLD."name"
                   AND "name" <> OLD."name"
                   AND "name" LIKE (prefix || '%')
                   AND "name" LIKE (prefix || '%')
             )
             )
         )
         )
        DELETE FROM "storage"."prefixes" WHERE name IN (SELECT prefix FROM can_delete_prefixes);
        DELETE FROM "storage"."prefixes" WHERE name IN (SELECT prefix FROM can_delete_prefixes);


        -- Add new prefixes
        -- Add new prefixes
        PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
        PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
    END IF;
    END IF;
    -- Set the new level
    -- Set the new level
    NEW."level" := "storage"."get_level"(NEW."name");
    NEW."level" := "storage"."get_level"(NEW."name");


    RETURN NEW;
    RETURN NEW;
END;
END;
$$;
$$;




--
--
-- Name: operation(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: operation(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql STABLE
    LANGUAGE plpgsql STABLE
    AS $$
    AS $$
BEGIN
BEGIN
    RETURN current_setting('storage.operation', true);
    RETURN current_setting('storage.operation', true);
END;
END;
$$;
$$;




--
--
-- Name: prefixes_delete_cleanup(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: prefixes_delete_cleanup(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql SECURITY DEFINER
    LANGUAGE plpgsql SECURITY DEFINER
    AS $$
    AS $$
DECLARE
DECLARE
    v_bucket_ids text[];
    v_bucket_ids text[];
    v_names      text[];
    v_names      text[];
BEGIN
BEGIN
    IF current_setting('storage.gc.prefixes', true) = '1' THEN
    IF current_setting('storage.gc.prefixes', true) = '1' THEN
        RETURN NULL;
        RETURN NULL;
    END IF;
    END IF;


    PERFORM set_config('storage.gc.prefixes', '1', true);
    PERFORM set_config('storage.gc.prefixes', '1', true);


    SELECT COALESCE(array_agg(d.bucket_id), '{}'),
    SELECT COALESCE(array_agg(d.bucket_id), '{}'),
           COALESCE(array_agg(d.name), '{}')
           COALESCE(array_agg(d.name), '{}')
    INTO v_bucket_ids, v_names
    INTO v_bucket_ids, v_names
    FROM deleted AS d
    FROM deleted AS d
    WHERE d.name <> '';
    WHERE d.name <> '';


    PERFORM storage.lock_top_prefixes(v_bucket_ids, v_names);
    PERFORM storage.lock_top_prefixes(v_bucket_ids, v_names);
    PERFORM storage.delete_leaf_prefixes(v_bucket_ids, v_names);
    PERFORM storage.delete_leaf_prefixes(v_bucket_ids, v_names);


    RETURN NULL;
    RETURN NULL;
END;
END;
$$;
$$;




--
--
-- Name: prefixes_insert_trigger(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: prefixes_insert_trigger(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
    PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
    PERFORM "storage"."add_prefixes"(NEW."bucket_id", NEW."name");
    RETURN NEW;
    RETURN NEW;
END;
END;
$$;
$$;




--
--
-- Name: search(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: search(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
    can_bypass_rls BOOLEAN;
    can_bypass_rls BOOLEAN;
begin
begin
    SELECT rolbypassrls
    SELECT rolbypassrls
    INTO can_bypass_rls
    INTO can_bypass_rls
    FROM pg_roles
    FROM pg_roles
    WHERE rolname = coalesce(nullif(current_setting('role', true), 'none'), current_user);
    WHERE rolname = coalesce(nullif(current_setting('role', true), 'none'), current_user);


    IF can_bypass_rls THEN
    IF can_bypass_rls THEN
        RETURN QUERY SELECT * FROM storage.search_v1_optimised(prefix, bucketname, limits, levels, offsets, search, sortcolumn, sortorder);
        RETURN QUERY SELECT * FROM storage.search_v1_optimised(prefix, bucketname, limits, levels, offsets, search, sortcolumn, sortorder);
    ELSE
    ELSE
        RETURN QUERY SELECT * FROM storage.search_legacy_v1(prefix, bucketname, limits, levels, offsets, search, sortcolumn, sortorder);
        RETURN QUERY SELECT * FROM storage.search_legacy_v1(prefix, bucketname, limits, levels, offsets, search, sortcolumn, sortorder);
    END IF;
    END IF;
end;
end;
$$;
$$;




--
--
-- Name: search_legacy_v1(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: search_legacy_v1(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql STABLE
    LANGUAGE plpgsql STABLE
    AS $_$
    AS $_$
declare
declare
    v_order_by text;
    v_order_by text;
    v_sort_order text;
    v_sort_order text;
begin
begin
    case
    case
        when sortcolumn = 'name' then
        when sortcolumn = 'name' then
            v_order_by = 'name';
            v_order_by = 'name';
        when sortcolumn = 'updated_at' then
        when sortcolumn = 'updated_at' then
            v_order_by = 'updated_at';
            v_order_by = 'updated_at';
        when sortcolumn = 'created_at' then
        when sortcolumn = 'created_at' then
            v_order_by = 'created_at';
            v_order_by = 'created_at';
        when sortcolumn = 'last_accessed_at' then
        when sortcolumn = 'last_accessed_at' then
            v_order_by = 'last_accessed_at';
            v_order_by = 'last_accessed_at';
        else
        else
            v_order_by = 'name';
            v_order_by = 'name';
        end case;
        end case;


    case
    case
        when sortorder = 'asc' then
        when sortorder = 'asc' then
            v_sort_order = 'asc';
            v_sort_order = 'asc';
        when sortorder = 'desc' then
        when sortorder = 'desc' then
            v_sort_order = 'desc';
            v_sort_order = 'desc';
        else
        else
            v_sort_order = 'asc';
            v_sort_order = 'asc';
        end case;
        end case;


    v_order_by = v_order_by || ' ' || v_sort_order;
    v_order_by = v_order_by || ' ' || v_sort_order;


    return query execute
    return query execute
        'with folders as (
        'with folders as (
           select path_tokens[$1] as folder
           select path_tokens[$1] as folder
           from storage.objects
           from storage.objects
             where objects.name ilike $2 || $3 || ''%''
             where objects.name ilike $2 || $3 || ''%''
               and bucket_id = $4
               and bucket_id = $4
               and array_length(objects.path_tokens, 1) <> $1
               and array_length(objects.path_tokens, 1) <> $1
           group by folder
           group by folder
           order by folder ' || v_sort_order || '
           order by folder ' || v_sort_order || '
     )
     )
     (select folder as "name",
     (select folder as "name",
            null as id,
            null as id,
            null as updated_at,
            null as updated_at,
            null as created_at,
            null as created_at,
            null as last_accessed_at,
            null as last_accessed_at,
            null as metadata from folders)
            null as metadata from folders)
     union all
     union all
     (select path_tokens[$1] as "name",
     (select path_tokens[$1] as "name",
            id,
            id,
            updated_at,
            updated_at,
            created_at,
            created_at,
            last_accessed_at,
            last_accessed_at,
            metadata
            metadata
     from storage.objects
     from storage.objects
     where objects.name ilike $2 || $3 || ''%''
     where objects.name ilike $2 || $3 || ''%''
       and bucket_id = $4
       and bucket_id = $4
       and array_length(objects.path_tokens, 1) = $1
       and array_length(objects.path_tokens, 1) = $1
     order by ' || v_order_by || ')
     order by ' || v_order_by || ')
     limit $5
     limit $5
     offset $6' using levels, prefix, search, bucketname, limits, offsets;
     offset $6' using levels, prefix, search, bucketname, limits, offsets;
end;
end;
$_$;
$_$;




--
--
-- Name: search_v1_optimised(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: search_v1_optimised(text, text, integer, integer, integer, text, text, text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql STABLE
    LANGUAGE plpgsql STABLE
    AS $_$
    AS $_$
declare
declare
    v_order_by text;
    v_order_by text;
    v_sort_order text;
    v_sort_order text;
begin
begin
    case
    case
        when sortcolumn = 'name' then
        when sortcolumn = 'name' then
            v_order_by = 'name';
            v_order_by = 'name';
        when sortcolumn = 'updated_at' then
        when sortcolumn = 'updated_at' then
            v_order_by = 'updated_at';
            v_order_by = 'updated_at';
        when sortcolumn = 'created_at' then
        when sortcolumn = 'created_at' then
            v_order_by = 'created_at';
            v_order_by = 'created_at';
        when sortcolumn = 'last_accessed_at' then
        when sortcolumn = 'last_accessed_at' then
            v_order_by = 'last_accessed_at';
            v_order_by = 'last_accessed_at';
        else
        else
            v_order_by = 'name';
            v_order_by = 'name';
        end case;
        end case;


    case
    case
        when sortorder = 'asc' then
        when sortorder = 'asc' then
            v_sort_order = 'asc';
            v_sort_order = 'asc';
        when sortorder = 'desc' then
        when sortorder = 'desc' then
            v_sort_order = 'desc';
            v_sort_order = 'desc';
        else
        else
            v_sort_order = 'asc';
            v_sort_order = 'asc';
        end case;
        end case;


    v_order_by = v_order_by || ' ' || v_sort_order;
    v_order_by = v_order_by || ' ' || v_sort_order;


    return query execute
    return query execute
        'with folders as (
        'with folders as (
           select (string_to_array(name, ''/''))[level] as name
           select (string_to_array(name, ''/''))[level] as name
           from storage.prefixes
           from storage.prefixes
             where lower(prefixes.name) like lower($2 || $3) || ''%''
             where lower(prefixes.name) like lower($2 || $3) || ''%''
               and bucket_id = $4
               and bucket_id = $4
               and level = $1
               and level = $1
           order by name ' || v_sort_order || '
           order by name ' || v_sort_order || '
     )
     )
     (select name,
     (select name,
            null as id,
            null as id,
            null as updated_at,
            null as updated_at,
            null as created_at,
            null as created_at,
            null as last_accessed_at,
            null as last_accessed_at,
            null as metadata from folders)
            null as metadata from folders)
     union all
     union all
     (select path_tokens[level] as "name",
     (select path_tokens[level] as "name",
            id,
            id,
            updated_at,
            updated_at,
            created_at,
            created_at,
            last_accessed_at,
            last_accessed_at,
            metadata
            metadata
     from storage.objects
     from storage.objects
     where lower(objects.name) like lower($2 || $3) || ''%''
     where lower(objects.name) like lower($2 || $3) || ''%''
       and bucket_id = $4
       and bucket_id = $4
       and level = $1
       and level = $1
     order by ' || v_order_by || ')
     order by ' || v_order_by || ')
     limit $5
     limit $5
     offset $6' using levels, prefix, search, bucketname, limits, offsets;
     offset $6' using levels, prefix, search, bucketname, limits, offsets;
end;
end;
$_$;
$_$;




--
--
-- Name: search_v2(text, text, integer, integer, text, text, text, text); Type: FUNCTION; Schema: storage; Owner: -
-- Name: search_v2(text, text, integer, integer, text, text, text, text); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql STABLE
    LANGUAGE plpgsql STABLE
    AS $_$
    AS $_$
DECLARE
DECLARE
    sort_col text;
    sort_col text;
    sort_ord text;
    sort_ord text;
    cursor_op text;
    cursor_op text;
    cursor_expr text;
    cursor_expr text;
    sort_expr text;
    sort_expr text;
BEGIN
BEGIN
    -- Validate sort_order
    -- Validate sort_order
    sort_ord := lower(sort_order);
    sort_ord := lower(sort_order);
    IF sort_ord NOT IN ('asc', 'desc') THEN
    IF sort_ord NOT IN ('asc', 'desc') THEN
        sort_ord := 'asc';
        sort_ord := 'asc';
    END IF;
    END IF;


    -- Determine cursor comparison operator
    -- Determine cursor comparison operator
    IF sort_ord = 'asc' THEN
    IF sort_ord = 'asc' THEN
        cursor_op := '>';
        cursor_op := '>';
    ELSE
    ELSE
        cursor_op := '<';
        cursor_op := '<';
    END IF;
    END IF;
    
    
    sort_col := lower(sort_column);
    sort_col := lower(sort_column);
    -- Validate sort column  
    -- Validate sort column  
    IF sort_col IN ('updated_at', 'created_at') THEN
    IF sort_col IN ('updated_at', 'created_at') THEN
        cursor_expr := format(
        cursor_expr := format(
            '($5 = '''' OR ROW(date_trunc(''milliseconds'', %I), name COLLATE "C") %s ROW(COALESCE(NULLIF($6, '''')::timestamptz, ''epoch''::timestamptz), $5))',
            '($5 = '''' OR ROW(date_trunc(''milliseconds'', %I), name COLLATE "C") %s ROW(COALESCE(NULLIF($6, '''')::timestamptz, ''epoch''::timestamptz), $5))',
            sort_col, cursor_op
            sort_col, cursor_op
        );
        );
        sort_expr := format(
        sort_expr := format(
            'COALESCE(date_trunc(''milliseconds'', %I), ''epoch''::timestamptz) %s, name COLLATE "C" %s',
            'COALESCE(date_trunc(''milliseconds'', %I), ''epoch''::timestamptz) %s, name COLLATE "C" %s',
            sort_col, sort_ord, sort_ord
            sort_col, sort_ord, sort_ord
        );
        );
    ELSE
    ELSE
        cursor_expr := format('($5 = '''' OR name COLLATE "C" %s $5)', cursor_op);
        cursor_expr := format('($5 = '''' OR name COLLATE "C" %s $5)', cursor_op);
        sort_expr := format('name COLLATE "C" %s', sort_ord);
        sort_expr := format('name COLLATE "C" %s', sort_ord);
    END IF;
    END IF;


    RETURN QUERY EXECUTE format(
    RETURN QUERY EXECUTE format(
        $sql$
        $sql$
        SELECT * FROM (
        SELECT * FROM (
            (
            (
                SELECT
                SELECT
                    split_part(name, '/', $4) AS key,
                    split_part(name, '/', $4) AS key,
                    name,
                    name,
                    NULL::uuid AS id,
                    NULL::uuid AS id,
                    updated_at,
                    updated_at,
                    created_at,
                    created_at,
                    NULL::timestamptz AS last_accessed_at,
                    NULL::timestamptz AS last_accessed_at,
                    NULL::jsonb AS metadata
                    NULL::jsonb AS metadata
                FROM storage.prefixes
                FROM storage.prefixes
                WHERE name COLLATE "C" LIKE $1 || '%%'
                WHERE name COLLATE "C" LIKE $1 || '%%'
                    AND bucket_id = $2
                    AND bucket_id = $2
                    AND level = $4
                    AND level = $4
                    AND %s
                    AND %s
                ORDER BY %s
                ORDER BY %s
                LIMIT $3
                LIMIT $3
            )
            )
            UNION ALL
            UNION ALL
            (
            (
                SELECT
                SELECT
                    split_part(name, '/', $4) AS key,
                    split_part(name, '/', $4) AS key,
                    name,
                    name,
                    id,
                    id,
                    updated_at,
                    updated_at,
                    created_at,
                    created_at,
                    last_accessed_at,
                    last_accessed_at,
                    metadata
                    metadata
                FROM storage.objects
                FROM storage.objects
                WHERE name COLLATE "C" LIKE $1 || '%%'
                WHERE name COLLATE "C" LIKE $1 || '%%'
                    AND bucket_id = $2
                    AND bucket_id = $2
                    AND level = $4
                    AND level = $4
                    AND %s
                    AND %s
                ORDER BY %s
                ORDER BY %s
                LIMIT $3
                LIMIT $3
            )
            )
        ) obj
        ) obj
        ORDER BY %s
        ORDER BY %s
        LIMIT $3
        LIMIT $3
        $sql$,
        $sql$,
        cursor_expr,    -- prefixes WHERE
        cursor_expr,    -- prefixes WHERE
        sort_expr,      -- prefixes ORDER BY
        sort_expr,      -- prefixes ORDER BY
        cursor_expr,    -- objects WHERE
        cursor_expr,    -- objects WHERE
        sort_expr,      -- objects ORDER BY
        sort_expr,      -- objects ORDER BY
        sort_expr       -- final ORDER BY
        sort_expr       -- final ORDER BY
    )
    )
    USING prefix, bucket_name, limits, levels, start_after, sort_column_after;
    USING prefix, bucket_name, limits, levels, start_after, sort_column_after;
END;
END;
$_$;
$_$;




--
--
-- Name: update_updated_at_column(); Type: FUNCTION; Schema: storage; Owner: -
-- Name: update_updated_at_column(); Type: FUNCTION; Schema: storage; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
BEGIN
BEGIN
    NEW.updated_at = now();
    NEW.updated_at = now();
    RETURN NEW; 
    RETURN NEW; 
END;
END;
$$;
$$;




--
--
-- Name: ai_optimize_runtime(integer); Type: FUNCTION; Schema: system; Owner: -
-- Name: ai_optimize_runtime(integer); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.ai_optimize_runtime(p_window_min integer DEFAULT 10) RETURNS TABLE(kind text, code text, old_val integer, new_val integer, reason text)
CREATE FUNCTION system.ai_optimize_runtime(p_window_min integer DEFAULT 10) RETURNS TABLE(kind text, code text, old_val integer, new_val integer, reason text)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  win interval := (coalesce(p_window_min,10) || ' minutes')::interval;
  win interval := (coalesce(p_window_min,10) || ' minutes')::interval;
  min_i int := 10;
  min_i int := 10;
  max_i int := 600;
  max_i int := 600;
begin
begin
  return query
  return query
  with backlog as (
  with backlog as (
    select r.command_code, count(*) as pending_cnt
    select r.command_code, count(*) as pending_cnt
      from system.exec_run_request r
      from system.exec_run_request r
     where r.status='PENDING'
     where r.status='PENDING'
     group by r.command_code
     group by r.command_code
  ),
  ),
  stats as (
  stats as (
    select
    select
      r.command_code,
      r.command_code,
      count(*) filter (where r.completed_at >= now()-win and r.status='DONE') as ok_cnt,
      count(*) filter (where r.completed_at >= now()-win and r.status='DONE') as ok_cnt,
      count(*) filter (where r.completed_at >= now()-win and r.status='FAILED') as ng_cnt
      count(*) filter (where r.completed_at >= now()-win and r.status='FAILED') as ng_cnt
    from system.exec_run_request r
    from system.exec_run_request r
    group by r.command_code
    group by r.command_code
  ),
  ),
  lc as (
  lc as (
    select loop_code, command_code, interval_sec
    select loop_code, command_code, interval_sec
      from system.loop_config
      from system.loop_config
     where is_enabled=true
     where is_enabled=true
  ),
  ),
  j as (
  j as (
    select
    select
      lc.loop_code,
      lc.loop_code,
      lc.command_code,
      lc.command_code,
      lc.interval_sec as old_interval,
      lc.interval_sec as old_interval,
      coalesce(b.pending_cnt,0) as pending_cnt,
      coalesce(b.pending_cnt,0) as pending_cnt,
      coalesce(s.ok_cnt,0) as ok_cnt,
      coalesce(s.ok_cnt,0) as ok_cnt,
      coalesce(s.ng_cnt,0) as ng_cnt
      coalesce(s.ng_cnt,0) as ng_cnt
    from lc
    from lc
    left join backlog b on b.command_code = lc.command_code
    left join backlog b on b.command_code = lc.command_code
    left join stats s on s.command_code = lc.command_code
    left join stats s on s.command_code = lc.command_code
  ),
  ),
  d as (
  d as (
    select
    select
      j.loop_code,
      j.loop_code,
      j.command_code,
      j.command_code,
      j.old_interval,
      j.old_interval,
      case
      case
        when (j.ok_cnt + j.ng_cnt) = 0 and j.pending_cnt >= 50 then least(max_i, j.old_interval * 2)
        when (j.ok_cnt + j.ng_cnt) = 0 and j.pending_cnt >= 50 then least(max_i, j.old_interval * 2)
        when (j.ok_cnt + j.ng_cnt) > 0 and (j.ng_cnt::numeric / (j.ok_cnt + j.ng_cnt)) >= 0.5 then least(max_i, j.old_interval * 2)
        when (j.ok_cnt + j.ng_cnt) > 0 and (j.ng_cnt::numeric / (j.ok_cnt + j.ng_cnt)) >= 0.5 then least(max_i, j.old_interval * 2)
        when j.pending_cnt >= 200 then least(max_i, j.old_interval * 2)
        when j.pending_cnt >= 200 then least(max_i, j.old_interval * 2)
        when j.pending_cnt <= 5 and (j.ok_cnt + j.ng_cnt) > 0 and (j.ok_cnt::numeric / (j.ok_cnt + j.ng_cnt)) >= 0.9 then greatest(min_i, (j.old_interval * 8 / 10))
        when j.pending_cnt <= 5 and (j.ok_cnt + j.ng_cnt) > 0 and (j.ok_cnt::numeric / (j.ok_cnt + j.ng_cnt)) >= 0.9 then greatest(min_i, (j.old_interval * 8 / 10))
        else j.old_interval
        else j.old_interval
      end as new_interval,
      end as new_interval,
      case
      case
        when (j.ok_cnt + j.ng_cnt) = 0 and j.pending_cnt >= 50 then 'no stats + backlog high -> slow'
        when (j.ok_cnt + j.ng_cnt) = 0 and j.pending_cnt >= 50 then 'no stats + backlog high -> slow'
        when (j.ok_cnt + j.ng_cnt) > 0 and (j.ng_cnt::numeric / (j.ok_cnt + j.ng_cnt)) >= 0.5 then 'fail rate high -> slow'
        when (j.ok_cnt + j.ng_cnt) > 0 and (j.ng_cnt::numeric / (j.ok_cnt + j.ng_cnt)) >= 0.5 then 'fail rate high -> slow'
        when j.pending_cnt >= 200 then 'backlog huge -> slow'
        when j.pending_cnt >= 200 then 'backlog huge -> slow'
        when j.pending_cnt <= 5 and (j.ok_cnt + j.ng_cnt) > 0 and (j.ok_cnt::numeric / (j.ok_cnt + j.ng_cnt)) >= 0.9 then 'mostly ok + low backlog -> speed'
        when j.pending_cnt <= 5 and (j.ok_cnt + j.ng_cnt) > 0 and (j.ok_cnt::numeric / (j.ok_cnt + j.ng_cnt)) >= 0.9 then 'mostly ok + low backlog -> speed'
        else 'keep'
        else 'keep'
      end as reason
      end as reason
    from j
    from j
  )
  )
  update system.loop_config lc
  update system.loop_config lc
     set interval_sec = d.new_interval
     set interval_sec = d.new_interval
    from d
    from d
   where lc.loop_code = d.loop_code
   where lc.loop_code = d.loop_code
     and d.new_interval <> d.old_interval
     and d.new_interval <> d.old_interval
  returning 'loop_interval'::text, lc.loop_code::text, d.old_interval::int, d.new_interval::int, d.reason::text;
  returning 'loop_interval'::text, lc.loop_code::text, d.old_interval::int, d.new_interval::int, d.reason::text;
end;
end;
$$;
$$;




--
--
-- Name: approve_request_and_enqueue(bigint, text); Type: FUNCTION; Schema: system; Owner: -
-- Name: approve_request_and_enqueue(bigint, text); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.approve_request_and_enqueue(p_approval_request_id bigint, p_comment text DEFAULT NULL::text) RETURNS bigint
CREATE FUNCTION system.approve_request_and_enqueue(p_approval_request_id bigint, p_comment text DEFAULT NULL::text) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  rid bigint;
  rid bigint;
begin
begin
  update system.approval_request
  update system.approval_request
     set approval_status = 'APPROVED',
     set approval_status = 'APPROVED',
         approved_at = now()
         approved_at = now()
   where approval_request_id = p_approval_request_id;
   where approval_request_id = p_approval_request_id;


  insert into system.approval_action_log(approval_request_id, step_no, action, action_by, comment)
  insert into system.approval_action_log(approval_request_id, step_no, action, action_by, comment)
  values (p_approval_request_id, 1, 'APPROVE', auth.uid(), p_comment);
  values (p_approval_request_id, 1, 'APPROVE', auth.uid(), p_comment);


  rid := system.enqueue_exec_from_approval(p_approval_request_id);
  rid := system.enqueue_exec_from_approval(p_approval_request_id);
  return rid;
  return rid;
end;
end;
$$;
$$;




--
--
-- Name: autotune_loop_config(integer); Type: FUNCTION; Schema: system; Owner: -
-- Name: autotune_loop_config(integer); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.autotune_loop_config(p_window_min integer DEFAULT 10) RETURNS TABLE(loop_code text, old_interval integer, new_interval integer, reason text)
CREATE FUNCTION system.autotune_loop_config(p_window_min integer DEFAULT 10) RETURNS TABLE(loop_code text, old_interval integer, new_interval integer, reason text)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  win interval := (coalesce(p_window_min,10) || ' minutes')::interval;
  win interval := (coalesce(p_window_min,10) || ' minutes')::interval;
  min_i int := 10;
  min_i int := 10;
  max_i int := 600;
  max_i int := 600;
begin
begin
  return query
  return query
  with base as (
  with base as (
    select lc.loop_code, lc.interval_sec, lc.command_code
    select lc.loop_code, lc.interval_sec, lc.command_code
      from system.loop_config lc
      from system.loop_config lc
     where lc.is_enabled = true
     where lc.is_enabled = true
  ),
  ),
  stats as (
  stats as (
    select
    select
      r.command_code,
      r.command_code,
      count(*) filter (where r.completed_at >= now()-win and r.status='DONE') as ok_cnt,
      count(*) filter (where r.completed_at >= now()-win and r.status='DONE') as ok_cnt,
      count(*) filter (where r.completed_at >= now()-win and r.status='FAILED') as ng_cnt
      count(*) filter (where r.completed_at >= now()-win and r.status='FAILED') as ng_cnt
    from system.exec_run_request r
    from system.exec_run_request r
    group by r.command_code
    group by r.command_code
  ),
  ),
  joined as (
  joined as (
    select
    select
      b.loop_code,
      b.loop_code,
      b.interval_sec as old_interval,
      b.interval_sec as old_interval,
      coalesce(s.ok_cnt,0) as ok_cnt,
      coalesce(s.ok_cnt,0) as ok_cnt,
      coalesce(s.ng_cnt,0) as ng_cnt
      coalesce(s.ng_cnt,0) as ng_cnt
    from base b
    from base b
    left join stats s on s.command_code = b.command_code
    left join stats s on s.command_code = b.command_code
  ),
  ),
  decision as (
  decision as (
    select
    select
      j.loop_code,
      j.loop_code,
      j.old_interval,
      j.old_interval,
      case
      case
        when (j.ok_cnt + j.ng_cnt) = 0 then j.old_interval
        when (j.ok_cnt + j.ng_cnt) = 0 then j.old_interval
        when j.ng_cnt * 1.0 / (j.ok_cnt + j.ng_cnt) >= 0.5 then least(max_i, greatest(min_i, (j.old_interval * 2)))
        when j.ng_cnt * 1.0 / (j.ok_cnt + j.ng_cnt) >= 0.5 then least(max_i, greatest(min_i, (j.old_interval * 2)))
        when j.ok_cnt * 1.0 / (j.ok_cnt + j.ng_cnt) >= 0.9 then greatest(min_i, (j.old_interval * 8 / 10))
        when j.ok_cnt * 1.0 / (j.ok_cnt + j.ng_cnt) >= 0.9 then greatest(min_i, (j.old_interval * 8 / 10))
        else j.old_interval
        else j.old_interval
      end as new_interval,
      end as new_interval,
      case
      case
        when (j.ok_cnt + j.ng_cnt) = 0 then 'no recent jobs'
        when (j.ok_cnt + j.ng_cnt) = 0 then 'no recent jobs'
        when j.ng_cnt * 1.0 / (j.ok_cnt + j.ng_cnt) >= 0.5 then 'too many failures -> slow down'
        when j.ng_cnt * 1.0 / (j.ok_cnt + j.ng_cnt) >= 0.5 then 'too many failures -> slow down'
        when j.ok_cnt * 1.0 / (j.ok_cnt + j.ng_cnt) >= 0.9 then 'mostly ok -> speed up'
        when j.ok_cnt * 1.0 / (j.ok_cnt + j.ng_cnt) >= 0.9 then 'mostly ok -> speed up'
        else 'keep'
        else 'keep'
      end as reason
      end as reason
    from joined j
    from joined j
  )
  )
  update system.loop_config lc
  update system.loop_config lc
     set interval_sec = d.new_interval
     set interval_sec = d.new_interval
    from decision d
    from decision d
   where lc.loop_code = d.loop_code
   where lc.loop_code = d.loop_code
     and d.new_interval <> d.old_interval
     and d.new_interval <> d.old_interval
  returning d.loop_code, d.old_interval, d.new_interval, d.reason;
  returning d.loop_code, d.old_interval, d.new_interval, d.reason;
end;
end;
$$;
$$;




--
--
-- Name: autotune_loops(timestamp with time zone, timestamp with time zone); Type: FUNCTION; Schema: system; Owner: -
-- Name: autotune_loops(timestamp with time zone, timestamp with time zone); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.autotune_loops(p_start timestamp with time zone, p_end timestamp with time zone) RETURNS integer
CREATE FUNCTION system.autotune_loops(p_start timestamp with time zone, p_end timestamp with time zone) RETURNS integer
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  s record;
  s record;
  r record;
  r record;
  ratio numeric;
  ratio numeric;
  new_interval int;
  new_interval int;
  changed int := 0;
  changed int := 0;
begin
begin
  -- compute stats first (idempotent-ish: duplicates allowed; acceptable as history)
  -- compute stats first (idempotent-ish: duplicates allowed; acceptable as history)
  perform system.compute_loop_sla(p_start, p_end);
  perform system.compute_loop_sla(p_start, p_end);


  for s in
  for s in
    select distinct on (loop_code)
    select distinct on (loop_code)
      loop_code, tick_count, fail_count
      loop_code, tick_count, fail_count
    from system.loop_sla_stat
    from system.loop_sla_stat
    where window_start = p_start and window_end = p_end
    where window_start = p_start and window_end = p_end
    order by loop_code, computed_at desc
    order by loop_code, computed_at desc
  loop
  loop
    select * into r
    select * into r
      from system.loop_autotune_rule
      from system.loop_autotune_rule
     where loop_code = s.loop_code
     where loop_code = s.loop_code
       and is_active = true;
       and is_active = true;


    if r.rule_id is null then
    if r.rule_id is null then
      continue;
      continue;
    end if;
    end if;


    if s.tick_count <= 0 then
    if s.tick_count <= 0 then
      continue;
      continue;
    end if;
    end if;


    ratio := (s.fail_count::numeric / s.tick_count::numeric);
    ratio := (s.fail_count::numeric / s.tick_count::numeric);


    select interval_sec into new_interval
    select interval_sec into new_interval
      from system.loop_config
      from system.loop_config
     where loop_code = s.loop_code;
     where loop_code = s.loop_code;


    if new_interval is null then
    if new_interval is null then
      continue;
      continue;
    end if;
    end if;


    if ratio >= r.fail_ratio_threshold then
    if ratio >= r.fail_ratio_threshold then
      new_interval := least(r.interval_max_sec, new_interval + r.step_up_sec);
      new_interval := least(r.interval_max_sec, new_interval + r.step_up_sec);
    else
    else
      new_interval := greatest(r.interval_min_sec, new_interval - r.step_down_sec);
      new_interval := greatest(r.interval_min_sec, new_interval - r.step_down_sec);
    end if;
    end if;


    update system.loop_config
    update system.loop_config
       set interval_sec = new_interval,
       set interval_sec = new_interval,
           updated_at = now()
           updated_at = now()
     where loop_code = s.loop_code;
     where loop_code = s.loop_code;


    changed := changed + 1;
    changed := changed + 1;
  end loop;
  end loop;


  return changed;
  return changed;
end;
end;
$$;
$$;




--
--
-- Name: calc_next_run_at(timestamp with time zone, integer, integer); Type: FUNCTION; Schema: system; Owner: -
-- Name: calc_next_run_at(timestamp with time zone, integer, integer); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.calc_next_run_at(p_from timestamp with time zone, p_interval_sec integer, p_jitter_sec integer) RETURNS timestamp with time zone
CREATE FUNCTION system.calc_next_run_at(p_from timestamp with time zone, p_interval_sec integer, p_jitter_sec integer) RETURNS timestamp with time zone
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  select
  select
    coalesce(p_from, now())
    coalesce(p_from, now())
    + make_interval(secs => greatest(coalesce(p_interval_sec,60),1))
    + make_interval(secs => greatest(coalesce(p_interval_sec,60),1))
    + make_interval(secs => (case when coalesce(p_jitter_sec,0) <= 0 then 0
    + make_interval(secs => (case when coalesce(p_jitter_sec,0) <= 0 then 0
                                  else (floor(random() * (p_jitter_sec+1)))::int end));
                                  else (floor(random() * (p_jitter_sec+1)))::int end));
$$;
$$;




--
--
-- Name: complete_ai_task(bigint, boolean, jsonb, text); Type: FUNCTION; Schema: system; Owner: -
-- Name: complete_ai_task(bigint, boolean, jsonb, text); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.complete_ai_task(p_task_id bigint, p_success boolean, p_result jsonb DEFAULT NULL::jsonb, p_error text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION system.complete_ai_task(p_task_id bigint, p_success boolean, p_result jsonb DEFAULT NULL::jsonb, p_error text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update system.ai_task
  update system.ai_task
     set status = case when p_success then 'DONE' else 'FAILED' end,
     set status = case when p_success then 'DONE' else 'FAILED' end,
         completed_at = now(),
         completed_at = now(),
         result_json = p_result,
         result_json = p_result,
         error_text = p_error
         error_text = p_error
   where task_id = p_task_id;
   where task_id = p_task_id;


  insert into system.ai_task_run(task_id, run_status, note)
  insert into system.ai_task_run(task_id, run_status, note)
  values (p_task_id, case when p_success then 'DONE' else 'FAIL' end,
  values (p_task_id, case when p_success then 'DONE' else 'FAIL' end,
          case when p_success then null else coalesce(p_error,'') end);
          case when p_success then null else coalesce(p_error,'') end);
end;
end;
$$;
$$;




--
--
-- Name: complete_exec_request(bigint, integer, text, text); Type: FUNCTION; Schema: system; Owner: -
-- Name: complete_exec_request(bigint, integer, text, text); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.complete_exec_request(p_request_id bigint, p_exit_code integer, p_stdout text, p_stderr text) RETURNS void
CREATE FUNCTION system.complete_exec_request(p_request_id bigint, p_exit_code integer, p_stdout text, p_stderr text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update system.exec_run_request
  update system.exec_run_request
     set status = case when coalesce(p_exit_code,1)=0 then 'DONE' else 'FAILED' end,
     set status = case when coalesce(p_exit_code,1)=0 then 'DONE' else 'FAILED' end,
         completed_at = now(),
         completed_at = now(),
         exit_code = p_exit_code,
         exit_code = p_exit_code,
         stdout_text = p_stdout,
         stdout_text = p_stdout,
         stderr_text = p_stderr
         stderr_text = p_stderr
   where request_id = p_request_id;
   where request_id = p_request_id;
end;
end;
$$;
$$;




--
--
-- Name: compute_loop_sla(timestamp with time zone, timestamp with time zone); Type: FUNCTION; Schema: system; Owner: -
-- Name: compute_loop_sla(timestamp with time zone, timestamp with time zone); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.compute_loop_sla(p_start timestamp with time zone, p_end timestamp with time zone) RETURNS integer
CREATE FUNCTION system.compute_loop_sla(p_start timestamp with time zone, p_end timestamp with time zone) RETURNS integer
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  rec record;
  rec record;
  n int := 0;
  n int := 0;
begin
begin
  for rec in
  for rec in
    select
    select
      loop_code,
      loop_code,
      count(*) filter (where tick_status in ('DONE','FAIL')) as tick_count,
      count(*) filter (where tick_status in ('DONE','FAIL')) as tick_count,
      count(*) filter (where tick_status = 'FAIL') as fail_count
      count(*) filter (where tick_status = 'FAIL') as fail_count
    from system.loop_tick_log
    from system.loop_tick_log
    where created_at >= p_start
    where created_at >= p_start
      and created_at <  p_end
      and created_at <  p_end
    group by loop_code
    group by loop_code
  loop
  loop
    insert into system.loop_sla_stat(loop_code, window_start, window_end, tick_count, fail_count)
    insert into system.loop_sla_stat(loop_code, window_start, window_end, tick_count, fail_count)
    values (rec.loop_code, p_start, p_end, rec.tick_count::int, rec.fail_count::int);
    values (rec.loop_code, p_start, p_end, rec.tick_count::int, rec.fail_count::int);
    n := n + 1;
    n := n + 1;
  end loop;
  end loop;


  return n;
  return n;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_exec_from_approval(bigint); Type: FUNCTION; Schema: system; Owner: -
-- Name: enqueue_exec_from_approval(bigint); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.enqueue_exec_from_approval(p_approval_request_id bigint) RETURNS bigint
CREATE FUNCTION system.enqueue_exec_from_approval(p_approval_request_id bigint) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  ar record;
  ar record;
  mp record;
  mp record;
  rid bigint;
  rid bigint;
begin
begin
  select * into ar
  select * into ar
    from system.approval_request
    from system.approval_request
   where approval_request_id = p_approval_request_id;
   where approval_request_id = p_approval_request_id;


  if ar.approval_request_id is null then
  if ar.approval_request_id is null then
    raise exception 'approval_request not found: %', p_approval_request_id;
    raise exception 'approval_request not found: %', p_approval_request_id;
  end if;
  end if;


  if ar.approval_status <> 'APPROVED' then
  if ar.approval_status <> 'APPROVED' then
    raise exception 'approval_status is not APPROVED: %', ar.approval_status;
    raise exception 'approval_status is not APPROVED: %', ar.approval_status;
  end if;
  end if;


  select * into mp
  select * into mp
    from system.approval_exec_map
    from system.approval_exec_map
   where approval_flow_code = ar.approval_flow_code;
   where approval_flow_code = ar.approval_flow_code;


  if mp.approval_flow_code is null then
  if mp.approval_flow_code is null then
    raise exception 'approval_exec_map missing for flow: %', ar.approval_flow_code;
    raise exception 'approval_exec_map missing for flow: %', ar.approval_flow_code;
  end if;
  end if;


  insert into system.exec_run_request(command_code, args_json, priority, status, requested_by, worker_tag)
  insert into system.exec_run_request(command_code, args_json, priority, status, requested_by, worker_tag)
  values (
  values (
    mp.command_code,
    mp.command_code,
    jsonb_build_object(
    jsonb_build_object(
      'approval_request_id', ar.approval_request_id::text,
      'approval_request_id', ar.approval_request_id::text,
      'business_table', ar.business_table,
      'business_table', ar.business_table,
      'business_id', ar.business_id::text
      'business_id', ar.business_id::text
    ),
    ),
    100,
    100,
    'PENDING',
    'PENDING',
    auth.uid(),
    auth.uid(),
    mp.worker_tag
    mp.worker_tag
  )
  )
  returning request_id into rid;
  returning request_id into rid;


  return rid;
  return rid;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_notification(text, jsonb); Type: FUNCTION; Schema: system; Owner: -
-- Name: enqueue_notification(text, jsonb); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.enqueue_notification(p_event_type text, p_payload jsonb) RETURNS bigint
CREATE FUNCTION system.enqueue_notification(p_event_type text, p_payload jsonb) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  rid bigint;
  rid bigint;
begin
begin
  insert into ops.notification_outbox(channel_type, destination, payload)
  insert into ops.notification_outbox(channel_type, destination, payload)
  select e.channel_type, e.destination,
  select e.channel_type, e.destination,
         jsonb_build_object(
         jsonb_build_object(
           'event_type', p_event_type,
           'event_type', p_event_type,
           'ts', now(),
           'ts', now(),
           'payload', coalesce(p_payload,'{}'::jsonb)
           'payload', coalesce(p_payload,'{}'::jsonb)
         )
         )
    from system.notification_subscription s
    from system.notification_subscription s
    join system.notification_endpoint e on e.endpoint_code = s.endpoint_code
    join system.notification_endpoint e on e.endpoint_code = s.endpoint_code
   where s.event_type = p_event_type
   where s.event_type = p_event_type
     and s.is_active = true
     and s.is_active = true
     and e.is_active = true;
     and e.is_active = true;


  -- last inserted id is not deterministic if multiple rows; return 0 for "ok"
  -- last inserted id is not deterministic if multiple rows; return 0 for "ok"
  rid := 0;
  rid := 0;
  return rid;
  return rid;
end;
end;
$$;
$$;




--
--
-- Name: enqueue_ops_for_finalized(text, text, bigint, jsonb); Type: FUNCTION; Schema: system; Owner: -
-- Name: enqueue_ops_for_finalized(text, text, bigint, jsonb); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.enqueue_ops_for_finalized(p_function_code text, p_business_table text, p_business_id bigint, p_payload jsonb DEFAULT '{}'::jsonb) RETURNS jsonb
CREATE FUNCTION system.enqueue_ops_for_finalized(p_function_code text, p_business_table text, p_business_id bigint, p_payload jsonb DEFAULT '{}'::jsonb) RETURNS jsonb
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
DECLARE
DECLARE
  v_doc text;
  v_doc text;
  v_gen boolean;
  v_gen boolean;
  v_send boolean;
  v_send boolean;
  v_job_pdf bigint;
  v_job_pdf bigint;
  v_job_send bigint;
  v_job_send bigint;
BEGIN
BEGIN
  SELECT document_type_code, generate_pdf, auto_send
  SELECT document_type_code, generate_pdf, auto_send
    INTO v_doc, v_gen, v_send
    INTO v_doc, v_gen, v_send
    FROM system.business_ops_map
    FROM system.business_ops_map
   WHERE function_code = p_function_code;
   WHERE function_code = p_function_code;


  IF NOT FOUND THEN
  IF NOT FOUND THEN
    RETURN jsonb_build_object(
    RETURN jsonb_build_object(
      'enqueued', false,
      'enqueued', false,
      'reason', 'no business_ops_map for function_code',
      'reason', 'no business_ops_map for function_code',
      'function_code', p_function_code
      'function_code', p_function_code
    );
    );
  END IF;
  END IF;


  IF v_gen THEN
  IF v_gen THEN
    v_job_pdf := ops.enqueue_generate_pdf(
    v_job_pdf := ops.enqueue_generate_pdf(
      p_function_code, v_doc, p_business_table, p_business_id,
      p_function_code, v_doc, p_business_table, p_business_id,
      jsonb_build_object('doc', v_doc, 'business_table', p_business_table, 'business_id', p_business_id) || COALESCE(p_payload,'{}'::jsonb),
      jsonb_build_object('doc', v_doc, 'business_table', p_business_table, 'business_id', p_business_id) || COALESCE(p_payload,'{}'::jsonb),
      100
      100
    );
    );
  END IF;
  END IF;


  IF v_send THEN
  IF v_send THEN
    v_job_send := ops.enqueue_send_document(
    v_job_send := ops.enqueue_send_document(
      p_function_code, v_doc, p_business_table, p_business_table::text, -- placeholder? NO: must be bigint; use p_business_id
      p_function_code, v_doc, p_business_table, p_business_table::text, -- placeholder? NO: must be bigint; use p_business_id
      '{}'::jsonb, 90
      '{}'::jsonb, 90
    );
    );
    -- ↑ ここは誤り防止のため、正しい insert を再実行で上書きする
    -- ↑ ここは誤り防止のため、正しい insert を再実行で上書きする
    --    （既に入ってしまうのを防ぐため、直下で正しい enqueue を作り直す）
    --    （既に入ってしまうのを防ぐため、直下で正しい enqueue を作り直す）
    DELETE FROM ops.ops_job_queue
    DELETE FROM ops.ops_job_queue
     WHERE job_id = v_job_send AND business_id IS NULL;
     WHERE job_id = v_job_send AND business_id IS NULL;


    v_job_send := ops.enqueue_send_document(
    v_job_send := ops.enqueue_send_document(
      p_function_code, v_doc, p_business_table, p_business_id,
      p_function_code, v_doc, p_business_table, p_business_id,
      jsonb_build_object('doc', v_doc, 'business_table', p_business_table, 'business_id', p_business_id) || COALESCE(p_payload,'{}'::jsonb),
      jsonb_build_object('doc', v_doc, 'business_table', p_business_table, 'business_id', p_business_id) || COALESCE(p_payload,'{}'::jsonb),
      90
      90
    );
    );
  END IF;
  END IF;


  RETURN jsonb_build_object(
  RETURN jsonb_build_object(
    'enqueued', true,
    'enqueued', true,
    'function_code', p_function_code,
    'function_code', p_function_code,
    'document_type_code', v_doc,
    'document_type_code', v_doc,
    'job_generate_pdf', v_job_pdf,
    'job_generate_pdf', v_job_pdf,
    'job_send_document', v_job_send
    'job_send_document', v_job_send
  );
  );
END;
END;
$$;
$$;




--
--
-- Name: enqueue_ops_for_finalized_business(text, bigint, text, uuid); Type: FUNCTION; Schema: system; Owner: -
-- Name: enqueue_ops_for_finalized_business(text, bigint, text, uuid); Type: FUNCTION; Schema: system; Owner: -
--
--


    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  v_doc_type text;
  v_doc_type text;
  v_gen boolean;
  v_gen boolean;
  v_send boolean;
  v_send boolean;
  v_job_pdf bigint;
  v_job_pdf bigint;
  v_job_send bigint;
  v_job_send bigint;
begin
begin
  select document_type_code, generate_pdf, auto_send
  select document_type_code, generate_pdf, auto_send
    into v_doc_type, v_gen, v_send
    into v_doc_type, v_gen, v_send
    from system.business_ops_map
    from system.business_ops_map
   where function_code = p_function_code;
   where function_code = p_function_code;


  if v_doc_type is null then
  if v_doc_type is null then
    return jsonb_build_object('ok', false, 'reason', 'business_ops_map_not_found', 'function_code', p_function_code);
    return jsonb_build_object('ok', false, 'reason', 'business_ops_map_not_found', 'function_code', p_function_code);
  end if;
  end if;


  -- PDFジョブ
  -- PDFジョブ
  if v_gen then
  if v_gen then
    v_job_pdf := ops.enqueue_job(
    v_job_pdf := ops.enqueue_job(
      'GENERATE_PDF',
      'GENERATE_PDF',
      jsonb_build_object(
      jsonb_build_object(
        'function_code', p_function_code,
        'function_code', p_function_code,
        'document_type_code', v_doc_type,
        'document_type_code', v_doc_type,
        'document_id', p_document_id,
        'document_id', p_document_id,
        'business_table', p_business_table
        'business_table', p_business_table
      ),
      ),
      now(), 50, 3, p_actor
      now(), 50, 3, p_actor
    );
    );
  end if;
  end if;


  -- 送付ジョブ（PDF後でも/並列でもOK。ワーカー側で依存を見る想定）
  -- 送付ジョブ（PDF後でも/並列でもOK。ワーカー側で依存を見る想定）
  if v_send then
  if v_send then
    v_job_send := ops.enqueue_job(
    v_job_send := ops.enqueue_job(
      'SEND_DOCUMENT',
      'SEND_DOCUMENT',
      jsonb_build_object(
      jsonb_build_object(
        'function_code', p_function_code,
        'function_code', p_function_code,
        'document_type_code', v_doc_type,
        'document_type_code', v_doc_type,
        'document_id', p_document_id,
        'document_id', p_document_id,
        'business_table', p_business_table,
        'business_table', p_business_table,
        'channels', jsonb_build_array('EMAIL','LINE')  -- 既定（後で変更可）
        'channels', jsonb_build_array('EMAIL','LINE')  -- 既定（後で変更可）
      ),
      ),
      now(), 60, 3, p_actor
      now(), 60, 3, p_actor
    );
    );
  end if;
  end if;


  return jsonb_build_object(
  return jsonb_build_object(
    'ok', true,
    'ok', true,
    'pdf_job_id', v_job_pdf,
    'pdf_job_id', v_job_pdf,
    'send_job_id', v_job_send
    'send_job_id', v_job_send
  );
  );
end;
end;
$$;
$$;




--
--
-- Name: finalize_business(text, text, bigint); Type: FUNCTION; Schema: system; Owner: -
-- Name: finalize_business(text, text, bigint); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.finalize_business(p_function_code text, p_target_table text, p_business_id bigint) RETURNS void
CREATE FUNCTION system.finalize_business(p_function_code text, p_target_table text, p_business_id bigint) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $_$
    AS $_$
declare
declare
  v_flow_code text;
  v_flow_code text;
begin
begin
  -- 承認フロー取得
  -- 承認フロー取得
  select m.approval_flow_code
  select m.approval_flow_code
    into v_flow_code
    into v_flow_code
    from system.action_approval_map m
    from system.action_approval_map m
   where m.action_code = 'FINALIZE'
   where m.action_code = 'FINALIZE'
     and m.function_code = p_function_code;
     and m.function_code = p_function_code;


  if v_flow_code is not null then
  if v_flow_code is not null then
    insert into system.approval_request(
    insert into system.approval_request(
      approval_flow_code,
      approval_flow_code,
      business_table,
      business_table,
      business_id,
      business_id,
      approval_status,
      approval_status,
      requested_by
      requested_by
    ) values (
    ) values (
      v_flow_code,
      v_flow_code,
      p_target_table,
      p_target_table,
      p_business_id,
      p_business_id,
      'REQUESTED',
      'REQUESTED',
      auth.uid()
      auth.uid()
    );
    );
  else
  else
    execute format(
    execute format(
      'update %s set status = %L where id = $1',
      'update %s set status = %L where id = $1',
      p_target_table, 'FINALIZED'
      p_target_table, 'FINALIZED'
    ) using p_business_id;
    ) using p_business_id;
  end if;
  end if;


  perform system.log_operation(
  perform system.log_operation(
    'FINALIZE_REQUEST',
    'FINALIZE_REQUEST',
    p_target_table,
    p_target_table,
    jsonb_build_object('id', p_business_id)
    jsonb_build_object('id', p_business_id)
  );
  );
end;
end;
$_$;
$_$;




--
--
-- Name: get_active_loop_configs(); Type: FUNCTION; Schema: system; Owner: -
-- Name: get_active_loop_configs(); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.get_active_loop_configs() RETURNS TABLE(loop_code text, command_code text, interval_sec integer, jitter_sec integer, command_text text, next_run_at timestamp with time zone)
CREATE FUNCTION system.get_active_loop_configs() RETURNS TABLE(loop_code text, command_code text, interval_sec integer, jitter_sec integer, command_text text, next_run_at timestamp with time zone)
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  select
  select
    lc.loop_code,
    lc.loop_code,
    lc.command_code,
    lc.command_code,
    lc.interval_sec,
    lc.interval_sec,
    lc.jitter_sec,
    lc.jitter_sec,
    c.command_text,
    c.command_text,
    lc.next_run_at
    lc.next_run_at
  from system.loop_config lc
  from system.loop_config lc
  join system.exec_command c on c.command_code = lc.command_code
  join system.exec_command c on c.command_code = lc.command_code
  where lc.is_enabled = true
  where lc.is_enabled = true
    and c.is_active = true;
    and c.is_active = true;
$$;
$$;




--
--
-- Name: get_due_loops(); Type: FUNCTION; Schema: system; Owner: -
-- Name: get_due_loops(); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.get_due_loops() RETURNS TABLE(loop_code text, command_code text, interval_sec integer, jitter_sec integer, command_text text)
CREATE FUNCTION system.get_due_loops() RETURNS TABLE(loop_code text, command_code text, interval_sec integer, jitter_sec integer, command_text text)
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  select
  select
    lc.loop_code,
    lc.loop_code,
    lc.command_code,
    lc.command_code,
    lc.interval_sec,
    lc.interval_sec,
    lc.jitter_sec,
    lc.jitter_sec,
    c.command_text
    c.command_text
  from system.loop_config lc
  from system.loop_config lc
  join system.exec_command c on c.command_code = lc.command_code
  join system.exec_command c on c.command_code = lc.command_code
  where lc.is_enabled = true
  where lc.is_enabled = true
    and c.is_active = true
    and c.is_active = true
    and coalesce((select is_enabled from system.runtime_killswitch where key='GLOBAL'), false) = false
    and coalesce((select is_enabled from system.runtime_killswitch where key='GLOBAL'), false) = false
    and (
    and (
      lc.next_run_at is null
      lc.next_run_at is null
      or lc.next_run_at <= now()
      or lc.next_run_at <= now()
    );
    );
$$;
$$;




--
--
-- Name: get_due_loops(timestamp with time zone); Type: FUNCTION; Schema: system; Owner: -
-- Name: get_due_loops(timestamp with time zone); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.get_due_loops(p_now timestamp with time zone DEFAULT now()) RETURNS TABLE(loop_code text, command_code text, interval_sec integer, jitter_sec integer, command_text text)
CREATE FUNCTION system.get_due_loops(p_now timestamp with time zone DEFAULT now()) RETURNS TABLE(loop_code text, command_code text, interval_sec integer, jitter_sec integer, command_text text)
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  select
  select
    lc.loop_code,
    lc.loop_code,
    lc.command_code,
    lc.command_code,
    lc.interval_sec,
    lc.interval_sec,
    lc.jitter_sec,
    lc.jitter_sec,
    c.command_text
    c.command_text
  from system.loop_config lc
  from system.loop_config lc
  join system.exec_command c on c.command_code = lc.command_code
  join system.exec_command c on c.command_code = lc.command_code
  where lc.is_enabled = true
  where lc.is_enabled = true
    and c.is_active = true
    and c.is_active = true
    and (lc.next_run_at is null or lc.next_run_at <= p_now);
    and (lc.next_run_at is null or lc.next_run_at <= p_now);
$$;
$$;




--
--
-- Name: log_operation(uuid, text, text, text, text, text, text, text, text, text); Type: FUNCTION; Schema: system; Owner: -
-- Name: log_operation(uuid, text, text, text, text, text, text, text, text, text); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.log_operation(p_session_id uuid, p_role_code text, p_module_code text, p_function_code text, p_screen_code text, p_operation_type text, p_target_table text DEFAULT NULL::text, p_target_id text DEFAULT NULL::text, p_operation_status text DEFAULT 'SUCCESS'::text, p_error_message text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION system.log_operation(p_session_id uuid, p_role_code text, p_module_code text, p_function_code text, p_screen_code text, p_operation_type text, p_target_table text DEFAULT NULL::text, p_target_id text DEFAULT NULL::text, p_operation_status text DEFAULT 'SUCCESS'::text, p_error_message text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  insert into system.operation_log (
  insert into system.operation_log (
    session_id,
    session_id,
    role_code,
    role_code,
    module_code,
    module_code,
    function_code,
    function_code,
    screen_code,
    screen_code,
    operation_type,
    operation_type,
    target_table,
    target_table,
    target_id,
    target_id,
    operation_status,
    operation_status,
    operated_by,
    operated_by,
    error_message
    error_message
  )
  )
  values (
  values (
    p_session_id,
    p_session_id,
    p_role_code,
    p_role_code,
    p_module_code,
    p_module_code,
    p_function_code,
    p_function_code,
    p_screen_code,
    p_screen_code,
    p_operation_type,
    p_operation_type,
    p_target_table,
    p_target_table,
    p_target_id,
    p_target_id,
    p_operation_status,
    p_operation_status,
    auth.uid(),
    auth.uid(),
    p_error_message
    p_error_message
  );
  );
end;
end;
$$;
$$;




--
--
-- Name: loop_mark_done(text, text); Type: FUNCTION; Schema: system; Owner: -
-- Name: loop_mark_done(text, text); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.loop_mark_done(p_loop_code text, p_note text DEFAULT NULL::text) RETURNS void
CREATE FUNCTION system.loop_mark_done(p_loop_code text, p_note text DEFAULT NULL::text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  update system.loop_config
  update system.loop_config
     set last_run_at = now(),
     set last_run_at = now(),
         next_run_at = system.calc_next_run_at(now(), interval_sec, jitter_sec),
         next_run_at = system.calc_next_run_at(now(), interval_sec, jitter_sec),
         updated_at = now()
         updated_at = now()
   where loop_code = p_loop_code;
   where loop_code = p_loop_code;


  insert into system.loop_tick_log(loop_code, tick_status, note) values (p_loop_code,'DONE',p_note);
  insert into system.loop_tick_log(loop_code, tick_status, note) values (p_loop_code,'DONE',p_note);
end;
end;
$$;
$$;




--
--
-- Name: loop_mark_start(text); Type: FUNCTION; Schema: system; Owner: -
-- Name: loop_mark_start(text); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.loop_mark_start(p_loop_code text) RETURNS void
CREATE FUNCTION system.loop_mark_start(p_loop_code text) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  insert into system.loop_tick_log(loop_code, tick_status) values (p_loop_code,'START');
  insert into system.loop_tick_log(loop_code, tick_status) values (p_loop_code,'START');
end;
end;
$$;
$$;




--
--
-- Name: mark_loop_ran(text, integer, integer); Type: FUNCTION; Schema: system; Owner: -
-- Name: mark_loop_ran(text, integer, integer); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.mark_loop_ran(p_loop_code text, p_interval_sec integer, p_jitter_sec integer) RETURNS void
CREATE FUNCTION system.mark_loop_ran(p_loop_code text, p_interval_sec integer, p_jitter_sec integer) RETURNS void
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  j int;
  j int;
begin
begin
  j := greatest(coalesce(p_jitter_sec,0),0);
  j := greatest(coalesce(p_jitter_sec,0),0);
  update system.loop_config
  update system.loop_config
     set last_run_at = now(),
     set last_run_at = now(),
         next_run_at = now()
         next_run_at = now()
           + (coalesce(p_interval_sec,60) || ' seconds')::interval
           + (coalesce(p_interval_sec,60) || ' seconds')::interval
           + ((floor(random()*(j+1))::int) || ' seconds')::interval
           + ((floor(random()*(j+1))::int) || ' seconds')::interval
   where loop_code = p_loop_code;
   where loop_code = p_loop_code;
end;
end;
$$;
$$;




--
--
-- Name: pick_next_ai_task(text); Type: FUNCTION; Schema: system; Owner: -
-- Name: pick_next_ai_task(text); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.pick_next_ai_task(p_agent_code text) RETURNS TABLE(task_id bigint, task_type text, input_json jsonb)
CREATE FUNCTION system.pick_next_ai_task(p_agent_code text) RETURNS TABLE(task_id bigint, task_type text, input_json jsonb)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  r record;
  r record;
begin
begin
  for r in
  for r in
    select *
    select *
      from system.ai_task
      from system.ai_task
     where status='PENDING'
     where status='PENDING'
       and agent_code=p_agent_code
       and agent_code=p_agent_code
     order by priority asc, requested_at asc
     order by priority asc, requested_at asc
     for update skip locked
     for update skip locked
     limit 1
     limit 1
  loop
  loop
    update system.ai_task
    update system.ai_task
       set status='RUNNING', started_at=now()
       set status='RUNNING', started_at=now()
     where task_id=r.task_id;
     where task_id=r.task_id;


    insert into system.ai_task_run(task_id, run_status, note)
    insert into system.ai_task_run(task_id, run_status, note)
    values (r.task_id, 'START', null);
    values (r.task_id, 'START', null);


    task_id := r.task_id;
    task_id := r.task_id;
    task_type := r.task_type;
    task_type := r.task_type;
    input_json := r.input_json;
    input_json := r.input_json;
    return next;
    return next;
    return;
    return;
  end loop;
  end loop;


  return;
  return;
end;
end;
$$;
$$;




--
--
-- Name: pick_next_exec_request(uuid); Type: FUNCTION; Schema: system; Owner: -
-- Name: pick_next_exec_request(uuid); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.pick_next_exec_request(p_worker_id uuid) RETURNS TABLE(request_id bigint, command_code text, command_text text, args_json_text text, priority integer)
CREATE FUNCTION system.pick_next_exec_request(p_worker_id uuid) RETURNS TABLE(request_id bigint, command_code text, command_text text, args_json_text text, priority integer)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  if coalesce((select is_enabled from system.runtime_killswitch where key='GLOBAL'), false) then
  if coalesce((select is_enabled from system.runtime_killswitch where key='GLOBAL'), false) then
    return;
    return;
  end if;
  end if;


  return query
  return query
  with picked as (
  with picked as (
    select r.request_id
    select r.request_id
      from system.exec_run_request r
      from system.exec_run_request r
     where r.status = 'PENDING'
     where r.status = 'PENDING'
     order by r.priority asc, r.requested_at asc
     order by r.priority asc, r.requested_at asc
     for update skip locked
     for update skip locked
     limit 1
     limit 1
  )
  )
  update system.exec_run_request r
  update system.exec_run_request r
     set status='RUNNING',
     set status='RUNNING',
         picked_by = p_worker_id,
         picked_by = p_worker_id,
         picked_at = now()
         picked_at = now()
    from picked
    from picked
   where r.request_id = picked.request_id
   where r.request_id = picked.request_id
  returning
  returning
    r.request_id,
    r.request_id,
    r.command_code,
    r.command_code,
    (select c.command_text from system.exec_command c where c.command_code=r.command_code),
    (select c.command_text from system.exec_command c where c.command_code=r.command_code),
    r.args_json::text,
    r.args_json::text,
    r.priority;
    r.priority;
end;
end;
$$;
$$;




--
--
-- Name: pick_next_exec_request(text, text); Type: FUNCTION; Schema: system; Owner: -
-- Name: pick_next_exec_request(text, text); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.pick_next_exec_request(p_worker_tag text DEFAULT NULL::text, p_command_code text DEFAULT NULL::text) RETURNS TABLE(request_id bigint, command_code text, args_json jsonb, priority integer, rendered_command text)
CREATE FUNCTION system.pick_next_exec_request(p_worker_tag text DEFAULT NULL::text, p_command_code text DEFAULT NULL::text) RETURNS TABLE(request_id bigint, command_code text, args_json jsonb, priority integer, rendered_command text)
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  r record;
  r record;
  cmd_text text;
  cmd_text text;
begin
begin
  for r in
  for r in
    select *
    select *
      from system.exec_run_request
      from system.exec_run_request
     where status = 'PENDING'
     where status = 'PENDING'
       and (p_worker_tag is null or worker_tag is null or worker_tag = p_worker_tag)
       and (p_worker_tag is null or worker_tag is null or worker_tag = p_worker_tag)
       and (p_command_code is null or command_code = p_command_code)
       and (p_command_code is null or command_code = p_command_code)
     order by priority asc, requested_at asc
     order by priority asc, requested_at asc
     for update skip locked
     for update skip locked
     limit 1
     limit 1
  loop
  loop
    select c.command_text into cmd_text
    select c.command_text into cmd_text
      from system.exec_command c
      from system.exec_command c
     where c.command_code = r.command_code
     where c.command_code = r.command_code
       and c.is_active = true;
       and c.is_active = true;


    cmd_text := system.render_command(cmd_text, r.args_json);
    cmd_text := system.render_command(cmd_text, r.args_json);


    update system.exec_run_request
    update system.exec_run_request
       set status = 'RUNNING',
       set status = 'RUNNING',
           picked_by = auth.uid(),
           picked_by = auth.uid(),
           picked_at = now(),
           picked_at = now(),
           rendered_command = cmd_text
           rendered_command = cmd_text
     where request_id = r.request_id;
     where request_id = r.request_id;


    request_id := r.request_id;
    request_id := r.request_id;
    command_code := r.command_code;
    command_code := r.command_code;
    args_json := r.args_json;
    args_json := r.args_json;
    priority := r.priority;
    priority := r.priority;
    rendered_command := cmd_text;
    rendered_command := cmd_text;
    return next;
    return next;
    return;
    return;
  end loop;
  end loop;


  return;
  return;
end;
end;
$$;
$$;




--
--
-- Name: render_command(text, jsonb); Type: FUNCTION; Schema: system; Owner: -
-- Name: render_command(text, jsonb); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.render_command(p_command_text text, p_args jsonb) RETURNS text
CREATE FUNCTION system.render_command(p_command_text text, p_args jsonb) RETURNS text
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  k text;
  k text;
  v text;
  v text;
  out_text text := coalesce(p_command_text,'');
  out_text text := coalesce(p_command_text,'');
begin
begin
  if p_args is null then
  if p_args is null then
    return out_text;
    return out_text;
  end if;
  end if;


  for k in
  for k in
    select jsonb_object_keys(p_args)
    select jsonb_object_keys(p_args)
  loop
  loop
    v := coalesce(p_args->>k,'');
    v := coalesce(p_args->>k,'');
    -- replace {{k}} occurrences
    -- replace {{k}} occurrences
    out_text := replace(out_text, '{{' || k || '}}', v);
    out_text := replace(out_text, '{{' || k || '}}', v);
  end loop;
  end loop;


  return out_text;
  return out_text;
end;
end;
$$;
$$;




--
--
-- Name: request_exec(text, jsonb, integer); Type: FUNCTION; Schema: system; Owner: -
-- Name: request_exec(text, jsonb, integer); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.request_exec(p_command_code text, p_args jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 100) RETURNS bigint
CREATE FUNCTION system.request_exec(p_command_code text, p_args jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 100) RETURNS bigint
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
declare
declare
  rid bigint;
  rid bigint;
begin
begin
  insert into system.exec_run_request(command_code, args_json, priority, requested_by)
  insert into system.exec_run_request(command_code, args_json, priority, requested_by)
  values (p_command_code, coalesce(p_args,'{}'::jsonb), coalesce(p_priority,100), auth.uid())
  values (p_command_code, coalesce(p_args,'{}'::jsonb), coalesce(p_priority,100), auth.uid())
  returning request_id into rid;
  returning request_id into rid;


  return rid;
  return rid;
end;
end;
$$;
$$;




--
--
-- Name: request_exec_simple(text, jsonb, integer); Type: FUNCTION; Schema: system; Owner: -
-- Name: request_exec_simple(text, jsonb, integer); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.request_exec_simple(p_command_code text, p_args jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 100) RETURNS bigint
CREATE FUNCTION system.request_exec_simple(p_command_code text, p_args jsonb DEFAULT '{}'::jsonb, p_priority integer DEFAULT 100) RETURNS bigint
    LANGUAGE sql
    LANGUAGE sql
    AS $$
    AS $$
  select system.request_exec(p_command_code, coalesce(p_args,'{}'::jsonb), coalesce(p_priority,100));
  select system.request_exec(p_command_code, coalesce(p_args,'{}'::jsonb), coalesce(p_priority,100));
$$;
$$;




--
--
-- Name: tg_exec_run_notify(); Type: FUNCTION; Schema: system; Owner: -
-- Name: tg_exec_run_notify(); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.tg_exec_run_notify() RETURNS trigger
CREATE FUNCTION system.tg_exec_run_notify() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
begin
begin
  if (tg_op = 'UPDATE') then
  if (tg_op = 'UPDATE') then
    if (old.status is distinct from new.status) then
    if (old.status is distinct from new.status) then
      if new.status = 'DONE' then
      if new.status = 'DONE' then
        perform system.enqueue_notification(
        perform system.enqueue_notification(
          'EXEC_DONE',
          'EXEC_DONE',
          jsonb_build_object(
          jsonb_build_object(
            'request_id', new.request_id,
            'request_id', new.request_id,
            'command_code', new.command_code,
            'command_code', new.command_code,
            'exit_code', new.exit_code
            'exit_code', new.exit_code
          )
          )
        );
        );
      elsif new.status = 'FAILED' then
      elsif new.status = 'FAILED' then
        perform system.enqueue_notification(
        perform system.enqueue_notification(
          'EXEC_FAILED',
          'EXEC_FAILED',
          jsonb_build_object(
          jsonb_build_object(
            'request_id', new.request_id,
            'request_id', new.request_id,
            'command_code', new.command_code,
            'command_code', new.command_code,
            'exit_code', new.exit_code,
            'exit_code', new.exit_code,
            'stderr_head', left(coalesce(new.stderr_text,''), 500)
            'stderr_head', left(coalesce(new.stderr_text,''), 500)
          )
          )
        );
        );
      end if;
      end if;
    end if;
    end if;
  end if;
  end if;
  return new;
  return new;
end;
end;
$$;
$$;




--
--
-- Name: tg_set_updated_at(); Type: FUNCTION; Schema: system; Owner: -
-- Name: tg_set_updated_at(); Type: FUNCTION; Schema: system; Owner: -
--
--


CREATE FUNCTION system.tg_set_updated_at() RETURNS trigger
CREATE FUNCTION system.tg_set_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    LANGUAGE plpgsql
    AS $$
    AS $$
    begin
    begin
      new.updated_at := now();
      new.updated_at := now();
      return new;
      return new;
    end;
    end;
    $$;
    $$;




--
--
-- Name: paper_send_fee_journal; Type: TABLE; Schema: accounting; Owner: -
-- Name: paper_send_fee_journal; Type: TABLE; Schema: accounting; Owner: -
--
--


CREATE TABLE accounting.paper_send_fee_journal (
CREATE TABLE accounting.paper_send_fee_journal (
    journal_id bigint NOT NULL,
    journal_id bigint NOT NULL,
    send_history_id bigint NOT NULL,
    send_history_id bigint NOT NULL,
    journal_date date DEFAULT CURRENT_DATE NOT NULL,
    journal_date date DEFAULT CURRENT_DATE NOT NULL,
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    fee_amount numeric NOT NULL,
    fee_amount numeric NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    account_code text DEFAULT '8001'::text NOT NULL,
    account_code text DEFAULT '8001'::text NOT NULL,
    description text,
    description text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: paper_send_fee_journal_journal_id_seq; Type: SEQUENCE; Schema: accounting; Owner: -
-- Name: paper_send_fee_journal_journal_id_seq; Type: SEQUENCE; Schema: accounting; Owner: -
--
--


CREATE SEQUENCE accounting.paper_send_fee_journal_journal_id_seq
CREATE SEQUENCE accounting.paper_send_fee_journal_journal_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: paper_send_fee_journal_journal_id_seq; Type: SEQUENCE OWNED BY; Schema: accounting; Owner: -
-- Name: paper_send_fee_journal_journal_id_seq; Type: SEQUENCE OWNED BY; Schema: accounting; Owner: -
--
--


ALTER SEQUENCE accounting.paper_send_fee_journal_journal_id_seq OWNED BY accounting.paper_send_fee_journal.journal_id;
ALTER SEQUENCE accounting.paper_send_fee_journal_journal_id_seq OWNED BY accounting.paper_send_fee_journal.journal_id;




--
--
-- Name: document_send_history; Type: TABLE; Schema: ops; Owner: -
-- Name: document_send_history; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.document_send_history (
CREATE TABLE ops.document_send_history (
    send_history_id bigint NOT NULL,
    send_history_id bigint NOT NULL,
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    document_id bigint NOT NULL,
    document_id bigint NOT NULL,
    channel_code text NOT NULL,
    channel_code text NOT NULL,
    resend_type_code text NOT NULL,
    resend_type_code text NOT NULL,
    send_fee_amount numeric DEFAULT 0 NOT NULL,
    send_fee_amount numeric DEFAULT 0 NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    send_status text NOT NULL,
    send_status text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    sent_at timestamp with time zone,
    sent_at timestamp with time zone,
    notified_at timestamp with time zone,
    notified_at timestamp with time zone,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    company_id uuid,
    company_id uuid,
    CONSTRAINT document_send_history_send_status_check CHECK ((send_status = ANY (ARRAY['SUCCESS'::text, 'FAILED'::text])))
    CONSTRAINT document_send_history_send_status_check CHECK ((send_status = ANY (ARRAY['SUCCESS'::text, 'FAILED'::text])))
);
);




--
--
-- Name: send_channel_master; Type: TABLE; Schema: ops; Owner: -
-- Name: send_channel_master; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.send_channel_master (
CREATE TABLE ops.send_channel_master (
    channel_code text NOT NULL,
    channel_code text NOT NULL,
    channel_name text NOT NULL,
    channel_name text NOT NULL,
    is_paper boolean NOT NULL,
    is_paper boolean NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_paper_send_fee_posting; Type: VIEW; Schema: accounting; Owner: -
-- Name: v_paper_send_fee_posting; Type: VIEW; Schema: accounting; Owner: -
--
--


CREATE VIEW accounting.v_paper_send_fee_posting AS
CREATE VIEW accounting.v_paper_send_fee_posting AS
 SELECT h.send_history_id,
 SELECT h.send_history_id,
    h.company_id,
    h.company_id,
    h.document_type_code,
    h.document_type_code,
    h.send_fee_amount AS fee_amount,
    h.send_fee_amount AS fee_amount,
    h.currency_code,
    h.currency_code,
    h.created_at AS source_created_at
    h.created_at AS source_created_at
   FROM (ops.document_send_history h
   FROM (ops.document_send_history h
     JOIN ops.send_channel_master c ON ((c.channel_code = h.channel_code)))
     JOIN ops.send_channel_master c ON ((c.channel_code = h.channel_code)))
  WHERE ((c.is_paper = true) AND (h.send_fee_amount > (0)::numeric) AND (h.send_status = 'SUCCESS'::text));
  WHERE ((c.is_paper = true) AND (h.send_fee_amount > (0)::numeric) AND (h.send_status = 'SUCCESS'::text));




--
--
-- Name: ai_apply_audit; Type: TABLE; Schema: analytics; Owner: -
-- Name: ai_apply_audit; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.ai_apply_audit (
CREATE TABLE analytics.ai_apply_audit (
    audit_id uuid DEFAULT gen_random_uuid() NOT NULL,
    audit_id uuid DEFAULT gen_random_uuid() NOT NULL,
    job_id uuid NOT NULL,
    job_id uuid NOT NULL,
    company_id uuid,
    company_id uuid,
    action_type text NOT NULL,
    action_type text NOT NULL,
    before_state jsonb NOT NULL,
    before_state jsonb NOT NULL,
    after_state jsonb NOT NULL,
    after_state jsonb NOT NULL,
    applied_by text NOT NULL,
    applied_by text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ai_event_ai_event_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: ai_event_ai_event_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.ai_event_ai_event_id_seq
CREATE SEQUENCE analytics.ai_event_ai_event_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ai_event_ai_event_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: ai_event_ai_event_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.ai_event_ai_event_id_seq OWNED BY analytics.ai_event.ai_event_id;
ALTER SEQUENCE analytics.ai_event_ai_event_id_seq OWNED BY analytics.ai_event.ai_event_id;




--
--
-- Name: ai_insight_job; Type: TABLE; Schema: analytics; Owner: -
-- Name: ai_insight_job; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.ai_insight_job (
CREATE TABLE analytics.ai_insight_job (
    job_id uuid DEFAULT gen_random_uuid() NOT NULL,
    job_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id uuid,
    company_id uuid,
    insight_type text NOT NULL,
    insight_type text NOT NULL,
    target_key text NOT NULL,
    target_key text NOT NULL,
    context jsonb NOT NULL,
    context jsonb NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    result_ja text,
    result_ja text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    processed_at timestamp with time zone,
    processed_at timestamp with time zone,
    proposed_action jsonb,
    proposed_action jsonb,
    is_applied boolean DEFAULT false NOT NULL,
    is_applied boolean DEFAULT false NOT NULL,
    applied_at timestamp with time zone,
    applied_at timestamp with time zone,
    applied_by text,
    applied_by text,
    rollback_of uuid,
    rollback_of uuid,
    summary_type text,
    summary_type text,
    confidence numeric
    confidence numeric
);
);




--
--
-- Name: ai_job_ai_job_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: ai_job_ai_job_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.ai_job_ai_job_id_seq
CREATE SEQUENCE analytics.ai_job_ai_job_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ai_job_ai_job_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: ai_job_ai_job_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.ai_job_ai_job_id_seq OWNED BY analytics.ai_job.ai_job_id;
ALTER SEQUENCE analytics.ai_job_ai_job_id_seq OWNED BY analytics.ai_job.ai_job_id;




--
--
-- Name: ai_job_type_master; Type: TABLE; Schema: analytics; Owner: -
-- Name: ai_job_type_master; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.ai_job_type_master (
CREATE TABLE analytics.ai_job_type_master (
    job_type text NOT NULL,
    job_type text NOT NULL,
    description text DEFAULT ''::text NOT NULL,
    description text DEFAULT ''::text NOT NULL,
    risk_level text DEFAULT 'low'::text NOT NULL,
    risk_level text DEFAULT 'low'::text NOT NULL,
    default_requires_approval boolean DEFAULT false NOT NULL,
    default_requires_approval boolean DEFAULT false NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ai_kill_switch; Type: TABLE; Schema: analytics; Owner: -
-- Name: ai_kill_switch; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.ai_kill_switch (
CREATE TABLE analytics.ai_kill_switch (
    scope text NOT NULL,
    scope text NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ai_module_manifest; Type: TABLE; Schema: analytics; Owner: -
-- Name: ai_module_manifest; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.ai_module_manifest (
CREATE TABLE analytics.ai_module_manifest (
    module_name text NOT NULL,
    module_name text NOT NULL,
    summary text DEFAULT ''::text NOT NULL,
    summary text DEFAULT ''::text NOT NULL,
    scope text DEFAULT ''::text NOT NULL,
    scope text DEFAULT ''::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ai_rate_limit; Type: TABLE; Schema: analytics; Owner: -
-- Name: ai_rate_limit; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.ai_rate_limit (
CREATE TABLE analytics.ai_rate_limit (
    job_type text NOT NULL,
    job_type text NOT NULL,
    max_per_min integer DEFAULT 30 NOT NULL,
    max_per_min integer DEFAULT 30 NOT NULL,
    cooldown_sec integer DEFAULT 60 NOT NULL,
    cooldown_sec integer DEFAULT 60 NOT NULL,
    last_failed_at timestamp with time zone
    last_failed_at timestamp with time zone
);
);




--
--
-- Name: audit_ai_feedback; Type: TABLE; Schema: analytics; Owner: -
-- Name: audit_ai_feedback; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.audit_ai_feedback (
CREATE TABLE analytics.audit_ai_feedback (
    feedback_id bigint NOT NULL,
    feedback_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    judgement_id bigint,
    judgement_id bigint,
    feedback_type text NOT NULL,
    feedback_type text NOT NULL,
    comment text,
    comment text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_ai_feedback_feedback_type_check CHECK ((feedback_type = ANY (ARRAY['true_positive'::text, 'false_positive'::text, 'needs_more_info'::text])))
    CONSTRAINT audit_ai_feedback_feedback_type_check CHECK ((feedback_type = ANY (ARRAY['true_positive'::text, 'false_positive'::text, 'needs_more_info'::text])))
);
);




--
--
-- Name: audit_ai_feedback_feedback_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: audit_ai_feedback_feedback_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.audit_ai_feedback_feedback_id_seq
CREATE SEQUENCE analytics.audit_ai_feedback_feedback_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_ai_feedback_feedback_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: audit_ai_feedback_feedback_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.audit_ai_feedback_feedback_id_seq OWNED BY analytics.audit_ai_feedback.feedback_id;
ALTER SEQUENCE analytics.audit_ai_feedback_feedback_id_seq OWNED BY analytics.audit_ai_feedback.feedback_id;




--
--
-- Name: audit_ai_job; Type: TABLE; Schema: analytics; Owner: -
-- Name: audit_ai_job; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.audit_ai_job (
CREATE TABLE analytics.audit_ai_job (
    job_id bigint NOT NULL,
    job_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    last_error text,
    last_error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    started_at timestamp with time zone,
    started_at timestamp with time zone,
    finished_at timestamp with time zone,
    finished_at timestamp with time zone,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    CONSTRAINT audit_ai_job_status_check CHECK ((status = ANY (ARRAY['queued'::text, 'processing'::text, 'done'::text, 'failed'::text, 'skipped'::text])))
    CONSTRAINT audit_ai_job_status_check CHECK ((status = ANY (ARRAY['queued'::text, 'processing'::text, 'done'::text, 'failed'::text, 'skipped'::text])))
);
);




--
--
-- Name: audit_ai_job_job_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: audit_ai_job_job_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.audit_ai_job_job_id_seq
CREATE SEQUENCE analytics.audit_ai_job_job_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_ai_job_job_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: audit_ai_job_job_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.audit_ai_job_job_id_seq OWNED BY analytics.audit_ai_job.job_id;
ALTER SEQUENCE analytics.audit_ai_job_job_id_seq OWNED BY analytics.audit_ai_job.job_id;




--
--
-- Name: audit_ai_llm_result; Type: TABLE; Schema: analytics; Owner: -
-- Name: audit_ai_llm_result; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.audit_ai_llm_result (
CREATE TABLE analytics.audit_ai_llm_result (
    llm_result_id bigint NOT NULL,
    llm_result_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    judgement_json jsonb NOT NULL,
    judgement_json jsonb NOT NULL,
    model_name text,
    model_name text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: audit_ai_llm_result_llm_result_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: audit_ai_llm_result_llm_result_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.audit_ai_llm_result_llm_result_id_seq
CREATE SEQUENCE analytics.audit_ai_llm_result_llm_result_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_ai_llm_result_llm_result_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: audit_ai_llm_result_llm_result_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.audit_ai_llm_result_llm_result_id_seq OWNED BY analytics.audit_ai_llm_result.llm_result_id;
ALTER SEQUENCE analytics.audit_ai_llm_result_llm_result_id_seq OWNED BY analytics.audit_ai_llm_result.llm_result_id;




--
--
-- Name: audit_alert_ai_judgement; Type: TABLE; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.audit_alert_ai_judgement (
CREATE TABLE analytics.audit_alert_ai_judgement (
    judgement_id bigint NOT NULL,
    judgement_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    is_anomaly boolean NOT NULL,
    is_anomaly boolean NOT NULL,
    confidence numeric(4,3) NOT NULL,
    confidence numeric(4,3) NOT NULL,
    judgement_reason text NOT NULL,
    judgement_reason text NOT NULL,
    decided_by text NOT NULL,
    decided_by text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_alert_ai_judgement_confidence_check CHECK (((confidence >= (0)::numeric) AND (confidence <= (1)::numeric))),
    CONSTRAINT audit_alert_ai_judgement_confidence_check CHECK (((confidence >= (0)::numeric) AND (confidence <= (1)::numeric))),
    CONSTRAINT audit_alert_ai_judgement_decided_by_check CHECK ((decided_by = ANY (ARRAY['rule'::text, 'ai'::text, 'human'::text])))
    CONSTRAINT audit_alert_ai_judgement_decided_by_check CHECK ((decided_by = ANY (ARRAY['rule'::text, 'ai'::text, 'human'::text])))
);
);




--
--
-- Name: audit_alert_ai_judgement_judgement_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement_judgement_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.audit_alert_ai_judgement_judgement_id_seq
CREATE SEQUENCE analytics.audit_alert_ai_judgement_judgement_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_alert_ai_judgement_judgement_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement_judgement_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.audit_alert_ai_judgement_judgement_id_seq OWNED BY analytics.audit_alert_ai_judgement.judgement_id;
ALTER SEQUENCE analytics.audit_alert_ai_judgement_judgement_id_seq OWNED BY analytics.audit_alert_ai_judgement.judgement_id;




--
--
-- Name: audit_alert_event; Type: TABLE; Schema: analytics; Owner: -
-- Name: audit_alert_event; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.audit_alert_event (
CREATE TABLE analytics.audit_alert_event (
    alert_event_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    rule_id bigint NOT NULL,
    rule_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    window_start timestamp with time zone NOT NULL,
    window_start timestamp with time zone NOT NULL,
    window_end timestamp with time zone NOT NULL,
    window_end timestamp with time zone NOT NULL,
    matched_count integer NOT NULL,
    matched_count integer NOT NULL,
    severity integer NOT NULL,
    severity integer NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_alert_event_matched_count_check CHECK ((matched_count >= 0)),
    CONSTRAINT audit_alert_event_matched_count_check CHECK ((matched_count >= 0)),
    CONSTRAINT audit_alert_event_severity_check CHECK ((severity >= 0))
    CONSTRAINT audit_alert_event_severity_check CHECK ((severity >= 0))
);
);




--
--
-- Name: audit_alert_event_alert_event_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: audit_alert_event_alert_event_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.audit_alert_event_alert_event_id_seq
CREATE SEQUENCE analytics.audit_alert_event_alert_event_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_alert_event_alert_event_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: audit_alert_event_alert_event_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.audit_alert_event_alert_event_id_seq OWNED BY analytics.audit_alert_event.alert_event_id;
ALTER SEQUENCE analytics.audit_alert_event_alert_event_id_seq OWNED BY analytics.audit_alert_event.alert_event_id;




--
--
-- Name: audit_alert_notification; Type: TABLE; Schema: analytics; Owner: -
-- Name: audit_alert_notification; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.audit_alert_notification (
CREATE TABLE analytics.audit_alert_notification (
    notification_id bigint NOT NULL,
    notification_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    alert_event_id bigint NOT NULL,
    channel_type text NOT NULL,
    channel_type text NOT NULL,
    destination text NOT NULL,
    destination text NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    last_error text,
    last_error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    sent_at timestamp with time zone,
    sent_at timestamp with time zone,
    CONSTRAINT audit_alert_notification_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'sent'::text, 'failed'::text, 'skipped'::text])))
    CONSTRAINT audit_alert_notification_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'sent'::text, 'failed'::text, 'skipped'::text])))
);
);




--
--
-- Name: audit_alert_notification_notification_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: audit_alert_notification_notification_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.audit_alert_notification_notification_id_seq
CREATE SEQUENCE analytics.audit_alert_notification_notification_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_alert_notification_notification_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: audit_alert_notification_notification_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.audit_alert_notification_notification_id_seq OWNED BY analytics.audit_alert_notification.notification_id;
ALTER SEQUENCE analytics.audit_alert_notification_notification_id_seq OWNED BY analytics.audit_alert_notification.notification_id;




--
--
-- Name: audit_alert_rule; Type: TABLE; Schema: analytics; Owner: -
-- Name: audit_alert_rule; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.audit_alert_rule (
CREATE TABLE analytics.audit_alert_rule (
    rule_id bigint NOT NULL,
    rule_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    rule_name text NOT NULL,
    rule_name text NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    window_seconds integer NOT NULL,
    window_seconds integer NOT NULL,
    threshold_count integer NOT NULL,
    threshold_count integer NOT NULL,
    table_name_like text,
    table_name_like text,
    actions text[],
    actions text[],
    severity_base integer NOT NULL,
    severity_base integer NOT NULL,
    severity_cap integer NOT NULL,
    severity_cap integer NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_alert_rule_check CHECK ((severity_cap >= severity_base)),
    CONSTRAINT audit_alert_rule_check CHECK ((severity_cap >= severity_base)),
    CONSTRAINT audit_alert_rule_severity_base_check CHECK ((severity_base >= 0)),
    CONSTRAINT audit_alert_rule_severity_base_check CHECK ((severity_base >= 0)),
    CONSTRAINT audit_alert_rule_threshold_count_check CHECK ((threshold_count > 0)),
    CONSTRAINT audit_alert_rule_threshold_count_check CHECK ((threshold_count > 0)),
    CONSTRAINT audit_alert_rule_window_seconds_check CHECK ((window_seconds > 0))
    CONSTRAINT audit_alert_rule_window_seconds_check CHECK ((window_seconds > 0))
);
);




--
--
-- Name: audit_alert_rule_rule_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: audit_alert_rule_rule_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.audit_alert_rule_rule_id_seq
CREATE SEQUENCE analytics.audit_alert_rule_rule_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_alert_rule_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: audit_alert_rule_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.audit_alert_rule_rule_id_seq OWNED BY analytics.audit_alert_rule.rule_id;
ALTER SEQUENCE analytics.audit_alert_rule_rule_id_seq OWNED BY analytics.audit_alert_rule.rule_id;




--
--
-- Name: fact_metric; Type: TABLE; Schema: analytics; Owner: -
-- Name: fact_metric; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.fact_metric (
CREATE TABLE analytics.fact_metric (
    fact_id bigint NOT NULL,
    fact_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text,
    entity_id text,
    metric_code text NOT NULL,
    metric_code text NOT NULL,
    metric_date date NOT NULL,
    metric_date date NOT NULL,
    metric_value numeric(18,4) NOT NULL,
    metric_value numeric(18,4) NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: fact_metric_fact_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: fact_metric_fact_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.fact_metric_fact_id_seq
CREATE SEQUENCE analytics.fact_metric_fact_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: fact_metric_fact_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: fact_metric_fact_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.fact_metric_fact_id_seq OWNED BY analytics.fact_metric.fact_id;
ALTER SEQUENCE analytics.fact_metric_fact_id_seq OWNED BY analytics.fact_metric.fact_id;




--
--
-- Name: notification_queue_notification_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
-- Name: notification_queue_notification_id_seq; Type: SEQUENCE; Schema: analytics; Owner: -
--
--


CREATE SEQUENCE analytics.notification_queue_notification_id_seq
CREATE SEQUENCE analytics.notification_queue_notification_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: notification_queue_notification_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
-- Name: notification_queue_notification_id_seq; Type: SEQUENCE OWNED BY; Schema: analytics; Owner: -
--
--


ALTER SEQUENCE analytics.notification_queue_notification_id_seq OWNED BY analytics.notification_queue.notification_id;
ALTER SEQUENCE analytics.notification_queue_notification_id_seq OWNED BY analytics.notification_queue.notification_id;




--
--
-- Name: sla_breach_event; Type: TABLE; Schema: analytics; Owner: -
-- Name: sla_breach_event; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.sla_breach_event (
CREATE TABLE analytics.sla_breach_event (
    breach_id uuid DEFAULT gen_random_uuid() NOT NULL,
    breach_id uuid DEFAULT gen_random_uuid() NOT NULL,
    domain text NOT NULL,
    domain text NOT NULL,
    p90_seconds integer NOT NULL,
    p90_seconds integer NOT NULL,
    threshold_seconds integer NOT NULL,
    threshold_seconds integer NOT NULL,
    severity text NOT NULL,
    severity text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: sla_definition; Type: TABLE; Schema: analytics; Owner: -
-- Name: sla_definition; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.sla_definition (
CREATE TABLE analytics.sla_definition (
    domain text NOT NULL,
    domain text NOT NULL,
    threshold_seconds integer NOT NULL,
    threshold_seconds integer NOT NULL,
    severity text DEFAULT 'warn'::text NOT NULL
    severity text DEFAULT 'warn'::text NOT NULL
);
);




--
--
-- Name: sla_escalation_target; Type: TABLE; Schema: analytics; Owner: -
-- Name: sla_escalation_target; Type: TABLE; Schema: analytics; Owner: -
--
--


CREATE TABLE analytics.sla_escalation_target (
CREATE TABLE analytics.sla_escalation_target (
    domain text NOT NULL,
    domain text NOT NULL,
    channel_type text NOT NULL,
    channel_type text NOT NULL,
    destination text NOT NULL,
    destination text NOT NULL,
    severity text DEFAULT 'critical'::text NOT NULL
    severity text DEFAULT 'critical'::text NOT NULL
);
);




--
--
-- Name: policy_change_queue; Type: TABLE; Schema: governance; Owner: -
-- Name: policy_change_queue; Type: TABLE; Schema: governance; Owner: -
--
--


CREATE TABLE governance.policy_change_queue (
CREATE TABLE governance.policy_change_queue (
    policy_change_id bigint NOT NULL,
    policy_change_id bigint NOT NULL,
    source_alert_event_id bigint,
    source_alert_event_id bigint,
    policy_key text NOT NULL,
    policy_key text NOT NULL,
    proposed_action text NOT NULL,
    proposed_action text NOT NULL,
    proposed_value jsonb NOT NULL,
    proposed_value jsonb NOT NULL,
    confidence numeric(4,3) NOT NULL,
    confidence numeric(4,3) NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    approved_at timestamp with time zone
    approved_at timestamp with time zone
);
);




--
--
-- Name: v_admin_alert_review; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_admin_alert_review; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_admin_alert_review AS
CREATE VIEW analytics.v_admin_alert_review AS
 SELECT e.alert_event_id,
 SELECT e.alert_event_id,
    e.company_id,
    e.company_id,
    e.window_start,
    e.window_start,
    e.window_end,
    e.window_end,
    e.severity,
    e.severity,
    e.matched_count,
    e.matched_count,
    j.is_anomaly,
    j.is_anomaly,
    j.confidence,
    j.confidence,
    j.judgement_reason,
    j.judgement_reason,
    j.decided_by,
    j.decided_by,
    p.policy_change_id,
    p.policy_change_id,
    p.policy_key,
    p.policy_key,
    p.proposed_action,
    p.proposed_action,
    p.proposed_value,
    p.proposed_value,
    p.status AS policy_status,
    p.status AS policy_status,
    p.created_at AS policy_created_at,
    p.created_at AS policy_created_at,
    COALESCE(job.status, 'none'::text) AS ai_job_status
    COALESCE(job.status, 'none'::text) AS ai_job_status
   FROM (((analytics.audit_alert_event e
   FROM (((analytics.audit_alert_event e
     LEFT JOIN analytics.audit_alert_ai_judgement j ON ((j.alert_event_id = e.alert_event_id)))
     LEFT JOIN analytics.audit_alert_ai_judgement j ON ((j.alert_event_id = e.alert_event_id)))
     LEFT JOIN governance.policy_change_queue p ON ((p.source_alert_event_id = e.alert_event_id)))
     LEFT JOIN governance.policy_change_queue p ON ((p.source_alert_event_id = e.alert_event_id)))
     LEFT JOIN analytics.audit_ai_job job ON ((job.alert_event_id = e.alert_event_id)));
     LEFT JOIN analytics.audit_ai_job job ON ((job.alert_event_id = e.alert_event_id)));




--
--
-- Name: schema_change_request; Type: TABLE; Schema: ci; Owner: -
-- Name: schema_change_request; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.schema_change_request (
CREATE TABLE ci.schema_change_request (
    request_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid DEFAULT gen_random_uuid() NOT NULL,
    schema_name text NOT NULL,
    schema_name text NOT NULL,
    requested_by text NOT NULL,
    requested_by text NOT NULL,
    diff_summary text NOT NULL,
    diff_summary text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    approved_by text,
    approved_by text,
    approved_at timestamp with time zone,
    approved_at timestamp with time zone,
    review_status text DEFAULT 'pending'::text NOT NULL,
    review_status text DEFAULT 'pending'::text NOT NULL,
    review_summary text,
    review_summary text,
    reviewed_at timestamp with time zone,
    reviewed_at timestamp with time zone,
    domain text,
    domain text,
    review_summary_ja text,
    review_summary_ja text,
    company_id uuid
    company_id uuid
);
);




--
--
-- Name: v_ai_approval_opt_candidate; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_approval_opt_candidate; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_approval_opt_candidate AS
CREATE VIEW analytics.v_ai_approval_opt_candidate AS
 SELECT COALESCE(company_id, '00000000-0000-0000-0000-000000000000'::uuid) AS company_id,
 SELECT COALESCE(company_id, '00000000-0000-0000-0000-000000000000'::uuid) AS company_id,
    domain,
    domain,
    schema_name,
    schema_name,
    count(*) AS approved_count
    count(*) AS approved_count
   FROM ci.schema_change_request
   FROM ci.schema_change_request
  WHERE ((status = 'approved'::text) AND (approved_at >= (now() - '30 days'::interval)))
  WHERE ((status = 'approved'::text) AND (approved_at >= (now() - '30 days'::interval)))
  GROUP BY COALESCE(company_id, '00000000-0000-0000-0000-000000000000'::uuid), domain, schema_name
  GROUP BY COALESCE(company_id, '00000000-0000-0000-0000-000000000000'::uuid), domain, schema_name
 HAVING (count(*) >= 30);
 HAVING (count(*) >= 30);




--
--
-- Name: v_ai_feedback_stats; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_feedback_stats; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_feedback_stats AS
CREATE VIEW analytics.v_ai_feedback_stats AS
 SELECT e.rule_id,
 SELECT e.rule_id,
    count(*) AS feedback_count,
    count(*) AS feedback_count,
    count(*) FILTER (WHERE (f.feedback_type = 'false_positive'::text)) AS false_positive_count,
    count(*) FILTER (WHERE (f.feedback_type = 'false_positive'::text)) AS false_positive_count,
    round(((count(*) FILTER (WHERE (f.feedback_type = 'false_positive'::text)))::numeric / (NULLIF(count(*), 0))::numeric), 3) AS false_positive_rate
    round(((count(*) FILTER (WHERE (f.feedback_type = 'false_positive'::text)))::numeric / (NULLIF(count(*), 0))::numeric), 3) AS false_positive_rate
   FROM (analytics.audit_ai_feedback f
   FROM (analytics.audit_ai_feedback f
     JOIN analytics.audit_alert_event e ON ((e.alert_event_id = f.alert_event_id)))
     JOIN analytics.audit_alert_event e ON ((e.alert_event_id = f.alert_event_id)))
  GROUP BY e.rule_id;
  GROUP BY e.rule_id;




--
--
-- Name: v_ai_feedback_stats_ext; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_feedback_stats_ext; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_feedback_stats_ext AS
CREATE VIEW analytics.v_ai_feedback_stats_ext AS
 SELECT e.rule_id,
 SELECT e.rule_id,
    e.severity,
    e.severity,
    count(*) AS feedback_count,
    count(*) AS feedback_count,
    count(*) FILTER (WHERE (f.feedback_type = 'false_positive'::text)) AS false_positive_count,
    count(*) FILTER (WHERE (f.feedback_type = 'false_positive'::text)) AS false_positive_count,
    round(((count(*) FILTER (WHERE (f.feedback_type = 'false_positive'::text)))::numeric / (NULLIF(count(*), 0))::numeric), 3) AS false_positive_rate,
    round(((count(*) FILTER (WHERE (f.feedback_type = 'false_positive'::text)))::numeric / (NULLIF(count(*), 0))::numeric), 3) AS false_positive_rate,
    count(*) FILTER (WHERE (f.feedback_type = 'true_positive'::text)) AS true_positive_count
    count(*) FILTER (WHERE (f.feedback_type = 'true_positive'::text)) AS true_positive_count
   FROM (analytics.audit_ai_feedback f
   FROM (analytics.audit_ai_feedback f
     JOIN analytics.audit_alert_event e ON ((e.alert_event_id = f.alert_event_id)))
     JOIN analytics.audit_alert_event e ON ((e.alert_event_id = f.alert_event_id)))
  GROUP BY e.rule_id, e.severity;
  GROUP BY e.rule_id, e.severity;




--
--
-- Name: v_ai_insight_actionable; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_insight_actionable; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_insight_actionable AS
CREATE VIEW analytics.v_ai_insight_actionable AS
 SELECT job_id,
 SELECT job_id,
    company_id,
    company_id,
    insight_type,
    insight_type,
    target_key,
    target_key,
    result_ja,
    result_ja,
    proposed_action,
    proposed_action,
    created_at
    created_at
   FROM analytics.ai_insight_job
   FROM analytics.ai_insight_job
  WHERE ((status = 'done'::text) AND (is_applied = false))
  WHERE ((status = 'done'::text) AND (is_applied = false))
  ORDER BY created_at DESC;
  ORDER BY created_at DESC;




--
--
-- Name: v_ai_insight_applied; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_insight_applied; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_insight_applied AS
CREATE VIEW analytics.v_ai_insight_applied AS
 SELECT j.job_id,
 SELECT j.job_id,
    j.company_id,
    j.company_id,
    j.insight_type,
    j.insight_type,
    j.target_key,
    j.target_key,
    j.applied_at,
    j.applied_at,
    j.applied_by,
    j.applied_by,
    a.audit_id,
    a.audit_id,
    a.action_type,
    a.action_type,
    a.before_state,
    a.before_state,
    a.after_state
    a.after_state
   FROM (analytics.ai_insight_job j
   FROM (analytics.ai_insight_job j
     JOIN analytics.ai_apply_audit a ON ((a.job_id = j.job_id)))
     JOIN analytics.ai_apply_audit a ON ((a.job_id = j.job_id)))
  WHERE (j.is_applied = true)
  WHERE (j.is_applied = true)
  ORDER BY j.applied_at DESC;
  ORDER BY j.applied_at DESC;




--
--
-- Name: company; Type: TABLE; Schema: tenant; Owner: -
-- Name: company; Type: TABLE; Schema: tenant; Owner: -
--
--


CREATE TABLE tenant.company (
CREATE TABLE tenant.company (
    company_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_code text NOT NULL,
    company_code text NOT NULL,
    company_name text NOT NULL,
    company_name text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_ai_insight_outbox; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_insight_outbox; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_insight_outbox AS
CREATE VIEW analytics.v_ai_insight_outbox AS
 SELECT j.job_id,
 SELECT j.job_id,
    j.company_id,
    j.company_id,
    c.company_code,
    c.company_code,
    j.insight_type,
    j.insight_type,
    j.target_key,
    j.target_key,
    j.result_ja,
    j.result_ja,
    j.status,
    j.status,
    j.created_at,
    j.created_at,
    j.processed_at
    j.processed_at
   FROM (analytics.ai_insight_job j
   FROM (analytics.ai_insight_job j
     LEFT JOIN tenant.company c ON ((c.company_id = j.company_id)))
     LEFT JOIN tenant.company c ON ((c.company_id = j.company_id)))
  WHERE (j.status = 'done'::text)
  WHERE (j.status = 'done'::text)
  ORDER BY j.processed_at DESC;
  ORDER BY j.processed_at DESC;




--
--
-- Name: v_ai_job_stats; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_job_stats; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_job_stats AS
CREATE VIEW analytics.v_ai_job_stats AS
 SELECT job_type,
 SELECT job_type,
    count(*) FILTER (WHERE (status = 'pending'::text)) AS pending,
    count(*) FILTER (WHERE (status = 'pending'::text)) AS pending,
    count(*) FILTER (WHERE (status = 'done'::text)) AS done,
    count(*) FILTER (WHERE (status = 'done'::text)) AS done,
    count(*) FILTER (WHERE (status = 'failed'::text)) AS failed
    count(*) FILTER (WHERE (status = 'failed'::text)) AS failed
   FROM analytics.ai_job
   FROM analytics.ai_job
  GROUP BY job_type;
  GROUP BY job_type;




--
--
-- Name: v_ai_job_type_master; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_job_type_master; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_job_type_master AS
CREATE VIEW analytics.v_ai_job_type_master AS
 SELECT job_type,
 SELECT job_type,
    description,
    description,
    risk_level,
    risk_level,
    default_requires_approval,
    default_requires_approval,
    is_enabled,
    is_enabled,
    updated_at
    updated_at
   FROM analytics.ai_job_type_master
   FROM analytics.ai_job_type_master
  ORDER BY job_type;
  ORDER BY job_type;




--
--
-- Name: v_ai_module_manifest; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_module_manifest; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_module_manifest AS
CREATE VIEW analytics.v_ai_module_manifest AS
 SELECT module_name,
 SELECT module_name,
    summary,
    summary,
    scope,
    scope,
    updated_at
    updated_at
   FROM analytics.ai_module_manifest
   FROM analytics.ai_module_manifest
  ORDER BY module_name;
  ORDER BY module_name;




--
--
-- Name: v_ai_object_inventory; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_object_inventory; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_object_inventory AS
CREATE VIEW analytics.v_ai_object_inventory AS
 WITH tbl AS (
 WITH tbl AS (
         SELECT 'table'::text AS object_type,
         SELECT 'table'::text AS object_type,
            n.nspname AS schema_name,
            n.nspname AS schema_name,
            c.relname AS object_name
            c.relname AS object_name
           FROM (pg_class c
           FROM (pg_class c
             JOIN pg_namespace n ON ((n.oid = c.relnamespace)))
             JOIN pg_namespace n ON ((n.oid = c.relnamespace)))
          WHERE ((n.nspname = 'analytics'::name) AND (c.relkind = 'r'::"char"))
          WHERE ((n.nspname = 'analytics'::name) AND (c.relkind = 'r'::"char"))
        ), vw AS (
        ), vw AS (
         SELECT 'view'::text AS object_type,
         SELECT 'view'::text AS object_type,
            n.nspname AS schema_name,
            n.nspname AS schema_name,
            c.relname AS object_name
            c.relname AS object_name
           FROM (pg_class c
           FROM (pg_class c
             JOIN pg_namespace n ON ((n.oid = c.relnamespace)))
             JOIN pg_namespace n ON ((n.oid = c.relnamespace)))
          WHERE ((n.nspname = 'analytics'::name) AND (c.relkind = 'v'::"char"))
          WHERE ((n.nspname = 'analytics'::name) AND (c.relkind = 'v'::"char"))
        ), fn AS (
        ), fn AS (
         SELECT 'function'::text AS object_type,
         SELECT 'function'::text AS object_type,
            n.nspname AS schema_name,
            n.nspname AS schema_name,
            p.proname AS object_name
            p.proname AS object_name
           FROM (pg_proc p
           FROM (pg_proc p
             JOIN pg_namespace n ON ((n.oid = p.pronamespace)))
             JOIN pg_namespace n ON ((n.oid = p.pronamespace)))
          WHERE (n.nspname = ANY (ARRAY['public'::name, 'analytics'::name]))
          WHERE (n.nspname = ANY (ARRAY['public'::name, 'analytics'::name]))
        )
        )
 SELECT tbl.object_type,
 SELECT tbl.object_type,
    tbl.schema_name,
    tbl.schema_name,
    tbl.object_name
    tbl.object_name
   FROM tbl
   FROM tbl
UNION ALL
UNION ALL
 SELECT vw.object_type,
 SELECT vw.object_type,
    vw.schema_name,
    vw.schema_name,
    vw.object_name
    vw.object_name
   FROM vw
   FROM vw
UNION ALL
UNION ALL
 SELECT fn.object_type,
 SELECT fn.object_type,
    fn.schema_name,
    fn.schema_name,
    fn.object_name
    fn.object_name
   FROM fn
   FROM fn
  ORDER BY 1, 2, 3;
  ORDER BY 1, 2, 3;




--
--
-- Name: v_ai_rule_suggest; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_rule_suggest; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_rule_suggest AS
CREATE VIEW analytics.v_ai_rule_suggest AS
 SELECT domain,
 SELECT domain,
    ((count(*) FILTER (WHERE (status = 'rejected'::text)))::numeric / (NULLIF(count(*), 0))::numeric) AS reject_rate
    ((count(*) FILTER (WHERE (status = 'rejected'::text)))::numeric / (NULLIF(count(*), 0))::numeric) AS reject_rate
   FROM ci.schema_change_request
   FROM ci.schema_change_request
  GROUP BY domain
  GROUP BY domain
 HAVING (((count(*) FILTER (WHERE (status = 'rejected'::text)))::numeric / (NULLIF(count(*), 0))::numeric) > 0.4);
 HAVING (((count(*) FILTER (WHERE (status = 'rejected'::text)))::numeric / (NULLIF(count(*), 0))::numeric) > 0.4);




--
--
-- Name: v_domain_sla; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_domain_sla; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_domain_sla AS
CREATE VIEW analytics.v_domain_sla AS
 SELECT domain,
 SELECT domain,
    count(*) AS request_count,
    count(*) AS request_count,
    percentile_cont((0.5)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (approved_at - requested_at)))::double precision)) FILTER (WHERE (approved_at IS NOT NULL)) AS p50_seconds,
    percentile_cont((0.5)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (approved_at - requested_at)))::double precision)) FILTER (WHERE (approved_at IS NOT NULL)) AS p50_seconds,
    percentile_cont((0.9)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (approved_at - requested_at)))::double precision)) FILTER (WHERE (approved_at IS NOT NULL)) AS p90_seconds
    percentile_cont((0.9)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (approved_at - requested_at)))::double precision)) FILTER (WHERE (approved_at IS NOT NULL)) AS p90_seconds
   FROM ci.schema_change_request r
   FROM ci.schema_change_request r
  GROUP BY domain;
  GROUP BY domain;




--
--
-- Name: v_ai_sla_risk; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ai_sla_risk; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ai_sla_risk AS
CREATE VIEW analytics.v_ai_sla_risk AS
 SELECT domain,
 SELECT domain,
    p90_seconds
    p90_seconds
   FROM analytics.v_domain_sla
   FROM analytics.v_domain_sla
  WHERE (p90_seconds > (3600)::double precision);
  WHERE (p90_seconds > (3600)::double precision);




--
--
-- Name: v_approval_backlog; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_approval_backlog; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_approval_backlog AS
CREATE VIEW analytics.v_approval_backlog AS
 SELECT domain,
 SELECT domain,
    count(*) AS pending_count,
    count(*) AS pending_count,
    min(requested_at) AS oldest_request
    min(requested_at) AS oldest_request
   FROM ci.schema_change_request
   FROM ci.schema_change_request
  WHERE (status = 'pending'::text)
  WHERE (status = 'pending'::text)
  GROUP BY domain
  GROUP BY domain
  ORDER BY (count(*)) DESC;
  ORDER BY (count(*)) DESC;




--
--
-- Name: v_approval_sla; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_approval_sla; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_approval_sla AS
CREATE VIEW analytics.v_approval_sla AS
 SELECT domain,
 SELECT domain,
    (percentile_cont((0.9)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (COALESCE(decided_at, now()) - detected_at)))::double precision)))::integer AS p90_seconds
    (percentile_cont((0.9)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (COALESCE(decided_at, now()) - detected_at)))::double precision)))::integer AS p90_seconds
   FROM audit.approval_request r
   FROM audit.approval_request r
  GROUP BY domain;
  GROUP BY domain;




--
--
-- Name: audit_trail; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail (
CREATE TABLE core.audit_trail (
    audit_trail_id bigint NOT NULL,
    audit_trail_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
)
)
PARTITION BY RANGE (performed_at);
PARTITION BY RANGE (performed_at);






--
--
-- Name: v_audit_daily_count; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_daily_count; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_daily_count AS
CREATE VIEW analytics.v_audit_daily_count AS
 SELECT company_id,
 SELECT company_id,
    split_part(entity_type, '.'::text, 1) AS domain,
    split_part(entity_type, '.'::text, 1) AS domain,
    action,
    action,
    (performed_at)::date AS audit_date,
    (performed_at)::date AS audit_date,
    count(*) AS change_count
    count(*) AS change_count
   FROM core.audit_trail
   FROM core.audit_trail
  GROUP BY company_id, (split_part(entity_type, '.'::text, 1)), action, ((performed_at)::date);
  GROUP BY company_id, (split_part(entity_type, '.'::text, 1)), action, ((performed_at)::date);




--
--
-- Name: v_audit_daily_summary; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_daily_summary; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_daily_summary AS
CREATE VIEW analytics.v_audit_daily_summary AS
 SELECT company_id,
 SELECT company_id,
    (date_trunc('day'::text, performed_at))::date AS day,
    (date_trunc('day'::text, performed_at))::date AS day,
    action_category,
    action_category,
    count(*) AS cnt
    count(*) AS cnt
   FROM core.audit_trail
   FROM core.audit_trail
  GROUP BY company_id, ((date_trunc('day'::text, performed_at))::date), action_category;
  GROUP BY company_id, ((date_trunc('day'::text, performed_at))::date), action_category;




--
--
-- Name: v_audit_dashboard; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_dashboard; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_dashboard AS
CREATE VIEW analytics.v_audit_dashboard AS
 SELECT date_trunc('hour'::text, performed_at) AS time_bucket,
 SELECT date_trunc('hour'::text, performed_at) AS time_bucket,
    company_id,
    company_id,
    entity_type,
    entity_type,
    action,
    action,
    count(*) AS change_count,
    count(*) AS change_count,
    avg(core.fn_calc_audit_impact(company_id, entity_type, action, detail)) AS avg_impact_score,
    avg(core.fn_calc_audit_impact(company_id, entity_type, action, detail)) AS avg_impact_score,
    max(core.fn_calc_audit_impact(company_id, entity_type, action, detail)) AS max_impact_score
    max(core.fn_calc_audit_impact(company_id, entity_type, action, detail)) AS max_impact_score
   FROM core.audit_trail at
   FROM core.audit_trail at
  GROUP BY (date_trunc('hour'::text, performed_at)), company_id, entity_type, action;
  GROUP BY (date_trunc('hour'::text, performed_at)), company_id, entity_type, action;




--
--
-- Name: VIEW v_audit_dashboard; Type: COMMENT; Schema: analytics; Owner: -
-- Name: VIEW v_audit_dashboard; Type: COMMENT; Schema: analytics; Owner: -
--
--


COMMENT ON VIEW analytics.v_audit_dashboard IS '監査ログ 影響度（impact_score）ダッシュボード用集計';
COMMENT ON VIEW analytics.v_audit_dashboard IS '監査ログ 影響度（impact_score）ダッシュボード用集計';




--
--
-- Name: v_audit_dashboard_daily; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_dashboard_daily; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_dashboard_daily AS
CREATE VIEW analytics.v_audit_dashboard_daily AS
 SELECT company_id,
 SELECT company_id,
    date_trunc('day'::text, performed_at) AS day,
    date_trunc('day'::text, performed_at) AS day,
    entity_type,
    entity_type,
    action,
    action,
    count(*) AS change_count,
    count(*) AS change_count,
    avg(core.fn_calc_audit_impact(company_id, entity_type, action, detail)) AS avg_impact,
    avg(core.fn_calc_audit_impact(company_id, entity_type, action, detail)) AS avg_impact,
    max(core.fn_calc_audit_impact(company_id, entity_type, action, detail)) AS max_impact
    max(core.fn_calc_audit_impact(company_id, entity_type, action, detail)) AS max_impact
   FROM core.audit_trail at
   FROM core.audit_trail at
  GROUP BY company_id, (date_trunc('day'::text, performed_at)), entity_type, action;
  GROUP BY company_id, (date_trunc('day'::text, performed_at)), entity_type, action;




--
--
-- Name: v_audit_export; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_export; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_export AS
CREATE VIEW analytics.v_audit_export AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail;
   FROM core.audit_trail;




--
--
-- Name: v_audit_reason_kpi; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_reason_kpi; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_reason_kpi AS
CREATE VIEW analytics.v_audit_reason_kpi AS
 SELECT company_id,
 SELECT company_id,
    (detail ->> 'reason_code'::text) AS reason_code,
    (detail ->> 'reason_code'::text) AS reason_code,
    action,
    action,
    count(*) AS change_count
    count(*) AS change_count
   FROM core.audit_trail
   FROM core.audit_trail
  WHERE (detail ? 'reason_code'::text)
  WHERE (detail ? 'reason_code'::text)
  GROUP BY company_id, (detail ->> 'reason_code'::text), action;
  GROUP BY company_id, (detail ->> 'reason_code'::text), action;




--
--
-- Name: v_audit_summary_report; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_summary_report; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_summary_report AS
CREATE VIEW analytics.v_audit_summary_report AS
 SELECT company_id,
 SELECT company_id,
    date_trunc('day'::text, performed_at) AS day,
    date_trunc('day'::text, performed_at) AS day,
    count(*) AS total_changes,
    count(*) AS total_changes,
    sum(
    sum(
        CASE
        CASE
            WHEN (action = 'DELETE'::text) THEN 1
            WHEN (action = 'DELETE'::text) THEN 1
            ELSE 0
            ELSE 0
        END) AS deletes,
        END) AS deletes,
    sum(
    sum(
        CASE
        CASE
            WHEN (core.fn_calc_audit_impact(company_id, entity_type, action, detail) >= (5)::numeric) THEN 1
            WHEN (core.fn_calc_audit_impact(company_id, entity_type, action, detail) >= (5)::numeric) THEN 1
            ELSE 0
            ELSE 0
        END) AS high_impact_changes,
        END) AS high_impact_changes,
    count(DISTINCT performed_by) AS distinct_actors
    count(DISTINCT performed_by) AS distinct_actors
   FROM core.audit_trail at
   FROM core.audit_trail at
  GROUP BY company_id, (date_trunc('day'::text, performed_at));
  GROUP BY company_id, (date_trunc('day'::text, performed_at));




--
--
-- Name: v_audit_table_rank; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_table_rank; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_table_rank AS
CREATE VIEW analytics.v_audit_table_rank AS
 SELECT company_id,
 SELECT company_id,
    entity_type,
    entity_type,
    count(*) AS change_count
    count(*) AS change_count
   FROM core.audit_trail
   FROM core.audit_trail
  GROUP BY company_id, entity_type;
  GROUP BY company_id, entity_type;




--
--
-- Name: v_audit_top_impact; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_top_impact; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_top_impact AS
CREATE VIEW analytics.v_audit_top_impact AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    performed_at,
    performed_at,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    performed_by,
    performed_by,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    detail
    detail
   FROM core.audit_trail at
   FROM core.audit_trail at
  ORDER BY (core.fn_calc_audit_impact(company_id, entity_type, action, detail)) DESC, performed_at DESC;
  ORDER BY (core.fn_calc_audit_impact(company_id, entity_type, action, detail)) DESC, performed_at DESC;




--
--
-- Name: v_audit_user_activity; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_user_activity; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_user_activity AS
CREATE VIEW analytics.v_audit_user_activity AS
 SELECT company_id,
 SELECT company_id,
    performed_by,
    performed_by,
    count(*) AS change_count,
    count(*) AS change_count,
    max(performed_at) AS last_activity
    max(performed_at) AS last_activity
   FROM core.audit_trail
   FROM core.audit_trail
  GROUP BY company_id, performed_by;
  GROUP BY company_id, performed_by;




--
--
-- Name: v_audit_with_impact; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_audit_with_impact; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_audit_with_impact AS
CREATE VIEW analytics.v_audit_with_impact AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    performed_by,
    performed_by,
    performed_at,
    performed_at,
    detail,
    detail,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score
   FROM core.audit_trail at;
   FROM core.audit_trail at;




--
--
-- Name: v_ops_overview; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ops_overview; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ops_overview AS
CREATE VIEW analytics.v_ops_overview AS
 SELECT domain,
 SELECT domain,
    count(*) FILTER (WHERE (status = 'pending'::text)) AS pending_count,
    count(*) FILTER (WHERE (status = 'pending'::text)) AS pending_count,
    count(*) FILTER (WHERE (status = 'approved'::text)) AS approved_count,
    count(*) FILTER (WHERE (status = 'approved'::text)) AS approved_count,
    count(*) FILTER (WHERE (status = 'rejected'::text)) AS rejected_count,
    count(*) FILTER (WHERE (status = 'rejected'::text)) AS rejected_count,
    max(detected_at) AS last_detected_at,
    max(detected_at) AS last_detected_at,
    max(decided_at) AS last_decided_at
    max(decided_at) AS last_decided_at
   FROM audit.approval_request r
   FROM audit.approval_request r
  GROUP BY domain;
  GROUP BY domain;




--
--
-- Name: v_sla_status; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_sla_status; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_sla_status AS
CREATE VIEW analytics.v_sla_status AS
 SELECT d.domain,
 SELECT d.domain,
    v.p90_seconds,
    v.p90_seconds,
    d.threshold_seconds,
    d.threshold_seconds,
        CASE
        CASE
            WHEN (v.p90_seconds > d.threshold_seconds) THEN 'breach'::text
            WHEN (v.p90_seconds > d.threshold_seconds) THEN 'breach'::text
            ELSE 'ok'::text
            ELSE 'ok'::text
        END AS sla_status
        END AS sla_status
   FROM (analytics.v_approval_sla v
   FROM (analytics.v_approval_sla v
     JOIN analytics.sla_definition d USING (domain));
     JOIN analytics.sla_definition d USING (domain));




--
--
-- Name: v_final_ops_dashboard; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_final_ops_dashboard; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_final_ops_dashboard AS
CREATE VIEW analytics.v_final_ops_dashboard AS
 SELECT o.domain,
 SELECT o.domain,
    o.pending_count,
    o.pending_count,
    o.approved_count,
    o.approved_count,
    o.rejected_count,
    o.rejected_count,
    s.sla_status,
    s.sla_status,
    s.p90_seconds,
    s.p90_seconds,
    s.threshold_seconds
    s.threshold_seconds
   FROM (analytics.v_ops_overview o
   FROM (analytics.v_ops_overview o
     JOIN analytics.v_sla_status s USING (domain));
     JOIN analytics.v_sla_status s USING (domain));




--
--
-- Name: v_iso_process_change_report; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_iso_process_change_report; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_iso_process_change_report AS
CREATE VIEW analytics.v_iso_process_change_report AS
 SELECT company_id,
 SELECT company_id,
    performed_at,
    performed_at,
    performed_by,
    performed_by,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    detail
    detail
   FROM core.audit_trail at
   FROM core.audit_trail at
  WHERE ((entity_type ~~ 'manufacturing.%'::text) OR (entity_type ~~ 'compliance.%'::text) OR (entity_type ~~ 'quality.%'::text))
  WHERE ((entity_type ~~ 'manufacturing.%'::text) OR (entity_type ~~ 'compliance.%'::text) OR (entity_type ~~ 'quality.%'::text))
  ORDER BY performed_at DESC;
  ORDER BY performed_at DESC;




--
--
-- Name: v_ops_kpi; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_ops_kpi; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_ops_kpi AS
CREATE VIEW analytics.v_ops_kpi AS
 SELECT d.domain,
 SELECT d.domain,
    d.request_count,
    d.request_count,
    d.p50_seconds,
    d.p50_seconds,
    d.p90_seconds,
    d.p90_seconds,
    b.pending_count,
    b.pending_count,
    b.oldest_request
    b.oldest_request
   FROM (analytics.v_domain_sla d
   FROM (analytics.v_domain_sla d
     LEFT JOIN analytics.v_approval_backlog b ON ((b.domain = d.domain)));
     LEFT JOIN analytics.v_approval_backlog b ON ((b.domain = d.domain)));




--
--
-- Name: v_sox_access_change_report; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_sox_access_change_report; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_sox_access_change_report AS
CREATE VIEW analytics.v_sox_access_change_report AS
 SELECT company_id,
 SELECT company_id,
    performed_at,
    performed_at,
    performed_by,
    performed_by,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    detail
    detail
   FROM core.audit_trail at
   FROM core.audit_trail at
  WHERE ((entity_type ~~ 'core.permission%'::text) OR (entity_type ~~ 'core.user_%'::text) OR (entity_type ~~ 'core.company_%'::text))
  WHERE ((entity_type ~~ 'core.permission%'::text) OR (entity_type ~~ 'core.user_%'::text) OR (entity_type ~~ 'core.company_%'::text))
  ORDER BY performed_at DESC;
  ORDER BY performed_at DESC;




--
--
-- Name: v_sox_financial_change_report; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_sox_financial_change_report; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_sox_financial_change_report AS
CREATE VIEW analytics.v_sox_financial_change_report AS
 SELECT company_id,
 SELECT company_id,
    performed_at,
    performed_at,
    performed_by,
    performed_by,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    detail
    detail
   FROM core.audit_trail at
   FROM core.audit_trail at
  WHERE ((entity_type ~~ 'finance.%'::text) OR ((entity_type ~~ 'sales.%'::text) AND ((detail)::text ~~* '%amount%'::text)) OR ((entity_type ~~ 'purchase.%'::text) AND ((detail)::text ~~* '%amount%'::text)))
  WHERE ((entity_type ~~ 'finance.%'::text) OR ((entity_type ~~ 'sales.%'::text) AND ((detail)::text ~~* '%amount%'::text)) OR ((entity_type ~~ 'purchase.%'::text) AND ((detail)::text ~~* '%amount%'::text)))
  ORDER BY performed_at DESC;
  ORDER BY performed_at DESC;




--
--
-- Name: v_sox_iso_audit_report; Type: VIEW; Schema: analytics; Owner: -
-- Name: v_sox_iso_audit_report; Type: VIEW; Schema: analytics; Owner: -
--
--


CREATE VIEW analytics.v_sox_iso_audit_report AS
CREATE VIEW analytics.v_sox_iso_audit_report AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    performed_at,
    performed_at,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    performed_by,
    performed_by,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    core.fn_calc_audit_impact(company_id, entity_type, action, detail) AS impact_score,
    (detail ->> 'reason_code'::text) AS reason_code,
    (detail ->> 'reason_code'::text) AS reason_code,
    (detail -> 'before'::text) AS before_snapshot,
    (detail -> 'before'::text) AS before_snapshot,
    (detail -> 'after'::text) AS after_snapshot
    (detail -> 'after'::text) AS after_snapshot
   FROM core.audit_trail at
   FROM core.audit_trail at
  WHERE ((entity_type ~~ 'finance.%'::text) OR (entity_type ~~ 'core.permission%'::text) OR (entity_type ~~ 'hr.%'::text) OR (entity_type ~~ 'core.company%'::text) OR (entity_type ~~ 'sales.%'::text) OR (entity_type ~~ 'purchase.%'::text));
  WHERE ((entity_type ~~ 'finance.%'::text) OR (entity_type ~~ 'core.permission%'::text) OR (entity_type ~~ 'hr.%'::text) OR (entity_type ~~ 'core.company%'::text) OR (entity_type ~~ 'sales.%'::text) OR (entity_type ~~ 'purchase.%'::text));




--
--
-- Name: VIEW v_sox_iso_audit_report; Type: COMMENT; Schema: analytics; Owner: -
-- Name: VIEW v_sox_iso_audit_report; Type: COMMENT; Schema: analytics; Owner: -
--
--


COMMENT ON VIEW analytics.v_sox_iso_audit_report IS 'SOX / ISO 用 監査証跡レポート正本VIEW';
COMMENT ON VIEW analytics.v_sox_iso_audit_report IS 'SOX / ISO 用 監査証跡レポート正本VIEW';




--
--
-- Name: ai_improvement_proposal; Type: TABLE; Schema: approval; Owner: -
-- Name: ai_improvement_proposal; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.ai_improvement_proposal (
CREATE TABLE approval.ai_improvement_proposal (
    proposal_id uuid DEFAULT gen_random_uuid() NOT NULL,
    proposal_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id text NOT NULL,
    request_id text NOT NULL,
    policy_id text NOT NULL,
    policy_id text NOT NULL,
    severity text NOT NULL,
    severity text NOT NULL,
    sla_minutes numeric NOT NULL,
    sla_minutes numeric NOT NULL,
    ai_summary text NOT NULL,
    ai_summary text NOT NULL,
    ai_suggestion text NOT NULL,
    ai_suggestion text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: approver; Type: TABLE; Schema: approval; Owner: -
-- Name: approver; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.approver (
CREATE TABLE approval.approver (
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: billing_customer; Type: TABLE; Schema: approval; Owner: -
-- Name: billing_customer; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.billing_customer (
CREATE TABLE approval.billing_customer (
    customer_code text NOT NULL,
    customer_code text NOT NULL,
    billing_email text NOT NULL,
    billing_email text NOT NULL,
    stripe_customer_id text
    stripe_customer_id text
);
);




--
--
-- Name: billing_invoice; Type: TABLE; Schema: approval; Owner: -
-- Name: billing_invoice; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.billing_invoice (
CREATE TABLE approval.billing_invoice (
    invoice_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid DEFAULT gen_random_uuid() NOT NULL,
    customer_code text NOT NULL,
    customer_code text NOT NULL,
    ym text NOT NULL,
    ym text NOT NULL,
    amount_yen numeric NOT NULL,
    amount_yen numeric NOT NULL,
    status text DEFAULT 'draft'::text NOT NULL,
    status text DEFAULT 'draft'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT billing_invoice_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'issued'::text, 'paid'::text, 'failed'::text])))
    CONSTRAINT billing_invoice_status_check CHECK ((status = ANY (ARRAY['draft'::text, 'issued'::text, 'paid'::text, 'failed'::text])))
);
);




--
--
-- Name: billing_payment; Type: TABLE; Schema: approval; Owner: -
-- Name: billing_payment; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.billing_payment (
CREATE TABLE approval.billing_payment (
    payment_id uuid DEFAULT gen_random_uuid() NOT NULL,
    payment_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid NOT NULL,
    invoice_id uuid NOT NULL,
    provider text NOT NULL,
    provider text NOT NULL,
    provider_ref text,
    provider_ref text,
    amount_yen numeric NOT NULL,
    amount_yen numeric NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT billing_payment_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'succeeded'::text, 'failed'::text])))
    CONSTRAINT billing_payment_status_check CHECK ((status = ANY (ARRAY['pending'::text, 'succeeded'::text, 'failed'::text])))
);
);




--
--
-- Name: company_cost; Type: TABLE; Schema: approval; Owner: -
-- Name: company_cost; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.company_cost (
CREATE TABLE approval.company_cost (
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    cost_per_hour numeric NOT NULL
    cost_per_hour numeric NOT NULL
);
);




--
--
-- Name: company_plan; Type: TABLE; Schema: approval; Owner: -
-- Name: company_plan; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.company_plan (
CREATE TABLE approval.company_plan (
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    plan_code text NOT NULL,
    plan_code text NOT NULL,
    started_at timestamp with time zone DEFAULT now() NOT NULL
    started_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: feature_flag; Type: TABLE; Schema: approval; Owner: -
-- Name: feature_flag; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.feature_flag (
CREATE TABLE approval.feature_flag (
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    feature_key text NOT NULL,
    feature_key text NOT NULL,
    is_enabled boolean DEFAULT false NOT NULL,
    is_enabled boolean DEFAULT false NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: invoice_delivery_log; Type: TABLE; Schema: approval; Owner: -
-- Name: invoice_delivery_log; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.invoice_delivery_log (
CREATE TABLE approval.invoice_delivery_log (
    delivery_id uuid DEFAULT gen_random_uuid() NOT NULL,
    delivery_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid NOT NULL,
    invoice_id uuid NOT NULL,
    to_email text NOT NULL,
    to_email text NOT NULL,
    channel text DEFAULT 'email'::text NOT NULL,
    channel text DEFAULT 'email'::text NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    sent_at timestamp with time zone,
    sent_at timestamp with time zone,
    last_error text,
    last_error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT invoice_delivery_log_channel_check CHECK ((channel = 'email'::text)),
    CONSTRAINT invoice_delivery_log_channel_check CHECK ((channel = 'email'::text)),
    CONSTRAINT invoice_delivery_log_status_check CHECK ((status = ANY (ARRAY['queued'::text, 'sent'::text, 'failed'::text])))
    CONSTRAINT invoice_delivery_log_status_check CHECK ((status = ANY (ARRAY['queued'::text, 'sent'::text, 'failed'::text])))
);
);




--
--
-- Name: jsox_control; Type: TABLE; Schema: approval; Owner: -
-- Name: jsox_control; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.jsox_control (
CREATE TABLE approval.jsox_control (
    control_id uuid DEFAULT gen_random_uuid() NOT NULL,
    control_id uuid DEFAULT gen_random_uuid() NOT NULL,
    control_code text NOT NULL,
    control_code text NOT NULL,
    control_name text NOT NULL,
    control_name text NOT NULL,
    objective text NOT NULL,
    objective text NOT NULL,
    frequency text NOT NULL,
    frequency text NOT NULL,
    owner_role text NOT NULL,
    owner_role text NOT NULL,
    evidence text NOT NULL,
    evidence text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: jsox_evidence_log; Type: TABLE; Schema: approval; Owner: -
-- Name: jsox_evidence_log; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.jsox_evidence_log (
CREATE TABLE approval.jsox_evidence_log (
    evidence_id uuid DEFAULT gen_random_uuid() NOT NULL,
    evidence_id uuid DEFAULT gen_random_uuid() NOT NULL,
    control_code text NOT NULL,
    control_code text NOT NULL,
    company_id uuid,
    company_id uuid,
    evidence_ref text NOT NULL,
    evidence_ref text NOT NULL,
    period_from date,
    period_from date,
    period_to date,
    period_to date,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: lp_copy_i18n; Type: TABLE; Schema: approval; Owner: -
-- Name: lp_copy_i18n; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.lp_copy_i18n (
CREATE TABLE approval.lp_copy_i18n (
    lang text NOT NULL,
    lang text NOT NULL,
    copy_key text NOT NULL,
    copy_key text NOT NULL,
    text text NOT NULL,
    text text NOT NULL,
    CONSTRAINT lp_copy_i18n_lang_check CHECK ((lang = ANY (ARRAY['ja'::text, 'en'::text])))
    CONSTRAINT lp_copy_i18n_lang_check CHECK ((lang = ANY (ARRAY['ja'::text, 'en'::text])))
);
);




--
--
-- Name: payment_provider; Type: TABLE; Schema: approval; Owner: -
-- Name: payment_provider; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.payment_provider (
CREATE TABLE approval.payment_provider (
    provider_code text NOT NULL,
    provider_code text NOT NULL,
    provider_name text NOT NULL,
    provider_name text NOT NULL,
    webhook_hint text
    webhook_hint text
);
);




--
--
-- Name: plan_master; Type: TABLE; Schema: approval; Owner: -
-- Name: plan_master; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.plan_master (
CREATE TABLE approval.plan_master (
    plan_code text NOT NULL,
    plan_code text NOT NULL,
    max_companies integer NOT NULL,
    max_companies integer NOT NULL,
    max_requests_per_month integer NOT NULL,
    max_requests_per_month integer NOT NULL,
    max_policies integer NOT NULL
    max_policies integer NOT NULL
);
);




--
--
-- Name: policy_activation_log; Type: TABLE; Schema: approval; Owner: -
-- Name: policy_activation_log; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.policy_activation_log (
CREATE TABLE approval.policy_activation_log (
    log_id uuid DEFAULT gen_random_uuid() NOT NULL,
    log_id uuid DEFAULT gen_random_uuid() NOT NULL,
    auto_policy_id uuid NOT NULL,
    auto_policy_id uuid NOT NULL,
    activated_at timestamp with time zone DEFAULT now() NOT NULL,
    activated_at timestamp with time zone DEFAULT now() NOT NULL,
    activated_by text DEFAULT 'ai-auto'::text NOT NULL
    activated_by text DEFAULT 'ai-auto'::text NOT NULL
);
);




--
--
-- Name: policy_auto_generated; Type: TABLE; Schema: approval; Owner: -
-- Name: policy_auto_generated; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.policy_auto_generated (
CREATE TABLE approval.policy_auto_generated (
    auto_policy_id uuid DEFAULT gen_random_uuid() NOT NULL,
    auto_policy_id uuid DEFAULT gen_random_uuid() NOT NULL,
    source_policy_id text NOT NULL,
    source_policy_id text NOT NULL,
    generated_rule jsonb NOT NULL,
    generated_rule jsonb NOT NULL,
    confidence_score numeric NOT NULL,
    confidence_score numeric NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    activated boolean DEFAULT false NOT NULL
    activated boolean DEFAULT false NOT NULL
);
);




--
--
-- Name: policy_eval_event; Type: TABLE; Schema: approval; Owner: -
-- Name: policy_eval_event; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.policy_eval_event (
CREATE TABLE approval.policy_eval_event (
    eval_id uuid DEFAULT gen_random_uuid() NOT NULL,
    eval_id uuid DEFAULT gen_random_uuid() NOT NULL,
    auto_policy_id uuid NOT NULL,
    auto_policy_id uuid NOT NULL,
    company_id uuid,
    company_id uuid,
    order_id bigint,
    order_id bigint,
    entity_id text,
    entity_id text,
    outcome text NOT NULL,
    outcome text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT policy_eval_event_outcome_check CHECK ((outcome = ANY (ARRAY['ok'::text, 'bad'::text])))
    CONSTRAINT policy_eval_event_outcome_check CHECK ((outcome = ANY (ARRAY['ok'::text, 'bad'::text])))
);
);




--
--
-- Name: policy_rollout; Type: TABLE; Schema: approval; Owner: -
-- Name: policy_rollout; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.policy_rollout (
CREATE TABLE approval.policy_rollout (
    auto_policy_id uuid NOT NULL,
    auto_policy_id uuid NOT NULL,
    company_id uuid,
    company_id uuid,
    rollout_percent integer DEFAULT 0 NOT NULL,
    rollout_percent integer DEFAULT 0 NOT NULL,
    status text DEFAULT 'staged'::text NOT NULL,
    status text DEFAULT 'staged'::text NOT NULL,
    min_confidence numeric DEFAULT 0.85 NOT NULL,
    min_confidence numeric DEFAULT 0.85 NOT NULL,
    max_error_rate numeric DEFAULT 0.05 NOT NULL,
    max_error_rate numeric DEFAULT 0.05 NOT NULL,
    min_samples integer DEFAULT 30 NOT NULL,
    min_samples integer DEFAULT 30 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT policy_rollout_rollout_percent_check CHECK ((rollout_percent = ANY (ARRAY[0, 10, 50, 100]))),
    CONSTRAINT policy_rollout_rollout_percent_check CHECK ((rollout_percent = ANY (ARRAY[0, 10, 50, 100]))),
    CONSTRAINT policy_rollout_status_check CHECK ((status = ANY (ARRAY['staged'::text, 'active'::text, 'paused'::text, 'rolled_back'::text])))
    CONSTRAINT policy_rollout_status_check CHECK ((status = ANY (ARRAY['staged'::text, 'active'::text, 'paused'::text, 'rolled_back'::text])))
);
);




--
--
-- Name: policy_rollout_log; Type: TABLE; Schema: approval; Owner: -
-- Name: policy_rollout_log; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.policy_rollout_log (
CREATE TABLE approval.policy_rollout_log (
    log_id uuid DEFAULT gen_random_uuid() NOT NULL,
    log_id uuid DEFAULT gen_random_uuid() NOT NULL,
    auto_policy_id uuid NOT NULL,
    auto_policy_id uuid NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    from_percent integer,
    from_percent integer,
    to_percent integer,
    to_percent integer,
    reason text,
    reason text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: public_pricing; Type: TABLE; Schema: approval; Owner: -
-- Name: public_pricing; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.public_pricing (
CREATE TABLE approval.public_pricing (
    plan_code text NOT NULL,
    plan_code text NOT NULL,
    plan_name text NOT NULL,
    plan_name text NOT NULL,
    monthly_yen numeric NOT NULL,
    monthly_yen numeric NOT NULL,
    description text NOT NULL,
    description text NOT NULL,
    features text NOT NULL
    features text NOT NULL
);
);




--
--
-- Name: rework_task; Type: TABLE; Schema: approval; Owner: -
-- Name: rework_task; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.rework_task (
CREATE TABLE approval.rework_task (
    task_id uuid DEFAULT gen_random_uuid() NOT NULL,
    task_id uuid DEFAULT gen_random_uuid() NOT NULL,
    auto_policy_id uuid NOT NULL,
    auto_policy_id uuid NOT NULL,
    company_id uuid,
    company_id uuid,
    order_id bigint,
    order_id bigint,
    entity_id text,
    entity_id text,
    reason text NOT NULL,
    reason text NOT NULL,
    status text DEFAULT 'open'::text NOT NULL,
    status text DEFAULT 'open'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    closed_at timestamp with time zone,
    closed_at timestamp with time zone,
    CONSTRAINT rework_task_status_check CHECK ((status = ANY (ARRAY['open'::text, 'closed'::text])))
    CONSTRAINT rework_task_status_check CHECK ((status = ANY (ARRAY['open'::text, 'closed'::text])))
);
);




--
--
-- Name: saas_company_map; Type: TABLE; Schema: approval; Owner: -
-- Name: saas_company_map; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.saas_company_map (
CREATE TABLE approval.saas_company_map (
    subscription_id uuid NOT NULL,
    subscription_id uuid NOT NULL,
    company_id uuid NOT NULL
    company_id uuid NOT NULL
);
);




--
--
-- Name: saas_plan; Type: TABLE; Schema: approval; Owner: -
-- Name: saas_plan; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.saas_plan (
CREATE TABLE approval.saas_plan (
    plan_code text NOT NULL,
    plan_code text NOT NULL,
    plan_name text NOT NULL,
    plan_name text NOT NULL,
    monthly_yen numeric NOT NULL,
    monthly_yen numeric NOT NULL,
    features jsonb DEFAULT '{}'::jsonb NOT NULL
    features jsonb DEFAULT '{}'::jsonb NOT NULL
);
);




--
--
-- Name: saas_plan_limit; Type: TABLE; Schema: approval; Owner: -
-- Name: saas_plan_limit; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.saas_plan_limit (
CREATE TABLE approval.saas_plan_limit (
    plan_code text NOT NULL,
    plan_code text NOT NULL,
    max_companies integer,
    max_companies integer,
    max_approvals_mo integer,
    max_approvals_mo integer,
    max_users integer,
    max_users integer,
    price_yen_mo numeric NOT NULL
    price_yen_mo numeric NOT NULL
);
);




--
--
-- Name: saas_subscription; Type: TABLE; Schema: approval; Owner: -
-- Name: saas_subscription; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.saas_subscription (
CREATE TABLE approval.saas_subscription (
    subscription_id uuid DEFAULT gen_random_uuid() NOT NULL,
    subscription_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    plan_code text NOT NULL,
    plan_code text NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    status text DEFAULT 'active'::text NOT NULL,
    started_at timestamp with time zone DEFAULT now() NOT NULL,
    started_at timestamp with time zone DEFAULT now() NOT NULL,
    ended_at timestamp with time zone,
    ended_at timestamp with time zone,
    CONSTRAINT saas_subscription_status_check CHECK ((status = ANY (ARRAY['active'::text, 'paused'::text, 'canceled'::text])))
    CONSTRAINT saas_subscription_status_check CHECK ((status = ANY (ARRAY['active'::text, 'paused'::text, 'canceled'::text])))
);
);




--
--
-- Name: saas_usage_daily; Type: TABLE; Schema: approval; Owner: -
-- Name: saas_usage_daily; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.saas_usage_daily (
CREATE TABLE approval.saas_usage_daily (
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    day date NOT NULL,
    day date NOT NULL,
    approvals integer DEFAULT 0 NOT NULL,
    approvals integer DEFAULT 0 NOT NULL,
    auto_approves integer DEFAULT 0 NOT NULL,
    auto_approves integer DEFAULT 0 NOT NULL,
    rollbacks integer DEFAULT 0 NOT NULL
    rollbacks integer DEFAULT 0 NOT NULL
);
);




--
--
-- Name: saas_usage_monthly; Type: TABLE; Schema: approval; Owner: -
-- Name: saas_usage_monthly; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.saas_usage_monthly (
CREATE TABLE approval.saas_usage_monthly (
    subscription_id uuid NOT NULL,
    subscription_id uuid NOT NULL,
    ym text NOT NULL,
    ym text NOT NULL,
    approvals_count integer DEFAULT 0 NOT NULL
    approvals_count integer DEFAULT 0 NOT NULL
);
);




--
--
-- Name: stripe_webhook_event; Type: TABLE; Schema: approval; Owner: -
-- Name: stripe_webhook_event; Type: TABLE; Schema: approval; Owner: -
--
--


CREATE TABLE approval.stripe_webhook_event (
CREATE TABLE approval.stripe_webhook_event (
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    event_id text NOT NULL,
    event_id text NOT NULL,
    event_type text NOT NULL,
    event_type text NOT NULL,
    payload jsonb NOT NULL,
    payload jsonb NOT NULL,
    received_at timestamp with time zone DEFAULT now() NOT NULL,
    received_at timestamp with time zone DEFAULT now() NOT NULL,
    processed_at timestamp with time zone,
    processed_at timestamp with time zone,
    process_status text DEFAULT 'received'::text NOT NULL,
    process_status text DEFAULT 'received'::text NOT NULL,
    last_error text,
    last_error text,
    CONSTRAINT stripe_webhook_event_process_status_check CHECK ((process_status = ANY (ARRAY['received'::text, 'processed'::text, 'failed'::text])))
    CONSTRAINT stripe_webhook_event_process_status_check CHECK ((process_status = ANY (ARRAY['received'::text, 'processed'::text, 'failed'::text])))
);
);




--
--
-- Name: order_detail; Type: TABLE; Schema: sales; Owner: -
-- Name: order_detail; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.order_detail (
CREATE TABLE sales.order_detail (
    order_detail_id bigint NOT NULL,
    order_detail_id bigint NOT NULL,
    order_id bigint NOT NULL,
    order_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    requested_ship_date date
    requested_ship_date date
);
);




--
--
-- Name: v_order_summary; Type: VIEW; Schema: sales; Owner: -
-- Name: v_order_summary; Type: VIEW; Schema: sales; Owner: -
--
--


CREATE VIEW sales.v_order_summary AS
CREATE VIEW sales.v_order_summary AS
 SELECT oh.order_id,
 SELECT oh.order_id,
    oh.order_no,
    oh.order_no,
    oh.company_id,
    oh.company_id,
    COALESCE(sum(od.amount), (0)::numeric) AS total_amount,
    COALESCE(sum(od.amount), (0)::numeric) AS total_amount,
    COALESCE(sum(od.qty), (0)::numeric) AS total_qty
    COALESCE(sum(od.qty), (0)::numeric) AS total_qty
   FROM (sales.order_header oh
   FROM (sales.order_header oh
     LEFT JOIN sales.order_detail od ON ((od.order_id = oh.order_id)))
     LEFT JOIN sales.order_detail od ON ((od.order_id = oh.order_id)))
  GROUP BY oh.order_id, oh.order_no, oh.company_id;
  GROUP BY oh.order_id, oh.order_no, oh.company_id;




--
--
-- Name: v_ai_improvement_input; Type: VIEW; Schema: approval; Owner: -
-- Name: v_ai_improvement_input; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_ai_improvement_input AS
CREATE VIEW approval.v_ai_improvement_input AS
 SELECT ar.request_id,
 SELECT ar.request_id,
    ar.policy_id,
    ar.policy_id,
    ar.severity,
    ar.severity,
    ar.status,
    ar.status,
    ar.reason,
    ar.reason,
    (EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0) AS sla_minutes,
    (EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0) AS sla_minutes,
    os.order_no,
    os.order_no,
    os.total_amount,
    os.total_amount,
    os.total_qty
    os.total_qty
   FROM (audit.approval_request ar
   FROM (audit.approval_request ar
     LEFT JOIN sales.v_order_summary os ON ((os.order_id = ar.order_id)))
     LEFT JOIN sales.v_order_summary os ON ((os.order_id = ar.order_id)))
  WHERE ((ar.reason IS NOT NULL) AND (ar.decided_at IS NOT NULL));
  WHERE ((ar.reason IS NOT NULL) AND (ar.decided_at IS NOT NULL));




--
--
-- Name: v_ai_llm_input; Type: VIEW; Schema: approval; Owner: -
-- Name: v_ai_llm_input; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_ai_llm_input AS
CREATE VIEW approval.v_ai_llm_input AS
 SELECT ar.request_id,
 SELECT ar.request_id,
    ar.policy_id,
    ar.policy_id,
    ar.severity,
    ar.severity,
    ar.reason,
    ar.reason,
    (EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0) AS sla_minutes,
    (EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0) AS sla_minutes,
    os.total_amount,
    os.total_amount,
    os.total_qty
    os.total_qty
   FROM (audit.approval_request ar
   FROM (audit.approval_request ar
     LEFT JOIN sales.v_order_summary os ON ((os.order_id = ar.order_id)))
     LEFT JOIN sales.v_order_summary os ON ((os.order_id = ar.order_id)))
  WHERE ((ar.status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (ar.decided_at IS NOT NULL) AND (ar.reason IS NOT NULL));
  WHERE ((ar.status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (ar.decided_at IS NOT NULL) AND (ar.reason IS NOT NULL));




--
--
-- Name: audit_trail; Type: VIEW; Schema: public; Owner: -
-- Name: audit_trail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.audit_trail AS
CREATE VIEW public.audit_trail AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail;
   FROM core.audit_trail;




--
--
-- Name: v_audit_action_classified; Type: VIEW; Schema: approval; Owner: -
-- Name: v_audit_action_classified; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_audit_action_classified AS
CREATE VIEW approval.v_audit_action_classified AS
 SELECT entity_id,
 SELECT entity_id,
    performed_at,
    performed_at,
    performed_by,
    performed_by,
        CASE
        CASE
            WHEN (detail ? 'price'::text) THEN 'price_change'::text
            WHEN (detail ? 'price'::text) THEN 'price_change'::text
            WHEN (detail ? 'qty'::text) THEN 'qty_change'::text
            WHEN (detail ? 'qty'::text) THEN 'qty_change'::text
            WHEN (detail ? 'amount'::text) THEN 'amount_change'::text
            WHEN (detail ? 'amount'::text) THEN 'amount_change'::text
            ELSE 'other_update'::text
            ELSE 'other_update'::text
        END AS action_type
        END AS action_type
   FROM public.audit_trail at
   FROM public.audit_trail at
  WHERE (action = 'update'::text);
  WHERE (action = 'update'::text);




--
--
-- Name: v_ai_override_audit_report; Type: VIEW; Schema: approval; Owner: -
-- Name: v_ai_override_audit_report; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_ai_override_audit_report AS
CREATE VIEW approval.v_ai_override_audit_report AS
 SELECT ar.request_id,
 SELECT ar.request_id,
    ar.company_id,
    ar.company_id,
    ar.order_id,
    ar.order_id,
    ar.policy_id,
    ar.policy_id,
    pe.auto_policy_id,
    pe.auto_policy_id,
    ac.action_type AS override_reason,
    ac.action_type AS override_reason,
    ac.performed_by AS overridden_by,
    ac.performed_by AS overridden_by,
    ac.performed_at AS overridden_at,
    ac.performed_at AS overridden_at,
    ar.decided_at AS ai_decided_at
    ar.decided_at AS ai_decided_at
   FROM ((audit.approval_request ar
   FROM ((audit.approval_request ar
     JOIN approval.policy_eval_event pe ON ((pe.order_id = ar.order_id)))
     JOIN approval.policy_eval_event pe ON ((pe.order_id = ar.order_id)))
     JOIN approval.v_audit_action_classified ac ON ((ac.entity_id = (ar.order_id)::text)))
     JOIN approval.v_audit_action_classified ac ON ((ac.entity_id = (ar.order_id)::text)))
  WHERE ((pe.outcome = 'ok'::text) AND (ac.performed_at > ar.decided_at));
  WHERE ((pe.outcome = 'ok'::text) AND (ac.performed_at > ar.decided_at));




--
--
-- Name: v_ai_rule_applicable_order; Type: VIEW; Schema: approval; Owner: -
-- Name: v_ai_rule_applicable_order; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_ai_rule_applicable_order AS
CREATE VIEW approval.v_ai_rule_applicable_order AS
 SELECT ar.request_id,
 SELECT ar.request_id,
    ar.company_id,
    ar.company_id,
    ar.order_id,
    ar.order_id,
    ar.entity_id,
    ar.entity_id,
    pr.auto_policy_id,
    pr.auto_policy_id,
    pr.rollout_percent
    pr.rollout_percent
   FROM (audit.approval_request ar
   FROM (audit.approval_request ar
     JOIN approval.policy_rollout pr ON ((pr.auto_policy_id = ( SELECT ap.auto_policy_id
     JOIN approval.policy_rollout pr ON ((pr.auto_policy_id = ( SELECT ap.auto_policy_id
           FROM approval.policy_auto_generated ap
           FROM approval.policy_auto_generated ap
          WHERE ((ap.source_policy_id = ar.policy_id) AND (ap.activated = true))
          WHERE ((ap.source_policy_id = ar.policy_id) AND (ap.activated = true))
         LIMIT 1))))
         LIMIT 1))))
  WHERE ((pr.status = 'active'::text) AND (approval.is_in_rollout(pr.rollout_percent, ar.entity_id) = true));
  WHERE ((pr.status = 'active'::text) AND (approval.is_in_rollout(pr.rollout_percent, ar.entity_id) = true));




--
--
-- Name: company_license; Type: TABLE; Schema: core; Owner: -
-- Name: company_license; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.company_license (
CREATE TABLE core.company_license (
    company_license_id bigint NOT NULL,
    company_license_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    license_code text NOT NULL,
    license_code text NOT NULL,
    purchased_at timestamp with time zone DEFAULT now() NOT NULL,
    purchased_at timestamp with time zone DEFAULT now() NOT NULL,
    expires_at timestamp with time zone,
    expires_at timestamp with time zone,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: company_license; Type: VIEW; Schema: public; Owner: -
-- Name: company_license; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.company_license AS
CREATE VIEW public.company_license AS
 SELECT company_license_id,
 SELECT company_license_id,
    company_id,
    company_id,
    license_code,
    license_code,
    purchased_at,
    purchased_at,
    expires_at,
    expires_at,
    is_active
    is_active
   FROM core.company_license;
   FROM core.company_license;




--
--
-- Name: v_ai_saas_enabled; Type: VIEW; Schema: approval; Owner: -
-- Name: v_ai_saas_enabled; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_ai_saas_enabled AS
CREATE VIEW approval.v_ai_saas_enabled AS
 SELECT ff.company_id
 SELECT ff.company_id
   FROM (approval.feature_flag ff
   FROM (approval.feature_flag ff
     JOIN public.company_license cl ON ((cl.company_id = ff.company_id)))
     JOIN public.company_license cl ON ((cl.company_id = ff.company_id)))
  WHERE ((ff.feature_key = 'approval_ai'::text) AND (ff.is_enabled = true) AND (cl.license_code = ANY (ARRAY['PRO'::text, 'ENTERPRISE'::text])));
  WHERE ((ff.feature_key = 'approval_ai'::text) AND (ff.is_enabled = true) AND (cl.license_code = ANY (ARRAY['PRO'::text, 'ENTERPRISE'::text])));




--
--
-- Name: approval_log; Type: TABLE; Schema: audit; Owner: -
-- Name: approval_log; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.approval_log (
CREATE TABLE audit.approval_log (
    approval_log_id uuid DEFAULT gen_random_uuid() NOT NULL,
    approval_log_id uuid DEFAULT gen_random_uuid() NOT NULL,
    approval_request_id uuid NOT NULL,
    approval_request_id uuid NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    actor uuid NOT NULL,
    actor uuid NOT NULL,
    note text,
    note text,
    acted_at timestamp with time zone DEFAULT now() NOT NULL,
    acted_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT approval_log_action_check CHECK ((action = ANY (ARRAY['approve'::text, 'reject'::text])))
    CONSTRAINT approval_log_action_check CHECK ((action = ANY (ARRAY['approve'::text, 'reject'::text])))
);
);




--
--
-- Name: v_approval_audit; Type: VIEW; Schema: approval; Owner: -
-- Name: v_approval_audit; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_approval_audit AS
CREATE VIEW approval.v_approval_audit AS
 SELECT ar.request_id,
 SELECT ar.request_id,
    ar.company_id,
    ar.company_id,
    ar.domain,
    ar.domain,
    ar.entity_type,
    ar.entity_type,
    ar.entity_id,
    ar.entity_id,
    ar.policy_id,
    ar.policy_id,
    ar.severity,
    ar.severity,
    ar.status,
    ar.status,
    ar.detected_at,
    ar.detected_at,
    ar.decided_at,
    ar.decided_at,
    al.actor,
    al.actor,
    al.action,
    al.action,
    al.note
    al.note
   FROM (audit.approval_request ar
   FROM (audit.approval_request ar
     LEFT JOIN audit.approval_log al ON ((al.approval_request_id = ar.request_id)));
     LEFT JOIN audit.approval_log al ON ((al.approval_request_id = ar.request_id)));




--
--
-- Name: v_approval_result_enriched; Type: VIEW; Schema: approval; Owner: -
-- Name: v_approval_result_enriched; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_approval_result_enriched AS
CREATE VIEW approval.v_approval_result_enriched AS
 SELECT ar.request_id,
 SELECT ar.request_id,
    ar.company_id,
    ar.company_id,
    ar.order_id,
    ar.order_id,
    ar.policy_id,
    ar.policy_id,
    ar.severity,
    ar.severity,
    ar.status,
    ar.status,
    ar.detected_at,
    ar.detected_at,
    ar.decided_at,
    ar.decided_at,
    os.order_no,
    os.order_no,
    os.total_amount,
    os.total_amount,
    os.total_qty
    os.total_qty
   FROM (audit.approval_request ar
   FROM (audit.approval_request ar
     LEFT JOIN sales.v_order_summary os ON ((os.order_id = ar.order_id)))
     LEFT JOIN sales.v_order_summary os ON ((os.order_id = ar.order_id)))
  WHERE (ar.status = ANY (ARRAY['approved'::text, 'rejected'::text]));
  WHERE (ar.status = ANY (ARRAY['approved'::text, 'rejected'::text]));




--
--
-- Name: v_approval_result_event; Type: VIEW; Schema: approval; Owner: -
-- Name: v_approval_result_event; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_approval_result_event AS
CREATE VIEW approval.v_approval_result_event AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    domain,
    domain,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    order_id,
    order_id,
    policy_id,
    policy_id,
    severity,
    severity,
    status,
    status,
    decided_at
    decided_at
   FROM audit.approval_request ar
   FROM audit.approval_request ar
  WHERE (status = ANY (ARRAY['approved'::text, 'rejected'::text]));
  WHERE (status = ANY (ARRAY['approved'::text, 'rejected'::text]));




--
--
-- Name: v_approval_sla_kpi; Type: VIEW; Schema: approval; Owner: -
-- Name: v_approval_sla_kpi; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_approval_sla_kpi AS
CREATE VIEW approval.v_approval_sla_kpi AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    policy_id,
    policy_id,
    severity,
    severity,
    status,
    status,
    (EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0) AS sla_minutes
    (EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0) AS sla_minutes
   FROM audit.approval_request ar
   FROM audit.approval_request ar
  WHERE ((status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (decided_at IS NOT NULL));
  WHERE ((status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (decided_at IS NOT NULL));




--
--
-- Name: v_audit_report_export; Type: VIEW; Schema: approval; Owner: -
-- Name: v_audit_report_export; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_audit_report_export AS
CREATE VIEW approval.v_audit_report_export AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    order_id,
    order_id,
    policy_id,
    policy_id,
    auto_policy_id,
    auto_policy_id,
    override_reason,
    override_reason,
    overridden_by,
    overridden_by,
    overridden_at,
    overridden_at,
    ai_decided_at
    ai_decided_at
   FROM approval.v_ai_override_audit_report;
   FROM approval.v_ai_override_audit_report;




--
--
-- Name: v_auto_policy_activate; Type: VIEW; Schema: approval; Owner: -
-- Name: v_auto_policy_activate; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_auto_policy_activate AS
CREATE VIEW approval.v_auto_policy_activate AS
 SELECT auto_policy_id,
 SELECT auto_policy_id,
    source_policy_id,
    source_policy_id,
    generated_rule,
    generated_rule,
    confidence_score
    confidence_score
   FROM approval.policy_auto_generated
   FROM approval.policy_auto_generated
  WHERE ((activated = false) AND (confidence_score >= 0.85));
  WHERE ((activated = false) AND (confidence_score >= 0.85));




--
--
-- Name: v_autopilot_company_enabled; Type: VIEW; Schema: approval; Owner: -
-- Name: v_autopilot_company_enabled; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_autopilot_company_enabled AS
CREATE VIEW approval.v_autopilot_company_enabled AS
 SELECT pr.auto_policy_id,
 SELECT pr.auto_policy_id,
    pr.company_id
    pr.company_id
   FROM (approval.policy_rollout pr
   FROM (approval.policy_rollout pr
     JOIN approval.feature_flag ff ON ((ff.company_id = pr.company_id)))
     JOIN approval.feature_flag ff ON ((ff.company_id = pr.company_id)))
  WHERE ((ff.feature_key = 'approval_ai'::text) AND (ff.is_enabled = true));
  WHERE ((ff.feature_key = 'approval_ai'::text) AND (ff.is_enabled = true));




--
--
-- Name: v_policy_eval_7d; Type: VIEW; Schema: approval; Owner: -
-- Name: v_policy_eval_7d; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_policy_eval_7d AS
CREATE VIEW approval.v_policy_eval_7d AS
 SELECT auto_policy_id,
 SELECT auto_policy_id,
    count(*) AS samples,
    count(*) AS samples,
    avg(
    avg(
        CASE
        CASE
            WHEN (outcome = 'bad'::text) THEN 1.0
            WHEN (outcome = 'bad'::text) THEN 1.0
            ELSE 0.0
            ELSE 0.0
        END) AS error_rate
        END) AS error_rate
   FROM approval.policy_eval_event
   FROM approval.policy_eval_event
  WHERE (created_at >= (now() - '7 days'::interval))
  WHERE (created_at >= (now() - '7 days'::interval))
  GROUP BY auto_policy_id;
  GROUP BY auto_policy_id;




--
--
-- Name: v_policy_roi; Type: VIEW; Schema: approval; Owner: -
-- Name: v_policy_roi; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_policy_roi AS
CREATE VIEW approval.v_policy_roi AS
 WITH base AS (
 WITH base AS (
         SELECT ap.auto_policy_id,
         SELECT ap.auto_policy_id,
            ap.source_policy_id AS policy_id,
            ap.source_policy_id AS policy_id,
            ap.created_at AS policy_created_at
            ap.created_at AS policy_created_at
           FROM approval.policy_auto_generated ap
           FROM approval.policy_auto_generated ap
        ), before_after AS (
        ), before_after AS (
         SELECT b.auto_policy_id,
         SELECT b.auto_policy_id,
            b.policy_id,
            b.policy_id,
            avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) FILTER (WHERE (ar.detected_at < b.policy_created_at)) AS avg_sla_before,
            avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) FILTER (WHERE (ar.detected_at < b.policy_created_at)) AS avg_sla_before,
            avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) FILTER (WHERE (ar.detected_at >= b.policy_created_at)) AS avg_sla_after,
            avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) FILTER (WHERE (ar.detected_at >= b.policy_created_at)) AS avg_sla_after,
            count(*) FILTER (WHERE (ar.detected_at >= b.policy_created_at)) AS after_count
            count(*) FILTER (WHERE (ar.detected_at >= b.policy_created_at)) AS after_count
           FROM (base b
           FROM (base b
             JOIN audit.approval_request ar ON (((ar.policy_id = b.policy_id) AND (ar.status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (ar.decided_at IS NOT NULL))))
             JOIN audit.approval_request ar ON (((ar.policy_id = b.policy_id) AND (ar.status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (ar.decided_at IS NOT NULL))))
          GROUP BY b.auto_policy_id, b.policy_id
          GROUP BY b.auto_policy_id, b.policy_id
        ), quality AS (
        ), quality AS (
         SELECT pe.auto_policy_id,
         SELECT pe.auto_policy_id,
            count(*) AS samples_7d,
            count(*) AS samples_7d,
            avg(
            avg(
                CASE
                CASE
                    WHEN (pe.outcome = 'bad'::text) THEN 1.0
                    WHEN (pe.outcome = 'bad'::text) THEN 1.0
                    ELSE 0.0
                    ELSE 0.0
                END) AS error_rate_7d
                END) AS error_rate_7d
           FROM approval.policy_eval_event pe
           FROM approval.policy_eval_event pe
          WHERE (pe.created_at >= (now() - '7 days'::interval))
          WHERE (pe.created_at >= (now() - '7 days'::interval))
          GROUP BY pe.auto_policy_id
          GROUP BY pe.auto_policy_id
        )
        )
 SELECT ba.auto_policy_id,
 SELECT ba.auto_policy_id,
    ba.policy_id,
    ba.policy_id,
    ba.avg_sla_before,
    ba.avg_sla_before,
    ba.avg_sla_after,
    ba.avg_sla_after,
    ba.after_count,
    ba.after_count,
    ((COALESCE(ba.avg_sla_before, (0)::numeric) - COALESCE(ba.avg_sla_after, (0)::numeric)) * (COALESCE(ba.after_count, (0)::bigint))::numeric) AS savings_minutes_total,
    ((COALESCE(ba.avg_sla_before, (0)::numeric) - COALESCE(ba.avg_sla_after, (0)::numeric)) * (COALESCE(ba.after_count, (0)::bigint))::numeric) AS savings_minutes_total,
    q.samples_7d,
    q.samples_7d,
    q.error_rate_7d
    q.error_rate_7d
   FROM (before_after ba
   FROM (before_after ba
     LEFT JOIN quality q ON ((q.auto_policy_id = ba.auto_policy_id)));
     LEFT JOIN quality q ON ((q.auto_policy_id = ba.auto_policy_id)));




--
--
-- Name: v_autopilot_recommendation; Type: VIEW; Schema: approval; Owner: -
-- Name: v_autopilot_recommendation; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_autopilot_recommendation AS
CREATE VIEW approval.v_autopilot_recommendation AS
 SELECT pr.auto_policy_id,
 SELECT pr.auto_policy_id,
    pr.company_id,
    pr.company_id,
    pr.rollout_percent,
    pr.rollout_percent,
    pr.status,
    pr.status,
    pr.min_samples,
    pr.min_samples,
    pr.max_error_rate,
    pr.max_error_rate,
    COALESCE(ev.samples, (0)::bigint) AS samples_7d,
    COALESCE(ev.samples, (0)::bigint) AS samples_7d,
    COALESCE(ev.error_rate, (0)::numeric) AS error_rate_7d,
    COALESCE(ev.error_rate, (0)::numeric) AS error_rate_7d,
    roi.savings_minutes_total,
    roi.savings_minutes_total,
        CASE
        CASE
            WHEN (pr.status = 'rolled_back'::text) THEN 'hold'::text
            WHEN (pr.status = 'rolled_back'::text) THEN 'hold'::text
            WHEN ((COALESCE(ev.samples, (0)::bigint) >= pr.min_samples) AND (COALESCE(ev.error_rate, (0)::numeric) > pr.max_error_rate)) THEN 'rollback'::text
            WHEN ((COALESCE(ev.samples, (0)::bigint) >= pr.min_samples) AND (COALESCE(ev.error_rate, (0)::numeric) > pr.max_error_rate)) THEN 'rollback'::text
            WHEN ((COALESCE(ev.samples, (0)::bigint) >= pr.min_samples) AND (COALESCE(ev.error_rate, (0)::numeric) <= pr.max_error_rate) AND (pr.rollout_percent = ANY (ARRAY[0, 10, 50]))) THEN 'promote'::text
            WHEN ((COALESCE(ev.samples, (0)::bigint) >= pr.min_samples) AND (COALESCE(ev.error_rate, (0)::numeric) <= pr.max_error_rate) AND (pr.rollout_percent = ANY (ARRAY[0, 10, 50]))) THEN 'promote'::text
            ELSE 'hold'::text
            ELSE 'hold'::text
        END AS recommended_action
        END AS recommended_action
   FROM ((approval.policy_rollout pr
   FROM ((approval.policy_rollout pr
     LEFT JOIN approval.v_policy_eval_7d ev ON ((ev.auto_policy_id = pr.auto_policy_id)))
     LEFT JOIN approval.v_policy_eval_7d ev ON ((ev.auto_policy_id = pr.auto_policy_id)))
     LEFT JOIN approval.v_policy_roi roi ON ((roi.auto_policy_id = pr.auto_policy_id)));
     LEFT JOIN approval.v_policy_roi roi ON ((roi.auto_policy_id = pr.auto_policy_id)));




--
--
-- Name: v_bad_candidate; Type: VIEW; Schema: approval; Owner: -
-- Name: v_bad_candidate; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_bad_candidate AS
CREATE VIEW approval.v_bad_candidate AS
 SELECT pe.auto_policy_id,
 SELECT pe.auto_policy_id,
    oh.company_id,
    oh.company_id,
    pe.order_id,
    pe.order_id,
    pe.entity_id,
    pe.entity_id,
    oh.status_code,
    oh.status_code,
    now() AS detected_at
    now() AS detected_at
   FROM (approval.policy_eval_event pe
   FROM (approval.policy_eval_event pe
     JOIN sales.order_header oh ON ((oh.order_id = pe.order_id)))
     JOIN sales.order_header oh ON ((oh.order_id = pe.order_id)))
  WHERE ((pe.outcome = 'ok'::text) AND (oh.status_code = ANY (ARRAY['rejected'::text, 'cancelled'::text])));
  WHERE ((pe.outcome = 'ok'::text) AND (oh.status_code = ANY (ARRAY['rejected'::text, 'cancelled'::text])));




--
--
-- Name: v_bad_candidate_audit; Type: VIEW; Schema: approval; Owner: -
-- Name: v_bad_candidate_audit; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_bad_candidate_audit AS
CREATE VIEW approval.v_bad_candidate_audit AS
 SELECT pe.auto_policy_id,
 SELECT pe.auto_policy_id,
    ar.company_id,
    ar.company_id,
    ar.order_id,
    ar.order_id,
    ar.entity_id,
    ar.entity_id,
    'manual_edit_after_approval'::text AS bad_reason
    'manual_edit_after_approval'::text AS bad_reason
   FROM ((approval.policy_eval_event pe
   FROM ((approval.policy_eval_event pe
     JOIN audit.approval_request ar ON ((ar.order_id = pe.order_id)))
     JOIN audit.approval_request ar ON ((ar.order_id = pe.order_id)))
     JOIN public.audit_trail at ON ((at.entity_id = (ar.order_id)::text)))
     JOIN public.audit_trail at ON ((at.entity_id = (ar.order_id)::text)))
  WHERE ((pe.outcome = 'ok'::text) AND (at.action = 'update'::text) AND (at.performed_at > ar.decided_at));
  WHERE ((pe.outcome = 'ok'::text) AND (at.action = 'update'::text) AND (at.performed_at > ar.decided_at));




--
--
-- Name: v_bad_candidate_extended; Type: VIEW; Schema: approval; Owner: -
-- Name: v_bad_candidate_extended; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_bad_candidate_extended AS
CREATE VIEW approval.v_bad_candidate_extended AS
 SELECT pe.auto_policy_id,
 SELECT pe.auto_policy_id,
    oh.company_id,
    oh.company_id,
    pe.order_id,
    pe.order_id,
    pe.entity_id,
    pe.entity_id,
    'status_reverted'::text AS bad_reason
    'status_reverted'::text AS bad_reason
   FROM ((approval.policy_eval_event pe
   FROM ((approval.policy_eval_event pe
     JOIN audit.approval_request ar ON ((ar.order_id = pe.order_id)))
     JOIN audit.approval_request ar ON ((ar.order_id = pe.order_id)))
     JOIN sales.order_header oh ON ((oh.order_id = pe.order_id)))
     JOIN sales.order_header oh ON ((oh.order_id = pe.order_id)))
  WHERE ((pe.outcome = 'ok'::text) AND (oh.status_code = ANY (ARRAY['rejected'::text, 'cancelled'::text])));
  WHERE ((pe.outcome = 'ok'::text) AND (oh.status_code = ANY (ARRAY['rejected'::text, 'cancelled'::text])));




--
--
-- Name: v_bad_candidate_all; Type: VIEW; Schema: approval; Owner: -
-- Name: v_bad_candidate_all; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_bad_candidate_all AS
CREATE VIEW approval.v_bad_candidate_all AS
 SELECT v_bad_candidate_extended.auto_policy_id,
 SELECT v_bad_candidate_extended.auto_policy_id,
    v_bad_candidate_extended.company_id,
    v_bad_candidate_extended.company_id,
    v_bad_candidate_extended.order_id,
    v_bad_candidate_extended.order_id,
    v_bad_candidate_extended.entity_id,
    v_bad_candidate_extended.entity_id,
    v_bad_candidate_extended.bad_reason
    v_bad_candidate_extended.bad_reason
   FROM approval.v_bad_candidate_extended
   FROM approval.v_bad_candidate_extended
UNION ALL
UNION ALL
 SELECT v_bad_candidate_audit.auto_policy_id,
 SELECT v_bad_candidate_audit.auto_policy_id,
    v_bad_candidate_audit.company_id,
    v_bad_candidate_audit.company_id,
    v_bad_candidate_audit.order_id,
    v_bad_candidate_audit.order_id,
    v_bad_candidate_audit.entity_id,
    v_bad_candidate_audit.entity_id,
    v_bad_candidate_audit.bad_reason
    v_bad_candidate_audit.bad_reason
   FROM approval.v_bad_candidate_audit;
   FROM approval.v_bad_candidate_audit;




--
--
-- Name: v_bad_candidate_audit_strict; Type: VIEW; Schema: approval; Owner: -
-- Name: v_bad_candidate_audit_strict; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_bad_candidate_audit_strict AS
CREATE VIEW approval.v_bad_candidate_audit_strict AS
 SELECT pe.auto_policy_id,
 SELECT pe.auto_policy_id,
    ar.company_id,
    ar.company_id,
    ar.order_id,
    ar.order_id,
    ar.entity_id,
    ar.entity_id,
    ac.action_type AS bad_reason,
    ac.action_type AS bad_reason,
        CASE
        CASE
            WHEN (ac.action_type = ANY (ARRAY['price_change'::text, 'amount_change'::text])) THEN 'high'::text
            WHEN (ac.action_type = ANY (ARRAY['price_change'::text, 'amount_change'::text])) THEN 'high'::text
            WHEN (ac.action_type = 'qty_change'::text) THEN 'medium'::text
            WHEN (ac.action_type = 'qty_change'::text) THEN 'medium'::text
            ELSE 'low'::text
            ELSE 'low'::text
        END AS severity_escalated
        END AS severity_escalated
   FROM ((approval.policy_eval_event pe
   FROM ((approval.policy_eval_event pe
     JOIN audit.approval_request ar ON ((ar.order_id = pe.order_id)))
     JOIN audit.approval_request ar ON ((ar.order_id = pe.order_id)))
     JOIN approval.v_audit_action_classified ac ON ((ac.entity_id = (ar.order_id)::text)))
     JOIN approval.v_audit_action_classified ac ON ((ac.entity_id = (ar.order_id)::text)))
  WHERE ((pe.outcome = 'ok'::text) AND (ac.performed_at > ar.decided_at));
  WHERE ((pe.outcome = 'ok'::text) AND (ac.performed_at > ar.decided_at));




--
--
-- Name: v_bottleneck_policy; Type: VIEW; Schema: approval; Owner: -
-- Name: v_bottleneck_policy; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_bottleneck_policy AS
CREATE VIEW approval.v_bottleneck_policy AS
 SELECT policy_id,
 SELECT policy_id,
    severity,
    severity,
    count(*) AS request_count,
    count(*) AS request_count,
    avg((EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0)) AS avg_sla_minutes,
    avg((EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0)) AS avg_sla_minutes,
    max((EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0)) AS max_sla_minutes
    max((EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0)) AS max_sla_minutes
   FROM audit.approval_request ar
   FROM audit.approval_request ar
  WHERE ((status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (decided_at IS NOT NULL))
  WHERE ((status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (decided_at IS NOT NULL))
  GROUP BY policy_id, severity;
  GROUP BY policy_id, severity;




--
--
-- Name: v_daily_quality_report; Type: VIEW; Schema: approval; Owner: -
-- Name: v_daily_quality_report; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_daily_quality_report AS
CREATE VIEW approval.v_daily_quality_report AS
 SELECT date_trunc('day'::text, ar.decided_at) AS day,
 SELECT date_trunc('day'::text, ar.decided_at) AS day,
    ar.policy_id,
    ar.policy_id,
    ar.severity,
    ar.severity,
    count(*) AS total,
    count(*) AS total,
    avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) AS avg_sla_minutes,
    avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) AS avg_sla_minutes,
    sum(
    sum(
        CASE
        CASE
            WHEN (pe.outcome = 'bad'::text) THEN 1
            WHEN (pe.outcome = 'bad'::text) THEN 1
            ELSE 0
            ELSE 0
        END) AS bad_count
        END) AS bad_count
   FROM (audit.approval_request ar
   FROM (audit.approval_request ar
     LEFT JOIN approval.policy_eval_event pe ON ((pe.order_id = ar.order_id)))
     LEFT JOIN approval.policy_eval_event pe ON ((pe.order_id = ar.order_id)))
  WHERE ((ar.status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (ar.decided_at IS NOT NULL))
  WHERE ((ar.status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (ar.decided_at IS NOT NULL))
  GROUP BY (date_trunc('day'::text, ar.decided_at)), ar.policy_id, ar.severity;
  GROUP BY (date_trunc('day'::text, ar.decided_at)), ar.policy_id, ar.severity;




--
--
-- Name: v_exec_dashboard; Type: VIEW; Schema: approval; Owner: -
-- Name: v_exec_dashboard; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_exec_dashboard AS
CREATE VIEW approval.v_exec_dashboard AS
 SELECT (date_trunc('month'::text, ar.decided_at))::date AS month,
 SELECT (date_trunc('month'::text, ar.decided_at))::date AS month,
    pr.company_id,
    pr.company_id,
    count(*) FILTER (WHERE (ar.status = 'approved'::text)) AS approved_count,
    count(*) FILTER (WHERE (ar.status = 'approved'::text)) AS approved_count,
    avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) AS avg_sla_minutes,
    avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) AS avg_sla_minutes,
    sum(roi.savings_minutes_total) AS saved_minutes,
    sum(roi.savings_minutes_total) AS saved_minutes,
    sum(((roi.savings_minutes_total / 60.0) * cc.cost_per_hour)) AS saved_yen
    sum(((roi.savings_minutes_total / 60.0) * cc.cost_per_hour)) AS saved_yen
   FROM (((audit.approval_request ar
   FROM (((audit.approval_request ar
     JOIN approval.policy_rollout pr ON (((pr.auto_policy_id)::text = ar.policy_id)))
     JOIN approval.policy_rollout pr ON (((pr.auto_policy_id)::text = ar.policy_id)))
     LEFT JOIN approval.v_policy_roi roi ON ((roi.policy_id = ar.policy_id)))
     LEFT JOIN approval.v_policy_roi roi ON ((roi.policy_id = ar.policy_id)))
     LEFT JOIN approval.company_cost cc ON ((cc.company_id = pr.company_id)))
     LEFT JOIN approval.company_cost cc ON ((cc.company_id = pr.company_id)))
  WHERE (ar.decided_at IS NOT NULL)
  WHERE (ar.decided_at IS NOT NULL)
  GROUP BY (date_trunc('month'::text, ar.decided_at)), pr.company_id;
  GROUP BY (date_trunc('month'::text, ar.decided_at)), pr.company_id;




--
--
-- Name: v_exec_dashboard_yoy; Type: VIEW; Schema: approval; Owner: -
-- Name: v_exec_dashboard_yoy; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_exec_dashboard_yoy AS
CREATE VIEW approval.v_exec_dashboard_yoy AS
 WITH base AS (
 WITH base AS (
         SELECT (date_trunc('month'::text, ar.decided_at))::date AS month,
         SELECT (date_trunc('month'::text, ar.decided_at))::date AS month,
            pr.company_id,
            pr.company_id,
            count(*) FILTER (WHERE (ar.status = 'approved'::text)) AS approved_count,
            count(*) FILTER (WHERE (ar.status = 'approved'::text)) AS approved_count,
            avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) AS avg_sla_minutes
            avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) AS avg_sla_minutes
           FROM (audit.approval_request ar
           FROM (audit.approval_request ar
             JOIN approval.policy_rollout pr ON (((pr.auto_policy_id)::text = ar.policy_id)))
             JOIN approval.policy_rollout pr ON (((pr.auto_policy_id)::text = ar.policy_id)))
          WHERE (ar.decided_at IS NOT NULL)
          WHERE (ar.decided_at IS NOT NULL)
          GROUP BY ((date_trunc('month'::text, ar.decided_at))::date), pr.company_id
          GROUP BY ((date_trunc('month'::text, ar.decided_at))::date), pr.company_id
        ), prev AS (
        ), prev AS (
         SELECT ((base.month + '1 year'::interval))::date AS month,
         SELECT ((base.month + '1 year'::interval))::date AS month,
            base.company_id,
            base.company_id,
            base.approved_count AS approved_count_prev_year,
            base.approved_count AS approved_count_prev_year,
            base.avg_sla_minutes AS avg_sla_minutes_prev_year
            base.avg_sla_minutes AS avg_sla_minutes_prev_year
           FROM base
           FROM base
        )
        )
 SELECT b.month,
 SELECT b.month,
    b.company_id,
    b.company_id,
    b.approved_count,
    b.approved_count,
    p.approved_count_prev_year,
    p.approved_count_prev_year,
    (b.approved_count - p.approved_count_prev_year) AS approved_count_yoy_diff,
    (b.approved_count - p.approved_count_prev_year) AS approved_count_yoy_diff,
    b.avg_sla_minutes,
    b.avg_sla_minutes,
    p.avg_sla_minutes_prev_year,
    p.avg_sla_minutes_prev_year,
    (b.avg_sla_minutes - p.avg_sla_minutes_prev_year) AS avg_sla_minutes_yoy_diff
    (b.avg_sla_minutes - p.avg_sla_minutes_prev_year) AS avg_sla_minutes_yoy_diff
   FROM (base b
   FROM (base b
     LEFT JOIN prev p ON (((p.month = b.month) AND (p.company_id = b.company_id))));
     LEFT JOIN prev p ON (((p.month = b.month) AND (p.company_id = b.company_id))));




--
--
-- Name: v_feature_enabled_company; Type: VIEW; Schema: approval; Owner: -
-- Name: v_feature_enabled_company; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_feature_enabled_company AS
CREATE VIEW approval.v_feature_enabled_company AS
 SELECT company_id
 SELECT company_id
   FROM approval.feature_flag
   FROM approval.feature_flag
  WHERE ((feature_key = 'approval_ai'::text) AND (is_enabled = true));
  WHERE ((feature_key = 'approval_ai'::text) AND (is_enabled = true));




--
--
-- Name: v_invoice_for_payment; Type: VIEW; Schema: approval; Owner: -
-- Name: v_invoice_for_payment; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_invoice_for_payment AS
CREATE VIEW approval.v_invoice_for_payment AS
 SELECT invoice_id,
 SELECT invoice_id,
    customer_code,
    customer_code,
    ym,
    ym,
    amount_yen,
    amount_yen,
    status
    status
   FROM approval.billing_invoice bi
   FROM approval.billing_invoice bi
  WHERE (status = ANY (ARRAY['draft'::text, 'issued'::text]));
  WHERE (status = ANY (ARRAY['draft'::text, 'issued'::text]));




--
--
-- Name: v_jsox_control_matrix; Type: VIEW; Schema: approval; Owner: -
-- Name: v_jsox_control_matrix; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_jsox_control_matrix AS
CREATE VIEW approval.v_jsox_control_matrix AS
 SELECT c.control_code,
 SELECT c.control_code,
    c.control_name,
    c.control_name,
    c.objective,
    c.objective,
    c.frequency,
    c.frequency,
    c.owner_role,
    c.owner_role,
    c.evidence,
    c.evidence,
    max(e.created_at) AS last_evidence_at
    max(e.created_at) AS last_evidence_at
   FROM (approval.jsox_control c
   FROM (approval.jsox_control c
     LEFT JOIN approval.jsox_evidence_log e ON ((e.control_code = c.control_code)))
     LEFT JOIN approval.jsox_evidence_log e ON ((e.control_code = c.control_code)))
  GROUP BY c.control_code, c.control_name, c.objective, c.frequency, c.owner_role, c.evidence;
  GROUP BY c.control_code, c.control_name, c.objective, c.frequency, c.owner_role, c.evidence;




--
--
-- Name: v_layer2_active_policies; Type: VIEW; Schema: approval; Owner: -
-- Name: v_layer2_active_policies; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_layer2_active_policies AS
CREATE VIEW approval.v_layer2_active_policies AS
 SELECT auto_policy_id,
 SELECT auto_policy_id,
    source_policy_id,
    source_policy_id,
    generated_rule
    generated_rule
   FROM approval.policy_auto_generated ap
   FROM approval.policy_auto_generated ap
  WHERE (activated = true);
  WHERE (activated = true);




--
--
-- Name: v_monthly_request_count; Type: VIEW; Schema: approval; Owner: -
-- Name: v_monthly_request_count; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_monthly_request_count AS
CREATE VIEW approval.v_monthly_request_count AS
 SELECT company_id,
 SELECT company_id,
    date_trunc('month'::text, detected_at) AS month,
    date_trunc('month'::text, detected_at) AS month,
    count(*) AS request_count
    count(*) AS request_count
   FROM audit.approval_request ar
   FROM audit.approval_request ar
  GROUP BY company_id, (date_trunc('month'::text, detected_at));
  GROUP BY company_id, (date_trunc('month'::text, detected_at));




--
--
-- Name: v_monthly_roi_report; Type: VIEW; Schema: approval; Owner: -
-- Name: v_monthly_roi_report; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_monthly_roi_report AS
CREATE VIEW approval.v_monthly_roi_report AS
 SELECT date_trunc('month'::text, ar.decided_at) AS month,
 SELECT date_trunc('month'::text, ar.decided_at) AS month,
    pr.company_id,
    pr.company_id,
    roi.policy_id,
    roi.policy_id,
    sum(roi.savings_minutes_total) AS savings_minutes,
    sum(roi.savings_minutes_total) AS savings_minutes,
    cc.cost_per_hour,
    cc.cost_per_hour,
    ((sum(roi.savings_minutes_total) / 60.0) * cc.cost_per_hour) AS savings_yen
    ((sum(roi.savings_minutes_total) / 60.0) * cc.cost_per_hour) AS savings_yen
   FROM (((approval.v_policy_roi roi
   FROM (((approval.v_policy_roi roi
     JOIN approval.policy_rollout pr ON ((pr.auto_policy_id = roi.auto_policy_id)))
     JOIN approval.policy_rollout pr ON ((pr.auto_policy_id = roi.auto_policy_id)))
     JOIN approval.company_cost cc ON ((cc.company_id = pr.company_id)))
     JOIN approval.company_cost cc ON ((cc.company_id = pr.company_id)))
     JOIN audit.approval_request ar ON ((ar.policy_id = roi.policy_id)))
     JOIN audit.approval_request ar ON ((ar.policy_id = roi.policy_id)))
  WHERE (ar.decided_at IS NOT NULL)
  WHERE (ar.decided_at IS NOT NULL)
  GROUP BY (date_trunc('month'::text, ar.decided_at)), pr.company_id, roi.policy_id, cc.cost_per_hour;
  GROUP BY (date_trunc('month'::text, ar.decided_at)), pr.company_id, roi.policy_id, cc.cost_per_hour;




--
--
-- Name: v_payment_status; Type: VIEW; Schema: approval; Owner: -
-- Name: v_payment_status; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_payment_status AS
CREATE VIEW approval.v_payment_status AS
 SELECT bi.invoice_id,
 SELECT bi.invoice_id,
    bi.customer_code,
    bi.customer_code,
    bi.ym,
    bi.ym,
    bi.amount_yen,
    bi.amount_yen,
    max(bp.status) AS payment_status
    max(bp.status) AS payment_status
   FROM (approval.billing_invoice bi
   FROM (approval.billing_invoice bi
     LEFT JOIN approval.billing_payment bp ON ((bp.invoice_id = bi.invoice_id)))
     LEFT JOIN approval.billing_payment bp ON ((bp.invoice_id = bi.invoice_id)))
  GROUP BY bi.invoice_id, bi.customer_code, bi.ym, bi.amount_yen;
  GROUP BY bi.invoice_id, bi.customer_code, bi.ym, bi.amount_yen;




--
--
-- Name: v_pending_approval_ui; Type: VIEW; Schema: approval; Owner: -
-- Name: v_pending_approval_ui; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_pending_approval_ui AS
CREATE VIEW approval.v_pending_approval_ui AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    entity_id AS order_no,
    entity_id AS order_no,
    order_id,
    order_id,
    reason,
    reason,
    detected_at
    detected_at
   FROM audit.approval_request
   FROM audit.approval_request
  WHERE (status = 'pending'::text);
  WHERE (status = 'pending'::text);




--
--
-- Name: v_pmloop_restart_target; Type: VIEW; Schema: approval; Owner: -
-- Name: v_pmloop_restart_target; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_pmloop_restart_target AS
CREATE VIEW approval.v_pmloop_restart_target AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    order_id,
    order_id,
    decided_at
    decided_at
   FROM audit.approval_request
   FROM audit.approval_request
  WHERE (status = 'approved'::text);
  WHERE (status = 'approved'::text);




--
--
-- Name: v_policy_ab_test; Type: VIEW; Schema: approval; Owner: -
-- Name: v_policy_ab_test; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_policy_ab_test AS
CREATE VIEW approval.v_policy_ab_test AS
 SELECT ar.policy_id,
 SELECT ar.policy_id,
    avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) FILTER (WHERE (ar.detected_at < ap.created_at)) AS avg_sla_before,
    avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) FILTER (WHERE (ar.detected_at < ap.created_at)) AS avg_sla_before,
    avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) FILTER (WHERE (ar.detected_at >= ap.created_at)) AS avg_sla_after
    avg((EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0)) FILTER (WHERE (ar.detected_at >= ap.created_at)) AS avg_sla_after
   FROM (audit.approval_request ar
   FROM (audit.approval_request ar
     JOIN approval.policy_auto_generated ap ON ((ap.source_policy_id = ar.policy_id)))
     JOIN approval.policy_auto_generated ap ON ((ap.source_policy_id = ar.policy_id)))
  WHERE ((ar.status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (ar.decided_at IS NOT NULL))
  WHERE ((ar.status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (ar.decided_at IS NOT NULL))
  GROUP BY ar.policy_id;
  GROUP BY ar.policy_id;




--
--
-- Name: v_policy_eval_auto_ok; Type: VIEW; Schema: approval; Owner: -
-- Name: v_policy_eval_auto_ok; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_policy_eval_auto_ok AS
CREATE VIEW approval.v_policy_eval_auto_ok AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    order_id,
    order_id,
    entity_id,
    entity_id,
    auto_policy_id,
    auto_policy_id,
    'ok'::text AS outcome
    'ok'::text AS outcome
   FROM approval.v_ai_rule_applicable_order;
   FROM approval.v_ai_rule_applicable_order;




--
--
-- Name: v_policy_roi_yen; Type: VIEW; Schema: approval; Owner: -
-- Name: v_policy_roi_yen; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_policy_roi_yen AS
CREATE VIEW approval.v_policy_roi_yen AS
 SELECT roi.auto_policy_id,
 SELECT roi.auto_policy_id,
    roi.policy_id,
    roi.policy_id,
    roi.savings_minutes_total,
    roi.savings_minutes_total,
    cc.cost_per_hour,
    cc.cost_per_hour,
    ((roi.savings_minutes_total / 60.0) * cc.cost_per_hour) AS savings_yen
    ((roi.savings_minutes_total / 60.0) * cc.cost_per_hour) AS savings_yen
   FROM ((approval.v_policy_roi roi
   FROM ((approval.v_policy_roi roi
     JOIN approval.policy_rollout pr ON ((pr.auto_policy_id = roi.auto_policy_id)))
     JOIN approval.policy_rollout pr ON ((pr.auto_policy_id = roi.auto_policy_id)))
     JOIN approval.company_cost cc ON ((cc.company_id = pr.company_id)));
     JOIN approval.company_cost cc ON ((cc.company_id = pr.company_id)));




--
--
-- Name: v_public_pricing_export; Type: VIEW; Schema: approval; Owner: -
-- Name: v_public_pricing_export; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_public_pricing_export AS
CREATE VIEW approval.v_public_pricing_export AS
 SELECT plan_code,
 SELECT plan_code,
    plan_name,
    plan_name,
    monthly_yen,
    monthly_yen,
    description,
    description,
    features
    features
   FROM approval.public_pricing;
   FROM approval.public_pricing;




--
--
-- Name: v_roi_report_export; Type: VIEW; Schema: approval; Owner: -
-- Name: v_roi_report_export; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_roi_report_export AS
CREATE VIEW approval.v_roi_report_export AS
 SELECT month,
 SELECT month,
    company_id,
    company_id,
    policy_id,
    policy_id,
    savings_minutes,
    savings_minutes,
    cost_per_hour,
    cost_per_hour,
    savings_yen
    savings_yen
   FROM approval.v_monthly_roi_report;
   FROM approval.v_monthly_roi_report;




--
--
-- Name: v_saas_kpi_company; Type: VIEW; Schema: approval; Owner: -
-- Name: v_saas_kpi_company; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_saas_kpi_company AS
CREATE VIEW approval.v_saas_kpi_company AS
 SELECT company_id,
 SELECT company_id,
    (date_trunc('month'::text, (day)::timestamp with time zone))::date AS month,
    (date_trunc('month'::text, (day)::timestamp with time zone))::date AS month,
    sum(approvals) AS approvals,
    sum(approvals) AS approvals,
    sum(auto_approves) AS auto_approves,
    sum(auto_approves) AS auto_approves,
    sum(rollbacks) AS rollbacks
    sum(rollbacks) AS rollbacks
   FROM approval.saas_usage_daily u
   FROM approval.saas_usage_daily u
  GROUP BY company_id, ((date_trunc('month'::text, (day)::timestamp with time zone))::date);
  GROUP BY company_id, ((date_trunc('month'::text, (day)::timestamp with time zone))::date);




--
--
-- Name: v_saas_limit_status; Type: VIEW; Schema: approval; Owner: -
-- Name: v_saas_limit_status; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_saas_limit_status AS
CREATE VIEW approval.v_saas_limit_status AS
 SELECT s.subscription_id,
 SELECT s.subscription_id,
    s.plan_code,
    s.plan_code,
    l.max_companies,
    l.max_companies,
    l.max_approvals_mo,
    l.max_approvals_mo,
    count(DISTINCT scm.company_id) AS used_companies,
    count(DISTINCT scm.company_id) AS used_companies,
    COALESCE(u.approvals_count, 0) AS used_approvals
    COALESCE(u.approvals_count, 0) AS used_approvals
   FROM (((approval.saas_subscription s
   FROM (((approval.saas_subscription s
     JOIN approval.saas_plan_limit l ON ((l.plan_code = s.plan_code)))
     JOIN approval.saas_plan_limit l ON ((l.plan_code = s.plan_code)))
     LEFT JOIN approval.saas_company_map scm ON ((scm.subscription_id = s.subscription_id)))
     LEFT JOIN approval.saas_company_map scm ON ((scm.subscription_id = s.subscription_id)))
     LEFT JOIN approval.saas_usage_monthly u ON (((u.subscription_id = s.subscription_id) AND (u.ym = to_char(now(), 'YYYYMM'::text)))))
     LEFT JOIN approval.saas_usage_monthly u ON (((u.subscription_id = s.subscription_id) AND (u.ym = to_char(now(), 'YYYYMM'::text)))))
  WHERE (s.status = 'active'::text)
  WHERE (s.status = 'active'::text)
  GROUP BY s.subscription_id, s.plan_code, l.max_companies, l.max_approvals_mo, u.approvals_count;
  GROUP BY s.subscription_id, s.plan_code, l.max_companies, l.max_approvals_mo, u.approvals_count;




--
--
-- Name: v_severity_escalation_target; Type: VIEW; Schema: approval; Owner: -
-- Name: v_severity_escalation_target; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_severity_escalation_target AS
CREATE VIEW approval.v_severity_escalation_target AS
 SELECT auto_policy_id,
 SELECT auto_policy_id,
    company_id,
    company_id,
    order_id,
    order_id,
    bad_reason,
    bad_reason,
    severity_escalated
    severity_escalated
   FROM approval.v_bad_candidate_audit_strict
   FROM approval.v_bad_candidate_audit_strict
  WHERE (severity_escalated = 'high'::text);
  WHERE (severity_escalated = 'high'::text);




--
--
-- Name: v_sla_distribution_monthly; Type: VIEW; Schema: approval; Owner: -
-- Name: v_sla_distribution_monthly; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_sla_distribution_monthly AS
CREATE VIEW approval.v_sla_distribution_monthly AS
 WITH s AS (
 WITH s AS (
         SELECT (date_trunc('month'::text, ar.decided_at))::date AS month,
         SELECT (date_trunc('month'::text, ar.decided_at))::date AS month,
            pr.company_id,
            pr.company_id,
            (EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0) AS sla_minutes
            (EXTRACT(epoch FROM (ar.decided_at - ar.detected_at)) / 60.0) AS sla_minutes
           FROM (audit.approval_request ar
           FROM (audit.approval_request ar
             JOIN approval.policy_rollout pr ON (((pr.auto_policy_id)::text = ar.policy_id)))
             JOIN approval.policy_rollout pr ON (((pr.auto_policy_id)::text = ar.policy_id)))
          WHERE (ar.decided_at IS NOT NULL)
          WHERE (ar.decided_at IS NOT NULL)
        ), b AS (
        ), b AS (
         SELECT s.month,
         SELECT s.month,
            s.company_id,
            s.company_id,
                CASE
                CASE
                    WHEN (s.sla_minutes < (5)::numeric) THEN '0-5'::text
                    WHEN (s.sla_minutes < (5)::numeric) THEN '0-5'::text
                    WHEN (s.sla_minutes < (15)::numeric) THEN '5-15'::text
                    WHEN (s.sla_minutes < (15)::numeric) THEN '5-15'::text
                    WHEN (s.sla_minutes < (30)::numeric) THEN '15-30'::text
                    WHEN (s.sla_minutes < (30)::numeric) THEN '15-30'::text
                    WHEN (s.sla_minutes < (60)::numeric) THEN '30-60'::text
                    WHEN (s.sla_minutes < (60)::numeric) THEN '30-60'::text
                    ELSE '60+'::text
                    ELSE '60+'::text
                END AS sla_bin
                END AS sla_bin
           FROM s
           FROM s
        )
        )
 SELECT month,
 SELECT month,
    company_id,
    company_id,
    sla_bin,
    sla_bin,
    count(*) AS cnt
    count(*) AS cnt
   FROM b
   FROM b
  GROUP BY month, company_id, sla_bin;
  GROUP BY month, company_id, sla_bin;




--
--
-- Name: v_sla_escalation; Type: VIEW; Schema: approval; Owner: -
-- Name: v_sla_escalation; Type: VIEW; Schema: approval; Owner: -
--
--


CREATE VIEW approval.v_sla_escalation AS
CREATE VIEW approval.v_sla_escalation AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    policy_id,
    policy_id,
    severity,
    severity,
    (EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0) AS sla_minutes
    (EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0) AS sla_minutes
   FROM audit.approval_request ar
   FROM audit.approval_request ar
  WHERE ((status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (decided_at IS NOT NULL) AND ((EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0) > (90)::numeric));
  WHERE ((status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (decided_at IS NOT NULL) AND ((EXTRACT(epoch FROM (decided_at - detected_at)) / 60.0) > (90)::numeric));




--
--
-- Name: approval_notify_queue; Type: TABLE; Schema: audit; Owner: -
-- Name: approval_notify_queue; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.approval_notify_queue (
CREATE TABLE audit.approval_notify_queue (
    notify_id uuid DEFAULT gen_random_uuid() NOT NULL,
    notify_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    request_id uuid NOT NULL,
    payload jsonb NOT NULL,
    payload jsonb NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    last_error text,
    last_error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    sent_at timestamp with time zone
    sent_at timestamp with time zone
);
);




--
--
-- Name: approval_reason_template; Type: TABLE; Schema: audit; Owner: -
-- Name: approval_reason_template; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.approval_reason_template (
CREATE TABLE audit.approval_reason_template (
    template_id uuid DEFAULT gen_random_uuid() NOT NULL,
    template_id uuid DEFAULT gen_random_uuid() NOT NULL,
    domain text NOT NULL,
    domain text NOT NULL,
    template_ja text NOT NULL,
    template_ja text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: audit_event; Type: TABLE; Schema: audit; Owner: -
-- Name: audit_event; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.audit_event (
CREATE TABLE audit.audit_event (
    audit_event_id bigint NOT NULL,
    audit_event_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    occurred_at timestamp with time zone NOT NULL,
    occurred_at timestamp with time zone NOT NULL,
    recorded_at timestamp with time zone DEFAULT now() NOT NULL,
    recorded_at timestamp with time zone DEFAULT now() NOT NULL,
    business_domain text NOT NULL,
    business_domain text NOT NULL,
    event_key text NOT NULL,
    event_key text NOT NULL,
    task_name text,
    task_name text,
    audit_scope text NOT NULL,
    audit_scope text NOT NULL,
    severity text NOT NULL,
    severity text NOT NULL,
    reason_code text NOT NULL,
    reason_code text NOT NULL,
    approval_required boolean DEFAULT false NOT NULL,
    approval_required boolean DEFAULT false NOT NULL,
    approved_by uuid,
    approved_by uuid,
    approved_at timestamp with time zone,
    approved_at timestamp with time zone,
    context jsonb DEFAULT '{}'::jsonb NOT NULL,
    context jsonb DEFAULT '{}'::jsonb NOT NULL,
    CONSTRAINT audit_event_audit_scope_check CHECK ((audit_scope = ANY (ARRAY['internal'::text, 'external'::text, 'both'::text]))),
    CONSTRAINT audit_event_audit_scope_check CHECK ((audit_scope = ANY (ARRAY['internal'::text, 'external'::text, 'both'::text]))),
    CONSTRAINT audit_event_severity_check CHECK ((severity = ANY (ARRAY['ok'::text, 'warn'::text, 'ng'::text, 'critical'::text])))
    CONSTRAINT audit_event_severity_check CHECK ((severity = ANY (ARRAY['ok'::text, 'warn'::text, 'ng'::text, 'critical'::text])))
);
);




--
--
-- Name: audit_event_audit_event_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
-- Name: audit_event_audit_event_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
--
--


CREATE SEQUENCE audit.audit_event_audit_event_id_seq
CREATE SEQUENCE audit.audit_event_audit_event_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_event_audit_event_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
-- Name: audit_event_audit_event_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
--
--


ALTER SEQUENCE audit.audit_event_audit_event_id_seq OWNED BY audit.audit_event.audit_event_id;
ALTER SEQUENCE audit.audit_event_audit_event_id_seq OWNED BY audit.audit_event.audit_event_id;




--
--
-- Name: audit_reason_policy; Type: TABLE; Schema: audit; Owner: -
-- Name: audit_reason_policy; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.audit_reason_policy (
CREATE TABLE audit.audit_reason_policy (
    reason_code text NOT NULL,
    reason_code text NOT NULL,
    default_severity text NOT NULL,
    default_severity text NOT NULL,
    approval_required boolean NOT NULL,
    approval_required boolean NOT NULL,
    auto_fix_allowed boolean NOT NULL,
    auto_fix_allowed boolean NOT NULL,
    quarantine_on_fail boolean NOT NULL,
    quarantine_on_fail boolean NOT NULL,
    description text NOT NULL,
    description text NOT NULL,
    CONSTRAINT audit_reason_policy_default_severity_check CHECK ((default_severity = ANY (ARRAY['ok'::text, 'warn'::text, 'ng'::text, 'critical'::text])))
    CONSTRAINT audit_reason_policy_default_severity_check CHECK ((default_severity = ANY (ARRAY['ok'::text, 'warn'::text, 'ng'::text, 'critical'::text])))
);
);




--
--
-- Name: audit_target_table; Type: TABLE; Schema: audit; Owner: -
-- Name: audit_target_table; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.audit_target_table (
CREATE TABLE audit.audit_target_table (
    table_schema text NOT NULL,
    table_schema text NOT NULL,
    table_name text NOT NULL,
    table_name text NOT NULL,
    audit_level text DEFAULT 'FULL'::text NOT NULL,
    audit_level text DEFAULT 'FULL'::text NOT NULL,
    audited_columns jsonb,
    audited_columns jsonb,
    reason text,
    reason text,
    decided_by text,
    decided_by text,
    decided_at timestamp with time zone DEFAULT now() NOT NULL,
    decided_at timestamp with time zone DEFAULT now() NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    CONSTRAINT audit_target_level_chk CHECK ((audit_level = ANY (ARRAY['FULL'::text, 'PARTIAL'::text, 'NONE'::text])))
    CONSTRAINT audit_target_level_chk CHECK ((audit_level = ANY (ARRAY['FULL'::text, 'PARTIAL'::text, 'NONE'::text])))
);
);




--
--
-- Name: audit_trail_db; Type: TABLE; Schema: audit; Owner: -
-- Name: audit_trail_db; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.audit_trail_db (
CREATE TABLE audit.audit_trail_db (
    audit_trail_db_id bigint NOT NULL,
    audit_trail_db_id bigint NOT NULL,
    company_id uuid,
    company_id uuid,
    table_schema text NOT NULL,
    table_schema text NOT NULL,
    table_name text NOT NULL,
    table_name text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    pk jsonb,
    pk jsonb,
    row_before jsonb,
    row_before jsonb,
    row_after jsonb,
    row_after jsonb,
    changed_columns jsonb,
    changed_columns jsonb,
    actor text,
    actor text,
    request_id uuid,
    request_id uuid,
    txid bigint DEFAULT txid_current() NOT NULL,
    txid bigint DEFAULT txid_current() NOT NULL,
    occurred_at timestamp with time zone DEFAULT now() NOT NULL
    occurred_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: audit_trail_db_audit_trail_db_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
-- Name: audit_trail_db_audit_trail_db_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
--
--


CREATE SEQUENCE audit.audit_trail_db_audit_trail_db_id_seq
CREATE SEQUENCE audit.audit_trail_db_audit_trail_db_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_trail_db_audit_trail_db_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
-- Name: audit_trail_db_audit_trail_db_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
--
--


ALTER SEQUENCE audit.audit_trail_db_audit_trail_db_id_seq OWNED BY audit.audit_trail_db.audit_trail_db_id;
ALTER SEQUENCE audit.audit_trail_db_audit_trail_db_id_seq OWNED BY audit.audit_trail_db.audit_trail_db_id;




--
--
-- Name: entity_status_history; Type: TABLE; Schema: audit; Owner: -
-- Name: entity_status_history; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.entity_status_history (
CREATE TABLE audit.entity_status_history (
    status_history_id bigint NOT NULL,
    status_history_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id bigint NOT NULL,
    entity_id bigint NOT NULL,
    status_code text NOT NULL,
    status_code text NOT NULL,
    status_name text,
    status_name text,
    reason text,
    reason text,
    changed_by uuid,
    changed_by uuid,
    changed_at timestamp with time zone DEFAULT now() NOT NULL,
    changed_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT entity_status_history_entity_type_check CHECK ((entity_type = ANY (ARRAY['quotation'::text, 'order'::text, 'shipping'::text, 'billing'::text, 'return'::text])))
    CONSTRAINT entity_status_history_entity_type_check CHECK ((entity_type = ANY (ARRAY['quotation'::text, 'order'::text, 'shipping'::text, 'billing'::text, 'return'::text])))
);
);




--
--
-- Name: entity_status_history_status_history_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
-- Name: entity_status_history_status_history_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
--
--


CREATE SEQUENCE audit.entity_status_history_status_history_id_seq
CREATE SEQUENCE audit.entity_status_history_status_history_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: entity_status_history_status_history_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
-- Name: entity_status_history_status_history_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
--
--


ALTER SEQUENCE audit.entity_status_history_status_history_id_seq OWNED BY audit.entity_status_history.status_history_id;
ALTER SEQUENCE audit.entity_status_history_status_history_id_seq OWNED BY audit.entity_status_history.status_history_id;




--
--
-- Name: exec_audit_event; Type: TABLE; Schema: audit; Owner: -
-- Name: exec_audit_event; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.exec_audit_event (
CREATE TABLE audit.exec_audit_event (
    audit_event_id bigint NOT NULL,
    audit_event_id bigint NOT NULL,
    request_id bigint,
    request_id bigint,
    event_type text NOT NULL,
    event_type text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT exec_audit_event_event_type_check CHECK ((event_type = ANY (ARRAY['ENQUEUE'::text, 'PICK'::text, 'DONE'::text, 'FAILED'::text])))
    CONSTRAINT exec_audit_event_event_type_check CHECK ((event_type = ANY (ARRAY['ENQUEUE'::text, 'PICK'::text, 'DONE'::text, 'FAILED'::text])))
);
);




--
--
-- Name: exec_audit_event_audit_event_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
-- Name: exec_audit_event_audit_event_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
--
--


CREATE SEQUENCE audit.exec_audit_event_audit_event_id_seq
CREATE SEQUENCE audit.exec_audit_event_audit_event_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: exec_audit_event_audit_event_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
-- Name: exec_audit_event_audit_event_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
--
--


ALTER SEQUENCE audit.exec_audit_event_audit_event_id_seq OWNED BY audit.exec_audit_event.audit_event_id;
ALTER SEQUENCE audit.exec_audit_event_audit_event_id_seq OWNED BY audit.exec_audit_event.audit_event_id;




--
--
-- Name: ng_event_ng_event_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
-- Name: ng_event_ng_event_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
--
--


CREATE SEQUENCE audit.ng_event_ng_event_id_seq
CREATE SEQUENCE audit.ng_event_ng_event_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ng_event_ng_event_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
-- Name: ng_event_ng_event_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
--
--


ALTER SEQUENCE audit.ng_event_ng_event_id_seq OWNED BY audit.ng_event.ng_event_id;
ALTER SEQUENCE audit.ng_event_ng_event_id_seq OWNED BY audit.ng_event.ng_event_id;




--
--
-- Name: notification_channel; Type: TABLE; Schema: audit; Owner: -
-- Name: notification_channel; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.notification_channel (
CREATE TABLE audit.notification_channel (
    channel_id uuid DEFAULT gen_random_uuid() NOT NULL,
    channel_id uuid DEFAULT gen_random_uuid() NOT NULL,
    channel_type text NOT NULL,
    channel_type text NOT NULL,
    destination text NOT NULL,
    destination text NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ops_audit_log; Type: TABLE; Schema: audit; Owner: -
-- Name: ops_audit_log; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.ops_audit_log (
CREATE TABLE audit.ops_audit_log (
    audit_id bigint NOT NULL,
    audit_id bigint NOT NULL,
    job_id bigint,
    job_id bigint,
    event_type text NOT NULL,
    event_type text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    logged_at timestamp with time zone DEFAULT now() NOT NULL
    logged_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ops_audit_log_audit_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
-- Name: ops_audit_log_audit_id_seq; Type: SEQUENCE; Schema: audit; Owner: -
--
--


CREATE SEQUENCE audit.ops_audit_log_audit_id_seq
CREATE SEQUENCE audit.ops_audit_log_audit_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ops_audit_log_audit_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
-- Name: ops_audit_log_audit_id_seq; Type: SEQUENCE OWNED BY; Schema: audit; Owner: -
--
--


ALTER SEQUENCE audit.ops_audit_log_audit_id_seq OWNED BY audit.ops_audit_log.audit_id;
ALTER SEQUENCE audit.ops_audit_log_audit_id_seq OWNED BY audit.ops_audit_log.audit_id;




--
--
-- Name: slack_interaction_log; Type: TABLE; Schema: audit; Owner: -
-- Name: slack_interaction_log; Type: TABLE; Schema: audit; Owner: -
--
--


CREATE TABLE audit.slack_interaction_log (
CREATE TABLE audit.slack_interaction_log (
    interaction_id uuid DEFAULT gen_random_uuid() NOT NULL,
    interaction_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    request_id uuid NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    actor text NOT NULL,
    actor text NOT NULL,
    payload jsonb NOT NULL,
    payload jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_audit_target_suggestions; Type: VIEW; Schema: audit; Owner: -
-- Name: v_audit_target_suggestions; Type: VIEW; Schema: audit; Owner: -
--
--


CREATE VIEW audit.v_audit_target_suggestions AS
CREATE VIEW audit.v_audit_target_suggestions AS
 WITH cols AS (
 WITH cols AS (
         SELECT c.table_schema,
         SELECT c.table_schema,
            c.table_name,
            c.table_name,
            bool_or(((c.column_name)::name = 'company_id'::name)) AS has_company_id,
            bool_or(((c.column_name)::name = 'company_id'::name)) AS has_company_id,
            bool_or(((c.column_name)::name ~* '(amount|price|cost|fee|tax|total|balance)'::text)) AS has_money,
            bool_or(((c.column_name)::name ~* '(amount|price|cost|fee|tax|total|balance)'::text)) AS has_money,
            bool_or(((c.column_name)::name ~* '(qty|quantity|stock|inventory)'::text)) AS has_qty,
            bool_or(((c.column_name)::name ~* '(qty|quantity|stock|inventory)'::text)) AS has_qty,
            bool_or(((c.column_name)::name ~* '(status|state|approved|approval|closed|posted|confirmed|shipped|paid)'::text)) AS has_status,
            bool_or(((c.column_name)::name ~* '(status|state|approved|approval|closed|posted|confirmed|shipped|paid)'::text)) AS has_status,
            count(*) FILTER (WHERE ((c.column_name)::name ~* '(created_at|updated_at|deleted_at)'::text)) AS ts_cols
            count(*) FILTER (WHERE ((c.column_name)::name ~* '(created_at|updated_at|deleted_at)'::text)) AS ts_cols
           FROM information_schema.columns c
           FROM information_schema.columns c
          WHERE ((c.table_schema)::name <> ALL (ARRAY['pg_catalog'::name, 'information_schema'::name]))
          WHERE ((c.table_schema)::name <> ALL (ARRAY['pg_catalog'::name, 'information_schema'::name]))
          GROUP BY c.table_schema, c.table_name
          GROUP BY c.table_schema, c.table_name
        ), fks AS (
        ), fks AS (
         SELECT tc.table_schema,
         SELECT tc.table_schema,
            tc.table_name,
            tc.table_name,
            count(*) AS fk_count
            count(*) AS fk_count
           FROM information_schema.table_constraints tc
           FROM information_schema.table_constraints tc
          WHERE (((tc.constraint_type)::text = 'FOREIGN KEY'::text) AND ((tc.table_schema)::name <> ALL (ARRAY['pg_catalog'::name, 'information_schema'::name])))
          WHERE (((tc.constraint_type)::text = 'FOREIGN KEY'::text) AND ((tc.table_schema)::name <> ALL (ARRAY['pg_catalog'::name, 'information_schema'::name])))
          GROUP BY tc.table_schema, tc.table_name
          GROUP BY tc.table_schema, tc.table_name
        ), base AS (
        ), base AS (
         SELECT cols.table_schema,
         SELECT cols.table_schema,
            cols.table_name,
            cols.table_name,
            cols.has_company_id,
            cols.has_company_id,
            cols.has_money,
            cols.has_money,
            cols.has_qty,
            cols.has_qty,
            cols.has_status,
            cols.has_status,
            cols.ts_cols,
            cols.ts_cols,
            COALESCE(fks.fk_count, (0)::bigint) AS fk_count
            COALESCE(fks.fk_count, (0)::bigint) AS fk_count
           FROM (cols
           FROM (cols
             LEFT JOIN fks ON ((((fks.table_schema)::name = (cols.table_schema)::name) AND ((fks.table_name)::name = (cols.table_name)::name))))
             LEFT JOIN fks ON ((((fks.table_schema)::name = (cols.table_schema)::name) AND ((fks.table_name)::name = (cols.table_name)::name))))
        )
        )
 SELECT table_schema,
 SELECT table_schema,
    table_name,
    table_name,
    has_company_id,
    has_company_id,
    has_money,
    has_money,
    has_qty,
    has_qty,
    has_status,
    has_status,
    fk_count,
    fk_count,
    ((((
    ((((
        CASE
        CASE
            WHEN has_company_id THEN 2
            WHEN has_company_id THEN 2
            ELSE 0
            ELSE 0
        END +
        END +
        CASE
        CASE
            WHEN has_money THEN 3
            WHEN has_money THEN 3
            ELSE 0
            ELSE 0
        END) +
        END) +
        CASE
        CASE
            WHEN has_qty THEN 2
            WHEN has_qty THEN 2
            ELSE 0
            ELSE 0
        END) +
        END) +
        CASE
        CASE
            WHEN has_status THEN 3
            WHEN has_status THEN 3
            ELSE 0
            ELSE 0
        END) + LEAST(fk_count, (5)::bigint)) AS score,
        END) + LEAST(fk_count, (5)::bigint)) AS score,
        CASE
        CASE
            WHEN (((
            WHEN (((
            CASE
            CASE
                WHEN has_company_id THEN 2
                WHEN has_company_id THEN 2
                ELSE 0
                ELSE 0
            END +
            END +
            CASE
            CASE
                WHEN has_money THEN 3
                WHEN has_money THEN 3
                ELSE 0
                ELSE 0
            END) +
            END) +
            CASE
            CASE
                WHEN has_status THEN 3
                WHEN has_status THEN 3
                ELSE 0
                ELSE 0
            END) >= 6) THEN 'FULL'::text
            END) >= 6) THEN 'FULL'::text
            WHEN (((
            WHEN (((
            CASE
            CASE
                WHEN has_company_id THEN 2
                WHEN has_company_id THEN 2
                ELSE 0
                ELSE 0
            END +
            END +
            CASE
            CASE
                WHEN has_qty THEN 2
                WHEN has_qty THEN 2
                ELSE 0
                ELSE 0
            END) +
            END) +
            CASE
            CASE
                WHEN has_status THEN 3
                WHEN has_status THEN 3
                ELSE 0
                ELSE 0
            END) >= 5) THEN 'FULL'::text
            END) >= 5) THEN 'FULL'::text
            WHEN (
            WHEN (
            CASE
            CASE
                WHEN has_company_id THEN 2
                WHEN has_company_id THEN 2
                ELSE 0
                ELSE 0
            END >= 2) THEN 'PARTIAL'::text
            END >= 2) THEN 'PARTIAL'::text
            ELSE 'NONE'::text
            ELSE 'NONE'::text
        END AS suggested_level
        END AS suggested_level
   FROM base
   FROM base
  ORDER BY ((((
  ORDER BY ((((
        CASE
        CASE
            WHEN has_company_id THEN 2
            WHEN has_company_id THEN 2
            ELSE 0
            ELSE 0
        END +
        END +
        CASE
        CASE
            WHEN has_money THEN 3
            WHEN has_money THEN 3
            ELSE 0
            ELSE 0
        END) +
        END) +
        CASE
        CASE
            WHEN has_qty THEN 2
            WHEN has_qty THEN 2
            ELSE 0
            ELSE 0
        END) +
        END) +
        CASE
        CASE
            WHEN has_status THEN 3
            WHEN has_status THEN 3
            ELSE 0
            ELSE 0
        END) + LEAST(fk_count, (5)::bigint)) DESC, table_schema, table_name;
        END) + LEAST(fk_count, (5)::bigint)) DESC, table_schema, table_name;




--
--
-- Name: v_external_audit_events; Type: VIEW; Schema: audit; Owner: -
-- Name: v_external_audit_events; Type: VIEW; Schema: audit; Owner: -
--
--


CREATE VIEW audit.v_external_audit_events AS
CREATE VIEW audit.v_external_audit_events AS
 SELECT occurred_at,
 SELECT occurred_at,
    business_domain,
    business_domain,
    event_key,
    event_key,
    severity,
    severity,
    reason_code,
    reason_code,
    approval_required,
    approval_required,
    (approved_at IS NOT NULL) AS approved,
    (approved_at IS NOT NULL) AS approved,
    (context ->> 'auto_fixed'::text) AS auto_fixed,
    (context ->> 'auto_fixed'::text) AS auto_fixed,
    (context ->> 'quarantined'::text) AS quarantined
    (context ->> 'quarantined'::text) AS quarantined
   FROM audit.audit_event
   FROM audit.audit_event
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]));
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]));




--
--
-- Name: VIEW v_external_audit_events; Type: COMMENT; Schema: audit; Owner: -
-- Name: VIEW v_external_audit_events; Type: COMMENT; Schema: audit; Owner: -
--
--


COMMENT ON VIEW audit.v_external_audit_events IS 'External audit view for third parties (non-technical).';
COMMENT ON VIEW audit.v_external_audit_events IS 'External audit view for third parties (non-technical).';




--
--
-- Name: v_external_audit_kpi_by_industry; Type: VIEW; Schema: audit; Owner: -
-- Name: v_external_audit_kpi_by_industry; Type: VIEW; Schema: audit; Owner: -
--
--


CREATE VIEW audit.v_external_audit_kpi_by_industry AS
CREATE VIEW audit.v_external_audit_kpi_by_industry AS
 SELECT business_domain,
 SELECT business_domain,
    severity,
    severity,
    count(*) AS event_count,
    count(*) AS event_count,
    count(*) FILTER (WHERE (approved_at IS NOT NULL)) AS approved_count,
    count(*) FILTER (WHERE (approved_at IS NOT NULL)) AS approved_count,
    count(*) FILTER (WHERE (((context ->> 'quarantined'::text))::boolean = true)) AS quarantined_count,
    count(*) FILTER (WHERE (((context ->> 'quarantined'::text))::boolean = true)) AS quarantined_count,
    max(occurred_at) AS last_occurred_at
    max(occurred_at) AS last_occurred_at
   FROM audit.audit_event
   FROM audit.audit_event
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]))
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]))
  GROUP BY business_domain, severity;
  GROUP BY business_domain, severity;




--
--
-- Name: VIEW v_external_audit_kpi_by_industry; Type: COMMENT; Schema: audit; Owner: -
-- Name: VIEW v_external_audit_kpi_by_industry; Type: COMMENT; Schema: audit; Owner: -
--
--


COMMENT ON VIEW audit.v_external_audit_kpi_by_industry IS 'External audit KPI by industry/domain.';
COMMENT ON VIEW audit.v_external_audit_kpi_by_industry IS 'External audit KPI by industry/domain.';




--
--
-- Name: v_external_audit_kpi_monthly_trend; Type: VIEW; Schema: audit; Owner: -
-- Name: v_external_audit_kpi_monthly_trend; Type: VIEW; Schema: audit; Owner: -
--
--


CREATE VIEW audit.v_external_audit_kpi_monthly_trend AS
CREATE VIEW audit.v_external_audit_kpi_monthly_trend AS
 SELECT business_domain,
 SELECT business_domain,
    date_trunc('month'::text, occurred_at) AS month,
    date_trunc('month'::text, occurred_at) AS month,
    severity,
    severity,
    count(*) AS event_count,
    count(*) AS event_count,
    count(*) FILTER (WHERE (approved_at IS NOT NULL)) AS approved_count,
    count(*) FILTER (WHERE (approved_at IS NOT NULL)) AS approved_count,
    count(*) FILTER (WHERE (((context ->> 'quarantined'::text))::boolean = true)) AS quarantined_count
    count(*) FILTER (WHERE (((context ->> 'quarantined'::text))::boolean = true)) AS quarantined_count
   FROM audit.audit_event
   FROM audit.audit_event
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]))
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]))
  GROUP BY business_domain, (date_trunc('month'::text, occurred_at)), severity;
  GROUP BY business_domain, (date_trunc('month'::text, occurred_at)), severity;




--
--
-- Name: VIEW v_external_audit_kpi_monthly_trend; Type: COMMENT; Schema: audit; Owner: -
-- Name: VIEW v_external_audit_kpi_monthly_trend; Type: COMMENT; Schema: audit; Owner: -
--
--


COMMENT ON VIEW audit.v_external_audit_kpi_monthly_trend IS 'External audit monthly KPI trend by business domain.';
COMMENT ON VIEW audit.v_external_audit_kpi_monthly_trend IS 'External audit monthly KPI trend by business domain.';




--
--
-- Name: v_external_audit_kpi_summary; Type: VIEW; Schema: audit; Owner: -
-- Name: v_external_audit_kpi_summary; Type: VIEW; Schema: audit; Owner: -
--
--


CREATE VIEW audit.v_external_audit_kpi_summary AS
CREATE VIEW audit.v_external_audit_kpi_summary AS
 SELECT business_domain,
 SELECT business_domain,
    severity,
    severity,
    count(*) AS event_count,
    count(*) AS event_count,
    count(*) FILTER (WHERE (approved_at IS NOT NULL)) AS approved_count,
    count(*) FILTER (WHERE (approved_at IS NOT NULL)) AS approved_count,
    max(occurred_at) AS last_occurred_at
    max(occurred_at) AS last_occurred_at
   FROM audit.audit_event
   FROM audit.audit_event
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]))
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]))
  GROUP BY business_domain, severity;
  GROUP BY business_domain, severity;




--
--
-- Name: v_external_audit_kpi_weekly_trend; Type: VIEW; Schema: audit; Owner: -
-- Name: v_external_audit_kpi_weekly_trend; Type: VIEW; Schema: audit; Owner: -
--
--


CREATE VIEW audit.v_external_audit_kpi_weekly_trend AS
CREATE VIEW audit.v_external_audit_kpi_weekly_trend AS
 SELECT business_domain,
 SELECT business_domain,
    date_trunc('week'::text, occurred_at) AS week,
    date_trunc('week'::text, occurred_at) AS week,
    severity,
    severity,
    count(*) AS event_count,
    count(*) AS event_count,
    count(*) FILTER (WHERE (approved_at IS NOT NULL)) AS approved_count,
    count(*) FILTER (WHERE (approved_at IS NOT NULL)) AS approved_count,
    count(*) FILTER (WHERE (((context ->> 'quarantined'::text))::boolean = true)) AS quarantined_count
    count(*) FILTER (WHERE (((context ->> 'quarantined'::text))::boolean = true)) AS quarantined_count
   FROM audit.audit_event
   FROM audit.audit_event
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]))
  WHERE (audit_scope = ANY (ARRAY['external'::text, 'both'::text]))
  GROUP BY business_domain, (date_trunc('week'::text, occurred_at)), severity;
  GROUP BY business_domain, (date_trunc('week'::text, occurred_at)), severity;




--
--
-- Name: VIEW v_external_audit_kpi_weekly_trend; Type: COMMENT; Schema: audit; Owner: -
-- Name: VIEW v_external_audit_kpi_weekly_trend; Type: COMMENT; Schema: audit; Owner: -
--
--


COMMENT ON VIEW audit.v_external_audit_kpi_weekly_trend IS 'External audit weekly KPI trend by business domain.';
COMMENT ON VIEW audit.v_external_audit_kpi_weekly_trend IS 'External audit weekly KPI trend by business domain.';




--
--
-- Name: audit_log_entries; Type: TABLE; Schema: auth; Owner: -
-- Name: audit_log_entries; Type: TABLE; Schema: auth; Owner: -
--
--


    instance_id uuid,
    instance_id uuid,
    id uuid NOT NULL,
    id uuid NOT NULL,
    payload json,
    payload json,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    ip_address character varying(64) DEFAULT ''::character varying NOT NULL
    ip_address character varying(64) DEFAULT ''::character varying NOT NULL
);
);




--
--
-- Name: TABLE audit_log_entries; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE audit_log_entries; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.audit_log_entries IS 'Auth: Audit trail for user actions.';
COMMENT ON TABLE auth.audit_log_entries IS 'Auth: Audit trail for user actions.';




--
--
-- Name: flow_state; Type: TABLE; Schema: auth; Owner: -
-- Name: flow_state; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    user_id uuid,
    user_id uuid,
    auth_code text NOT NULL,
    auth_code text NOT NULL,
    code_challenge_method auth.code_challenge_method NOT NULL,
    code_challenge_method auth.code_challenge_method NOT NULL,
    code_challenge text NOT NULL,
    code_challenge text NOT NULL,
    provider_type text NOT NULL,
    provider_type text NOT NULL,
    provider_access_token text,
    provider_access_token text,
    provider_refresh_token text,
    provider_refresh_token text,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    authentication_method text NOT NULL,
    authentication_method text NOT NULL,
    auth_code_issued_at timestamp with time zone
    auth_code_issued_at timestamp with time zone
);
);




--
--
-- Name: TABLE flow_state; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE flow_state; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.flow_state IS 'stores metadata for pkce logins';
COMMENT ON TABLE auth.flow_state IS 'stores metadata for pkce logins';




--
--
-- Name: identities; Type: TABLE; Schema: auth; Owner: -
-- Name: identities; Type: TABLE; Schema: auth; Owner: -
--
--


    provider_id text NOT NULL,
    provider_id text NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    identity_data jsonb NOT NULL,
    identity_data jsonb NOT NULL,
    provider text NOT NULL,
    provider text NOT NULL,
    last_sign_in_at timestamp with time zone,
    last_sign_in_at timestamp with time zone,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    email text GENERATED ALWAYS AS (lower((identity_data ->> 'email'::text))) STORED,
    email text GENERATED ALWAYS AS (lower((identity_data ->> 'email'::text))) STORED,
    id uuid DEFAULT gen_random_uuid() NOT NULL
    id uuid DEFAULT gen_random_uuid() NOT NULL
);
);




--
--
-- Name: TABLE identities; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE identities; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.identities IS 'Auth: Stores identities associated to a user.';
COMMENT ON TABLE auth.identities IS 'Auth: Stores identities associated to a user.';




--
--
-- Name: COLUMN identities.email; Type: COMMENT; Schema: auth; Owner: -
-- Name: COLUMN identities.email; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON COLUMN auth.identities.email IS 'Auth: Email is a generated column that references the optional email property in the identity_data';
COMMENT ON COLUMN auth.identities.email IS 'Auth: Email is a generated column that references the optional email property in the identity_data';




--
--
-- Name: instances; Type: TABLE; Schema: auth; Owner: -
-- Name: instances; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    uuid uuid,
    uuid uuid,
    raw_base_config text,
    raw_base_config text,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone
    updated_at timestamp with time zone
);
);




--
--
-- Name: TABLE instances; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE instances; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.instances IS 'Auth: Manages users across multiple sites.';
COMMENT ON TABLE auth.instances IS 'Auth: Manages users across multiple sites.';




--
--
-- Name: mfa_amr_claims; Type: TABLE; Schema: auth; Owner: -
-- Name: mfa_amr_claims; Type: TABLE; Schema: auth; Owner: -
--
--


    session_id uuid NOT NULL,
    session_id uuid NOT NULL,
    created_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    authentication_method text NOT NULL,
    authentication_method text NOT NULL,
    id uuid NOT NULL
    id uuid NOT NULL
);
);




--
--
-- Name: TABLE mfa_amr_claims; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE mfa_amr_claims; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.mfa_amr_claims IS 'auth: stores authenticator method reference claims for multi factor authentication';
COMMENT ON TABLE auth.mfa_amr_claims IS 'auth: stores authenticator method reference claims for multi factor authentication';




--
--
-- Name: mfa_challenges; Type: TABLE; Schema: auth; Owner: -
-- Name: mfa_challenges; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    factor_id uuid NOT NULL,
    factor_id uuid NOT NULL,
    created_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone NOT NULL,
    verified_at timestamp with time zone,
    verified_at timestamp with time zone,
    ip_address inet NOT NULL,
    ip_address inet NOT NULL,
    otp_code text,
    otp_code text,
    web_authn_session_data jsonb
    web_authn_session_data jsonb
);
);




--
--
-- Name: TABLE mfa_challenges; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE mfa_challenges; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.mfa_challenges IS 'auth: stores metadata about challenge requests made';
COMMENT ON TABLE auth.mfa_challenges IS 'auth: stores metadata about challenge requests made';




--
--
-- Name: mfa_factors; Type: TABLE; Schema: auth; Owner: -
-- Name: mfa_factors; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    friendly_name text,
    friendly_name text,
    factor_type auth.factor_type NOT NULL,
    factor_type auth.factor_type NOT NULL,
    status auth.factor_status NOT NULL,
    status auth.factor_status NOT NULL,
    created_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    secret text,
    secret text,
    phone text,
    phone text,
    last_challenged_at timestamp with time zone,
    last_challenged_at timestamp with time zone,
    web_authn_credential jsonb,
    web_authn_credential jsonb,
    web_authn_aaguid uuid,
    web_authn_aaguid uuid,
    last_webauthn_challenge_data jsonb
    last_webauthn_challenge_data jsonb
);
);




--
--
-- Name: TABLE mfa_factors; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE mfa_factors; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.mfa_factors IS 'auth: stores metadata about factors';
COMMENT ON TABLE auth.mfa_factors IS 'auth: stores metadata about factors';




--
--
-- Name: COLUMN mfa_factors.last_webauthn_challenge_data; Type: COMMENT; Schema: auth; Owner: -
-- Name: COLUMN mfa_factors.last_webauthn_challenge_data; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON COLUMN auth.mfa_factors.last_webauthn_challenge_data IS 'Stores the latest WebAuthn challenge data including attestation/assertion for customer verification';
COMMENT ON COLUMN auth.mfa_factors.last_webauthn_challenge_data IS 'Stores the latest WebAuthn challenge data including attestation/assertion for customer verification';




--
--
-- Name: oauth_authorizations; Type: TABLE; Schema: auth; Owner: -
-- Name: oauth_authorizations; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    authorization_id text NOT NULL,
    authorization_id text NOT NULL,
    client_id uuid NOT NULL,
    client_id uuid NOT NULL,
    user_id uuid,
    user_id uuid,
    redirect_uri text NOT NULL,
    redirect_uri text NOT NULL,
    scope text NOT NULL,
    scope text NOT NULL,
    state text,
    state text,
    resource text,
    resource text,
    code_challenge text,
    code_challenge text,
    code_challenge_method auth.code_challenge_method,
    code_challenge_method auth.code_challenge_method,
    response_type auth.oauth_response_type DEFAULT 'code'::auth.oauth_response_type NOT NULL,
    response_type auth.oauth_response_type DEFAULT 'code'::auth.oauth_response_type NOT NULL,
    status auth.oauth_authorization_status DEFAULT 'pending'::auth.oauth_authorization_status NOT NULL,
    status auth.oauth_authorization_status DEFAULT 'pending'::auth.oauth_authorization_status NOT NULL,
    authorization_code text,
    authorization_code text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    expires_at timestamp with time zone DEFAULT (now() + '00:03:00'::interval) NOT NULL,
    expires_at timestamp with time zone DEFAULT (now() + '00:03:00'::interval) NOT NULL,
    approved_at timestamp with time zone,
    approved_at timestamp with time zone,
    nonce text,
    nonce text,
    CONSTRAINT oauth_authorizations_authorization_code_length CHECK ((char_length(authorization_code) <= 255)),
    CONSTRAINT oauth_authorizations_authorization_code_length CHECK ((char_length(authorization_code) <= 255)),
    CONSTRAINT oauth_authorizations_code_challenge_length CHECK ((char_length(code_challenge) <= 128)),
    CONSTRAINT oauth_authorizations_code_challenge_length CHECK ((char_length(code_challenge) <= 128)),
    CONSTRAINT oauth_authorizations_expires_at_future CHECK ((expires_at > created_at)),
    CONSTRAINT oauth_authorizations_expires_at_future CHECK ((expires_at > created_at)),
    CONSTRAINT oauth_authorizations_nonce_length CHECK ((char_length(nonce) <= 255)),
    CONSTRAINT oauth_authorizations_nonce_length CHECK ((char_length(nonce) <= 255)),
    CONSTRAINT oauth_authorizations_redirect_uri_length CHECK ((char_length(redirect_uri) <= 2048)),
    CONSTRAINT oauth_authorizations_redirect_uri_length CHECK ((char_length(redirect_uri) <= 2048)),
    CONSTRAINT oauth_authorizations_resource_length CHECK ((char_length(resource) <= 2048)),
    CONSTRAINT oauth_authorizations_resource_length CHECK ((char_length(resource) <= 2048)),
    CONSTRAINT oauth_authorizations_scope_length CHECK ((char_length(scope) <= 4096)),
    CONSTRAINT oauth_authorizations_scope_length CHECK ((char_length(scope) <= 4096)),
    CONSTRAINT oauth_authorizations_state_length CHECK ((char_length(state) <= 4096))
    CONSTRAINT oauth_authorizations_state_length CHECK ((char_length(state) <= 4096))
);
);




--
--
-- Name: oauth_client_states; Type: TABLE; Schema: auth; Owner: -
-- Name: oauth_client_states; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    provider_type text NOT NULL,
    provider_type text NOT NULL,
    code_verifier text,
    code_verifier text,
    created_at timestamp with time zone NOT NULL
    created_at timestamp with time zone NOT NULL
);
);




--
--
-- Name: TABLE oauth_client_states; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE oauth_client_states; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.oauth_client_states IS 'Stores OAuth states for third-party provider authentication flows where Supabase acts as the OAuth client.';
COMMENT ON TABLE auth.oauth_client_states IS 'Stores OAuth states for third-party provider authentication flows where Supabase acts as the OAuth client.';




--
--
-- Name: oauth_clients; Type: TABLE; Schema: auth; Owner: -
-- Name: oauth_clients; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    client_secret_hash text,
    client_secret_hash text,
    registration_type auth.oauth_registration_type NOT NULL,
    registration_type auth.oauth_registration_type NOT NULL,
    redirect_uris text NOT NULL,
    redirect_uris text NOT NULL,
    grant_types text NOT NULL,
    grant_types text NOT NULL,
    client_name text,
    client_name text,
    client_uri text,
    client_uri text,
    logo_uri text,
    logo_uri text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    deleted_at timestamp with time zone,
    client_type auth.oauth_client_type DEFAULT 'confidential'::auth.oauth_client_type NOT NULL,
    client_type auth.oauth_client_type DEFAULT 'confidential'::auth.oauth_client_type NOT NULL,
    CONSTRAINT oauth_clients_client_name_length CHECK ((char_length(client_name) <= 1024)),
    CONSTRAINT oauth_clients_client_name_length CHECK ((char_length(client_name) <= 1024)),
    CONSTRAINT oauth_clients_client_uri_length CHECK ((char_length(client_uri) <= 2048)),
    CONSTRAINT oauth_clients_client_uri_length CHECK ((char_length(client_uri) <= 2048)),
    CONSTRAINT oauth_clients_logo_uri_length CHECK ((char_length(logo_uri) <= 2048))
    CONSTRAINT oauth_clients_logo_uri_length CHECK ((char_length(logo_uri) <= 2048))
);
);




--
--
-- Name: oauth_consents; Type: TABLE; Schema: auth; Owner: -
-- Name: oauth_consents; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    client_id uuid NOT NULL,
    client_id uuid NOT NULL,
    scopes text NOT NULL,
    scopes text NOT NULL,
    granted_at timestamp with time zone DEFAULT now() NOT NULL,
    granted_at timestamp with time zone DEFAULT now() NOT NULL,
    revoked_at timestamp with time zone,
    revoked_at timestamp with time zone,
    CONSTRAINT oauth_consents_revoked_after_granted CHECK (((revoked_at IS NULL) OR (revoked_at >= granted_at))),
    CONSTRAINT oauth_consents_revoked_after_granted CHECK (((revoked_at IS NULL) OR (revoked_at >= granted_at))),
    CONSTRAINT oauth_consents_scopes_length CHECK ((char_length(scopes) <= 2048)),
    CONSTRAINT oauth_consents_scopes_length CHECK ((char_length(scopes) <= 2048)),
    CONSTRAINT oauth_consents_scopes_not_empty CHECK ((char_length(TRIM(BOTH FROM scopes)) > 0))
    CONSTRAINT oauth_consents_scopes_not_empty CHECK ((char_length(TRIM(BOTH FROM scopes)) > 0))
);
);




--
--
-- Name: one_time_tokens; Type: TABLE; Schema: auth; Owner: -
-- Name: one_time_tokens; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    token_type auth.one_time_token_type NOT NULL,
    token_type auth.one_time_token_type NOT NULL,
    token_hash text NOT NULL,
    token_hash text NOT NULL,
    relates_to text NOT NULL,
    relates_to text NOT NULL,
    created_at timestamp without time zone DEFAULT now() NOT NULL,
    created_at timestamp without time zone DEFAULT now() NOT NULL,
    updated_at timestamp without time zone DEFAULT now() NOT NULL,
    updated_at timestamp without time zone DEFAULT now() NOT NULL,
    CONSTRAINT one_time_tokens_token_hash_check CHECK ((char_length(token_hash) > 0))
    CONSTRAINT one_time_tokens_token_hash_check CHECK ((char_length(token_hash) > 0))
);
);




--
--
-- Name: refresh_tokens; Type: TABLE; Schema: auth; Owner: -
-- Name: refresh_tokens; Type: TABLE; Schema: auth; Owner: -
--
--


    instance_id uuid,
    instance_id uuid,
    id bigint NOT NULL,
    id bigint NOT NULL,
    token character varying(255),
    token character varying(255),
    user_id character varying(255),
    user_id character varying(255),
    revoked boolean,
    revoked boolean,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    parent character varying(255),
    parent character varying(255),
    session_id uuid
    session_id uuid
);
);




--
--
-- Name: TABLE refresh_tokens; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE refresh_tokens; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.refresh_tokens IS 'Auth: Store of tokens used to refresh JWT tokens once they expire.';
COMMENT ON TABLE auth.refresh_tokens IS 'Auth: Store of tokens used to refresh JWT tokens once they expire.';




--
--
-- Name: refresh_tokens_id_seq; Type: SEQUENCE; Schema: auth; Owner: -
-- Name: refresh_tokens_id_seq; Type: SEQUENCE; Schema: auth; Owner: -
--
--


    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: refresh_tokens_id_seq; Type: SEQUENCE OWNED BY; Schema: auth; Owner: -
-- Name: refresh_tokens_id_seq; Type: SEQUENCE OWNED BY; Schema: auth; Owner: -
--
--






--
--
-- Name: saml_providers; Type: TABLE; Schema: auth; Owner: -
-- Name: saml_providers; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    metadata_xml text NOT NULL,
    metadata_xml text NOT NULL,
    metadata_url text,
    metadata_url text,
    attribute_mapping jsonb,
    attribute_mapping jsonb,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    name_id_format text,
    name_id_format text,
    CONSTRAINT "entity_id not empty" CHECK ((char_length(entity_id) > 0)),
    CONSTRAINT "entity_id not empty" CHECK ((char_length(entity_id) > 0)),
    CONSTRAINT "metadata_url not empty" CHECK (((metadata_url = NULL::text) OR (char_length(metadata_url) > 0))),
    CONSTRAINT "metadata_url not empty" CHECK (((metadata_url = NULL::text) OR (char_length(metadata_url) > 0))),
    CONSTRAINT "metadata_xml not empty" CHECK ((char_length(metadata_xml) > 0))
    CONSTRAINT "metadata_xml not empty" CHECK ((char_length(metadata_xml) > 0))
);
);




--
--
-- Name: TABLE saml_providers; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE saml_providers; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.saml_providers IS 'Auth: Manages SAML Identity Provider connections.';
COMMENT ON TABLE auth.saml_providers IS 'Auth: Manages SAML Identity Provider connections.';




--
--
-- Name: saml_relay_states; Type: TABLE; Schema: auth; Owner: -
-- Name: saml_relay_states; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    request_id text NOT NULL,
    request_id text NOT NULL,
    for_email text,
    for_email text,
    redirect_to text,
    redirect_to text,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    flow_state_id uuid,
    flow_state_id uuid,
    CONSTRAINT "request_id not empty" CHECK ((char_length(request_id) > 0))
    CONSTRAINT "request_id not empty" CHECK ((char_length(request_id) > 0))
);
);




--
--
-- Name: TABLE saml_relay_states; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE saml_relay_states; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.saml_relay_states IS 'Auth: Contains SAML Relay State information for each Service Provider initiated login.';
COMMENT ON TABLE auth.saml_relay_states IS 'Auth: Contains SAML Relay State information for each Service Provider initiated login.';




--
--
-- Name: schema_migrations; Type: TABLE; Schema: auth; Owner: -
-- Name: schema_migrations; Type: TABLE; Schema: auth; Owner: -
--
--


    version character varying(255) NOT NULL
    version character varying(255) NOT NULL
);
);




--
--
-- Name: TABLE schema_migrations; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE schema_migrations; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.schema_migrations IS 'Auth: Manages updates to the auth system.';
COMMENT ON TABLE auth.schema_migrations IS 'Auth: Manages updates to the auth system.';




--
--
-- Name: sessions; Type: TABLE; Schema: auth; Owner: -
-- Name: sessions; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    factor_id uuid,
    factor_id uuid,
    aal auth.aal_level,
    aal auth.aal_level,
    not_after timestamp with time zone,
    not_after timestamp with time zone,
    refreshed_at timestamp without time zone,
    refreshed_at timestamp without time zone,
    user_agent text,
    user_agent text,
    ip inet,
    ip inet,
    tag text,
    tag text,
    oauth_client_id uuid,
    oauth_client_id uuid,
    refresh_token_hmac_key text,
    refresh_token_hmac_key text,
    refresh_token_counter bigint,
    refresh_token_counter bigint,
    scopes text,
    scopes text,
    CONSTRAINT sessions_scopes_length CHECK ((char_length(scopes) <= 4096))
    CONSTRAINT sessions_scopes_length CHECK ((char_length(scopes) <= 4096))
);
);




--
--
-- Name: TABLE sessions; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE sessions; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.sessions IS 'Auth: Stores session data associated to a user.';
COMMENT ON TABLE auth.sessions IS 'Auth: Stores session data associated to a user.';




--
--
-- Name: COLUMN sessions.not_after; Type: COMMENT; Schema: auth; Owner: -
-- Name: COLUMN sessions.not_after; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON COLUMN auth.sessions.not_after IS 'Auth: Not after is a nullable column that contains a timestamp after which the session should be regarded as expired.';
COMMENT ON COLUMN auth.sessions.not_after IS 'Auth: Not after is a nullable column that contains a timestamp after which the session should be regarded as expired.';




--
--
-- Name: COLUMN sessions.refresh_token_hmac_key; Type: COMMENT; Schema: auth; Owner: -
-- Name: COLUMN sessions.refresh_token_hmac_key; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON COLUMN auth.sessions.refresh_token_hmac_key IS 'Holds a HMAC-SHA256 key used to sign refresh tokens for this session.';
COMMENT ON COLUMN auth.sessions.refresh_token_hmac_key IS 'Holds a HMAC-SHA256 key used to sign refresh tokens for this session.';




--
--
-- Name: COLUMN sessions.refresh_token_counter; Type: COMMENT; Schema: auth; Owner: -
-- Name: COLUMN sessions.refresh_token_counter; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON COLUMN auth.sessions.refresh_token_counter IS 'Holds the ID (counter) of the last issued refresh token.';
COMMENT ON COLUMN auth.sessions.refresh_token_counter IS 'Holds the ID (counter) of the last issued refresh token.';




--
--
-- Name: sso_domains; Type: TABLE; Schema: auth; Owner: -
-- Name: sso_domains; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    sso_provider_id uuid NOT NULL,
    domain text NOT NULL,
    domain text NOT NULL,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    CONSTRAINT "domain not empty" CHECK ((char_length(domain) > 0))
    CONSTRAINT "domain not empty" CHECK ((char_length(domain) > 0))
);
);




--
--
-- Name: TABLE sso_domains; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE sso_domains; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.sso_domains IS 'Auth: Manages SSO email address domain mapping to an SSO Identity Provider.';
COMMENT ON TABLE auth.sso_domains IS 'Auth: Manages SSO email address domain mapping to an SSO Identity Provider.';




--
--
-- Name: sso_providers; Type: TABLE; Schema: auth; Owner: -
-- Name: sso_providers; Type: TABLE; Schema: auth; Owner: -
--
--


    id uuid NOT NULL,
    id uuid NOT NULL,
    resource_id text,
    resource_id text,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    disabled boolean,
    disabled boolean,
    CONSTRAINT "resource_id not empty" CHECK (((resource_id = NULL::text) OR (char_length(resource_id) > 0)))
    CONSTRAINT "resource_id not empty" CHECK (((resource_id = NULL::text) OR (char_length(resource_id) > 0)))
);
);




--
--
-- Name: TABLE sso_providers; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE sso_providers; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.sso_providers IS 'Auth: Manages SSO identity provider information; see saml_providers for SAML.';
COMMENT ON TABLE auth.sso_providers IS 'Auth: Manages SSO identity provider information; see saml_providers for SAML.';




--
--
-- Name: COLUMN sso_providers.resource_id; Type: COMMENT; Schema: auth; Owner: -
-- Name: COLUMN sso_providers.resource_id; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON COLUMN auth.sso_providers.resource_id IS 'Auth: Uniquely identifies a SSO provider according to a user-chosen resource ID (case insensitive), useful in infrastructure as code.';
COMMENT ON COLUMN auth.sso_providers.resource_id IS 'Auth: Uniquely identifies a SSO provider according to a user-chosen resource ID (case insensitive), useful in infrastructure as code.';




--
--
-- Name: users; Type: TABLE; Schema: auth; Owner: -
-- Name: users; Type: TABLE; Schema: auth; Owner: -
--
--


    instance_id uuid,
    instance_id uuid,
    id uuid NOT NULL,
    id uuid NOT NULL,
    aud character varying(255),
    aud character varying(255),
    role character varying(255),
    role character varying(255),
    email character varying(255),
    email character varying(255),
    encrypted_password character varying(255),
    encrypted_password character varying(255),
    email_confirmed_at timestamp with time zone,
    email_confirmed_at timestamp with time zone,
    invited_at timestamp with time zone,
    invited_at timestamp with time zone,
    confirmation_token character varying(255),
    confirmation_token character varying(255),
    confirmation_sent_at timestamp with time zone,
    confirmation_sent_at timestamp with time zone,
    recovery_token character varying(255),
    recovery_token character varying(255),
    recovery_sent_at timestamp with time zone,
    recovery_sent_at timestamp with time zone,
    email_change_token_new character varying(255),
    email_change_token_new character varying(255),
    email_change character varying(255),
    email_change character varying(255),
    email_change_sent_at timestamp with time zone,
    email_change_sent_at timestamp with time zone,
    last_sign_in_at timestamp with time zone,
    last_sign_in_at timestamp with time zone,
    raw_app_meta_data jsonb,
    raw_app_meta_data jsonb,
    raw_user_meta_data jsonb,
    raw_user_meta_data jsonb,
    is_super_admin boolean,
    is_super_admin boolean,
    created_at timestamp with time zone,
    created_at timestamp with time zone,
    updated_at timestamp with time zone,
    updated_at timestamp with time zone,
    phone text DEFAULT NULL::character varying,
    phone text DEFAULT NULL::character varying,
    phone_confirmed_at timestamp with time zone,
    phone_confirmed_at timestamp with time zone,
    phone_change text DEFAULT ''::character varying,
    phone_change text DEFAULT ''::character varying,
    phone_change_token character varying(255) DEFAULT ''::character varying,
    phone_change_token character varying(255) DEFAULT ''::character varying,
    phone_change_sent_at timestamp with time zone,
    phone_change_sent_at timestamp with time zone,
    confirmed_at timestamp with time zone GENERATED ALWAYS AS (LEAST(email_confirmed_at, phone_confirmed_at)) STORED,
    confirmed_at timestamp with time zone GENERATED ALWAYS AS (LEAST(email_confirmed_at, phone_confirmed_at)) STORED,
    email_change_token_current character varying(255) DEFAULT ''::character varying,
    email_change_token_current character varying(255) DEFAULT ''::character varying,
    email_change_confirm_status smallint DEFAULT 0,
    email_change_confirm_status smallint DEFAULT 0,
    banned_until timestamp with time zone,
    banned_until timestamp with time zone,
    reauthentication_token character varying(255) DEFAULT ''::character varying,
    reauthentication_token character varying(255) DEFAULT ''::character varying,
    reauthentication_sent_at timestamp with time zone,
    reauthentication_sent_at timestamp with time zone,
    is_sso_user boolean DEFAULT false NOT NULL,
    is_sso_user boolean DEFAULT false NOT NULL,
    deleted_at timestamp with time zone,
    deleted_at timestamp with time zone,
    is_anonymous boolean DEFAULT false NOT NULL,
    is_anonymous boolean DEFAULT false NOT NULL,
    CONSTRAINT users_email_change_confirm_status_check CHECK (((email_change_confirm_status >= 0) AND (email_change_confirm_status <= 2)))
    CONSTRAINT users_email_change_confirm_status_check CHECK (((email_change_confirm_status >= 0) AND (email_change_confirm_status <= 2)))
);
);




--
--
-- Name: TABLE users; Type: COMMENT; Schema: auth; Owner: -
-- Name: TABLE users; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON TABLE auth.users IS 'Auth: Stores user login data within a secure schema.';
COMMENT ON TABLE auth.users IS 'Auth: Stores user login data within a secure schema.';




--
--
-- Name: COLUMN users.is_sso_user; Type: COMMENT; Schema: auth; Owner: -
-- Name: COLUMN users.is_sso_user; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON COLUMN auth.users.is_sso_user IS 'Auth: Set this column to true when the account comes from SSO. These accounts can have duplicate emails.';
COMMENT ON COLUMN auth.users.is_sso_user IS 'Auth: Set this column to true when the account comes from SSO. These accounts can have duplicate emails.';




--
--
-- Name: checkout_session; Type: TABLE; Schema: billing; Owner: -
-- Name: checkout_session; Type: TABLE; Schema: billing; Owner: -
--
--


CREATE TABLE billing.checkout_session (
CREATE TABLE billing.checkout_session (
    checkout_id uuid DEFAULT gen_random_uuid() NOT NULL,
    checkout_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid NOT NULL,
    invoice_id uuid NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    customer_code text,
    customer_code text,
    provider text DEFAULT 'stripe'::text NOT NULL,
    provider text DEFAULT 'stripe'::text NOT NULL,
    status text DEFAULT 'created'::text NOT NULL,
    status text DEFAULT 'created'::text NOT NULL,
    stripe_session_id text,
    stripe_session_id text,
    stripe_url text,
    stripe_url text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    last_error text,
    last_error text,
    CONSTRAINT checkout_session_provider_check CHECK ((provider = 'stripe'::text)),
    CONSTRAINT checkout_session_provider_check CHECK ((provider = 'stripe'::text)),
    CONSTRAINT checkout_session_status_check CHECK ((status = ANY (ARRAY['created'::text, 'redirected'::text, 'completed'::text, 'failed'::text])))
    CONSTRAINT checkout_session_status_check CHECK ((status = ANY (ARRAY['created'::text, 'redirected'::text, 'completed'::text, 'failed'::text])))
);
);




--
--
-- Name: customer_profile; Type: TABLE; Schema: billing; Owner: -
-- Name: customer_profile; Type: TABLE; Schema: billing; Owner: -
--
--


CREATE TABLE billing.customer_profile (
CREATE TABLE billing.customer_profile (
    customer_code text NOT NULL,
    customer_code text NOT NULL,
    customer_name text NOT NULL,
    customer_name text NOT NULL,
    customer_postal_code text,
    customer_postal_code text,
    customer_address1 text,
    customer_address1 text,
    customer_address2 text,
    customer_address2 text,
    customer_tel text,
    customer_tel text,
    customer_email text,
    customer_email text,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: invoice; Type: TABLE; Schema: billing; Owner: -
-- Name: invoice; Type: TABLE; Schema: billing; Owner: -
--
--


CREATE TABLE billing.invoice (
CREATE TABLE billing.invoice (
    invoice_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    billing_month date NOT NULL,
    billing_month date NOT NULL,
    total_amount numeric NOT NULL,
    total_amount numeric NOT NULL,
    currency text DEFAULT 'JPY'::text NOT NULL,
    currency text DEFAULT 'JPY'::text NOT NULL,
    pdf_url text,
    pdf_url text,
    status text DEFAULT 'issued'::text NOT NULL,
    status text DEFAULT 'issued'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    customer_code text,
    customer_code text,
    due_date date,
    due_date date,
    tax_rate numeric,
    tax_rate numeric,
    tax_amount numeric,
    tax_amount numeric,
    subtotal_amount numeric
    subtotal_amount numeric
);
);




--
--
-- Name: invoice_line; Type: TABLE; Schema: billing; Owner: -
-- Name: invoice_line; Type: TABLE; Schema: billing; Owner: -
--
--


CREATE TABLE billing.invoice_line (
CREATE TABLE billing.invoice_line (
    invoice_line_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_line_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid NOT NULL,
    invoice_id uuid NOT NULL,
    description text NOT NULL,
    description text NOT NULL,
    quantity integer NOT NULL,
    quantity integer NOT NULL,
    unit_price numeric NOT NULL,
    unit_price numeric NOT NULL,
    amount numeric NOT NULL,
    amount numeric NOT NULL,
    tax_category text DEFAULT 'standard'::text
    tax_category text DEFAULT 'standard'::text
);
);




--
--
-- Name: invoice_send_audit; Type: TABLE; Schema: billing; Owner: -
-- Name: invoice_send_audit; Type: TABLE; Schema: billing; Owner: -
--
--


CREATE TABLE billing.invoice_send_audit (
CREATE TABLE billing.invoice_send_audit (
    audit_id uuid DEFAULT gen_random_uuid() NOT NULL,
    audit_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid NOT NULL,
    invoice_id uuid NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    channel text NOT NULL,
    channel text NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    attempt_no integer DEFAULT 1 NOT NULL,
    attempt_no integer DEFAULT 1 NOT NULL,
    error_message text,
    error_message text,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    processed_at timestamp with time zone,
    processed_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: invoice_send_retry; Type: TABLE; Schema: billing; Owner: -
-- Name: invoice_send_retry; Type: TABLE; Schema: billing; Owner: -
--
--


CREATE TABLE billing.invoice_send_retry (
CREATE TABLE billing.invoice_send_retry (
    retry_id uuid DEFAULT gen_random_uuid() NOT NULL,
    retry_id uuid DEFAULT gen_random_uuid() NOT NULL,
    invoice_id uuid NOT NULL,
    invoice_id uuid NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    next_retry_at timestamp with time zone NOT NULL,
    next_retry_at timestamp with time zone NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    last_error text,
    last_error text,
    status text DEFAULT 'pending'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: invoice_template; Type: TABLE; Schema: billing; Owner: -
-- Name: invoice_template; Type: TABLE; Schema: billing; Owner: -
--
--


CREATE TABLE billing.invoice_template (
CREATE TABLE billing.invoice_template (
    template_code text NOT NULL,
    template_code text NOT NULL,
    locale text DEFAULT 'ja-JP'::text NOT NULL,
    locale text DEFAULT 'ja-JP'::text NOT NULL,
    html_template text NOT NULL,
    html_template text NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: issuer_profile; Type: TABLE; Schema: billing; Owner: -
-- Name: issuer_profile; Type: TABLE; Schema: billing; Owner: -
--
--


CREATE TABLE billing.issuer_profile (
CREATE TABLE billing.issuer_profile (
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    issuer_name text NOT NULL,
    issuer_name text NOT NULL,
    issuer_postal_code text,
    issuer_postal_code text,
    issuer_address1 text,
    issuer_address1 text,
    issuer_address2 text,
    issuer_address2 text,
    issuer_tel text,
    issuer_tel text,
    issuer_email text,
    issuer_email text,
    issuer_reg_no text,
    issuer_reg_no text,
    bank_name text,
    bank_name text,
    bank_branch text,
    bank_branch text,
    bank_account_type text,
    bank_account_type text,
    bank_account_no text,
    bank_account_no text,
    bank_account_name text,
    bank_account_name text,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_invoice_render_data; Type: VIEW; Schema: billing; Owner: -
-- Name: v_invoice_render_data; Type: VIEW; Schema: billing; Owner: -
--
--


CREATE VIEW billing.v_invoice_render_data AS
CREATE VIEW billing.v_invoice_render_data AS
 SELECT invoice_id,
 SELECT invoice_id,
    company_id,
    company_id,
    billing_month,
    billing_month,
    total_amount,
    total_amount,
    currency,
    currency,
    status,
    status,
    ( SELECT string_agg(format('%s | qty=%s | unit=%s | amount=%s'::text, il.description, il.quantity, il.unit_price, il.amount), '
    ( SELECT string_agg(format('%s | qty=%s | unit=%s | amount=%s'::text, il.description, il.quantity, il.unit_price, il.amount), '
'::text) AS string_agg
'::text) AS string_agg
           FROM billing.invoice_line il
           FROM billing.invoice_line il
          WHERE (il.invoice_id = i.invoice_id)) AS lines_text
          WHERE (il.invoice_id = i.invoice_id)) AS lines_text
   FROM billing.invoice i;
   FROM billing.invoice i;




--
--
-- Name: v_invoice_render_data_ext; Type: VIEW; Schema: billing; Owner: -
-- Name: v_invoice_render_data_ext; Type: VIEW; Schema: billing; Owner: -
--
--


CREATE VIEW billing.v_invoice_render_data_ext AS
CREATE VIEW billing.v_invoice_render_data_ext AS
 SELECT v.invoice_id,
 SELECT v.invoice_id,
    v.company_id,
    v.company_id,
    v.billing_month,
    v.billing_month,
    v.total_amount,
    v.total_amount,
    v.currency,
    v.currency,
    v.status,
    v.status,
    v.lines_text,
    v.lines_text,
    ip.issuer_name,
    ip.issuer_name,
    ip.issuer_postal_code,
    ip.issuer_postal_code,
    ip.issuer_address1,
    ip.issuer_address1,
    ip.issuer_address2,
    ip.issuer_address2,
    ip.issuer_tel,
    ip.issuer_tel,
    ip.issuer_email,
    ip.issuer_email,
    ip.issuer_reg_no,
    ip.issuer_reg_no,
    ip.bank_name,
    ip.bank_name,
    ip.bank_branch,
    ip.bank_branch,
    ip.bank_account_type,
    ip.bank_account_type,
    ip.bank_account_no,
    ip.bank_account_no,
    ip.bank_account_name,
    ip.bank_account_name,
    concat_ws(' '::text, ip.issuer_postal_code, ip.issuer_address1, ip.issuer_address2) AS issuer_full_address,
    concat_ws(' '::text, ip.issuer_postal_code, ip.issuer_address1, ip.issuer_address2) AS issuer_full_address,
    now() AS render_generated_at
    now() AS render_generated_at
   FROM (billing.v_invoice_render_data v
   FROM (billing.v_invoice_render_data v
     LEFT JOIN billing.issuer_profile ip ON ((ip.company_id = v.company_id)));
     LEFT JOIN billing.issuer_profile ip ON ((ip.company_id = v.company_id)));




--
--
-- Name: escalation_outbox; Type: TABLE; Schema: ci; Owner: -
-- Name: escalation_outbox; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.escalation_outbox (
CREATE TABLE ci.escalation_outbox (
    outbox_id uuid DEFAULT gen_random_uuid() NOT NULL,
    outbox_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    request_id uuid NOT NULL,
    payload jsonb NOT NULL,
    payload jsonb NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    last_error text,
    last_error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    sent_at timestamp with time zone
    sent_at timestamp with time zone
);
);




--
--
-- Name: json_schema_check_log; Type: TABLE; Schema: ci; Owner: -
-- Name: json_schema_check_log; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.json_schema_check_log (
CREATE TABLE ci.json_schema_check_log (
    check_id uuid DEFAULT gen_random_uuid() NOT NULL,
    check_id uuid DEFAULT gen_random_uuid() NOT NULL,
    check_scope text NOT NULL,
    check_scope text NOT NULL,
    schema_name text NOT NULL,
    schema_name text NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    diff_summary text,
    diff_summary text,
    checked_at timestamp with time zone DEFAULT now() NOT NULL
    checked_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: kill_switch; Type: TABLE; Schema: ci; Owner: -
-- Name: kill_switch; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.kill_switch (
CREATE TABLE ci.kill_switch (
    switch_name text NOT NULL,
    switch_name text NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    reason text,
    reason text,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ops_notification_queue; Type: TABLE; Schema: ci; Owner: -
-- Name: ops_notification_queue; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.ops_notification_queue (
CREATE TABLE ci.ops_notification_queue (
    notification_id uuid DEFAULT gen_random_uuid() NOT NULL,
    notification_id uuid DEFAULT gen_random_uuid() NOT NULL,
    channel text NOT NULL,
    channel text NOT NULL,
    destination text NOT NULL,
    destination text NOT NULL,
    payload jsonb NOT NULL,
    payload jsonb NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    error text,
    error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    sent_at timestamp with time zone
    sent_at timestamp with time zone
);
);




--
--
-- Name: schema_ai_review_job; Type: TABLE; Schema: ci; Owner: -
-- Name: schema_ai_review_job; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.schema_ai_review_job (
CREATE TABLE ci.schema_ai_review_job (
    job_id uuid DEFAULT gen_random_uuid() NOT NULL,
    job_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    request_id uuid NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    prompt text NOT NULL,
    prompt text NOT NULL,
    response text,
    response text,
    error text,
    error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: schema_review_prompt_template; Type: TABLE; Schema: ci; Owner: -
-- Name: schema_review_prompt_template; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.schema_review_prompt_template (
CREATE TABLE ci.schema_review_prompt_template (
    template_id uuid DEFAULT gen_random_uuid() NOT NULL,
    template_id uuid DEFAULT gen_random_uuid() NOT NULL,
    domain text NOT NULL,
    domain text NOT NULL,
    schema_name text NOT NULL,
    schema_name text NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    prompt_prefix text NOT NULL,
    prompt_prefix text NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: schema_review_summary; Type: TABLE; Schema: ci; Owner: -
-- Name: schema_review_summary; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.schema_review_summary (
CREATE TABLE ci.schema_review_summary (
    request_id uuid NOT NULL,
    request_id uuid NOT NULL,
    summary_ja text NOT NULL,
    summary_ja text NOT NULL,
    generated_at timestamp with time zone DEFAULT now() NOT NULL
    generated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: sla_escalation_policy; Type: TABLE; Schema: ci; Owner: -
-- Name: sla_escalation_policy; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.sla_escalation_policy (
CREATE TABLE ci.sla_escalation_policy (
    policy_id uuid DEFAULT gen_random_uuid() NOT NULL,
    policy_id uuid DEFAULT gen_random_uuid() NOT NULL,
    domain text NOT NULL,
    domain text NOT NULL,
    threshold_min integer NOT NULL,
    threshold_min integer NOT NULL,
    severity text DEFAULT 'high'::text NOT NULL,
    severity text DEFAULT 'high'::text NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: slack_approval_audit; Type: TABLE; Schema: ci; Owner: -
-- Name: slack_approval_audit; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.slack_approval_audit (
CREATE TABLE ci.slack_approval_audit (
    audit_id uuid DEFAULT gen_random_uuid() NOT NULL,
    audit_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid NOT NULL,
    request_id uuid NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    actor text NOT NULL,
    actor text NOT NULL,
    source text DEFAULT 'slack'::text NOT NULL,
    source text DEFAULT 'slack'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: slack_interaction_log; Type: TABLE; Schema: ci; Owner: -
-- Name: slack_interaction_log; Type: TABLE; Schema: ci; Owner: -
--
--


CREATE TABLE ci.slack_interaction_log (
CREATE TABLE ci.slack_interaction_log (
    interaction_id uuid DEFAULT gen_random_uuid() NOT NULL,
    interaction_id uuid DEFAULT gen_random_uuid() NOT NULL,
    request_id uuid,
    request_id uuid,
    action text,
    action text,
    actor text,
    actor text,
    payload jsonb,
    payload jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_admin_all_requests; Type: VIEW; Schema: ci; Owner: -
-- Name: v_admin_all_requests; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_admin_all_requests AS
CREATE VIEW ci.v_admin_all_requests AS
 SELECT request_id,
 SELECT request_id,
    domain,
    domain,
    schema_name,
    schema_name,
    status,
    status,
    review_status,
    review_status,
    review_summary_ja,
    review_summary_ja,
    requested_by,
    requested_by,
    requested_at,
    requested_at,
    approved_by,
    approved_by,
    approved_at
    approved_at
   FROM ci.schema_change_request
   FROM ci.schema_change_request
  ORDER BY requested_at DESC;
  ORDER BY requested_at DESC;




--
--
-- Name: v_android_pending; Type: VIEW; Schema: ci; Owner: -
-- Name: v_android_pending; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_android_pending AS
CREATE VIEW ci.v_android_pending AS
 SELECT request_id,
 SELECT request_id,
    domain,
    domain,
    schema_name,
    schema_name,
    review_status,
    review_status,
    review_summary_ja,
    review_summary_ja,
    requested_by,
    requested_by,
    requested_at
    requested_at
   FROM ci.schema_change_request
   FROM ci.schema_change_request
  WHERE (status = 'pending'::text)
  WHERE (status = 'pending'::text)
  ORDER BY requested_at;
  ORDER BY requested_at;




--
--
-- Name: v_edge_deploy_allowed; Type: VIEW; Schema: ci; Owner: -
-- Name: v_edge_deploy_allowed; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_edge_deploy_allowed AS
CREATE VIEW ci.v_edge_deploy_allowed AS
 SELECT (NOT (EXISTS ( SELECT 1
 SELECT (NOT (EXISTS ( SELECT 1
           FROM ci.schema_change_request
           FROM ci.schema_change_request
          WHERE (schema_change_request.status = 'pending'::text)))) AS deploy_allowed;
          WHERE (schema_change_request.status = 'pending'::text)))) AS deploy_allowed;




--
--
-- Name: v_kill_switch; Type: VIEW; Schema: ci; Owner: -
-- Name: v_kill_switch; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_kill_switch AS
CREATE VIEW ci.v_kill_switch AS
 SELECT switch_name,
 SELECT switch_name,
    is_enabled,
    is_enabled,
    reason,
    reason,
    updated_at
    updated_at
   FROM ci.kill_switch;
   FROM ci.kill_switch;




--
--
-- Name: v_schema_change_sla; Type: VIEW; Schema: ci; Owner: -
-- Name: v_schema_change_sla; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_schema_change_sla AS
CREATE VIEW ci.v_schema_change_sla AS
 SELECT schema_name,
 SELECT schema_name,
    status,
    status,
    review_status,
    review_status,
    count(*) AS change_count,
    count(*) AS change_count,
    percentile_cont((0.5)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (approved_at - requested_at)))::double precision)) FILTER (WHERE ((status = 'approved'::text) AND (approved_at IS NOT NULL))) AS p50_seconds_to_approve,
    percentile_cont((0.5)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (approved_at - requested_at)))::double precision)) FILTER (WHERE ((status = 'approved'::text) AND (approved_at IS NOT NULL))) AS p50_seconds_to_approve,
    percentile_cont((0.9)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (approved_at - requested_at)))::double precision)) FILTER (WHERE ((status = 'approved'::text) AND (approved_at IS NOT NULL))) AS p90_seconds_to_approve,
    percentile_cont((0.9)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (approved_at - requested_at)))::double precision)) FILTER (WHERE ((status = 'approved'::text) AND (approved_at IS NOT NULL))) AS p90_seconds_to_approve,
    percentile_cont((0.5)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (reviewed_at - requested_at)))::double precision)) FILTER (WHERE (reviewed_at IS NOT NULL)) AS p50_seconds_to_review,
    percentile_cont((0.5)::double precision) WITHIN GROUP (ORDER BY ((EXTRACT(epoch FROM (reviewed_at - requested_at)))::double precision)) FILTER (WHERE (reviewed_at IS NOT NULL)) AS p50_seconds_to_review,
    max(requested_at) AS last_requested_at
    max(requested_at) AS last_requested_at
   FROM ci.schema_change_request
   FROM ci.schema_change_request
  GROUP BY schema_name, status, review_status;
  GROUP BY schema_name, status, review_status;




--
--
-- Name: v_ops_dashboard; Type: VIEW; Schema: ci; Owner: -
-- Name: v_ops_dashboard; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_ops_dashboard AS
CREATE VIEW ci.v_ops_dashboard AS
 SELECT r.request_id,
 SELECT r.request_id,
    r.schema_name,
    r.schema_name,
    r.status,
    r.status,
    r.review_status,
    r.review_status,
    r.review_summary,
    r.review_summary,
    r.requested_by,
    r.requested_by,
    r.requested_at,
    r.requested_at,
    r.approved_by,
    r.approved_by,
    r.approved_at,
    r.approved_at,
    ks.is_enabled AS edge_deploy_enabled,
    ks.is_enabled AS edge_deploy_enabled,
    ks.reason AS kill_switch_reason,
    ks.reason AS kill_switch_reason,
    sla.p50_seconds_to_review,
    sla.p50_seconds_to_review,
    sla.p50_seconds_to_approve
    sla.p50_seconds_to_approve
   FROM ((ci.schema_change_request r
   FROM ((ci.schema_change_request r
     LEFT JOIN ci.kill_switch ks ON ((ks.switch_name = 'edge_deploy'::text)))
     LEFT JOIN ci.kill_switch ks ON ((ks.switch_name = 'edge_deploy'::text)))
     LEFT JOIN ci.v_schema_change_sla sla ON (((sla.schema_name = r.schema_name) AND (sla.status = r.status) AND (sla.review_status = r.review_status))));
     LEFT JOIN ci.v_schema_change_sla sla ON (((sla.schema_name = r.schema_name) AND (sla.status = r.status) AND (sla.review_status = r.review_status))));




--
--
-- Name: v_pending_with_ui_link; Type: VIEW; Schema: ci; Owner: -
-- Name: v_pending_with_ui_link; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_pending_with_ui_link AS
CREATE VIEW ci.v_pending_with_ui_link AS
 SELECT request_id,
 SELECT request_id,
    domain,
    domain,
    schema_name,
    schema_name,
    requested_by,
    requested_by,
    requested_at,
    requested_at,
    review_summary_ja,
    review_summary_ja,
    concat('/?request_id=', request_id) AS ui_path
    concat('/?request_id=', request_id) AS ui_path
   FROM ci.schema_change_request r
   FROM ci.schema_change_request r
  WHERE (status = 'pending'::text);
  WHERE (status = 'pending'::text);




--
--
-- Name: v_schema_change_approvable; Type: VIEW; Schema: ci; Owner: -
-- Name: v_schema_change_approvable; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_schema_change_approvable AS
CREATE VIEW ci.v_schema_change_approvable AS
 SELECT r.request_id,
 SELECT r.request_id,
    r.schema_name,
    r.schema_name,
    r.requested_by,
    r.requested_by,
    r.diff_summary,
    r.diff_summary,
    r.status,
    r.status,
    r.requested_at,
    r.requested_at,
    r.approved_by,
    r.approved_by,
    r.approved_at,
    r.approved_at,
    r.review_status,
    r.review_status,
    r.review_summary,
    r.review_summary,
    r.reviewed_at,
    r.reviewed_at,
    ks.is_enabled AS edge_deploy_enabled
    ks.is_enabled AS edge_deploy_enabled
   FROM (ci.schema_change_request r
   FROM (ci.schema_change_request r
     LEFT JOIN ci.kill_switch ks ON ((ks.switch_name = 'edge_deploy'::text)))
     LEFT JOIN ci.kill_switch ks ON ((ks.switch_name = 'edge_deploy'::text)))
  WHERE ((r.status = 'pending'::text) AND (r.review_status = 'ok'::text) AND (COALESCE(ks.is_enabled, true) = true));
  WHERE ((r.status = 'pending'::text) AND (r.review_status = 'ok'::text) AND (COALESCE(ks.is_enabled, true) = true));




--
--
-- Name: v_schema_change_sla_30d; Type: VIEW; Schema: ci; Owner: -
-- Name: v_schema_change_sla_30d; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_schema_change_sla_30d AS
CREATE VIEW ci.v_schema_change_sla_30d AS
 SELECT schema_name,
 SELECT schema_name,
    status,
    status,
    review_status,
    review_status,
    change_count,
    change_count,
    p50_seconds_to_approve,
    p50_seconds_to_approve,
    p90_seconds_to_approve,
    p90_seconds_to_approve,
    p50_seconds_to_review,
    p50_seconds_to_review,
    last_requested_at
    last_requested_at
   FROM ci.v_schema_change_sla
   FROM ci.v_schema_change_sla
  WHERE (last_requested_at >= (now() - '30 days'::interval));
  WHERE (last_requested_at >= (now() - '30 days'::interval));




--
--
-- Name: v_sla_overdue_requests; Type: VIEW; Schema: ci; Owner: -
-- Name: v_sla_overdue_requests; Type: VIEW; Schema: ci; Owner: -
--
--


CREATE VIEW ci.v_sla_overdue_requests AS
CREATE VIEW ci.v_sla_overdue_requests AS
 SELECT r.request_id,
 SELECT r.request_id,
    r.domain,
    r.domain,
    r.schema_name,
    r.schema_name,
    r.requested_by,
    r.requested_by,
    r.requested_at,
    r.requested_at,
    r.diff_summary,
    r.diff_summary,
    p.threshold_min,
    p.threshold_min,
    p.severity,
    p.severity,
    (now() - r.requested_at) AS overdue_by
    (now() - r.requested_at) AS overdue_by
   FROM (ci.schema_change_request r
   FROM (ci.schema_change_request r
     JOIN ci.sla_escalation_policy p ON ((p.domain = COALESCE(r.domain, p.domain))))
     JOIN ci.sla_escalation_policy p ON ((p.domain = COALESCE(r.domain, p.domain))))
  WHERE ((r.status = 'pending'::text) AND (p.is_enabled = true) AND ((now() - r.requested_at) > make_interval(mins => p.threshold_min)));
  WHERE ((r.status = 'pending'::text) AND (p.is_enabled = true) AND ((now() - r.requested_at) > make_interval(mins => p.threshold_min)));




--
--
-- Name: audit_action; Type: TABLE; Schema: compliance; Owner: -
-- Name: audit_action; Type: TABLE; Schema: compliance; Owner: -
--
--


CREATE TABLE compliance.audit_action (
CREATE TABLE compliance.audit_action (
    audit_action_id bigint NOT NULL,
    audit_action_id bigint NOT NULL,
    audit_issue_id bigint NOT NULL,
    audit_issue_id bigint NOT NULL,
    action_plan text NOT NULL,
    action_plan text NOT NULL,
    owner_id uuid,
    owner_id uuid,
    due_date date,
    due_date date,
    status_code text DEFAULT 'OPEN'::text NOT NULL,
    status_code text DEFAULT 'OPEN'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: audit_action_audit_action_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
-- Name: audit_action_audit_action_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
--
--


CREATE SEQUENCE compliance.audit_action_audit_action_id_seq
CREATE SEQUENCE compliance.audit_action_audit_action_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_action_audit_action_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
-- Name: audit_action_audit_action_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
--
--


ALTER SEQUENCE compliance.audit_action_audit_action_id_seq OWNED BY compliance.audit_action.audit_action_id;
ALTER SEQUENCE compliance.audit_action_audit_action_id_seq OWNED BY compliance.audit_action.audit_action_id;




--
--
-- Name: audit_event; Type: TABLE; Schema: compliance; Owner: -
-- Name: audit_event; Type: TABLE; Schema: compliance; Owner: -
--
--


CREATE TABLE compliance.audit_event (
CREATE TABLE compliance.audit_event (
    audit_event_id bigint NOT NULL,
    audit_event_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    iso_standard_id bigint,
    iso_standard_id bigint,
    audit_date date NOT NULL,
    audit_date date NOT NULL,
    audit_type text NOT NULL,
    audit_type text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: audit_event_audit_event_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
-- Name: audit_event_audit_event_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
--
--


CREATE SEQUENCE compliance.audit_event_audit_event_id_seq
CREATE SEQUENCE compliance.audit_event_audit_event_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_event_audit_event_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
-- Name: audit_event_audit_event_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
--
--


ALTER SEQUENCE compliance.audit_event_audit_event_id_seq OWNED BY compliance.audit_event.audit_event_id;
ALTER SEQUENCE compliance.audit_event_audit_event_id_seq OWNED BY compliance.audit_event.audit_event_id;




--
--
-- Name: audit_issue; Type: TABLE; Schema: compliance; Owner: -
-- Name: audit_issue; Type: TABLE; Schema: compliance; Owner: -
--
--


CREATE TABLE compliance.audit_issue (
CREATE TABLE compliance.audit_issue (
    audit_issue_id bigint NOT NULL,
    audit_issue_id bigint NOT NULL,
    audit_event_id bigint NOT NULL,
    audit_event_id bigint NOT NULL,
    iso_clause_id bigint,
    iso_clause_id bigint,
    severity text DEFAULT 'MINOR'::text NOT NULL,
    severity text DEFAULT 'MINOR'::text NOT NULL,
    description text NOT NULL,
    description text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: audit_issue_audit_issue_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
-- Name: audit_issue_audit_issue_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
--
--


CREATE SEQUENCE compliance.audit_issue_audit_issue_id_seq
CREATE SEQUENCE compliance.audit_issue_audit_issue_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_issue_audit_issue_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
-- Name: audit_issue_audit_issue_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
--
--


ALTER SEQUENCE compliance.audit_issue_audit_issue_id_seq OWNED BY compliance.audit_issue.audit_issue_id;
ALTER SEQUENCE compliance.audit_issue_audit_issue_id_seq OWNED BY compliance.audit_issue.audit_issue_id;




--
--
-- Name: iso_clause; Type: TABLE; Schema: compliance; Owner: -
-- Name: iso_clause; Type: TABLE; Schema: compliance; Owner: -
--
--


CREATE TABLE compliance.iso_clause (
CREATE TABLE compliance.iso_clause (
    iso_clause_id bigint NOT NULL,
    iso_clause_id bigint NOT NULL,
    iso_standard_id bigint NOT NULL,
    iso_standard_id bigint NOT NULL,
    clause_code text NOT NULL,
    clause_code text NOT NULL,
    clause_name text NOT NULL
    clause_name text NOT NULL
);
);




--
--
-- Name: iso_clause_iso_clause_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
-- Name: iso_clause_iso_clause_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
--
--


CREATE SEQUENCE compliance.iso_clause_iso_clause_id_seq
CREATE SEQUENCE compliance.iso_clause_iso_clause_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: iso_clause_iso_clause_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
-- Name: iso_clause_iso_clause_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
--
--


ALTER SEQUENCE compliance.iso_clause_iso_clause_id_seq OWNED BY compliance.iso_clause.iso_clause_id;
ALTER SEQUENCE compliance.iso_clause_iso_clause_id_seq OWNED BY compliance.iso_clause.iso_clause_id;




--
--
-- Name: iso_standard; Type: TABLE; Schema: compliance; Owner: -
-- Name: iso_standard; Type: TABLE; Schema: compliance; Owner: -
--
--


CREATE TABLE compliance.iso_standard (
CREATE TABLE compliance.iso_standard (
    iso_standard_id bigint NOT NULL,
    iso_standard_id bigint NOT NULL,
    iso_code text NOT NULL,
    iso_code text NOT NULL,
    iso_name text NOT NULL
    iso_name text NOT NULL
);
);




--
--
-- Name: iso_standard_iso_standard_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
-- Name: iso_standard_iso_standard_id_seq; Type: SEQUENCE; Schema: compliance; Owner: -
--
--


CREATE SEQUENCE compliance.iso_standard_iso_standard_id_seq
CREATE SEQUENCE compliance.iso_standard_iso_standard_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: iso_standard_iso_standard_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
-- Name: iso_standard_iso_standard_id_seq; Type: SEQUENCE OWNED BY; Schema: compliance; Owner: -
--
--


ALTER SEQUENCE compliance.iso_standard_iso_standard_id_seq OWNED BY compliance.iso_standard.iso_standard_id;
ALTER SEQUENCE compliance.iso_standard_iso_standard_id_seq OWNED BY compliance.iso_standard.iso_standard_id;




--
--
-- Name: accounting_period; Type: TABLE; Schema: core; Owner: -
-- Name: accounting_period; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.accounting_period (
CREATE TABLE core.accounting_period (
    period_id bigint NOT NULL,
    period_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    period_year integer NOT NULL,
    period_year integer NOT NULL,
    period_month integer NOT NULL,
    period_month integer NOT NULL,
    is_closed boolean DEFAULT false NOT NULL,
    is_closed boolean DEFAULT false NOT NULL,
    closed_at timestamp with time zone,
    closed_at timestamp with time zone,
    CONSTRAINT accounting_period_period_month_check CHECK (((period_month >= 1) AND (period_month <= 12)))
    CONSTRAINT accounting_period_period_month_check CHECK (((period_month >= 1) AND (period_month <= 12)))
);
);






--
--
-- Name: accounting_period_period_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: accounting_period_period_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.accounting_period_period_id_seq
CREATE SEQUENCE core.accounting_period_period_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: accounting_period_period_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: accounting_period_period_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.accounting_period_period_id_seq OWNED BY core.accounting_period.period_id;
ALTER SEQUENCE core.accounting_period_period_id_seq OWNED BY core.accounting_period.period_id;




--
--
-- Name: accounts; Type: TABLE; Schema: core; Owner: -
-- Name: accounts; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.accounts (
CREATE TABLE core.accounts (
    account_id bigint NOT NULL,
    account_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    account_code text NOT NULL,
    account_code text NOT NULL,
    account_name text NOT NULL,
    account_name text NOT NULL,
    account_type text NOT NULL,
    account_type text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: accounts_account_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: accounts_account_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.accounts_account_id_seq
CREATE SEQUENCE core.accounts_account_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: accounts_account_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: accounts_account_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.accounts_account_id_seq OWNED BY core.accounts.account_id;
ALTER SEQUENCE core.accounts_account_id_seq OWNED BY core.accounts.account_id;




--
--
-- Name: app_user; Type: TABLE; Schema: core; Owner: -
-- Name: app_user; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.app_user (
CREATE TABLE core.app_user (
    user_id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    email text NOT NULL,
    email text NOT NULL,
    display_name text,
    display_name text,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: audit_column_weight; Type: TABLE; Schema: core; Owner: -
-- Name: audit_column_weight; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_column_weight (
CREATE TABLE core.audit_column_weight (
    column_weight_id bigint NOT NULL,
    column_weight_id bigint NOT NULL,
    company_id uuid,
    company_id uuid,
    entity_type_like text NOT NULL,
    entity_type_like text NOT NULL,
    column_name text NOT NULL,
    column_name text NOT NULL,
    weight numeric(10,4) DEFAULT 1.0 NOT NULL,
    weight numeric(10,4) DEFAULT 1.0 NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: audit_column_weight_column_weight_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: audit_column_weight_column_weight_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.audit_column_weight_column_weight_id_seq
CREATE SEQUENCE core.audit_column_weight_column_weight_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_column_weight_column_weight_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: audit_column_weight_column_weight_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.audit_column_weight_column_weight_id_seq OWNED BY core.audit_column_weight.column_weight_id;
ALTER SEQUENCE core.audit_column_weight_column_weight_id_seq OWNED BY core.audit_column_weight.column_weight_id;




--
--
-- Name: audit_entity_pk_map; Type: TABLE; Schema: core; Owner: -
-- Name: audit_entity_pk_map; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_entity_pk_map (
CREATE TABLE core.audit_entity_pk_map (
    schema_name text NOT NULL,
    schema_name text NOT NULL,
    table_name text NOT NULL,
    table_name text NOT NULL,
    pk_column text NOT NULL
    pk_column text NOT NULL
);
);




--
--
-- Name: audit_impact_rule; Type: TABLE; Schema: core; Owner: -
-- Name: audit_impact_rule; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_impact_rule (
CREATE TABLE core.audit_impact_rule (
    rule_id bigint NOT NULL,
    rule_id bigint NOT NULL,
    company_id uuid,
    company_id uuid,
    entity_type_like text NOT NULL,
    entity_type_like text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    base_weight numeric(10,4) DEFAULT 1.0 NOT NULL,
    base_weight numeric(10,4) DEFAULT 1.0 NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: audit_impact_rule_rule_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: audit_impact_rule_rule_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.audit_impact_rule_rule_id_seq
CREATE SEQUENCE core.audit_impact_rule_rule_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_impact_rule_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: audit_impact_rule_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.audit_impact_rule_rule_id_seq OWNED BY core.audit_impact_rule.rule_id;
ALTER SEQUENCE core.audit_impact_rule_rule_id_seq OWNED BY core.audit_impact_rule.rule_id;




--
--
-- Name: audit_trail_audit_trail_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: audit_trail_audit_trail_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.audit_trail_audit_trail_id_seq
CREATE SEQUENCE core.audit_trail_audit_trail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_trail_audit_trail_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: audit_trail_audit_trail_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.audit_trail_audit_trail_id_seq OWNED BY core.audit_trail.audit_trail_id;
ALTER SEQUENCE core.audit_trail_audit_trail_id_seq OWNED BY core.audit_trail.audit_trail_id;




--
--
-- Name: audit_trail_2025_12; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail_2025_12; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail_2025_12 (
CREATE TABLE core.audit_trail_2025_12 (
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
);
);






--
--
-- Name: audit_trail_2026_01; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail_2026_01; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail_2026_01 (
CREATE TABLE core.audit_trail_2026_01 (
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
);
);






--
--
-- Name: audit_trail_2026_02; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail_2026_02; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail_2026_02 (
CREATE TABLE core.audit_trail_2026_02 (
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
);
);






--
--
-- Name: audit_trail_2026_03; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail_2026_03; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail_2026_03 (
CREATE TABLE core.audit_trail_2026_03 (
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
);
);






--
--
-- Name: audit_trail_2026_04; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail_2026_04; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail_2026_04 (
CREATE TABLE core.audit_trail_2026_04 (
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
);
);






--
--
-- Name: audit_trail_2026_05; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail_2026_05; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail_2026_05 (
CREATE TABLE core.audit_trail_2026_05 (
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
);
);






--
--
-- Name: audit_trail_2026_06; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail_2026_06; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail_2026_06 (
CREATE TABLE core.audit_trail_2026_06 (
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
);
);






--
--
-- Name: audit_trail_2026_07; Type: TABLE; Schema: core; Owner: -
-- Name: audit_trail_2026_07; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.audit_trail_2026_07 (
CREATE TABLE core.audit_trail_2026_07 (
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    audit_trail_id bigint DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass) NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_category text NOT NULL,
    action_category text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    performed_by uuid,
    performed_by uuid,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    performed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
    CONSTRAINT audit_trail_action_category_check CHECK ((action_category = ANY (ARRAY['READ'::text, 'WRITE'::text, 'ADMIN'::text])))
);
);






--
--
-- Name: company; Type: TABLE; Schema: core; Owner: -
-- Name: company; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.company (
CREATE TABLE core.company (
    company_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_code text NOT NULL,
    company_code text NOT NULL,
    company_name text NOT NULL,
    company_name text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    timezone text DEFAULT 'Asia/Tokyo'::text NOT NULL,
    timezone text DEFAULT 'Asia/Tokyo'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: company_license_company_license_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: company_license_company_license_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.company_license_company_license_id_seq
CREATE SEQUENCE core.company_license_company_license_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: company_license_company_license_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: company_license_company_license_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.company_license_company_license_id_seq OWNED BY core.company_license.company_license_id;
ALTER SEQUENCE core.company_license_company_license_id_seq OWNED BY core.company_license.company_license_id;




--
--
-- Name: company_permission; Type: TABLE; Schema: core; Owner: -
-- Name: company_permission; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.company_permission (
CREATE TABLE core.company_permission (
    company_permission_id bigint NOT NULL,
    company_permission_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    permission_code text NOT NULL,
    permission_code text NOT NULL,
    enabled boolean DEFAULT true NOT NULL,
    enabled boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: company_permission_company_permission_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: company_permission_company_permission_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.company_permission_company_permission_id_seq
CREATE SEQUENCE core.company_permission_company_permission_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: company_permission_company_permission_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: company_permission_company_permission_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.company_permission_company_permission_id_seq OWNED BY core.company_permission.company_permission_id;
ALTER SEQUENCE core.company_permission_company_permission_id_seq OWNED BY core.company_permission.company_permission_id;




--
--
-- Name: company_users; Type: TABLE; Schema: core; Owner: -
-- Name: company_users; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.company_users (
CREATE TABLE core.company_users (
    company_user_id bigint NOT NULL,
    company_user_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    role_code text,
    role_code text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: company_users_company_user_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: company_users_company_user_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.company_users_company_user_id_seq
CREATE SEQUENCE core.company_users_company_user_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: company_users_company_user_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: company_users_company_user_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.company_users_company_user_id_seq OWNED BY core.company_users.company_user_id;
ALTER SEQUENCE core.company_users_company_user_id_seq OWNED BY core.company_users.company_user_id;




--
--
-- Name: document_sequence; Type: TABLE; Schema: core; Owner: -
-- Name: document_sequence; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.document_sequence (
CREATE TABLE core.document_sequence (
    sequence_id bigint NOT NULL,
    sequence_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    doc_type text NOT NULL,
    doc_type text NOT NULL,
    prefix text DEFAULT ''::text NOT NULL,
    prefix text DEFAULT ''::text NOT NULL,
    current_no bigint DEFAULT 0 NOT NULL,
    current_no bigint DEFAULT 0 NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: document_sequence_sequence_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: document_sequence_sequence_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.document_sequence_sequence_id_seq
CREATE SEQUENCE core.document_sequence_sequence_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: document_sequence_sequence_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: document_sequence_sequence_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.document_sequence_sequence_id_seq OWNED BY core.document_sequence.sequence_id;
ALTER SEQUENCE core.document_sequence_sequence_id_seq OWNED BY core.document_sequence.sequence_id;




--
--
-- Name: entity_attribute_def; Type: TABLE; Schema: core; Owner: -
-- Name: entity_attribute_def; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.entity_attribute_def (
CREATE TABLE core.entity_attribute_def (
    attribute_def_id bigint NOT NULL,
    attribute_def_id bigint NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    attribute_code text NOT NULL,
    attribute_code text NOT NULL,
    attribute_name text NOT NULL,
    attribute_name text NOT NULL,
    data_type text NOT NULL,
    data_type text NOT NULL,
    is_required boolean DEFAULT false NOT NULL,
    is_required boolean DEFAULT false NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: entity_attribute_def_attribute_def_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: entity_attribute_def_attribute_def_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.entity_attribute_def_attribute_def_id_seq
CREATE SEQUENCE core.entity_attribute_def_attribute_def_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: entity_attribute_def_attribute_def_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: entity_attribute_def_attribute_def_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.entity_attribute_def_attribute_def_id_seq OWNED BY core.entity_attribute_def.attribute_def_id;
ALTER SEQUENCE core.entity_attribute_def_attribute_def_id_seq OWNED BY core.entity_attribute_def.attribute_def_id;




--
--
-- Name: entity_attribute_value; Type: TABLE; Schema: core; Owner: -
-- Name: entity_attribute_value; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.entity_attribute_value (
CREATE TABLE core.entity_attribute_value (
    attribute_value_id bigint NOT NULL,
    attribute_value_id bigint NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    attribute_def_id bigint NOT NULL,
    attribute_def_id bigint NOT NULL,
    value_text text,
    value_text text,
    value_number numeric(18,4),
    value_number numeric(18,4),
    value_date date,
    value_date date,
    value_boolean boolean,
    value_boolean boolean,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: entity_attribute_value_attribute_value_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: entity_attribute_value_attribute_value_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.entity_attribute_value_attribute_value_id_seq
CREATE SEQUENCE core.entity_attribute_value_attribute_value_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: entity_attribute_value_attribute_value_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: entity_attribute_value_attribute_value_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.entity_attribute_value_attribute_value_id_seq OWNED BY core.entity_attribute_value.attribute_value_id;
ALTER SEQUENCE core.entity_attribute_value_attribute_value_id_seq OWNED BY core.entity_attribute_value.attribute_value_id;




--
--
-- Name: journal_entries; Type: TABLE; Schema: core; Owner: -
-- Name: journal_entries; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.journal_entries (
CREATE TABLE core.journal_entries (
    journal_id bigint NOT NULL,
    journal_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    period_id bigint,
    period_id bigint,
    journal_date date NOT NULL,
    journal_date date NOT NULL,
    description text,
    description text,
    source_type text,
    source_type text,
    source_id text,
    source_id text,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: journal_entries_journal_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: journal_entries_journal_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.journal_entries_journal_id_seq
CREATE SEQUENCE core.journal_entries_journal_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: journal_entries_journal_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: journal_entries_journal_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.journal_entries_journal_id_seq OWNED BY core.journal_entries.journal_id;
ALTER SEQUENCE core.journal_entries_journal_id_seq OWNED BY core.journal_entries.journal_id;




--
--
-- Name: journal_lines; Type: TABLE; Schema: core; Owner: -
-- Name: journal_lines; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.journal_lines (
CREATE TABLE core.journal_lines (
    journal_line_id bigint NOT NULL,
    journal_line_id bigint NOT NULL,
    journal_id bigint NOT NULL,
    journal_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    account_id bigint NOT NULL,
    account_id bigint NOT NULL,
    debit_amount numeric(18,2) DEFAULT 0 NOT NULL,
    debit_amount numeric(18,2) DEFAULT 0 NOT NULL,
    credit_amount numeric(18,2) DEFAULT 0 NOT NULL,
    credit_amount numeric(18,2) DEFAULT 0 NOT NULL,
    memo text,
    memo text,
    CONSTRAINT journal_lines_check CHECK ((((debit_amount = (0)::numeric) AND (credit_amount > (0)::numeric)) OR ((credit_amount = (0)::numeric) AND (debit_amount > (0)::numeric))))
    CONSTRAINT journal_lines_check CHECK ((((debit_amount = (0)::numeric) AND (credit_amount > (0)::numeric)) OR ((credit_amount = (0)::numeric) AND (debit_amount > (0)::numeric))))
);
);




--
--
-- Name: journal_lines_journal_line_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: journal_lines_journal_line_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.journal_lines_journal_line_id_seq
CREATE SEQUENCE core.journal_lines_journal_line_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: journal_lines_journal_line_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: journal_lines_journal_line_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.journal_lines_journal_line_id_seq OWNED BY core.journal_lines.journal_line_id;
ALTER SEQUENCE core.journal_lines_journal_line_id_seq OWNED BY core.journal_lines.journal_line_id;




--
--
-- Name: journal_source_link; Type: TABLE; Schema: core; Owner: -
-- Name: journal_source_link; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.journal_source_link (
CREATE TABLE core.journal_source_link (
    journal_source_link_id bigint NOT NULL,
    journal_source_link_id bigint NOT NULL,
    journal_id bigint NOT NULL,
    journal_id bigint NOT NULL,
    source_type text NOT NULL,
    source_type text NOT NULL,
    source_id text NOT NULL,
    source_id text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: journal_source_link_journal_source_link_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: journal_source_link_journal_source_link_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.journal_source_link_journal_source_link_id_seq
CREATE SEQUENCE core.journal_source_link_journal_source_link_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: journal_source_link_journal_source_link_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: journal_source_link_journal_source_link_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.journal_source_link_journal_source_link_id_seq OWNED BY core.journal_source_link.journal_source_link_id;
ALTER SEQUENCE core.journal_source_link_journal_source_link_id_seq OWNED BY core.journal_source_link.journal_source_link_id;




--
--
-- Name: license_master; Type: TABLE; Schema: core; Owner: -
-- Name: license_master; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.license_master (
CREATE TABLE core.license_master (
    code text NOT NULL,
    code text NOT NULL,
    name text NOT NULL,
    name text NOT NULL,
    description text,
    description text,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: login_history; Type: TABLE; Schema: core; Owner: -
-- Name: login_history; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.login_history (
CREATE TABLE core.login_history (
    login_id bigint NOT NULL,
    login_id bigint NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    logged_in_at timestamp with time zone DEFAULT now() NOT NULL,
    logged_in_at timestamp with time zone DEFAULT now() NOT NULL,
    ip_addr inet,
    ip_addr inet,
    user_agent text
    user_agent text
);
);




--
--
-- Name: login_history_login_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: login_history_login_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.login_history_login_id_seq
CREATE SEQUENCE core.login_history_login_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: login_history_login_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: login_history_login_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.login_history_login_id_seq OWNED BY core.login_history.login_id;
ALTER SEQUENCE core.login_history_login_id_seq OWNED BY core.login_history.login_id;




--
--
-- Name: payment_method; Type: TABLE; Schema: core; Owner: -
-- Name: payment_method; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.payment_method (
CREATE TABLE core.payment_method (
    payment_method_code text NOT NULL,
    payment_method_code text NOT NULL,
    payment_method_name text NOT NULL,
    payment_method_name text NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: payment_term; Type: TABLE; Schema: core; Owner: -
-- Name: payment_term; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.payment_term (
CREATE TABLE core.payment_term (
    payment_term_id bigint NOT NULL,
    payment_term_id bigint NOT NULL,
    term_code text NOT NULL,
    term_code text NOT NULL,
    term_name text NOT NULL,
    term_name text NOT NULL,
    closing_day integer,
    closing_day integer,
    payment_offset_month integer DEFAULT 0 NOT NULL,
    payment_offset_month integer DEFAULT 0 NOT NULL,
    payment_day integer,
    payment_day integer,
    description text,
    description text,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: payment_term_payment_term_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: payment_term_payment_term_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.payment_term_payment_term_id_seq
CREATE SEQUENCE core.payment_term_payment_term_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: payment_term_payment_term_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: payment_term_payment_term_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.payment_term_payment_term_id_seq OWNED BY core.payment_term.payment_term_id;
ALTER SEQUENCE core.payment_term_payment_term_id_seq OWNED BY core.payment_term.payment_term_id;




--
--
-- Name: permission_group_permissions; Type: TABLE; Schema: core; Owner: -
-- Name: permission_group_permissions; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.permission_group_permissions (
CREATE TABLE core.permission_group_permissions (
    group_id bigint NOT NULL,
    group_id bigint NOT NULL,
    permission_id bigint NOT NULL
    permission_id bigint NOT NULL
);
);




--
--
-- Name: permission_groups; Type: TABLE; Schema: core; Owner: -
-- Name: permission_groups; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.permission_groups (
CREATE TABLE core.permission_groups (
    group_id bigint NOT NULL,
    group_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    group_code text NOT NULL,
    group_code text NOT NULL,
    group_name text NOT NULL,
    group_name text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: permission_groups_group_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: permission_groups_group_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.permission_groups_group_id_seq
CREATE SEQUENCE core.permission_groups_group_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: permission_groups_group_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: permission_groups_group_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.permission_groups_group_id_seq OWNED BY core.permission_groups.group_id;
ALTER SEQUENCE core.permission_groups_group_id_seq OWNED BY core.permission_groups.group_id;




--
--
-- Name: permissions; Type: TABLE; Schema: core; Owner: -
-- Name: permissions; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.permissions (
CREATE TABLE core.permissions (
    permission_id bigint NOT NULL,
    permission_id bigint NOT NULL,
    company_id uuid,
    company_id uuid,
    code text NOT NULL,
    code text NOT NULL,
    name text NOT NULL,
    name text NOT NULL,
    description text,
    description text,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: permissions_permission_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: permissions_permission_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.permissions_permission_id_seq
CREATE SEQUENCE core.permissions_permission_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: permissions_permission_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: permissions_permission_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.permissions_permission_id_seq OWNED BY core.permissions.permission_id;
ALTER SEQUENCE core.permissions_permission_id_seq OWNED BY core.permissions.permission_id;




--
--
-- Name: posting_profile; Type: TABLE; Schema: core; Owner: -
-- Name: posting_profile; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.posting_profile (
CREATE TABLE core.posting_profile (
    posting_profile_id bigint NOT NULL,
    posting_profile_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    profile_code text NOT NULL,
    profile_code text NOT NULL,
    source_type text NOT NULL,
    source_type text NOT NULL,
    debit_account_id bigint NOT NULL,
    debit_account_id bigint NOT NULL,
    credit_account_id bigint NOT NULL,
    credit_account_id bigint NOT NULL,
    description text,
    description text,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: posting_profile_posting_profile_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: posting_profile_posting_profile_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.posting_profile_posting_profile_id_seq
CREATE SEQUENCE core.posting_profile_posting_profile_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: posting_profile_posting_profile_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: posting_profile_posting_profile_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.posting_profile_posting_profile_id_seq OWNED BY core.posting_profile.posting_profile_id;
ALTER SEQUENCE core.posting_profile_posting_profile_id_seq OWNED BY core.posting_profile.posting_profile_id;




--
--
-- Name: reason_code_master; Type: TABLE; Schema: core; Owner: -
-- Name: reason_code_master; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.reason_code_master (
CREATE TABLE core.reason_code_master (
    reason_code text NOT NULL,
    reason_code text NOT NULL,
    reason_name text NOT NULL,
    reason_name text NOT NULL,
    target_ops text[] NOT NULL,
    target_ops text[] NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_to date,
    valid_to date,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: status_history; Type: TABLE; Schema: core; Owner: -
-- Name: status_history; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.status_history (
CREATE TABLE core.status_history (
    status_history_id bigint NOT NULL,
    status_history_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    from_status_code text,
    from_status_code text,
    to_status_code text NOT NULL,
    to_status_code text NOT NULL,
    changed_by uuid,
    changed_by uuid,
    changed_at timestamp with time zone DEFAULT now() NOT NULL,
    changed_at timestamp with time zone DEFAULT now() NOT NULL,
    reason text
    reason text
);
);






--
--
-- Name: status_history_status_history_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: status_history_status_history_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.status_history_status_history_id_seq
CREATE SEQUENCE core.status_history_status_history_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: status_history_status_history_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: status_history_status_history_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.status_history_status_history_id_seq OWNED BY core.status_history.status_history_id;
ALTER SEQUENCE core.status_history_status_history_id_seq OWNED BY core.status_history.status_history_id;




--
--
-- Name: status_master; Type: TABLE; Schema: core; Owner: -
-- Name: status_master; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.status_master (
CREATE TABLE core.status_master (
    status_id bigint NOT NULL,
    status_id bigint NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    status_code text NOT NULL,
    status_code text NOT NULL,
    status_name text NOT NULL,
    status_name text NOT NULL,
    sort_order integer DEFAULT 0 NOT NULL,
    sort_order integer DEFAULT 0 NOT NULL,
    is_terminal boolean DEFAULT false NOT NULL
    is_terminal boolean DEFAULT false NOT NULL
);
);




--
--
-- Name: status_master_status_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: status_master_status_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.status_master_status_id_seq
CREATE SEQUENCE core.status_master_status_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: status_master_status_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: status_master_status_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.status_master_status_id_seq OWNED BY core.status_master.status_id;
ALTER SEQUENCE core.status_master_status_id_seq OWNED BY core.status_master.status_id;




--
--
-- Name: sync_queue; Type: TABLE; Schema: core; Owner: -
-- Name: sync_queue; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.sync_queue (
CREATE TABLE core.sync_queue (
    sync_id bigint NOT NULL,
    sync_id bigint NOT NULL,
    company_id uuid,
    company_id uuid,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    last_error text,
    last_error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: sync_queue_sync_id_seq; Type: SEQUENCE; Schema: core; Owner: -
-- Name: sync_queue_sync_id_seq; Type: SEQUENCE; Schema: core; Owner: -
--
--


CREATE SEQUENCE core.sync_queue_sync_id_seq
CREATE SEQUENCE core.sync_queue_sync_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: sync_queue_sync_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
-- Name: sync_queue_sync_id_seq; Type: SEQUENCE OWNED BY; Schema: core; Owner: -
--
--


ALTER SEQUENCE core.sync_queue_sync_id_seq OWNED BY core.sync_queue.sync_id;
ALTER SEQUENCE core.sync_queue_sync_id_seq OWNED BY core.sync_queue.sync_id;




--
--
-- Name: uom; Type: TABLE; Schema: core; Owner: -
-- Name: uom; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.uom (
CREATE TABLE core.uom (
    uom_code text NOT NULL,
    uom_code text NOT NULL,
    uom_name text NOT NULL,
    uom_name text NOT NULL,
    uom_type text NOT NULL,
    uom_type text NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: uom_conversion; Type: TABLE; Schema: core; Owner: -
-- Name: uom_conversion; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.uom_conversion (
CREATE TABLE core.uom_conversion (
    from_uom_code text NOT NULL,
    from_uom_code text NOT NULL,
    to_uom_code text NOT NULL,
    to_uom_code text NOT NULL,
    conversion_rate numeric(18,6) NOT NULL
    conversion_rate numeric(18,6) NOT NULL
);
);




--
--
-- Name: user_permissions; Type: TABLE; Schema: core; Owner: -
-- Name: user_permissions; Type: TABLE; Schema: core; Owner: -
--
--


CREATE TABLE core.user_permissions (
CREATE TABLE core.user_permissions (
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    permission_id bigint NOT NULL,
    permission_id bigint NOT NULL,
    granted_at timestamp with time zone DEFAULT now() NOT NULL
    granted_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_audit_diff_only; Type: VIEW; Schema: core; Owner: -
-- Name: v_audit_diff_only; Type: VIEW; Schema: core; Owner: -
--
--


CREATE VIEW core.v_audit_diff_only AS
CREATE VIEW core.v_audit_diff_only AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    performed_at,
    performed_at,
    performed_by,
    performed_by,
    jsonb_strip_nulls(jsonb_object_agg(k, jsonb_build_object('before', before_val, 'after', after_val))) AS diff
    jsonb_strip_nulls(jsonb_object_agg(k, jsonb_build_object('before', before_val, 'after', after_val))) AS diff
   FROM ( SELECT at.audit_trail_id,
   FROM ( SELECT at.audit_trail_id,
            at.company_id,
            at.company_id,
            at.entity_type,
            at.entity_type,
            at.entity_id,
            at.entity_id,
            at.action,
            at.action,
            at.performed_at,
            at.performed_at,
            at.performed_by,
            at.performed_by,
            k.k,
            k.k,
            ((at.detail -> 'before'::text) -> k.k) AS before_val,
            ((at.detail -> 'before'::text) -> k.k) AS before_val,
            ((at.detail -> 'after'::text) -> k.k) AS after_val
            ((at.detail -> 'after'::text) -> k.k) AS after_val
           FROM core.audit_trail at,
           FROM core.audit_trail at,
            LATERAL jsonb_object_keys(COALESCE((at.detail -> 'after'::text), '{}'::jsonb)) k(k)
            LATERAL jsonb_object_keys(COALESCE((at.detail -> 'after'::text), '{}'::jsonb)) k(k)
          WHERE ((at.action = 'UPDATE'::text) AND (((at.detail -> 'before'::text) -> k.k) IS DISTINCT FROM ((at.detail -> 'after'::text) -> k.k)))) s
          WHERE ((at.action = 'UPDATE'::text) AND (((at.detail -> 'before'::text) -> k.k) IS DISTINCT FROM ((at.detail -> 'after'::text) -> k.k)))) s
  GROUP BY audit_trail_id, company_id, entity_type, entity_id, action, performed_at, performed_by;
  GROUP BY audit_trail_id, company_id, entity_type, entity_id, action, performed_at, performed_by;




--
--
-- Name: v_change_history_all; Type: VIEW; Schema: core; Owner: -
-- Name: v_change_history_all; Type: VIEW; Schema: core; Owner: -
--
--


CREATE VIEW core.v_change_history_all AS
CREATE VIEW core.v_change_history_all AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail;
   FROM core.audit_trail;




--
--
-- Name: codegen_artifact; Type: TABLE; Schema: devops; Owner: -
-- Name: codegen_artifact; Type: TABLE; Schema: devops; Owner: -
--
--


CREATE TABLE devops.codegen_artifact (
CREATE TABLE devops.codegen_artifact (
    artifact_id uuid DEFAULT gen_random_uuid() NOT NULL,
    artifact_id uuid DEFAULT gen_random_uuid() NOT NULL,
    run_id uuid NOT NULL,
    run_id uuid NOT NULL,
    kind text NOT NULL,
    kind text NOT NULL,
    path text NOT NULL,
    path text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: codegen_run; Type: TABLE; Schema: devops; Owner: -
-- Name: codegen_run; Type: TABLE; Schema: devops; Owner: -
--
--


CREATE TABLE devops.codegen_run (
CREATE TABLE devops.codegen_run (
    run_id uuid DEFAULT gen_random_uuid() NOT NULL,
    run_id uuid DEFAULT gen_random_uuid() NOT NULL,
    phase text NOT NULL,
    phase text NOT NULL,
    input_hash text NOT NULL,
    input_hash text NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    generated_at timestamp with time zone DEFAULT now() NOT NULL,
    generated_at timestamp with time zone DEFAULT now() NOT NULL,
    note text,
    note text,
    CONSTRAINT codegen_run_status_check CHECK ((status = ANY (ARRAY['success'::text, 'failure'::text])))
    CONSTRAINT codegen_run_status_check CHECK ((status = ANY (ARRAY['success'::text, 'failure'::text])))
);
);




--
--
-- Name: bank_account; Type: TABLE; Schema: finance; Owner: -
-- Name: bank_account; Type: TABLE; Schema: finance; Owner: -
--
--


CREATE TABLE finance.bank_account (
CREATE TABLE finance.bank_account (
    bank_account_id bigint NOT NULL,
    bank_account_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    bank_name text NOT NULL,
    bank_name text NOT NULL,
    branch_name text,
    branch_name text,
    account_type text NOT NULL,
    account_type text NOT NULL,
    account_number text NOT NULL,
    account_number text NOT NULL,
    account_name text NOT NULL,
    account_name text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: bank_account_bank_account_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
-- Name: bank_account_bank_account_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
--
--


CREATE SEQUENCE finance.bank_account_bank_account_id_seq
CREATE SEQUENCE finance.bank_account_bank_account_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: bank_account_bank_account_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
-- Name: bank_account_bank_account_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
--
--


ALTER SEQUENCE finance.bank_account_bank_account_id_seq OWNED BY finance.bank_account.bank_account_id;
ALTER SEQUENCE finance.bank_account_bank_account_id_seq OWNED BY finance.bank_account.bank_account_id;




--
--
-- Name: bank_statement_header; Type: TABLE; Schema: finance; Owner: -
-- Name: bank_statement_header; Type: TABLE; Schema: finance; Owner: -
--
--


CREATE TABLE finance.bank_statement_header (
CREATE TABLE finance.bank_statement_header (
    bank_statement_id bigint NOT NULL,
    bank_statement_id bigint NOT NULL,
    bank_account_id bigint NOT NULL,
    bank_account_id bigint NOT NULL,
    statement_date date NOT NULL,
    statement_date date NOT NULL,
    imported_at timestamp with time zone DEFAULT now() NOT NULL
    imported_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: bank_statement_header_bank_statement_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
-- Name: bank_statement_header_bank_statement_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
--
--


CREATE SEQUENCE finance.bank_statement_header_bank_statement_id_seq
CREATE SEQUENCE finance.bank_statement_header_bank_statement_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: bank_statement_header_bank_statement_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
-- Name: bank_statement_header_bank_statement_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
--
--


ALTER SEQUENCE finance.bank_statement_header_bank_statement_id_seq OWNED BY finance.bank_statement_header.bank_statement_id;
ALTER SEQUENCE finance.bank_statement_header_bank_statement_id_seq OWNED BY finance.bank_statement_header.bank_statement_id;




--
--
-- Name: bank_statement_line; Type: TABLE; Schema: finance; Owner: -
-- Name: bank_statement_line; Type: TABLE; Schema: finance; Owner: -
--
--


CREATE TABLE finance.bank_statement_line (
CREATE TABLE finance.bank_statement_line (
    bank_statement_line_id bigint NOT NULL,
    bank_statement_line_id bigint NOT NULL,
    bank_statement_id bigint NOT NULL,
    bank_statement_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    transaction_date date NOT NULL,
    transaction_date date NOT NULL,
    description text,
    description text,
    debit_amount numeric(18,2) DEFAULT 0 NOT NULL,
    debit_amount numeric(18,2) DEFAULT 0 NOT NULL,
    credit_amount numeric(18,2) DEFAULT 0 NOT NULL,
    credit_amount numeric(18,2) DEFAULT 0 NOT NULL,
    balance_amount numeric(18,2)
    balance_amount numeric(18,2)
);
);




--
--
-- Name: bank_statement_line_bank_statement_line_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
-- Name: bank_statement_line_bank_statement_line_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
--
--


CREATE SEQUENCE finance.bank_statement_line_bank_statement_line_id_seq
CREATE SEQUENCE finance.bank_statement_line_bank_statement_line_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: bank_statement_line_bank_statement_line_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
-- Name: bank_statement_line_bank_statement_line_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
--
--


ALTER SEQUENCE finance.bank_statement_line_bank_statement_line_id_seq OWNED BY finance.bank_statement_line.bank_statement_line_id;
ALTER SEQUENCE finance.bank_statement_line_bank_statement_line_id_seq OWNED BY finance.bank_statement_line.bank_statement_line_id;




--
--
-- Name: payment; Type: TABLE; Schema: finance; Owner: -
-- Name: payment; Type: TABLE; Schema: finance; Owner: -
--
--


CREATE TABLE finance.payment (
CREATE TABLE finance.payment (
    payment_id bigint NOT NULL,
    payment_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    payment_type text NOT NULL,
    payment_type text NOT NULL,
    partner_type text NOT NULL,
    partner_type text NOT NULL,
    partner_id bigint NOT NULL,
    partner_id bigint NOT NULL,
    payment_date date NOT NULL,
    payment_date date NOT NULL,
    amount numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    bank_account_id bigint,
    bank_account_id bigint,
    status_code text DEFAULT 'POSTED'::text NOT NULL,
    status_code text DEFAULT 'POSTED'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: payment_allocation; Type: TABLE; Schema: finance; Owner: -
-- Name: payment_allocation; Type: TABLE; Schema: finance; Owner: -
--
--


CREATE TABLE finance.payment_allocation (
CREATE TABLE finance.payment_allocation (
    payment_allocation_id bigint NOT NULL,
    payment_allocation_id bigint NOT NULL,
    payment_id bigint NOT NULL,
    payment_id bigint NOT NULL,
    source_type text NOT NULL,
    source_type text NOT NULL,
    source_id bigint NOT NULL,
    source_id bigint NOT NULL,
    allocated_amount numeric(18,2) NOT NULL,
    allocated_amount numeric(18,2) NOT NULL,
    allocated_at timestamp with time zone DEFAULT now() NOT NULL
    allocated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: payment_allocation_payment_allocation_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
-- Name: payment_allocation_payment_allocation_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
--
--


CREATE SEQUENCE finance.payment_allocation_payment_allocation_id_seq
CREATE SEQUENCE finance.payment_allocation_payment_allocation_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: payment_allocation_payment_allocation_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
-- Name: payment_allocation_payment_allocation_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
--
--


ALTER SEQUENCE finance.payment_allocation_payment_allocation_id_seq OWNED BY finance.payment_allocation.payment_allocation_id;
ALTER SEQUENCE finance.payment_allocation_payment_allocation_id_seq OWNED BY finance.payment_allocation.payment_allocation_id;




--
--
-- Name: payment_payment_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
-- Name: payment_payment_id_seq; Type: SEQUENCE; Schema: finance; Owner: -
--
--


CREATE SEQUENCE finance.payment_payment_id_seq
CREATE SEQUENCE finance.payment_payment_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: payment_payment_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
-- Name: payment_payment_id_seq; Type: SEQUENCE OWNED BY; Schema: finance; Owner: -
--
--


ALTER SEQUENCE finance.payment_payment_id_seq OWNED BY finance.payment.payment_id;
ALTER SEQUENCE finance.payment_payment_id_seq OWNED BY finance.payment.payment_id;




--
--
-- Name: business_rule; Type: TABLE; Schema: governance; Owner: -
-- Name: business_rule; Type: TABLE; Schema: governance; Owner: -
--
--


CREATE TABLE governance.business_rule (
CREATE TABLE governance.business_rule (
    business_rule_id bigint NOT NULL,
    business_rule_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    rule_code text NOT NULL,
    rule_code text NOT NULL,
    target_entity text NOT NULL,
    target_entity text NOT NULL,
    rule_type text NOT NULL,
    rule_type text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: business_rule_action; Type: TABLE; Schema: governance; Owner: -
-- Name: business_rule_action; Type: TABLE; Schema: governance; Owner: -
--
--


CREATE TABLE governance.business_rule_action (
CREATE TABLE governance.business_rule_action (
    rule_action_id bigint NOT NULL,
    rule_action_id bigint NOT NULL,
    business_rule_id bigint NOT NULL,
    business_rule_id bigint NOT NULL,
    action_type text NOT NULL,
    action_type text NOT NULL,
    action_value text
    action_value text
);
);




--
--
-- Name: business_rule_action_rule_action_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
-- Name: business_rule_action_rule_action_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
--
--


CREATE SEQUENCE governance.business_rule_action_rule_action_id_seq
CREATE SEQUENCE governance.business_rule_action_rule_action_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: business_rule_action_rule_action_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
-- Name: business_rule_action_rule_action_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
--
--


ALTER SEQUENCE governance.business_rule_action_rule_action_id_seq OWNED BY governance.business_rule_action.rule_action_id;
ALTER SEQUENCE governance.business_rule_action_rule_action_id_seq OWNED BY governance.business_rule_action.rule_action_id;




--
--
-- Name: business_rule_business_rule_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
-- Name: business_rule_business_rule_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
--
--


CREATE SEQUENCE governance.business_rule_business_rule_id_seq
CREATE SEQUENCE governance.business_rule_business_rule_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: business_rule_business_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
-- Name: business_rule_business_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
--
--


ALTER SEQUENCE governance.business_rule_business_rule_id_seq OWNED BY governance.business_rule.business_rule_id;
ALTER SEQUENCE governance.business_rule_business_rule_id_seq OWNED BY governance.business_rule.business_rule_id;




--
--
-- Name: business_rule_condition; Type: TABLE; Schema: governance; Owner: -
-- Name: business_rule_condition; Type: TABLE; Schema: governance; Owner: -
--
--


CREATE TABLE governance.business_rule_condition (
CREATE TABLE governance.business_rule_condition (
    rule_condition_id bigint NOT NULL,
    rule_condition_id bigint NOT NULL,
    business_rule_id bigint NOT NULL,
    business_rule_id bigint NOT NULL,
    condition_expr text NOT NULL,
    condition_expr text NOT NULL,
    priority integer DEFAULT 1 NOT NULL
    priority integer DEFAULT 1 NOT NULL
);
);




--
--
-- Name: business_rule_condition_rule_condition_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
-- Name: business_rule_condition_rule_condition_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
--
--


CREATE SEQUENCE governance.business_rule_condition_rule_condition_id_seq
CREATE SEQUENCE governance.business_rule_condition_rule_condition_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: business_rule_condition_rule_condition_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
-- Name: business_rule_condition_rule_condition_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
--
--


ALTER SEQUENCE governance.business_rule_condition_rule_condition_id_seq OWNED BY governance.business_rule_condition.rule_condition_id;
ALTER SEQUENCE governance.business_rule_condition_rule_condition_id_seq OWNED BY governance.business_rule_condition.rule_condition_id;




--
--
-- Name: contract_header; Type: TABLE; Schema: governance; Owner: -
-- Name: contract_header; Type: TABLE; Schema: governance; Owner: -
--
--


CREATE TABLE governance.contract_header (
CREATE TABLE governance.contract_header (
    contract_id bigint NOT NULL,
    contract_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    contract_type text NOT NULL,
    contract_type text NOT NULL,
    partner_type text NOT NULL,
    partner_type text NOT NULL,
    partner_id bigint NOT NULL,
    partner_id bigint NOT NULL,
    start_date date NOT NULL,
    start_date date NOT NULL,
    end_date date,
    end_date date,
    status_code text DEFAULT 'ACTIVE'::text NOT NULL,
    status_code text DEFAULT 'ACTIVE'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: contract_header_contract_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
-- Name: contract_header_contract_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
--
--


CREATE SEQUENCE governance.contract_header_contract_id_seq
CREATE SEQUENCE governance.contract_header_contract_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: contract_header_contract_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
-- Name: contract_header_contract_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
--
--


ALTER SEQUENCE governance.contract_header_contract_id_seq OWNED BY governance.contract_header.contract_id;
ALTER SEQUENCE governance.contract_header_contract_id_seq OWNED BY governance.contract_header.contract_id;




--
--
-- Name: contract_item_price; Type: TABLE; Schema: governance; Owner: -
-- Name: contract_item_price; Type: TABLE; Schema: governance; Owner: -
--
--


CREATE TABLE governance.contract_item_price (
CREATE TABLE governance.contract_item_price (
    contract_item_price_id bigint NOT NULL,
    contract_item_price_id bigint NOT NULL,
    contract_id bigint NOT NULL,
    contract_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    price numeric(18,2) NOT NULL,
    price numeric(18,2) NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    priority integer DEFAULT 1 NOT NULL
    priority integer DEFAULT 1 NOT NULL
);
);




--
--
-- Name: contract_item_price_contract_item_price_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
-- Name: contract_item_price_contract_item_price_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
--
--


CREATE SEQUENCE governance.contract_item_price_contract_item_price_id_seq
CREATE SEQUENCE governance.contract_item_price_contract_item_price_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: contract_item_price_contract_item_price_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
-- Name: contract_item_price_contract_item_price_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
--
--


ALTER SEQUENCE governance.contract_item_price_contract_item_price_id_seq OWNED BY governance.contract_item_price.contract_item_price_id;
ALTER SEQUENCE governance.contract_item_price_contract_item_price_id_seq OWNED BY governance.contract_item_price.contract_item_price_id;




--
--
-- Name: document_archive; Type: TABLE; Schema: governance; Owner: -
-- Name: document_archive; Type: TABLE; Schema: governance; Owner: -
--
--


CREATE TABLE governance.document_archive (
CREATE TABLE governance.document_archive (
    document_archive_id bigint NOT NULL,
    document_archive_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    document_category_id bigint NOT NULL,
    document_category_id bigint NOT NULL,
    related_entity_type text,
    related_entity_type text,
    related_entity_id text,
    related_entity_id text,
    file_path text NOT NULL,
    file_path text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: document_archive_document_archive_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
-- Name: document_archive_document_archive_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
--
--


CREATE SEQUENCE governance.document_archive_document_archive_id_seq
CREATE SEQUENCE governance.document_archive_document_archive_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: document_archive_document_archive_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
-- Name: document_archive_document_archive_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
--
--


ALTER SEQUENCE governance.document_archive_document_archive_id_seq OWNED BY governance.document_archive.document_archive_id;
ALTER SEQUENCE governance.document_archive_document_archive_id_seq OWNED BY governance.document_archive.document_archive_id;




--
--
-- Name: document_category; Type: TABLE; Schema: governance; Owner: -
-- Name: document_category; Type: TABLE; Schema: governance; Owner: -
--
--


CREATE TABLE governance.document_category (
CREATE TABLE governance.document_category (
    document_category_id bigint NOT NULL,
    document_category_id bigint NOT NULL,
    category_code text NOT NULL,
    category_code text NOT NULL,
    category_name text NOT NULL,
    category_name text NOT NULL,
    retention_years integer DEFAULT 7 NOT NULL
    retention_years integer DEFAULT 7 NOT NULL
);
);




--
--
-- Name: document_category_document_category_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
-- Name: document_category_document_category_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
--
--


CREATE SEQUENCE governance.document_category_document_category_id_seq
CREATE SEQUENCE governance.document_category_document_category_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: document_category_document_category_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
-- Name: document_category_document_category_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
--
--


ALTER SEQUENCE governance.document_category_document_category_id_seq OWNED BY governance.document_category.document_category_id;
ALTER SEQUENCE governance.document_category_document_category_id_seq OWNED BY governance.document_category.document_category_id;




--
--
-- Name: policy_change_queue_policy_change_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
-- Name: policy_change_queue_policy_change_id_seq; Type: SEQUENCE; Schema: governance; Owner: -
--
--


CREATE SEQUENCE governance.policy_change_queue_policy_change_id_seq
CREATE SEQUENCE governance.policy_change_queue_policy_change_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: policy_change_queue_policy_change_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
-- Name: policy_change_queue_policy_change_id_seq; Type: SEQUENCE OWNED BY; Schema: governance; Owner: -
--
--


ALTER SEQUENCE governance.policy_change_queue_policy_change_id_seq OWNED BY governance.policy_change_queue.policy_change_id;
ALTER SEQUENCE governance.policy_change_queue_policy_change_id_seq OWNED BY governance.policy_change_queue.policy_change_id;




--
--
-- Name: v_policy_yaml_source; Type: VIEW; Schema: governance; Owner: -
-- Name: v_policy_yaml_source; Type: VIEW; Schema: governance; Owner: -
--
--


CREATE VIEW governance.v_policy_yaml_source AS
CREATE VIEW governance.v_policy_yaml_source AS
 SELECT policy_key,
 SELECT policy_key,
    proposed_value
    proposed_value
   FROM governance.policy_change_queue
   FROM governance.policy_change_queue
  WHERE (status = 'approved'::text)
  WHERE (status = 'approved'::text)
  ORDER BY policy_key;
  ORDER BY policy_key;




--
--
-- Name: attendance_log; Type: TABLE; Schema: hr; Owner: -
-- Name: attendance_log; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.attendance_log (
CREATE TABLE hr.attendance_log (
    attendance_log_id bigint NOT NULL,
    attendance_log_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    employee_id bigint NOT NULL,
    employee_id bigint NOT NULL,
    work_date date NOT NULL,
    work_date date NOT NULL,
    clock_in timestamp with time zone,
    clock_in timestamp with time zone,
    clock_out timestamp with time zone,
    clock_out timestamp with time zone,
    work_minutes integer
    work_minutes integer
);
);






--
--
-- Name: attendance_log_attendance_log_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
-- Name: attendance_log_attendance_log_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
--
--


CREATE SEQUENCE hr.attendance_log_attendance_log_id_seq
CREATE SEQUENCE hr.attendance_log_attendance_log_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: attendance_log_attendance_log_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
-- Name: attendance_log_attendance_log_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
--
--


ALTER SEQUENCE hr.attendance_log_attendance_log_id_seq OWNED BY hr.attendance_log.attendance_log_id;
ALTER SEQUENCE hr.attendance_log_attendance_log_id_seq OWNED BY hr.attendance_log.attendance_log_id;




--
--
-- Name: employee; Type: TABLE; Schema: hr; Owner: -
-- Name: employee; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.employee (
CREATE TABLE hr.employee (
    employee_id bigint NOT NULL,
    employee_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    employee_code text NOT NULL,
    employee_code text NOT NULL,
    employee_name text NOT NULL,
    employee_name text NOT NULL,
    department_id bigint,
    department_id bigint,
    position_id bigint,
    position_id bigint,
    hired_date date,
    hired_date date,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: employee_employee_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
-- Name: employee_employee_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
--
--


CREATE SEQUENCE hr.employee_employee_id_seq
CREATE SEQUENCE hr.employee_employee_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: employee_employee_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
-- Name: employee_employee_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
--
--


ALTER SEQUENCE hr.employee_employee_id_seq OWNED BY hr.employee.employee_id;
ALTER SEQUENCE hr.employee_employee_id_seq OWNED BY hr.employee.employee_id;




--
--
-- Name: employment_contract; Type: TABLE; Schema: hr; Owner: -
-- Name: employment_contract; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.employment_contract (
CREATE TABLE hr.employment_contract (
    employment_contract_id bigint NOT NULL,
    employment_contract_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    employee_id bigint NOT NULL,
    employee_id bigint NOT NULL,
    employment_type text NOT NULL,
    employment_type text NOT NULL,
    start_date date NOT NULL,
    start_date date NOT NULL,
    end_date date,
    end_date date,
    base_salary numeric(18,2),
    base_salary numeric(18,2),
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: employment_contract_employment_contract_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
-- Name: employment_contract_employment_contract_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
--
--


CREATE SEQUENCE hr.employment_contract_employment_contract_id_seq
CREATE SEQUENCE hr.employment_contract_employment_contract_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: employment_contract_employment_contract_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
-- Name: employment_contract_employment_contract_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
--
--


ALTER SEQUENCE hr.employment_contract_employment_contract_id_seq OWNED BY hr.employment_contract.employment_contract_id;
ALTER SEQUENCE hr.employment_contract_employment_contract_id_seq OWNED BY hr.employment_contract.employment_contract_id;




--
--
-- Name: hr_department; Type: TABLE; Schema: hr; Owner: -
-- Name: hr_department; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.hr_department (
CREATE TABLE hr.hr_department (
    department_id bigint NOT NULL,
    department_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    department_code text NOT NULL,
    department_code text NOT NULL,
    department_name text NOT NULL
    department_name text NOT NULL
);
);






--
--
-- Name: hr_department_department_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
-- Name: hr_department_department_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
--
--


CREATE SEQUENCE hr.hr_department_department_id_seq
CREATE SEQUENCE hr.hr_department_department_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: hr_department_department_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
-- Name: hr_department_department_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
--
--


ALTER SEQUENCE hr.hr_department_department_id_seq OWNED BY hr.hr_department.department_id;
ALTER SEQUENCE hr.hr_department_department_id_seq OWNED BY hr.hr_department.department_id;




--
--
-- Name: hr_position; Type: TABLE; Schema: hr; Owner: -
-- Name: hr_position; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.hr_position (
CREATE TABLE hr.hr_position (
    position_id bigint NOT NULL,
    position_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    position_code text NOT NULL,
    position_code text NOT NULL,
    position_name text NOT NULL
    position_name text NOT NULL
);
);






--
--
-- Name: hr_position_position_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
-- Name: hr_position_position_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
--
--


CREATE SEQUENCE hr.hr_position_position_id_seq
CREATE SEQUENCE hr.hr_position_position_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: hr_position_position_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
-- Name: hr_position_position_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
--
--


ALTER SEQUENCE hr.hr_position_position_id_seq OWNED BY hr.hr_position.position_id;
ALTER SEQUENCE hr.hr_position_position_id_seq OWNED BY hr.hr_position.position_id;




--
--
-- Name: leave_request; Type: TABLE; Schema: hr; Owner: -
-- Name: leave_request; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.leave_request (
CREATE TABLE hr.leave_request (
    leave_request_id bigint NOT NULL,
    leave_request_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    employee_id bigint NOT NULL,
    employee_id bigint NOT NULL,
    leave_type_code text NOT NULL,
    leave_type_code text NOT NULL,
    start_date date NOT NULL,
    start_date date NOT NULL,
    end_date date NOT NULL,
    end_date date NOT NULL,
    status_code text DEFAULT 'REQUESTED'::text NOT NULL,
    status_code text DEFAULT 'REQUESTED'::text NOT NULL,
    approved_by uuid,
    approved_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: leave_request_leave_request_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
-- Name: leave_request_leave_request_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
--
--


CREATE SEQUENCE hr.leave_request_leave_request_id_seq
CREATE SEQUENCE hr.leave_request_leave_request_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: leave_request_leave_request_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
-- Name: leave_request_leave_request_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
--
--


ALTER SEQUENCE hr.leave_request_leave_request_id_seq OWNED BY hr.leave_request.leave_request_id;
ALTER SEQUENCE hr.leave_request_leave_request_id_seq OWNED BY hr.leave_request.leave_request_id;




--
--
-- Name: leave_type; Type: TABLE; Schema: hr; Owner: -
-- Name: leave_type; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.leave_type (
CREATE TABLE hr.leave_type (
    leave_type_code text NOT NULL,
    leave_type_code text NOT NULL,
    leave_type_name text NOT NULL
    leave_type_name text NOT NULL
);
);




--
--
-- Name: payroll_run; Type: TABLE; Schema: hr; Owner: -
-- Name: payroll_run; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.payroll_run (
CREATE TABLE hr.payroll_run (
    payroll_run_id bigint NOT NULL,
    payroll_run_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    pay_month date NOT NULL,
    pay_month date NOT NULL,
    status_code text DEFAULT 'CALCULATED'::text NOT NULL,
    status_code text DEFAULT 'CALCULATED'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: payroll_run_payroll_run_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
-- Name: payroll_run_payroll_run_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
--
--


CREATE SEQUENCE hr.payroll_run_payroll_run_id_seq
CREATE SEQUENCE hr.payroll_run_payroll_run_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: payroll_run_payroll_run_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
-- Name: payroll_run_payroll_run_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
--
--


ALTER SEQUENCE hr.payroll_run_payroll_run_id_seq OWNED BY hr.payroll_run.payroll_run_id;
ALTER SEQUENCE hr.payroll_run_payroll_run_id_seq OWNED BY hr.payroll_run.payroll_run_id;




--
--
-- Name: payroll_slip; Type: TABLE; Schema: hr; Owner: -
-- Name: payroll_slip; Type: TABLE; Schema: hr; Owner: -
--
--


CREATE TABLE hr.payroll_slip (
CREATE TABLE hr.payroll_slip (
    payroll_slip_id bigint NOT NULL,
    payroll_slip_id bigint NOT NULL,
    payroll_run_id bigint NOT NULL,
    payroll_run_id bigint NOT NULL,
    employee_id bigint NOT NULL,
    employee_id bigint NOT NULL,
    gross_pay numeric(18,2) DEFAULT 0 NOT NULL,
    gross_pay numeric(18,2) DEFAULT 0 NOT NULL,
    net_pay numeric(18,2) DEFAULT 0 NOT NULL,
    net_pay numeric(18,2) DEFAULT 0 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: payroll_slip_payroll_slip_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
-- Name: payroll_slip_payroll_slip_id_seq; Type: SEQUENCE; Schema: hr; Owner: -
--
--


CREATE SEQUENCE hr.payroll_slip_payroll_slip_id_seq
CREATE SEQUENCE hr.payroll_slip_payroll_slip_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: payroll_slip_payroll_slip_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
-- Name: payroll_slip_payroll_slip_id_seq; Type: SEQUENCE OWNED BY; Schema: hr; Owner: -
--
--


ALTER SEQUENCE hr.payroll_slip_payroll_slip_id_seq OWNED BY hr.payroll_slip.payroll_slip_id;
ALTER SEQUENCE hr.payroll_slip_payroll_slip_id_seq OWNED BY hr.payroll_slip.payroll_slip_id;




--
--
-- Name: v_change_history; Type: VIEW; Schema: hr; Owner: -
-- Name: v_change_history; Type: VIEW; Schema: hr; Owner: -
--
--


CREATE VIEW hr.v_change_history AS
CREATE VIEW hr.v_change_history AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail
   FROM core.audit_trail
  WHERE (entity_type ~~ 'hr.%'::text);
  WHERE (entity_type ~~ 'hr.%'::text);




--
--
-- Name: api_credential; Type: TABLE; Schema: integration; Owner: -
-- Name: api_credential; Type: TABLE; Schema: integration; Owner: -
--
--


CREATE TABLE integration.api_credential (
CREATE TABLE integration.api_credential (
    api_credential_id bigint NOT NULL,
    api_credential_id bigint NOT NULL,
    external_system_id bigint NOT NULL,
    external_system_id bigint NOT NULL,
    auth_type text NOT NULL,
    auth_type text NOT NULL,
    credential_ref text NOT NULL,
    credential_ref text NOT NULL,
    expires_at timestamp with time zone
    expires_at timestamp with time zone
);
);




--
--
-- Name: api_credential_api_credential_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
-- Name: api_credential_api_credential_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
--
--


CREATE SEQUENCE integration.api_credential_api_credential_id_seq
CREATE SEQUENCE integration.api_credential_api_credential_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: api_credential_api_credential_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
-- Name: api_credential_api_credential_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
--
--


ALTER SEQUENCE integration.api_credential_api_credential_id_seq OWNED BY integration.api_credential.api_credential_id;
ALTER SEQUENCE integration.api_credential_api_credential_id_seq OWNED BY integration.api_credential.api_credential_id;




--
--
-- Name: audit_export_queue; Type: TABLE; Schema: integration; Owner: -
-- Name: audit_export_queue; Type: TABLE; Schema: integration; Owner: -
--
--


CREATE TABLE integration.audit_export_queue (
CREATE TABLE integration.audit_export_queue (
    export_id bigint NOT NULL,
    export_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    from_time timestamp with time zone NOT NULL,
    from_time timestamp with time zone NOT NULL,
    to_time timestamp with time zone NOT NULL,
    to_time timestamp with time zone NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    last_error text,
    last_error text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT audit_export_queue_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'RUNNING'::text, 'DONE'::text, 'FAILED'::text])))
    CONSTRAINT audit_export_queue_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'RUNNING'::text, 'DONE'::text, 'FAILED'::text])))
);
);






--
--
-- Name: audit_export_queue_export_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
-- Name: audit_export_queue_export_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
--
--


CREATE SEQUENCE integration.audit_export_queue_export_id_seq
CREATE SEQUENCE integration.audit_export_queue_export_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_export_queue_export_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
-- Name: audit_export_queue_export_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
--
--


ALTER SEQUENCE integration.audit_export_queue_export_id_seq OWNED BY integration.audit_export_queue.export_id;
ALTER SEQUENCE integration.audit_export_queue_export_id_seq OWNED BY integration.audit_export_queue.export_id;




--
--
-- Name: external_system; Type: TABLE; Schema: integration; Owner: -
-- Name: external_system; Type: TABLE; Schema: integration; Owner: -
--
--


CREATE TABLE integration.external_system (
CREATE TABLE integration.external_system (
    external_system_id bigint NOT NULL,
    external_system_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    system_code text NOT NULL,
    system_code text NOT NULL,
    system_name text NOT NULL,
    system_name text NOT NULL,
    system_type text NOT NULL,
    system_type text NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: external_system_external_system_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
-- Name: external_system_external_system_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
--
--


CREATE SEQUENCE integration.external_system_external_system_id_seq
CREATE SEQUENCE integration.external_system_external_system_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: external_system_external_system_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
-- Name: external_system_external_system_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
--
--


ALTER SEQUENCE integration.external_system_external_system_id_seq OWNED BY integration.external_system.external_system_id;
ALTER SEQUENCE integration.external_system_external_system_id_seq OWNED BY integration.external_system.external_system_id;




--
--
-- Name: integration_job; Type: TABLE; Schema: integration; Owner: -
-- Name: integration_job; Type: TABLE; Schema: integration; Owner: -
--
--


CREATE TABLE integration.integration_job (
CREATE TABLE integration.integration_job (
    integration_job_id bigint NOT NULL,
    integration_job_id bigint NOT NULL,
    external_system_id bigint NOT NULL,
    external_system_id bigint NOT NULL,
    job_type text NOT NULL,
    job_type text NOT NULL,
    schedule_type text DEFAULT 'MANUAL'::text NOT NULL,
    schedule_type text DEFAULT 'MANUAL'::text NOT NULL,
    last_run_at timestamp with time zone,
    last_run_at timestamp with time zone,
    last_status text
    last_status text
);
);




--
--
-- Name: integration_job_integration_job_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
-- Name: integration_job_integration_job_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
--
--


CREATE SEQUENCE integration.integration_job_integration_job_id_seq
CREATE SEQUENCE integration.integration_job_integration_job_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: integration_job_integration_job_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
-- Name: integration_job_integration_job_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
--
--


ALTER SEQUENCE integration.integration_job_integration_job_id_seq OWNED BY integration.integration_job.integration_job_id;
ALTER SEQUENCE integration.integration_job_integration_job_id_seq OWNED BY integration.integration_job.integration_job_id;




--
--
-- Name: integration_log; Type: TABLE; Schema: integration; Owner: -
-- Name: integration_log; Type: TABLE; Schema: integration; Owner: -
--
--


CREATE TABLE integration.integration_log (
CREATE TABLE integration.integration_log (
    integration_log_id bigint NOT NULL,
    integration_log_id bigint NOT NULL,
    integration_job_id bigint NOT NULL,
    integration_job_id bigint NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    error_message text,
    error_message text,
    executed_at timestamp with time zone DEFAULT now() NOT NULL
    executed_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: integration_log_integration_log_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
-- Name: integration_log_integration_log_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
--
--


CREATE SEQUENCE integration.integration_log_integration_log_id_seq
CREATE SEQUENCE integration.integration_log_integration_log_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: integration_log_integration_log_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
-- Name: integration_log_integration_log_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
--
--


ALTER SEQUENCE integration.integration_log_integration_log_id_seq OWNED BY integration.integration_log.integration_log_id;
ALTER SEQUENCE integration.integration_log_integration_log_id_seq OWNED BY integration.integration_log.integration_log_id;




--
--
-- Name: siem_delivery_queue; Type: TABLE; Schema: integration; Owner: -
-- Name: siem_delivery_queue; Type: TABLE; Schema: integration; Owner: -
--
--


CREATE TABLE integration.siem_delivery_queue (
CREATE TABLE integration.siem_delivery_queue (
    delivery_id bigint NOT NULL,
    delivery_id bigint NOT NULL,
    endpoint_id bigint NOT NULL,
    endpoint_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    audit_trail_id bigint NOT NULL,
    audit_trail_id bigint NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    last_error text,
    last_error text,
    enqueued_at timestamp with time zone DEFAULT now() NOT NULL,
    enqueued_at timestamp with time zone DEFAULT now() NOT NULL,
    sent_at timestamp with time zone,
    sent_at timestamp with time zone,
    CONSTRAINT siem_delivery_queue_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'SENT'::text, 'FAILED'::text])))
    CONSTRAINT siem_delivery_queue_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'SENT'::text, 'FAILED'::text])))
);
);






--
--
-- Name: siem_delivery_queue_delivery_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
-- Name: siem_delivery_queue_delivery_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
--
--


CREATE SEQUENCE integration.siem_delivery_queue_delivery_id_seq
CREATE SEQUENCE integration.siem_delivery_queue_delivery_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: siem_delivery_queue_delivery_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
-- Name: siem_delivery_queue_delivery_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
--
--


ALTER SEQUENCE integration.siem_delivery_queue_delivery_id_seq OWNED BY integration.siem_delivery_queue.delivery_id;
ALTER SEQUENCE integration.siem_delivery_queue_delivery_id_seq OWNED BY integration.siem_delivery_queue.delivery_id;




--
--
-- Name: siem_endpoint; Type: TABLE; Schema: integration; Owner: -
-- Name: siem_endpoint; Type: TABLE; Schema: integration; Owner: -
--
--


CREATE TABLE integration.siem_endpoint (
CREATE TABLE integration.siem_endpoint (
    endpoint_id bigint NOT NULL,
    endpoint_id bigint NOT NULL,
    company_id uuid,
    company_id uuid,
    endpoint_name text NOT NULL,
    endpoint_name text NOT NULL,
    endpoint_type text DEFAULT 'HTTP'::text NOT NULL,
    endpoint_type text DEFAULT 'HTTP'::text NOT NULL,
    url text NOT NULL,
    url text NOT NULL,
    auth_ref text,
    auth_ref text,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: siem_endpoint_endpoint_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
-- Name: siem_endpoint_endpoint_id_seq; Type: SEQUENCE; Schema: integration; Owner: -
--
--


CREATE SEQUENCE integration.siem_endpoint_endpoint_id_seq
CREATE SEQUENCE integration.siem_endpoint_endpoint_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: siem_endpoint_endpoint_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
-- Name: siem_endpoint_endpoint_id_seq; Type: SEQUENCE OWNED BY; Schema: integration; Owner: -
--
--


ALTER SEQUENCE integration.siem_endpoint_endpoint_id_seq OWNED BY integration.siem_endpoint.endpoint_id;
ALTER SEQUENCE integration.siem_endpoint_endpoint_id_seq OWNED BY integration.siem_endpoint.endpoint_id;




--
--
-- Name: v_audit_export_payload; Type: VIEW; Schema: integration; Owner: -
-- Name: v_audit_export_payload; Type: VIEW; Schema: integration; Owner: -
--
--


CREATE VIEW integration.v_audit_export_payload AS
CREATE VIEW integration.v_audit_export_payload AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail;
   FROM core.audit_trail;




--
--
-- Name: v_siem_payload; Type: VIEW; Schema: integration; Owner: -
-- Name: v_siem_payload; Type: VIEW; Schema: integration; Owner: -
--
--


CREATE VIEW integration.v_siem_payload AS
CREATE VIEW integration.v_siem_payload AS
 SELECT q.delivery_id,
 SELECT q.delivery_id,
    q.endpoint_id,
    q.endpoint_id,
    e.endpoint_type,
    e.endpoint_type,
    e.url,
    e.url,
    e.auth_ref,
    e.auth_ref,
    at.audit_trail_id,
    at.audit_trail_id,
    at.company_id,
    at.company_id,
    at.entity_type,
    at.entity_type,
    at.entity_id,
    at.entity_id,
    at.action,
    at.action,
    at.performed_by,
    at.performed_by,
    at.performed_at,
    at.performed_at,
    core.fn_calc_audit_impact(at.company_id, at.entity_type, at.action, at.detail) AS impact_score,
    core.fn_calc_audit_impact(at.company_id, at.entity_type, at.action, at.detail) AS impact_score,
    at.detail
    at.detail
   FROM ((integration.siem_delivery_queue q
   FROM ((integration.siem_delivery_queue q
     JOIN integration.siem_endpoint e ON (((e.endpoint_id = q.endpoint_id) AND e.is_active)))
     JOIN integration.siem_endpoint e ON (((e.endpoint_id = q.endpoint_id) AND e.is_active)))
     JOIN core.audit_trail at ON ((at.audit_trail_id = q.audit_trail_id)))
     JOIN core.audit_trail at ON ((at.audit_trail_id = q.audit_trail_id)))
  WHERE (q.status = 'PENDING'::text);
  WHERE (q.status = 'PENDING'::text);




--
--
-- Name: inventory_valuation; Type: TABLE; Schema: inventory; Owner: -
-- Name: inventory_valuation; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.inventory_valuation (
CREATE TABLE inventory.inventory_valuation (
    inventory_valuation_id bigint NOT NULL,
    inventory_valuation_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    valuation_date date NOT NULL,
    valuation_date date NOT NULL,
    method text DEFAULT 'AVG'::text NOT NULL,
    method text DEFAULT 'AVG'::text NOT NULL,
    unit_cost numeric(18,4) NOT NULL,
    unit_cost numeric(18,4) NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: inventory_valuation_inventory_valuation_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: inventory_valuation_inventory_valuation_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.inventory_valuation_inventory_valuation_id_seq
CREATE SEQUENCE inventory.inventory_valuation_inventory_valuation_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: inventory_valuation_inventory_valuation_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: inventory_valuation_inventory_valuation_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.inventory_valuation_inventory_valuation_id_seq OWNED BY inventory.inventory_valuation.inventory_valuation_id;
ALTER SEQUENCE inventory.inventory_valuation_inventory_valuation_id_seq OWNED BY inventory.inventory_valuation.inventory_valuation_id;




--
--
-- Name: stock_balance; Type: TABLE; Schema: inventory; Owner: -
-- Name: stock_balance; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stock_balance (
CREATE TABLE inventory.stock_balance (
    stock_balance_id bigint NOT NULL,
    stock_balance_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    location_id bigint NOT NULL,
    location_id bigint NOT NULL,
    bin_id bigint NOT NULL,
    bin_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty_on_hand numeric(18,3) DEFAULT 0 NOT NULL,
    qty_on_hand numeric(18,3) DEFAULT 0 NOT NULL,
    qty_reserved numeric(18,3) DEFAULT 0 NOT NULL,
    qty_reserved numeric(18,3) DEFAULT 0 NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: stock_balance_stock_balance_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stock_balance_stock_balance_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stock_balance_stock_balance_id_seq
CREATE SEQUENCE inventory.stock_balance_stock_balance_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stock_balance_stock_balance_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stock_balance_stock_balance_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stock_balance_stock_balance_id_seq OWNED BY inventory.stock_balance.stock_balance_id;
ALTER SEQUENCE inventory.stock_balance_stock_balance_id_seq OWNED BY inventory.stock_balance.stock_balance_id;




--
--
-- Name: stock_bin; Type: TABLE; Schema: inventory; Owner: -
-- Name: stock_bin; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stock_bin (
CREATE TABLE inventory.stock_bin (
    bin_id bigint NOT NULL,
    bin_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    location_id bigint NOT NULL,
    location_id bigint NOT NULL,
    bin_code text NOT NULL,
    bin_code text NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: stock_bin_bin_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stock_bin_bin_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stock_bin_bin_id_seq
CREATE SEQUENCE inventory.stock_bin_bin_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stock_bin_bin_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stock_bin_bin_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stock_bin_bin_id_seq OWNED BY inventory.stock_bin.bin_id;
ALTER SEQUENCE inventory.stock_bin_bin_id_seq OWNED BY inventory.stock_bin.bin_id;




--
--
-- Name: stock_lot; Type: TABLE; Schema: inventory; Owner: -
-- Name: stock_lot; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stock_lot (
CREATE TABLE inventory.stock_lot (
    stock_lot_id bigint NOT NULL,
    stock_lot_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    lot_no text,
    lot_no text,
    serial_no text,
    serial_no text,
    expiry_date date
    expiry_date date
);
);






--
--
-- Name: stock_lot_balance; Type: TABLE; Schema: inventory; Owner: -
-- Name: stock_lot_balance; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stock_lot_balance (
CREATE TABLE inventory.stock_lot_balance (
    stock_lot_balance_id bigint NOT NULL,
    stock_lot_balance_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    location_id bigint NOT NULL,
    location_id bigint NOT NULL,
    bin_id bigint NOT NULL,
    bin_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    stock_lot_id bigint NOT NULL,
    stock_lot_id bigint NOT NULL,
    qty_on_hand numeric(18,3) DEFAULT 0 NOT NULL,
    qty_on_hand numeric(18,3) DEFAULT 0 NOT NULL,
    qty_reserved numeric(18,3) DEFAULT 0 NOT NULL,
    qty_reserved numeric(18,3) DEFAULT 0 NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: stock_lot_balance_stock_lot_balance_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stock_lot_balance_stock_lot_balance_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stock_lot_balance_stock_lot_balance_id_seq
CREATE SEQUENCE inventory.stock_lot_balance_stock_lot_balance_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stock_lot_balance_stock_lot_balance_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stock_lot_balance_stock_lot_balance_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stock_lot_balance_stock_lot_balance_id_seq OWNED BY inventory.stock_lot_balance.stock_lot_balance_id;
ALTER SEQUENCE inventory.stock_lot_balance_stock_lot_balance_id_seq OWNED BY inventory.stock_lot_balance.stock_lot_balance_id;




--
--
-- Name: stock_lot_stock_lot_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stock_lot_stock_lot_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stock_lot_stock_lot_id_seq
CREATE SEQUENCE inventory.stock_lot_stock_lot_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stock_lot_stock_lot_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stock_lot_stock_lot_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stock_lot_stock_lot_id_seq OWNED BY inventory.stock_lot.stock_lot_id;
ALTER SEQUENCE inventory.stock_lot_stock_lot_id_seq OWNED BY inventory.stock_lot.stock_lot_id;




--
--
-- Name: stock_reservation; Type: TABLE; Schema: inventory; Owner: -
-- Name: stock_reservation; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stock_reservation (
CREATE TABLE inventory.stock_reservation (
    stock_reservation_id bigint NOT NULL,
    stock_reservation_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    stock_lot_id bigint,
    stock_lot_id bigint,
    qty_reserved numeric(18,3) NOT NULL,
    qty_reserved numeric(18,3) NOT NULL,
    reserved_at timestamp with time zone DEFAULT now() NOT NULL
    reserved_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: stock_reservation_stock_reservation_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stock_reservation_stock_reservation_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stock_reservation_stock_reservation_id_seq
CREATE SEQUENCE inventory.stock_reservation_stock_reservation_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stock_reservation_stock_reservation_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stock_reservation_stock_reservation_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stock_reservation_stock_reservation_id_seq OWNED BY inventory.stock_reservation.stock_reservation_id;
ALTER SEQUENCE inventory.stock_reservation_stock_reservation_id_seq OWNED BY inventory.stock_reservation.stock_reservation_id;




--
--
-- Name: stock_transaction; Type: TABLE; Schema: inventory; Owner: -
-- Name: stock_transaction; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stock_transaction (
CREATE TABLE inventory.stock_transaction (
    stock_tx_id bigint NOT NULL,
    stock_tx_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    tx_type text NOT NULL,
    tx_type text NOT NULL,
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    stock_lot_id bigint,
    stock_lot_id bigint,
    from_bin_id bigint,
    from_bin_id bigint,
    to_bin_id bigint,
    to_bin_id bigint,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    reference_type text,
    reference_type text,
    reference_id text,
    reference_id text,
    occurred_at timestamp with time zone DEFAULT now() NOT NULL
    occurred_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: stock_transaction_stock_tx_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stock_transaction_stock_tx_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stock_transaction_stock_tx_id_seq
CREATE SEQUENCE inventory.stock_transaction_stock_tx_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stock_transaction_stock_tx_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stock_transaction_stock_tx_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stock_transaction_stock_tx_id_seq OWNED BY inventory.stock_transaction.stock_tx_id;
ALTER SEQUENCE inventory.stock_transaction_stock_tx_id_seq OWNED BY inventory.stock_transaction.stock_tx_id;




--
--
-- Name: stock_transfer_detail; Type: TABLE; Schema: inventory; Owner: -
-- Name: stock_transfer_detail; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stock_transfer_detail (
CREATE TABLE inventory.stock_transfer_detail (
    stock_transfer_detail_id bigint NOT NULL,
    stock_transfer_detail_id bigint NOT NULL,
    stock_transfer_id bigint NOT NULL,
    stock_transfer_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    from_location_id bigint,
    from_location_id bigint,
    to_location_id bigint,
    to_location_id bigint,
    from_bin_id bigint,
    from_bin_id bigint,
    to_bin_id bigint,
    to_bin_id bigint,
    stock_lot_id bigint
    stock_lot_id bigint
);
);




--
--
-- Name: stock_transfer_detail_stock_transfer_detail_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stock_transfer_detail_stock_transfer_detail_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stock_transfer_detail_stock_transfer_detail_id_seq
CREATE SEQUENCE inventory.stock_transfer_detail_stock_transfer_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stock_transfer_detail_stock_transfer_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stock_transfer_detail_stock_transfer_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stock_transfer_detail_stock_transfer_detail_id_seq OWNED BY inventory.stock_transfer_detail.stock_transfer_detail_id;
ALTER SEQUENCE inventory.stock_transfer_detail_stock_transfer_detail_id_seq OWNED BY inventory.stock_transfer_detail.stock_transfer_detail_id;




--
--
-- Name: stock_transfer_header; Type: TABLE; Schema: inventory; Owner: -
-- Name: stock_transfer_header; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stock_transfer_header (
CREATE TABLE inventory.stock_transfer_header (
    stock_transfer_id bigint NOT NULL,
    stock_transfer_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    transfer_no text NOT NULL,
    transfer_no text NOT NULL,
    from_warehouse_id bigint NOT NULL,
    from_warehouse_id bigint NOT NULL,
    to_warehouse_id bigint NOT NULL,
    to_warehouse_id bigint NOT NULL,
    request_date date DEFAULT CURRENT_DATE NOT NULL,
    request_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'REQUESTED'::text NOT NULL,
    status_code text DEFAULT 'REQUESTED'::text NOT NULL,
    requested_by uuid,
    requested_by uuid,
    approved_by uuid,
    approved_by uuid,
    approved_at timestamp with time zone,
    approved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: stock_transfer_header_stock_transfer_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stock_transfer_header_stock_transfer_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stock_transfer_header_stock_transfer_id_seq
CREATE SEQUENCE inventory.stock_transfer_header_stock_transfer_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stock_transfer_header_stock_transfer_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stock_transfer_header_stock_transfer_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stock_transfer_header_stock_transfer_id_seq OWNED BY inventory.stock_transfer_header.stock_transfer_id;
ALTER SEQUENCE inventory.stock_transfer_header_stock_transfer_id_seq OWNED BY inventory.stock_transfer_header.stock_transfer_id;




--
--
-- Name: stocktaking_plan; Type: TABLE; Schema: inventory; Owner: -
-- Name: stocktaking_plan; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stocktaking_plan (
CREATE TABLE inventory.stocktaking_plan (
    stocktaking_plan_id bigint NOT NULL,
    stocktaking_plan_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    plan_date date NOT NULL,
    plan_date date NOT NULL,
    status_code text DEFAULT 'PLANNED'::text NOT NULL,
    status_code text DEFAULT 'PLANNED'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: stocktaking_plan_stocktaking_plan_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stocktaking_plan_stocktaking_plan_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stocktaking_plan_stocktaking_plan_id_seq
CREATE SEQUENCE inventory.stocktaking_plan_stocktaking_plan_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stocktaking_plan_stocktaking_plan_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stocktaking_plan_stocktaking_plan_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stocktaking_plan_stocktaking_plan_id_seq OWNED BY inventory.stocktaking_plan.stocktaking_plan_id;
ALTER SEQUENCE inventory.stocktaking_plan_stocktaking_plan_id_seq OWNED BY inventory.stocktaking_plan.stocktaking_plan_id;




--
--
-- Name: stocktaking_result; Type: TABLE; Schema: inventory; Owner: -
-- Name: stocktaking_result; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.stocktaking_result (
CREATE TABLE inventory.stocktaking_result (
    stocktaking_result_id bigint NOT NULL,
    stocktaking_result_id bigint NOT NULL,
    stocktaking_plan_id bigint NOT NULL,
    stocktaking_plan_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    bin_id bigint NOT NULL,
    bin_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    counted_qty numeric(18,3) NOT NULL,
    counted_qty numeric(18,3) NOT NULL,
    system_qty numeric(18,3) NOT NULL,
    system_qty numeric(18,3) NOT NULL,
    difference_qty numeric(18,3) NOT NULL,
    difference_qty numeric(18,3) NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: stocktaking_result_stocktaking_result_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: stocktaking_result_stocktaking_result_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.stocktaking_result_stocktaking_result_id_seq
CREATE SEQUENCE inventory.stocktaking_result_stocktaking_result_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: stocktaking_result_stocktaking_result_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: stocktaking_result_stocktaking_result_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.stocktaking_result_stocktaking_result_id_seq OWNED BY inventory.stocktaking_result.stocktaking_result_id;
ALTER SEQUENCE inventory.stocktaking_result_stocktaking_result_id_seq OWNED BY inventory.stocktaking_result.stocktaking_result_id;




--
--
-- Name: storage_location; Type: TABLE; Schema: inventory; Owner: -
-- Name: storage_location; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.storage_location (
CREATE TABLE inventory.storage_location (
    location_id bigint NOT NULL,
    location_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    location_code text NOT NULL,
    location_code text NOT NULL,
    location_name text,
    location_name text,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: storage_location_location_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: storage_location_location_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.storage_location_location_id_seq
CREATE SEQUENCE inventory.storage_location_location_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: storage_location_location_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: storage_location_location_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.storage_location_location_id_seq OWNED BY inventory.storage_location.location_id;
ALTER SEQUENCE inventory.storage_location_location_id_seq OWNED BY inventory.storage_location.location_id;




--
--
-- Name: v_change_history; Type: VIEW; Schema: inventory; Owner: -
-- Name: v_change_history; Type: VIEW; Schema: inventory; Owner: -
--
--


CREATE VIEW inventory.v_change_history AS
CREATE VIEW inventory.v_change_history AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail
   FROM core.audit_trail
  WHERE (entity_type ~~ 'inventory.%'::text);
  WHERE (entity_type ~~ 'inventory.%'::text);




--
--
-- Name: warehouse; Type: TABLE; Schema: inventory; Owner: -
-- Name: warehouse; Type: TABLE; Schema: inventory; Owner: -
--
--


CREATE TABLE inventory.warehouse (
CREATE TABLE inventory.warehouse (
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    warehouse_code text NOT NULL,
    warehouse_code text NOT NULL,
    warehouse_name text NOT NULL,
    warehouse_name text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: warehouse_warehouse_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
-- Name: warehouse_warehouse_id_seq; Type: SEQUENCE; Schema: inventory; Owner: -
--
--


CREATE SEQUENCE inventory.warehouse_warehouse_id_seq
CREATE SEQUENCE inventory.warehouse_warehouse_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: warehouse_warehouse_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
-- Name: warehouse_warehouse_id_seq; Type: SEQUENCE OWNED BY; Schema: inventory; Owner: -
--
--


ALTER SEQUENCE inventory.warehouse_warehouse_id_seq OWNED BY inventory.warehouse.warehouse_id;
ALTER SEQUENCE inventory.warehouse_warehouse_id_seq OWNED BY inventory.warehouse.warehouse_id;




--
--
-- Name: bom_detail; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: bom_detail; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.bom_detail (
CREATE TABLE manufacturing.bom_detail (
    bom_detail_id bigint NOT NULL,
    bom_detail_id bigint NOT NULL,
    bom_id bigint NOT NULL,
    bom_id bigint NOT NULL,
    component_item_id bigint NOT NULL,
    component_item_id bigint NOT NULL,
    qty_per numeric(18,6) NOT NULL,
    qty_per numeric(18,6) NOT NULL,
    issue_method text DEFAULT 'BACKFLUSH'::text NOT NULL,
    issue_method text DEFAULT 'BACKFLUSH'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: bom_detail_bom_detail_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: bom_detail_bom_detail_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.bom_detail_bom_detail_id_seq
CREATE SEQUENCE manufacturing.bom_detail_bom_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: bom_detail_bom_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: bom_detail_bom_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.bom_detail_bom_detail_id_seq OWNED BY manufacturing.bom_detail.bom_detail_id;
ALTER SEQUENCE manufacturing.bom_detail_bom_detail_id_seq OWNED BY manufacturing.bom_detail.bom_detail_id;




--
--
-- Name: bom_header; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: bom_header; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.bom_header (
CREATE TABLE manufacturing.bom_header (
    bom_id bigint NOT NULL,
    bom_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    parent_item_id bigint NOT NULL,
    parent_item_id bigint NOT NULL,
    version integer DEFAULT 1 NOT NULL,
    version integer DEFAULT 1 NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: bom_header_bom_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: bom_header_bom_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.bom_header_bom_id_seq
CREATE SEQUENCE manufacturing.bom_header_bom_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: bom_header_bom_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: bom_header_bom_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.bom_header_bom_id_seq OWNED BY manufacturing.bom_header.bom_id;
ALTER SEQUENCE manufacturing.bom_header_bom_id_seq OWNED BY manufacturing.bom_header.bom_id;




--
--
-- Name: manufacturing_cost_snapshot; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.manufacturing_cost_snapshot (
CREATE TABLE manufacturing.manufacturing_cost_snapshot (
    manufacturing_cost_snapshot_id bigint NOT NULL,
    manufacturing_cost_snapshot_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    work_order_id bigint NOT NULL,
    work_order_id bigint NOT NULL,
    total_cost numeric(18,2) DEFAULT 0 NOT NULL,
    total_cost numeric(18,2) DEFAULT 0 NOT NULL,
    snapshot_at timestamp with time zone DEFAULT now() NOT NULL
    snapshot_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq
CREATE SEQUENCE manufacturing.manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq OWNED BY manufacturing.manufacturing_cost_snapshot.manufacturing_cost_snapshot_id;
ALTER SEQUENCE manufacturing.manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq OWNED BY manufacturing.manufacturing_cost_snapshot.manufacturing_cost_snapshot_id;




--
--
-- Name: manufacturing_execution; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.manufacturing_execution (
CREATE TABLE manufacturing.manufacturing_execution (
    execution_id bigint NOT NULL,
    execution_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    work_order_id bigint NOT NULL,
    work_order_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    executed_at timestamp with time zone DEFAULT now() NOT NULL,
    executed_at timestamp with time zone DEFAULT now() NOT NULL,
    status_code text DEFAULT 'DONE'::text NOT NULL
    status_code text DEFAULT 'DONE'::text NOT NULL
);
);






--
--
-- Name: manufacturing_execution_detail; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.manufacturing_execution_detail (
CREATE TABLE manufacturing.manufacturing_execution_detail (
    execution_detail_id bigint NOT NULL,
    execution_detail_id bigint NOT NULL,
    execution_id bigint NOT NULL,
    execution_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    movement_type text DEFAULT 'CONSUME'::text NOT NULL
    movement_type text DEFAULT 'CONSUME'::text NOT NULL
);
);




--
--
-- Name: manufacturing_execution_detail_execution_detail_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail_execution_detail_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.manufacturing_execution_detail_execution_detail_id_seq
CREATE SEQUENCE manufacturing.manufacturing_execution_detail_execution_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: manufacturing_execution_detail_execution_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail_execution_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.manufacturing_execution_detail_execution_detail_id_seq OWNED BY manufacturing.manufacturing_execution_detail.execution_detail_id;
ALTER SEQUENCE manufacturing.manufacturing_execution_detail_execution_detail_id_seq OWNED BY manufacturing.manufacturing_execution_detail.execution_detail_id;




--
--
-- Name: manufacturing_execution_execution_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_execution_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.manufacturing_execution_execution_id_seq
CREATE SEQUENCE manufacturing.manufacturing_execution_execution_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: manufacturing_execution_execution_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_execution_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.manufacturing_execution_execution_id_seq OWNED BY manufacturing.manufacturing_execution.execution_id;
ALTER SEQUENCE manufacturing.manufacturing_execution_execution_id_seq OWNED BY manufacturing.manufacturing_execution.execution_id;




--
--
-- Name: mps_plan; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: mps_plan; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.mps_plan (
CREATE TABLE manufacturing.mps_plan (
    mps_plan_id bigint NOT NULL,
    mps_plan_id bigint NOT NULL,
    mps_run_id bigint NOT NULL,
    mps_run_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    plan_date date NOT NULL,
    plan_date date NOT NULL,
    plan_qty numeric(18,3) NOT NULL
    plan_qty numeric(18,3) NOT NULL
);
);




--
--
-- Name: mps_plan_mps_plan_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: mps_plan_mps_plan_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.mps_plan_mps_plan_id_seq
CREATE SEQUENCE manufacturing.mps_plan_mps_plan_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: mps_plan_mps_plan_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: mps_plan_mps_plan_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.mps_plan_mps_plan_id_seq OWNED BY manufacturing.mps_plan.mps_plan_id;
ALTER SEQUENCE manufacturing.mps_plan_mps_plan_id_seq OWNED BY manufacturing.mps_plan.mps_plan_id;




--
--
-- Name: mps_run; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: mps_run; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.mps_run (
CREATE TABLE manufacturing.mps_run (
    mps_run_id bigint NOT NULL,
    mps_run_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    run_type text DEFAULT 'MONTHLY'::text NOT NULL,
    run_type text DEFAULT 'MONTHLY'::text NOT NULL,
    run_at timestamp with time zone DEFAULT now() NOT NULL
    run_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: mps_run_mps_run_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: mps_run_mps_run_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.mps_run_mps_run_id_seq
CREATE SEQUENCE manufacturing.mps_run_mps_run_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: mps_run_mps_run_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: mps_run_mps_run_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.mps_run_mps_run_id_seq OWNED BY manufacturing.mps_run.mps_run_id;
ALTER SEQUENCE manufacturing.mps_run_mps_run_id_seq OWNED BY manufacturing.mps_run.mps_run_id;




--
--
-- Name: mrp_allocation; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: mrp_allocation; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.mrp_allocation (
CREATE TABLE manufacturing.mrp_allocation (
    mrp_allocation_id bigint NOT NULL,
    mrp_allocation_id bigint NOT NULL,
    mrp_requirement_id bigint NOT NULL,
    mrp_requirement_id bigint NOT NULL,
    source_type text NOT NULL,
    source_type text NOT NULL,
    source_id text NOT NULL,
    source_id text NOT NULL,
    qty_allocated numeric(18,3) NOT NULL
    qty_allocated numeric(18,3) NOT NULL
);
);




--
--
-- Name: mrp_allocation_mrp_allocation_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: mrp_allocation_mrp_allocation_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.mrp_allocation_mrp_allocation_id_seq
CREATE SEQUENCE manufacturing.mrp_allocation_mrp_allocation_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: mrp_allocation_mrp_allocation_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: mrp_allocation_mrp_allocation_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.mrp_allocation_mrp_allocation_id_seq OWNED BY manufacturing.mrp_allocation.mrp_allocation_id;
ALTER SEQUENCE manufacturing.mrp_allocation_mrp_allocation_id_seq OWNED BY manufacturing.mrp_allocation.mrp_allocation_id;




--
--
-- Name: mrp_requirement; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: mrp_requirement; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.mrp_requirement (
CREATE TABLE manufacturing.mrp_requirement (
    mrp_requirement_id bigint NOT NULL,
    mrp_requirement_id bigint NOT NULL,
    mrp_run_id bigint NOT NULL,
    mrp_run_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    requirement_date date NOT NULL,
    requirement_date date NOT NULL,
    qty_required numeric(18,3) NOT NULL,
    qty_required numeric(18,3) NOT NULL,
    supply_type text DEFAULT 'PURCHASE'::text NOT NULL
    supply_type text DEFAULT 'PURCHASE'::text NOT NULL
);
);




--
--
-- Name: mrp_requirement_mrp_requirement_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: mrp_requirement_mrp_requirement_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.mrp_requirement_mrp_requirement_id_seq
CREATE SEQUENCE manufacturing.mrp_requirement_mrp_requirement_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: mrp_requirement_mrp_requirement_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: mrp_requirement_mrp_requirement_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.mrp_requirement_mrp_requirement_id_seq OWNED BY manufacturing.mrp_requirement.mrp_requirement_id;
ALTER SEQUENCE manufacturing.mrp_requirement_mrp_requirement_id_seq OWNED BY manufacturing.mrp_requirement.mrp_requirement_id;




--
--
-- Name: mrp_run; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: mrp_run; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.mrp_run (
CREATE TABLE manufacturing.mrp_run (
    mrp_run_id bigint NOT NULL,
    mrp_run_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    run_type text DEFAULT 'DAILY'::text NOT NULL,
    run_type text DEFAULT 'DAILY'::text NOT NULL,
    run_at timestamp with time zone DEFAULT now() NOT NULL
    run_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: mrp_run_mrp_run_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: mrp_run_mrp_run_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.mrp_run_mrp_run_id_seq
CREATE SEQUENCE manufacturing.mrp_run_mrp_run_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: mrp_run_mrp_run_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: mrp_run_mrp_run_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.mrp_run_mrp_run_id_seq OWNED BY manufacturing.mrp_run.mrp_run_id;
ALTER SEQUENCE manufacturing.mrp_run_mrp_run_id_seq OWNED BY manufacturing.mrp_run.mrp_run_id;




--
--
-- Name: process_master; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: process_master; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.process_master (
CREATE TABLE manufacturing.process_master (
    process_id bigint NOT NULL,
    process_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    process_code text NOT NULL,
    process_code text NOT NULL,
    process_name text NOT NULL
    process_name text NOT NULL
);
);






--
--
-- Name: process_master_process_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: process_master_process_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.process_master_process_id_seq
CREATE SEQUENCE manufacturing.process_master_process_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: process_master_process_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: process_master_process_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.process_master_process_id_seq OWNED BY manufacturing.process_master.process_id;
ALTER SEQUENCE manufacturing.process_master_process_id_seq OWNED BY manufacturing.process_master.process_id;




--
--
-- Name: routing_header; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: routing_header; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.routing_header (
CREATE TABLE manufacturing.routing_header (
    routing_id bigint NOT NULL,
    routing_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    version integer DEFAULT 1 NOT NULL,
    version integer DEFAULT 1 NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: routing_header_routing_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: routing_header_routing_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.routing_header_routing_id_seq
CREATE SEQUENCE manufacturing.routing_header_routing_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: routing_header_routing_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: routing_header_routing_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.routing_header_routing_id_seq OWNED BY manufacturing.routing_header.routing_id;
ALTER SEQUENCE manufacturing.routing_header_routing_id_seq OWNED BY manufacturing.routing_header.routing_id;




--
--
-- Name: routing_operation; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: routing_operation; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.routing_operation (
CREATE TABLE manufacturing.routing_operation (
    routing_operation_id bigint NOT NULL,
    routing_operation_id bigint NOT NULL,
    routing_id bigint NOT NULL,
    routing_id bigint NOT NULL,
    operation_no integer NOT NULL,
    operation_no integer NOT NULL,
    process_id bigint NOT NULL,
    process_id bigint NOT NULL,
    std_time_minutes numeric(18,3) DEFAULT 0 NOT NULL
    std_time_minutes numeric(18,3) DEFAULT 0 NOT NULL
);
);




--
--
-- Name: routing_operation_routing_operation_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: routing_operation_routing_operation_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.routing_operation_routing_operation_id_seq
CREATE SEQUENCE manufacturing.routing_operation_routing_operation_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: routing_operation_routing_operation_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: routing_operation_routing_operation_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.routing_operation_routing_operation_id_seq OWNED BY manufacturing.routing_operation.routing_operation_id;
ALTER SEQUENCE manufacturing.routing_operation_routing_operation_id_seq OWNED BY manufacturing.routing_operation.routing_operation_id;




--
--
-- Name: work_order; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: work_order; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.work_order (
CREATE TABLE manufacturing.work_order (
    work_order_id bigint NOT NULL,
    work_order_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    wo_no text NOT NULL,
    wo_no text NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    bom_id bigint,
    bom_id bigint,
    routing_id bigint,
    routing_id bigint,
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    plan_qty numeric(18,3) NOT NULL,
    plan_qty numeric(18,3) NOT NULL,
    plan_start_date date,
    plan_start_date date,
    plan_end_date date,
    plan_end_date date,
    status_code text DEFAULT 'PLANNED'::text NOT NULL,
    status_code text DEFAULT 'PLANNED'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: work_order_work_order_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: work_order_work_order_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.work_order_work_order_id_seq
CREATE SEQUENCE manufacturing.work_order_work_order_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: work_order_work_order_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: work_order_work_order_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.work_order_work_order_id_seq OWNED BY manufacturing.work_order.work_order_id;
ALTER SEQUENCE manufacturing.work_order_work_order_id_seq OWNED BY manufacturing.work_order.work_order_id;




--
--
-- Name: yield_metric; Type: TABLE; Schema: manufacturing; Owner: -
-- Name: yield_metric; Type: TABLE; Schema: manufacturing; Owner: -
--
--


CREATE TABLE manufacturing.yield_metric (
CREATE TABLE manufacturing.yield_metric (
    yield_metric_id bigint NOT NULL,
    yield_metric_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    process_id bigint NOT NULL,
    process_id bigint NOT NULL,
    metric_date date NOT NULL,
    metric_date date NOT NULL,
    yield_rate numeric(9,4) NOT NULL
    yield_rate numeric(9,4) NOT NULL
);
);






--
--
-- Name: yield_metric_yield_metric_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
-- Name: yield_metric_yield_metric_id_seq; Type: SEQUENCE; Schema: manufacturing; Owner: -
--
--


CREATE SEQUENCE manufacturing.yield_metric_yield_metric_id_seq
CREATE SEQUENCE manufacturing.yield_metric_yield_metric_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: yield_metric_yield_metric_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
-- Name: yield_metric_yield_metric_id_seq; Type: SEQUENCE OWNED BY; Schema: manufacturing; Owner: -
--
--


ALTER SEQUENCE manufacturing.yield_metric_yield_metric_id_seq OWNED BY manufacturing.yield_metric.yield_metric_id;
ALTER SEQUENCE manufacturing.yield_metric_yield_metric_id_seq OWNED BY manufacturing.yield_metric.yield_metric_id;




--
--
-- Name: asset; Type: TABLE; Schema: media; Owner: -
-- Name: asset; Type: TABLE; Schema: media; Owner: -
--
--


CREATE TABLE media.asset (
CREATE TABLE media.asset (
    asset_id bigint NOT NULL,
    asset_id bigint NOT NULL,
    asset_type text DEFAULT 'IMAGE'::text NOT NULL,
    asset_type text DEFAULT 'IMAGE'::text NOT NULL,
    storage_provider text DEFAULT 'supabase_storage'::text NOT NULL,
    storage_provider text DEFAULT 'supabase_storage'::text NOT NULL,
    bucket text,
    bucket text,
    object_path text,
    object_path text,
    public_url text,
    public_url text,
    content_type text,
    content_type text,
    byte_size bigint,
    byte_size bigint,
    sha256 text,
    sha256 text,
    width_px integer,
    width_px integer,
    height_px integer,
    height_px integer,
    note text,
    note text,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT asset_asset_type_check CHECK ((asset_type = ANY (ARRAY['IMAGE'::text, 'FILE'::text])))
    CONSTRAINT asset_asset_type_check CHECK ((asset_type = ANY (ARRAY['IMAGE'::text, 'FILE'::text])))
);
);




--
--
-- Name: asset_asset_id_seq; Type: SEQUENCE; Schema: media; Owner: -
-- Name: asset_asset_id_seq; Type: SEQUENCE; Schema: media; Owner: -
--
--


CREATE SEQUENCE media.asset_asset_id_seq
CREATE SEQUENCE media.asset_asset_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: asset_asset_id_seq; Type: SEQUENCE OWNED BY; Schema: media; Owner: -
-- Name: asset_asset_id_seq; Type: SEQUENCE OWNED BY; Schema: media; Owner: -
--
--


ALTER SEQUENCE media.asset_asset_id_seq OWNED BY media.asset.asset_id;
ALTER SEQUENCE media.asset_asset_id_seq OWNED BY media.asset.asset_id;




--
--
-- Name: asset_link; Type: TABLE; Schema: media; Owner: -
-- Name: asset_link; Type: TABLE; Schema: media; Owner: -
--
--


CREATE TABLE media.asset_link (
CREATE TABLE media.asset_link (
    asset_id bigint NOT NULL,
    asset_id bigint NOT NULL,
    entity_table text NOT NULL,
    entity_table text NOT NULL,
    entity_id bigint NOT NULL,
    entity_id bigint NOT NULL,
    role text NOT NULL,
    role text NOT NULL,
    sort_order integer DEFAULT 1 NOT NULL,
    sort_order integer DEFAULT 1 NOT NULL,
    is_primary boolean DEFAULT false NOT NULL,
    is_primary boolean DEFAULT false NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_item_images; Type: VIEW; Schema: media; Owner: -
-- Name: v_item_images; Type: VIEW; Schema: media; Owner: -
--
--


CREATE VIEW media.v_item_images AS
CREATE VIEW media.v_item_images AS
 SELECT l.entity_table,
 SELECT l.entity_table,
    l.entity_id AS item_id,
    l.entity_id AS item_id,
    l.sort_order,
    l.sort_order,
    l.is_primary,
    l.is_primary,
    a.asset_id,
    a.asset_id,
    a.public_url,
    a.public_url,
    a.bucket,
    a.bucket,
    a.object_path,
    a.object_path,
    a.content_type,
    a.content_type,
    a.byte_size,
    a.byte_size,
    a.width_px,
    a.width_px,
    a.height_px,
    a.height_px,
    a.created_at
    a.created_at
   FROM (media.asset_link l
   FROM (media.asset_link l
     JOIN media.asset a ON ((a.asset_id = l.asset_id)))
     JOIN media.asset a ON ((a.asset_id = l.asset_id)))
  WHERE (l.role = 'ITEM_IMAGE'::text);
  WHERE (l.role = 'ITEM_IMAGE'::text);




--
--
-- Name: ai_event; Type: TABLE; Schema: notify; Owner: -
-- Name: ai_event; Type: TABLE; Schema: notify; Owner: -
--
--


CREATE TABLE notify.ai_event (
CREATE TABLE notify.ai_event (
    ai_event_id bigint NOT NULL,
    ai_event_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    ai_rule_id bigint,
    ai_rule_id bigint,
    title text NOT NULL,
    title text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    severity text DEFAULT 'warn'::text NOT NULL,
    severity text DEFAULT 'warn'::text NOT NULL,
    status text DEFAULT 'open'::text NOT NULL,
    status text DEFAULT 'open'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ai_event_ai_event_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
-- Name: ai_event_ai_event_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
--
--


CREATE SEQUENCE notify.ai_event_ai_event_id_seq
CREATE SEQUENCE notify.ai_event_ai_event_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ai_event_ai_event_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
-- Name: ai_event_ai_event_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
--
--


ALTER SEQUENCE notify.ai_event_ai_event_id_seq OWNED BY notify.ai_event.ai_event_id;
ALTER SEQUENCE notify.ai_event_ai_event_id_seq OWNED BY notify.ai_event.ai_event_id;




--
--
-- Name: ai_rule; Type: TABLE; Schema: notify; Owner: -
-- Name: ai_rule; Type: TABLE; Schema: notify; Owner: -
--
--


CREATE TABLE notify.ai_rule (
CREATE TABLE notify.ai_rule (
    ai_rule_id bigint NOT NULL,
    ai_rule_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    rule_key text NOT NULL,
    rule_key text NOT NULL,
    rule jsonb NOT NULL,
    rule jsonb NOT NULL,
    severity text DEFAULT 'warn'::text NOT NULL,
    severity text DEFAULT 'warn'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ai_rule_ai_rule_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
-- Name: ai_rule_ai_rule_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
--
--


CREATE SEQUENCE notify.ai_rule_ai_rule_id_seq
CREATE SEQUENCE notify.ai_rule_ai_rule_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ai_rule_ai_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
-- Name: ai_rule_ai_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
--
--


ALTER SEQUENCE notify.ai_rule_ai_rule_id_seq OWNED BY notify.ai_rule.ai_rule_id;
ALTER SEQUENCE notify.ai_rule_ai_rule_id_seq OWNED BY notify.ai_rule.ai_rule_id;




--
--
-- Name: approval_action_log; Type: TABLE; Schema: notify; Owner: -
-- Name: approval_action_log; Type: TABLE; Schema: notify; Owner: -
--
--


CREATE TABLE notify.approval_action_log (
CREATE TABLE notify.approval_action_log (
    action_log_id bigint NOT NULL,
    action_log_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    approval_request_id bigint NOT NULL,
    approval_request_id bigint NOT NULL,
    line_user_id text NOT NULL,
    line_user_id text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: approval_action_log_action_log_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
-- Name: approval_action_log_action_log_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
--
--


CREATE SEQUENCE notify.approval_action_log_action_log_id_seq
CREATE SEQUENCE notify.approval_action_log_action_log_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: approval_action_log_action_log_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
-- Name: approval_action_log_action_log_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
--
--


ALTER SEQUENCE notify.approval_action_log_action_log_id_seq OWNED BY notify.approval_action_log.action_log_id;
ALTER SEQUENCE notify.approval_action_log_action_log_id_seq OWNED BY notify.approval_action_log.action_log_id;




--
--
-- Name: approval_request; Type: TABLE; Schema: notify; Owner: -
-- Name: approval_request; Type: TABLE; Schema: notify; Owner: -
--
--


CREATE TABLE notify.approval_request (
CREATE TABLE notify.approval_request (
    approval_request_id bigint NOT NULL,
    approval_request_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    request_type text NOT NULL,
    request_type text NOT NULL,
    entity_id text NOT NULL,
    entity_id text NOT NULL,
    title text NOT NULL,
    title text NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    decided_by_line_user_id text,
    decided_by_line_user_id text,
    decided_at timestamp with time zone
    decided_at timestamp with time zone
);
);




--
--
-- Name: approval_request_approval_request_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
-- Name: approval_request_approval_request_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
--
--


CREATE SEQUENCE notify.approval_request_approval_request_id_seq
CREATE SEQUENCE notify.approval_request_approval_request_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: approval_request_approval_request_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
-- Name: approval_request_approval_request_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
--
--


ALTER SEQUENCE notify.approval_request_approval_request_id_seq OWNED BY notify.approval_request.approval_request_id;
ALTER SEQUENCE notify.approval_request_approval_request_id_seq OWNED BY notify.approval_request.approval_request_id;




--
--
-- Name: audit_trail; Type: TABLE; Schema: notify; Owner: -
-- Name: audit_trail; Type: TABLE; Schema: notify; Owner: -
--
--


CREATE TABLE notify.audit_trail (
CREATE TABLE notify.audit_trail (
    audit_id bigint NOT NULL,
    audit_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    actor_line_user_id text,
    actor_line_user_id text,
    actor text NOT NULL,
    actor text NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    entity_type text,
    entity_type text,
    entity_id text,
    entity_id text,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: audit_trail_audit_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
-- Name: audit_trail_audit_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
--
--


CREATE SEQUENCE notify.audit_trail_audit_id_seq
CREATE SEQUENCE notify.audit_trail_audit_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: audit_trail_audit_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
-- Name: audit_trail_audit_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
--
--


ALTER SEQUENCE notify.audit_trail_audit_id_seq OWNED BY notify.audit_trail.audit_id;
ALTER SEQUENCE notify.audit_trail_audit_id_seq OWNED BY notify.audit_trail.audit_id;




--
--
-- Name: notification_log; Type: TABLE; Schema: notify; Owner: -
-- Name: notification_log; Type: TABLE; Schema: notify; Owner: -
--
--


CREATE TABLE notify.notification_log (
CREATE TABLE notify.notification_log (
    notification_id bigint NOT NULL,
    notification_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    route_key text NOT NULL,
    route_key text NOT NULL,
    line_user_id text NOT NULL,
    line_user_id text NOT NULL,
    template_key text,
    template_key text,
    payload jsonb NOT NULL,
    payload jsonb NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    status text DEFAULT 'queued'::text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    last_error text,
    last_error text,
    sent_at timestamp with time zone,
    sent_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: notification_log_notification_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
-- Name: notification_log_notification_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
--
--


CREATE SEQUENCE notify.notification_log_notification_id_seq
CREATE SEQUENCE notify.notification_log_notification_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: notification_log_notification_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
-- Name: notification_log_notification_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
--
--


ALTER SEQUENCE notify.notification_log_notification_id_seq OWNED BY notify.notification_log.notification_id;
ALTER SEQUENCE notify.notification_log_notification_id_seq OWNED BY notify.notification_log.notification_id;




--
--
-- Name: notification_route; Type: TABLE; Schema: notify; Owner: -
-- Name: notification_route; Type: TABLE; Schema: notify; Owner: -
--
--


CREATE TABLE notify.notification_route (
CREATE TABLE notify.notification_route (
    route_id bigint NOT NULL,
    route_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    route_key text NOT NULL,
    route_key text NOT NULL,
    line_user_id text NOT NULL,
    line_user_id text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: notification_route_route_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
-- Name: notification_route_route_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
--
--


CREATE SEQUENCE notify.notification_route_route_id_seq
CREATE SEQUENCE notify.notification_route_route_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: notification_route_route_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
-- Name: notification_route_route_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
--
--


ALTER SEQUENCE notify.notification_route_route_id_seq OWNED BY notify.notification_route.route_id;
ALTER SEQUENCE notify.notification_route_route_id_seq OWNED BY notify.notification_route.route_id;




--
--
-- Name: notification_template; Type: TABLE; Schema: notify; Owner: -
-- Name: notification_template; Type: TABLE; Schema: notify; Owner: -
--
--


CREATE TABLE notify.notification_template (
CREATE TABLE notify.notification_template (
    template_id bigint NOT NULL,
    template_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    template_key text NOT NULL,
    template_key text NOT NULL,
    title text NOT NULL,
    title text NOT NULL,
    body text NOT NULL,
    body text NOT NULL,
    kind text DEFAULT 'text'::text NOT NULL,
    kind text DEFAULT 'text'::text NOT NULL,
    severity text DEFAULT 'info'::text NOT NULL,
    severity text DEFAULT 'info'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: notification_template_template_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
-- Name: notification_template_template_id_seq; Type: SEQUENCE; Schema: notify; Owner: -
--
--


CREATE SEQUENCE notify.notification_template_template_id_seq
CREATE SEQUENCE notify.notification_template_template_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: notification_template_template_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
-- Name: notification_template_template_id_seq; Type: SEQUENCE OWNED BY; Schema: notify; Owner: -
--
--


ALTER SEQUENCE notify.notification_template_template_id_seq OWNED BY notify.notification_template.template_id;
ALTER SEQUENCE notify.notification_template_template_id_seq OWNED BY notify.notification_template.template_id;




--
--
-- Name: v_audit_recent; Type: VIEW; Schema: notify; Owner: -
-- Name: v_audit_recent; Type: VIEW; Schema: notify; Owner: -
--
--


CREATE VIEW notify.v_audit_recent AS
CREATE VIEW notify.v_audit_recent AS
 SELECT audit_id,
 SELECT audit_id,
    company_id,
    company_id,
    actor_line_user_id,
    actor_line_user_id,
    actor,
    actor,
    action,
    action,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    detail,
    detail,
    created_at
    created_at
   FROM notify.audit_trail
   FROM notify.audit_trail
  ORDER BY created_at DESC
  ORDER BY created_at DESC
 LIMIT 200;
 LIMIT 200;




--
--
-- Name: approval_rule; Type: TABLE; Schema: ops; Owner: -
-- Name: approval_rule; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.approval_rule (
CREATE TABLE ops.approval_rule (
    rule_id uuid DEFAULT gen_random_uuid() NOT NULL,
    rule_id uuid DEFAULT gen_random_uuid() NOT NULL,
    domain text NOT NULL,
    domain text NOT NULL,
    event_type text NOT NULL,
    event_type text NOT NULL,
    threshold_amount numeric,
    threshold_amount numeric,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: backup_log; Type: TABLE; Schema: ops; Owner: -
-- Name: backup_log; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.backup_log (
CREATE TABLE ops.backup_log (
    backup_id uuid DEFAULT gen_random_uuid() NOT NULL,
    backup_id uuid DEFAULT gen_random_uuid() NOT NULL,
    backup_type text NOT NULL,
    backup_type text NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    location text,
    location text,
    executed_at timestamp with time zone DEFAULT now() NOT NULL
    executed_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: business_event; Type: TABLE; Schema: ops; Owner: -
-- Name: business_event; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.business_event (
CREATE TABLE ops.business_event (
    event_id uuid DEFAULT gen_random_uuid() NOT NULL,
    event_id uuid DEFAULT gen_random_uuid() NOT NULL,
    company_id uuid,
    company_id uuid,
    domain text NOT NULL,
    domain text NOT NULL,
    entity_type text NOT NULL,
    entity_type text NOT NULL,
    entity_id uuid NOT NULL,
    entity_id uuid NOT NULL,
    event_type text NOT NULL,
    event_type text NOT NULL,
    amount numeric,
    amount numeric,
    currency text,
    currency text,
    created_by text,
    created_by text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: document_file; Type: TABLE; Schema: ops; Owner: -
-- Name: document_file; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.document_file (
CREATE TABLE ops.document_file (
    document_file_id bigint NOT NULL,
    document_file_id bigint NOT NULL,
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    document_id bigint NOT NULL,
    document_id bigint NOT NULL,
    file_path text NOT NULL,
    file_path text NOT NULL,
    file_hash text NOT NULL,
    file_hash text NOT NULL,
    generated_at timestamp with time zone DEFAULT now() NOT NULL,
    generated_at timestamp with time zone DEFAULT now() NOT NULL,
    generated_by uuid,
    generated_by uuid,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: document_file_document_file_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
-- Name: document_file_document_file_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
--
--


CREATE SEQUENCE ops.document_file_document_file_id_seq
CREATE SEQUENCE ops.document_file_document_file_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: document_file_document_file_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
-- Name: document_file_document_file_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
--
--


ALTER SEQUENCE ops.document_file_document_file_id_seq OWNED BY ops.document_file.document_file_id;
ALTER SEQUENCE ops.document_file_document_file_id_seq OWNED BY ops.document_file.document_file_id;




--
--
-- Name: document_send_history_send_history_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
-- Name: document_send_history_send_history_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
--
--


CREATE SEQUENCE ops.document_send_history_send_history_id_seq
CREATE SEQUENCE ops.document_send_history_send_history_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: document_send_history_send_history_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
-- Name: document_send_history_send_history_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
--
--


ALTER SEQUENCE ops.document_send_history_send_history_id_seq OWNED BY ops.document_send_history.send_history_id;
ALTER SEQUENCE ops.document_send_history_send_history_id_seq OWNED BY ops.document_send_history.send_history_id;




--
--
-- Name: document_send_queue; Type: TABLE; Schema: ops; Owner: -
-- Name: document_send_queue; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.document_send_queue (
CREATE TABLE ops.document_send_queue (
    send_queue_id bigint NOT NULL,
    send_queue_id bigint NOT NULL,
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    business_id bigint NOT NULL,
    business_id bigint NOT NULL,
    channel_code text DEFAULT 'EMAIL'::text NOT NULL,
    channel_code text DEFAULT 'EMAIL'::text NOT NULL,
    queued_at timestamp with time zone DEFAULT now() NOT NULL,
    queued_at timestamp with time zone DEFAULT now() NOT NULL,
    sent_at timestamp with time zone
    sent_at timestamp with time zone
);
);




--
--
-- Name: document_send_queue_send_queue_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
-- Name: document_send_queue_send_queue_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
--
--


CREATE SEQUENCE ops.document_send_queue_send_queue_id_seq
CREATE SEQUENCE ops.document_send_queue_send_queue_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: document_send_queue_send_queue_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
-- Name: document_send_queue_send_queue_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
--
--


ALTER SEQUENCE ops.document_send_queue_send_queue_id_seq OWNED BY ops.document_send_queue.send_queue_id;
ALTER SEQUENCE ops.document_send_queue_send_queue_id_seq OWNED BY ops.document_send_queue.send_queue_id;




--
--
-- Name: document_type_master; Type: TABLE; Schema: ops; Owner: -
-- Name: document_type_master; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.document_type_master (
CREATE TABLE ops.document_type_master (
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    document_type_name text NOT NULL,
    document_type_name text NOT NULL,
    is_external boolean NOT NULL,
    is_external boolean NOT NULL,
    is_chargeable_paper boolean NOT NULL,
    is_chargeable_paper boolean NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: notification_outbox; Type: TABLE; Schema: ops; Owner: -
-- Name: notification_outbox; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.notification_outbox (
CREATE TABLE ops.notification_outbox (
    notification_id bigint NOT NULL,
    notification_id bigint NOT NULL,
    channel_code text NOT NULL,
    channel_code text NOT NULL,
    destination text,
    destination text,
    message text NOT NULL,
    message text NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    retry_count integer DEFAULT 0 NOT NULL,
    max_retry integer DEFAULT 3 NOT NULL,
    max_retry integer DEFAULT 3 NOT NULL,
    last_error text,
    last_error text,
    run_after timestamp with time zone DEFAULT now() NOT NULL,
    run_after timestamp with time zone DEFAULT now() NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    sent_at timestamp with time zone,
    sent_at timestamp with time zone,
    channel_type text,
    channel_type text,
    title text,
    title text,
    body text,
    body text,
    CONSTRAINT notification_outbox_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'SENT'::text, 'FAILED'::text])))
    CONSTRAINT notification_outbox_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'SENT'::text, 'FAILED'::text])))
);
);




--
--
-- Name: notification_outbox_notification_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
-- Name: notification_outbox_notification_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
--
--


CREATE SEQUENCE ops.notification_outbox_notification_id_seq
CREATE SEQUENCE ops.notification_outbox_notification_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: notification_outbox_notification_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
-- Name: notification_outbox_notification_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
--
--


ALTER SEQUENCE ops.notification_outbox_notification_id_seq OWNED BY ops.notification_outbox.notification_id;
ALTER SEQUENCE ops.notification_outbox_notification_id_seq OWNED BY ops.notification_outbox.notification_id;




--
--
-- Name: ops_idempotency; Type: TABLE; Schema: ops; Owner: -
-- Name: ops_idempotency; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.ops_idempotency (
CREATE TABLE ops.ops_idempotency (
    idempotency_key text NOT NULL,
    idempotency_key text NOT NULL,
    job_type text NOT NULL,
    job_type text NOT NULL,
    business_table text NOT NULL,
    business_table text NOT NULL,
    business_id bigint NOT NULL,
    business_id bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ops_job_queue_job_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
-- Name: ops_job_queue_job_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
--
--


CREATE SEQUENCE ops.ops_job_queue_job_id_seq
CREATE SEQUENCE ops.ops_job_queue_job_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ops_job_queue_job_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
-- Name: ops_job_queue_job_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
--
--


ALTER SEQUENCE ops.ops_job_queue_job_id_seq OWNED BY ops.ops_job_queue.job_id;
ALTER SEQUENCE ops.ops_job_queue_job_id_seq OWNED BY ops.ops_job_queue.job_id;




--
--
-- Name: ops_job_result; Type: TABLE; Schema: ops; Owner: -
-- Name: ops_job_result; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.ops_job_result (
CREATE TABLE ops.ops_job_result (
    job_id bigint NOT NULL,
    job_id bigint NOT NULL,
    result_status text NOT NULL,
    result_status text NOT NULL,
    result_message text,
    result_message text,
    finished_at timestamp with time zone DEFAULT now() NOT NULL,
    finished_at timestamp with time zone DEFAULT now() NOT NULL,
    status text DEFAULT 'SUCCESS'::text,
    status text DEFAULT 'SUCCESS'::text,
    result_payload jsonb DEFAULT '{}'::jsonb,
    result_payload jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    result_detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    result_detail jsonb DEFAULT '{}'::jsonb NOT NULL,
    completed_at timestamp with time zone DEFAULT now() NOT NULL,
    completed_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT ops_job_result_result_status_check CHECK ((result_status = ANY (ARRAY['SUCCESS'::text, 'FAILED'::text])))
    CONSTRAINT ops_job_result_result_status_check CHECK ((result_status = ANY (ARRAY['SUCCESS'::text, 'FAILED'::text])))
);
);




--
--
-- Name: pdf_generate_queue; Type: TABLE; Schema: ops; Owner: -
-- Name: pdf_generate_queue; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.pdf_generate_queue (
CREATE TABLE ops.pdf_generate_queue (
    queue_id bigint NOT NULL,
    queue_id bigint NOT NULL,
    function_code text NOT NULL,
    function_code text NOT NULL,
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    business_id bigint NOT NULL,
    business_id bigint NOT NULL,
    queued_at timestamp with time zone DEFAULT now() NOT NULL,
    queued_at timestamp with time zone DEFAULT now() NOT NULL,
    processed_at timestamp with time zone
    processed_at timestamp with time zone
);
);




--
--
-- Name: pdf_generate_queue_queue_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
-- Name: pdf_generate_queue_queue_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
--
--


CREATE SEQUENCE ops.pdf_generate_queue_queue_id_seq
CREATE SEQUENCE ops.pdf_generate_queue_queue_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: pdf_generate_queue_queue_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
-- Name: pdf_generate_queue_queue_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
--
--


ALTER SEQUENCE ops.pdf_generate_queue_queue_id_seq OWNED BY ops.pdf_generate_queue.queue_id;
ALTER SEQUENCE ops.pdf_generate_queue_queue_id_seq OWNED BY ops.pdf_generate_queue.queue_id;




--
--
-- Name: resend_type_master; Type: TABLE; Schema: ops; Owner: -
-- Name: resend_type_master; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.resend_type_master (
CREATE TABLE ops.resend_type_master (
    resend_type_code text NOT NULL,
    resend_type_code text NOT NULL,
    resend_type_name text NOT NULL,
    resend_type_name text NOT NULL,
    is_chargeable_paper boolean NOT NULL,
    is_chargeable_paper boolean NOT NULL,
    description text,
    description text,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: runtime_flag; Type: TABLE; Schema: ops; Owner: -
-- Name: runtime_flag; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.runtime_flag (
CREATE TABLE ops.runtime_flag (
    flag_key text NOT NULL,
    flag_key text NOT NULL,
    flag_value text NOT NULL,
    flag_value text NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: runtime_health; Type: TABLE; Schema: ops; Owner: -
-- Name: runtime_health; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.runtime_health (
CREATE TABLE ops.runtime_health (
    health_id uuid DEFAULT gen_random_uuid() NOT NULL,
    health_id uuid DEFAULT gen_random_uuid() NOT NULL,
    component text NOT NULL,
    component text NOT NULL,
    status text NOT NULL,
    status text NOT NULL,
    message text,
    message text,
    checked_at timestamp with time zone DEFAULT now() NOT NULL
    checked_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: send_fee_master; Type: TABLE; Schema: ops; Owner: -
-- Name: send_fee_master; Type: TABLE; Schema: ops; Owner: -
--
--


CREATE TABLE ops.send_fee_master (
CREATE TABLE ops.send_fee_master (
    fee_id bigint NOT NULL,
    fee_id bigint NOT NULL,
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    resend_type_code text NOT NULL,
    resend_type_code text NOT NULL,
    fee_amount numeric NOT NULL,
    fee_amount numeric NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: send_fee_master_fee_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
-- Name: send_fee_master_fee_id_seq; Type: SEQUENCE; Schema: ops; Owner: -
--
--


CREATE SEQUENCE ops.send_fee_master_fee_id_seq
CREATE SEQUENCE ops.send_fee_master_fee_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: send_fee_master_fee_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
-- Name: send_fee_master_fee_id_seq; Type: SEQUENCE OWNED BY; Schema: ops; Owner: -
--
--


ALTER SEQUENCE ops.send_fee_master_fee_id_seq OWNED BY ops.send_fee_master.fee_id;
ALTER SEQUENCE ops.send_fee_master_fee_id_seq OWNED BY ops.send_fee_master.fee_id;




--
--
-- Name: v_dashboard_send_summary; Type: VIEW; Schema: ops; Owner: -
-- Name: v_dashboard_send_summary; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_dashboard_send_summary AS
CREATE VIEW ops.v_dashboard_send_summary AS
 SELECT to_char(date_trunc('month'::text, h.created_at), 'YYYY-MM'::text) AS month,
 SELECT to_char(date_trunc('month'::text, h.created_at), 'YYYY-MM'::text) AS month,
    d.document_type_name,
    d.document_type_name,
    c.channel_name,
    c.channel_name,
    count(*) AS send_count,
    count(*) AS send_count,
    sum(h.send_fee_amount) AS total_fee,
    sum(h.send_fee_amount) AS total_fee,
    sum(
    sum(
        CASE
        CASE
            WHEN (h.send_status = 'FAILED'::text) THEN 1
            WHEN (h.send_status = 'FAILED'::text) THEN 1
            ELSE 0
            ELSE 0
        END) AS failed_count,
        END) AS failed_count,
    round(((100.0 * (sum(
    round(((100.0 * (sum(
        CASE
        CASE
            WHEN (h.send_status = 'FAILED'::text) THEN 1
            WHEN (h.send_status = 'FAILED'::text) THEN 1
            ELSE 0
            ELSE 0
        END))::numeric) / (GREATEST(count(*), (1)::bigint))::numeric), 2) AS failed_rate
        END))::numeric) / (GREATEST(count(*), (1)::bigint))::numeric), 2) AS failed_rate
   FROM ((ops.document_send_history h
   FROM ((ops.document_send_history h
     JOIN ops.document_type_master d ON ((d.document_type_code = h.document_type_code)))
     JOIN ops.document_type_master d ON ((d.document_type_code = h.document_type_code)))
     JOIN ops.send_channel_master c ON ((c.channel_code = h.channel_code)))
     JOIN ops.send_channel_master c ON ((c.channel_code = h.channel_code)))
  GROUP BY (to_char(date_trunc('month'::text, h.created_at), 'YYYY-MM'::text)), d.document_type_name, c.channel_name
  GROUP BY (to_char(date_trunc('month'::text, h.created_at), 'YYYY-MM'::text)), d.document_type_name, c.channel_name
  ORDER BY (to_char(date_trunc('month'::text, h.created_at), 'YYYY-MM'::text)) DESC, d.document_type_name, c.channel_name;
  ORDER BY (to_char(date_trunc('month'::text, h.created_at), 'YYYY-MM'::text)) DESC, d.document_type_name, c.channel_name;




--
--
-- Name: v_document_send_fee_calc; Type: VIEW; Schema: ops; Owner: -
-- Name: v_document_send_fee_calc; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_document_send_fee_calc AS
CREATE VIEW ops.v_document_send_fee_calc AS
 SELECT h.send_history_id,
 SELECT h.send_history_id,
    h.company_id,
    h.company_id,
    h.document_type_code,
    h.document_type_code,
    h.channel_code,
    h.channel_code,
    h.resend_type_code,
    h.resend_type_code,
        CASE
        CASE
            WHEN (c.is_paper = false) THEN (0)::numeric
            WHEN (c.is_paper = false) THEN (0)::numeric
            WHEN (d.is_chargeable_paper = false) THEN (0)::numeric
            WHEN (d.is_chargeable_paper = false) THEN (0)::numeric
            WHEN (r.is_chargeable_paper = false) THEN (0)::numeric
            WHEN (r.is_chargeable_paper = false) THEN (0)::numeric
            ELSE COALESCE(f.fee_amount, (0)::numeric)
            ELSE COALESCE(f.fee_amount, (0)::numeric)
        END AS calculated_fee,
        END AS calculated_fee,
    h.currency_code
    h.currency_code
   FROM ((((ops.document_send_history h
   FROM ((((ops.document_send_history h
     JOIN ops.send_channel_master c ON ((c.channel_code = h.channel_code)))
     JOIN ops.send_channel_master c ON ((c.channel_code = h.channel_code)))
     JOIN ops.document_type_master d ON ((d.document_type_code = h.document_type_code)))
     JOIN ops.document_type_master d ON ((d.document_type_code = h.document_type_code)))
     JOIN ops.resend_type_master r ON ((r.resend_type_code = h.resend_type_code)))
     JOIN ops.resend_type_master r ON ((r.resend_type_code = h.resend_type_code)))
     LEFT JOIN ops.send_fee_master f ON (((f.document_type_code = h.document_type_code) AND (f.resend_type_code = h.resend_type_code) AND (f.is_active = true))));
     LEFT JOIN ops.send_fee_master f ON (((f.document_type_code = h.document_type_code) AND (f.resend_type_code = h.resend_type_code) AND (f.is_active = true))));




--
--
-- Name: v_ops_job_metrics; Type: VIEW; Schema: ops; Owner: -
-- Name: v_ops_job_metrics; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_ops_job_metrics AS
CREATE VIEW ops.v_ops_job_metrics AS
 SELECT job_type,
 SELECT job_type,
    status,
    status,
    count(*) AS cnt,
    count(*) AS cnt,
    min(created_at) AS oldest_created_at,
    min(created_at) AS oldest_created_at,
    max(created_at) AS newest_created_at
    max(created_at) AS newest_created_at
   FROM ops.ops_job_queue q
   FROM ops.ops_job_queue q
  GROUP BY job_type, status
  GROUP BY job_type, status
  ORDER BY job_type, status;
  ORDER BY job_type, status;




--
--
-- Name: v_ops_job_queue_failed; Type: VIEW; Schema: ops; Owner: -
-- Name: v_ops_job_queue_failed; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_ops_job_queue_failed AS
CREATE VIEW ops.v_ops_job_queue_failed AS
 SELECT job_id,
 SELECT job_id,
    job_type,
    job_type,
    function_code,
    function_code,
    document_type_code,
    document_type_code,
    business_table,
    business_table,
    business_id,
    business_id,
    job_status,
    job_status,
    retry_count,
    retry_count,
    max_retry,
    max_retry,
    locked_at,
    locked_at,
    locked_by,
    locked_by,
    created_at,
    created_at,
    executed_at,
    executed_at,
    payload,
    payload,
    status,
    status,
    priority,
    priority,
    run_after,
    run_after,
    attempts,
    attempts,
    max_attempts,
    max_attempts,
    last_error,
    last_error,
    created_by,
    created_by,
    updated_at
    updated_at
   FROM ops.ops_job_queue
   FROM ops.ops_job_queue
  WHERE (status = 'FAILED'::text)
  WHERE (status = 'FAILED'::text)
  ORDER BY updated_at DESC, job_id DESC;
  ORDER BY updated_at DESC, job_id DESC;




--
--
-- Name: v_ops_job_queue_open; Type: VIEW; Schema: ops; Owner: -
-- Name: v_ops_job_queue_open; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_ops_job_queue_open AS
CREATE VIEW ops.v_ops_job_queue_open AS
 SELECT job_id,
 SELECT job_id,
    job_type,
    job_type,
    function_code,
    function_code,
    document_type_code,
    document_type_code,
    business_table,
    business_table,
    business_id,
    business_id,
    status,
    status,
    priority,
    priority,
    retry_count,
    retry_count,
    max_retry,
    max_retry,
    locked_at,
    locked_at,
    picked_at,
    picked_at,
    created_at,
    created_at,
    payload
    payload
   FROM ops.ops_job_queue q
   FROM ops.ops_job_queue q
  WHERE (status = ANY (ARRAY['PENDING'::text, 'PROCESSING'::text]))
  WHERE (status = ANY (ARRAY['PENDING'::text, 'PROCESSING'::text]))
  ORDER BY priority DESC, created_at;
  ORDER BY priority DESC, created_at;




--
--
-- Name: v_ops_job_queue_stuck; Type: VIEW; Schema: ops; Owner: -
-- Name: v_ops_job_queue_stuck; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_ops_job_queue_stuck AS
CREATE VIEW ops.v_ops_job_queue_stuck AS
 SELECT job_id,
 SELECT job_id,
    job_type,
    job_type,
    function_code,
    function_code,
    document_type_code,
    document_type_code,
    business_table,
    business_table,
    business_id,
    business_id,
    job_status,
    job_status,
    retry_count,
    retry_count,
    max_retry,
    max_retry,
    locked_at,
    locked_at,
    locked_by,
    locked_by,
    created_at,
    created_at,
    executed_at,
    executed_at,
    payload,
    payload,
    status,
    status,
    priority,
    priority,
    run_after,
    run_after,
    attempts,
    attempts,
    max_attempts,
    max_attempts,
    last_error,
    last_error,
    created_by,
    created_by,
    updated_at,
    updated_at,
    picked_at,
    picked_at,
    finished_at,
    finished_at,
    (now() - locked_at) AS locked_age
    (now() - locked_at) AS locked_age
   FROM ops.ops_job_queue q
   FROM ops.ops_job_queue q
  WHERE ((status = 'PROCESSING'::text) AND (locked_at IS NOT NULL) AND (locked_at < (now() - '00:15:00'::interval)))
  WHERE ((status = 'PROCESSING'::text) AND (locked_at IS NOT NULL) AND (locked_at < (now() - '00:15:00'::interval)))
  ORDER BY locked_at;
  ORDER BY locked_at;




--
--
-- Name: v_ops_job_queue_summary; Type: VIEW; Schema: ops; Owner: -
-- Name: v_ops_job_queue_summary; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_ops_job_queue_summary AS
CREATE VIEW ops.v_ops_job_queue_summary AS
 SELECT status,
 SELECT status,
    count(*) AS job_count,
    count(*) AS job_count,
    min(created_at) AS oldest_created_at,
    min(created_at) AS oldest_created_at,
    min(run_after) AS oldest_run_after
    min(run_after) AS oldest_run_after
   FROM ops.ops_job_queue
   FROM ops.ops_job_queue
  GROUP BY status
  GROUP BY status
  ORDER BY status;
  ORDER BY status;




--
--
-- Name: v_ops_job_recent; Type: VIEW; Schema: ops; Owner: -
-- Name: v_ops_job_recent; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_ops_job_recent AS
CREATE VIEW ops.v_ops_job_recent AS
 SELECT q.job_id,
 SELECT q.job_id,
    q.job_type,
    q.job_type,
    q.function_code,
    q.function_code,
    q.document_type_code,
    q.document_type_code,
    q.business_table,
    q.business_table,
    q.business_id,
    q.business_id,
    q.status,
    q.status,
    r.result_status,
    r.result_status,
    r.completed_at,
    r.completed_at,
    q.created_at,
    q.created_at,
    q.updated_at
    q.updated_at
   FROM (ops.ops_job_queue q
   FROM (ops.ops_job_queue q
     LEFT JOIN ops.ops_job_result r ON ((r.job_id = q.job_id)))
     LEFT JOIN ops.ops_job_result r ON ((r.job_id = q.job_id)))
  ORDER BY q.job_id DESC;
  ORDER BY q.job_id DESC;




--
--
-- Name: v_ops_job_result_latest; Type: VIEW; Schema: ops; Owner: -
-- Name: v_ops_job_result_latest; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_ops_job_result_latest AS
CREATE VIEW ops.v_ops_job_result_latest AS
 SELECT DISTINCT ON (job_id) job_id,
 SELECT DISTINCT ON (job_id) job_id,
    status,
    status,
    created_at,
    created_at,
    result_payload
    result_payload
   FROM ops.ops_job_result r
   FROM ops.ops_job_result r
  ORDER BY job_id, created_at DESC;
  ORDER BY job_id, created_at DESC;




--
--
-- Name: v_paper_send_cost_monthly; Type: VIEW; Schema: ops; Owner: -
-- Name: v_paper_send_cost_monthly; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_paper_send_cost_monthly AS
CREATE VIEW ops.v_paper_send_cost_monthly AS
 SELECT company_id,
 SELECT company_id,
    date_trunc('month'::text, created_at) AS month,
    date_trunc('month'::text, created_at) AS month,
    document_type_code,
    document_type_code,
    sum(send_fee_amount) AS total_fee,
    sum(send_fee_amount) AS total_fee,
    count(*) AS send_count
    count(*) AS send_count
   FROM ops.document_send_history
   FROM ops.document_send_history
  WHERE (send_fee_amount > (0)::numeric)
  WHERE (send_fee_amount > (0)::numeric)
  GROUP BY company_id, (date_trunc('month'::text, created_at)), document_type_code;
  GROUP BY company_id, (date_trunc('month'::text, created_at)), document_type_code;




--
--
-- Name: v_send_failed_alert; Type: VIEW; Schema: ops; Owner: -
-- Name: v_send_failed_alert; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_send_failed_alert AS
CREATE VIEW ops.v_send_failed_alert AS
 SELECT send_history_id,
 SELECT send_history_id,
    company_id,
    company_id,
    document_type_code,
    document_type_code,
    document_id,
    document_id,
    channel_code,
    channel_code,
    resend_type_code,
    resend_type_code,
    retry_count,
    retry_count,
    created_at
    created_at
   FROM ops.document_send_history
   FROM ops.document_send_history
  WHERE ((send_status = 'FAILED'::text) AND (retry_count >= 3));
  WHERE ((send_status = 'FAILED'::text) AND (retry_count >= 3));




--
--
-- Name: v_shipping_package_photos; Type: VIEW; Schema: ops; Owner: -
-- Name: v_shipping_package_photos; Type: VIEW; Schema: ops; Owner: -
--
--


CREATE VIEW ops.v_shipping_package_photos AS
CREATE VIEW ops.v_shipping_package_photos AS
 SELECT l.entity_id AS shipping_id,
 SELECT l.entity_id AS shipping_id,
    l.sort_order,
    l.sort_order,
    l.is_primary,
    l.is_primary,
    a.asset_id,
    a.asset_id,
    a.public_url,
    a.public_url,
    a.bucket,
    a.bucket,
    a.object_path,
    a.object_path,
    a.content_type,
    a.content_type,
    a.byte_size,
    a.byte_size,
    a.width_px,
    a.width_px,
    a.height_px,
    a.height_px,
    a.created_at
    a.created_at
   FROM (media.asset_link l
   FROM (media.asset_link l
     JOIN media.asset a ON ((a.asset_id = l.asset_id)))
     JOIN media.asset a ON ((a.asset_id = l.asset_id)))
  WHERE ((l.entity_table = 'sales.shipping_header'::text) AND (l.role = 'PACKAGE_PHOTO'::text));
  WHERE ((l.entity_table = 'sales.shipping_header'::text) AND (l.role = 'PACKAGE_PHOTO'::text));




--
--
-- Name: accounting_period; Type: VIEW; Schema: public; Owner: -
-- Name: accounting_period; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.accounting_period AS
CREATE VIEW public.accounting_period AS
 SELECT period_id,
 SELECT period_id,
    company_id,
    company_id,
    period_year,
    period_year,
    period_month,
    period_month,
    is_closed,
    is_closed,
    closed_at
    closed_at
   FROM core.accounting_period;
   FROM core.accounting_period;




--
--
-- Name: accounts; Type: VIEW; Schema: public; Owner: -
-- Name: accounts; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.accounts AS
CREATE VIEW public.accounts AS
 SELECT account_id,
 SELECT account_id,
    company_id,
    company_id,
    account_code,
    account_code,
    account_name,
    account_name,
    account_type,
    account_type,
    is_active,
    is_active,
    created_at
    created_at
   FROM core.accounts;
   FROM core.accounts;




--
--
-- Name: app_user; Type: VIEW; Schema: public; Owner: -
-- Name: app_user; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.app_user AS
CREATE VIEW public.app_user AS
 SELECT user_id,
 SELECT user_id,
    company_id,
    company_id,
    email,
    email,
    display_name,
    display_name,
    is_active,
    is_active,
    created_at
    created_at
   FROM core.app_user;
   FROM core.app_user;




--
--
-- Name: approval_completed_event; Type: VIEW; Schema: public; Owner: -
-- Name: approval_completed_event; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.approval_completed_event AS
CREATE VIEW public.approval_completed_event AS
 SELECT request_id,
 SELECT request_id,
    order_id,
    order_id,
    status,
    status,
    decided_at
    decided_at
   FROM audit.approval_request
   FROM audit.approval_request
  WHERE (status = ANY (ARRAY['approved'::text, 'rejected'::text]));
  WHERE (status = ANY (ARRAY['approved'::text, 'rejected'::text]));




--
--
-- Name: approval_request_with_url; Type: VIEW; Schema: public; Owner: -
-- Name: approval_request_with_url; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.approval_request_with_url AS
CREATE VIEW public.approval_request_with_url AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    domain,
    domain,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    order_id,
    order_id,
    policy_id,
    policy_id,
    status,
    status,
    detected_at,
    detected_at,
    decided_at,
    decided_at,
    decided_by,
    decided_by,
    decision_note,
    decision_note,
    format('https://YOUR-APP-DOMAIN/approve?request_id=%s'::text, request_id) AS approval_url
    format('https://YOUR-APP-DOMAIN/approve?request_id=%s'::text, request_id) AS approval_url
   FROM audit.approval_request ar;
   FROM audit.approval_request ar;




--
--
-- Name: attendance_log; Type: VIEW; Schema: public; Owner: -
-- Name: attendance_log; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.attendance_log AS
CREATE VIEW public.attendance_log AS
 SELECT attendance_log_id,
 SELECT attendance_log_id,
    company_id,
    company_id,
    employee_id,
    employee_id,
    work_date,
    work_date,
    clock_in,
    clock_in,
    clock_out,
    clock_out,
    work_minutes
    work_minutes
   FROM hr.attendance_log;
   FROM hr.attendance_log;




--
--
-- Name: billing_detail; Type: TABLE; Schema: sales; Owner: -
-- Name: billing_detail; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.billing_detail (
CREATE TABLE sales.billing_detail (
    billing_detail_id bigint NOT NULL,
    billing_detail_id bigint NOT NULL,
    billing_id bigint NOT NULL,
    billing_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    tax_category_code text
    tax_category_code text
);
);




--
--
-- Name: billing_detail; Type: VIEW; Schema: public; Owner: -
-- Name: billing_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.billing_detail AS
CREATE VIEW public.billing_detail AS
 SELECT billing_detail_id,
 SELECT billing_detail_id,
    billing_id,
    billing_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    tax_category_code
    tax_category_code
   FROM sales.billing_detail;
   FROM sales.billing_detail;




--
--
-- Name: billing_header; Type: TABLE; Schema: sales; Owner: -
-- Name: billing_header; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.billing_header (
CREATE TABLE sales.billing_header (
    billing_id bigint NOT NULL,
    billing_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    billing_no text NOT NULL,
    billing_no text NOT NULL,
    customer_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    billing_date date DEFAULT CURRENT_DATE NOT NULL,
    billing_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'ISSUED'::text NOT NULL,
    status_code text DEFAULT 'ISSUED'::text NOT NULL,
    total_amount numeric(18,2) DEFAULT 0 NOT NULL,
    total_amount numeric(18,2) DEFAULT 0 NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    original_billing_id bigint
    original_billing_id bigint
);
);






--
--
-- Name: billing_header; Type: VIEW; Schema: public; Owner: -
-- Name: billing_header; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.billing_header AS
CREATE VIEW public.billing_header AS
 SELECT billing_id,
 SELECT billing_id,
    company_id,
    company_id,
    billing_no,
    billing_no,
    customer_id,
    customer_id,
    billing_date,
    billing_date,
    status_code,
    status_code,
    total_amount,
    total_amount,
    created_by,
    created_by,
    created_at
    created_at
   FROM sales.billing_header;
   FROM sales.billing_header;




--
--
-- Name: bom_detail; Type: VIEW; Schema: public; Owner: -
-- Name: bom_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.bom_detail AS
CREATE VIEW public.bom_detail AS
 SELECT bom_detail_id,
 SELECT bom_detail_id,
    bom_id,
    bom_id,
    component_item_id,
    component_item_id,
    qty_per,
    qty_per,
    issue_method,
    issue_method,
    created_at
    created_at
   FROM manufacturing.bom_detail;
   FROM manufacturing.bom_detail;




--
--
-- Name: bom_header; Type: VIEW; Schema: public; Owner: -
-- Name: bom_header; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.bom_header AS
CREATE VIEW public.bom_header AS
 SELECT bom_id,
 SELECT bom_id,
    company_id,
    company_id,
    parent_item_id,
    parent_item_id,
    version,
    version,
    is_active,
    is_active,
    created_at
    created_at
   FROM manufacturing.bom_header;
   FROM manufacturing.bom_header;




--
--
-- Name: company; Type: VIEW; Schema: public; Owner: -
-- Name: company; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.company AS
CREATE VIEW public.company AS
 SELECT company_id,
 SELECT company_id,
    company_code,
    company_code,
    company_name,
    company_name,
    currency_code,
    currency_code,
    timezone,
    timezone,
    is_active,
    is_active,
    created_at,
    created_at,
    updated_at
    updated_at
   FROM core.company;
   FROM core.company;




--
--
-- Name: company_users; Type: VIEW; Schema: public; Owner: -
-- Name: company_users; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.company_users AS
CREATE VIEW public.company_users AS
 SELECT company_user_id,
 SELECT company_user_id,
    company_id,
    company_id,
    user_id,
    user_id,
    role_code,
    role_code,
    created_at
    created_at
   FROM core.company_users;
   FROM core.company_users;




--
--
-- Name: customer; Type: TABLE; Schema: sales; Owner: -
-- Name: customer; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.customer (
CREATE TABLE sales.customer (
    customer_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    customer_code text NOT NULL,
    customer_code text NOT NULL,
    customer_name text NOT NULL,
    customer_name text NOT NULL,
    billing_address text,
    billing_address text,
    shipping_address text,
    shipping_address text,
    payment_term text,
    payment_term text,
    credit_limit numeric(18,2),
    credit_limit numeric(18,2),
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: customer; Type: VIEW; Schema: public; Owner: -
-- Name: customer; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.customer AS
CREATE VIEW public.customer AS
 SELECT customer_id,
 SELECT customer_id,
    company_id,
    company_id,
    customer_code,
    customer_code,
    customer_name,
    customer_name,
    billing_address,
    billing_address,
    shipping_address,
    shipping_address,
    payment_term,
    payment_term,
    credit_limit,
    credit_limit,
    is_active,
    is_active,
    created_at
    created_at
   FROM sales.customer;
   FROM sales.customer;




--
--
-- Name: document_sequence; Type: VIEW; Schema: public; Owner: -
-- Name: document_sequence; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.document_sequence AS
CREATE VIEW public.document_sequence AS
 SELECT sequence_id,
 SELECT sequence_id,
    company_id,
    company_id,
    doc_type,
    doc_type,
    prefix,
    prefix,
    current_no,
    current_no,
    updated_at
    updated_at
   FROM core.document_sequence;
   FROM core.document_sequence;




--
--
-- Name: employee; Type: VIEW; Schema: public; Owner: -
-- Name: employee; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.employee AS
CREATE VIEW public.employee AS
 SELECT employee_id,
 SELECT employee_id,
    company_id,
    company_id,
    employee_code,
    employee_code,
    employee_name,
    employee_name,
    department_id,
    department_id,
    position_id,
    position_id,
    hired_date,
    hired_date,
    is_active
    is_active
   FROM hr.employee;
   FROM hr.employee;




--
--
-- Name: employment_contract; Type: VIEW; Schema: public; Owner: -
-- Name: employment_contract; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.employment_contract AS
CREATE VIEW public.employment_contract AS
 SELECT employment_contract_id,
 SELECT employment_contract_id,
    company_id,
    company_id,
    employee_id,
    employee_id,
    employment_type,
    employment_type,
    start_date,
    start_date,
    end_date,
    end_date,
    base_salary,
    base_salary,
    created_at
    created_at
   FROM hr.employment_contract;
   FROM hr.employment_contract;




--
--
-- Name: hr_department; Type: VIEW; Schema: public; Owner: -
-- Name: hr_department; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.hr_department AS
CREATE VIEW public.hr_department AS
 SELECT department_id,
 SELECT department_id,
    company_id,
    company_id,
    department_code,
    department_code,
    department_name
    department_name
   FROM hr.hr_department;
   FROM hr.hr_department;




--
--
-- Name: hr_position; Type: VIEW; Schema: public; Owner: -
-- Name: hr_position; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.hr_position AS
CREATE VIEW public.hr_position AS
 SELECT position_id,
 SELECT position_id,
    company_id,
    company_id,
    position_code,
    position_code,
    position_name
    position_name
   FROM hr.hr_position;
   FROM hr.hr_position;




--
--
-- Name: inventory_valuation; Type: VIEW; Schema: public; Owner: -
-- Name: inventory_valuation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.inventory_valuation AS
CREATE VIEW public.inventory_valuation AS
 SELECT inventory_valuation_id,
 SELECT inventory_valuation_id,
    company_id,
    company_id,
    item_id,
    item_id,
    valuation_date,
    valuation_date,
    method,
    method,
    unit_cost,
    unit_cost,
    created_at
    created_at
   FROM inventory.inventory_valuation;
   FROM inventory.inventory_valuation;




--
--
-- Name: invoice_pdf; Type: TABLE; Schema: sales; Owner: -
-- Name: invoice_pdf; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.invoice_pdf (
CREATE TABLE sales.invoice_pdf (
    invoice_pdf_id bigint NOT NULL,
    invoice_pdf_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    billing_id bigint NOT NULL,
    billing_id bigint NOT NULL,
    file_path text NOT NULL,
    file_path text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: invoice_pdf; Type: VIEW; Schema: public; Owner: -
-- Name: invoice_pdf; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.invoice_pdf AS
CREATE VIEW public.invoice_pdf AS
 SELECT invoice_pdf_id,
 SELECT invoice_pdf_id,
    company_id,
    company_id,
    billing_id,
    billing_id,
    file_path,
    file_path,
    created_at
    created_at
   FROM sales.invoice_pdf;
   FROM sales.invoice_pdf;




--
--
-- Name: item; Type: TABLE; Schema: sales; Owner: -
-- Name: item; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.item (
CREATE TABLE sales.item (
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    item_code text NOT NULL,
    item_code text NOT NULL,
    item_name text NOT NULL,
    item_name text NOT NULL,
    item_category_id bigint,
    item_category_id bigint,
    uom text DEFAULT 'EA'::text NOT NULL,
    uom text DEFAULT 'EA'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: item; Type: VIEW; Schema: public; Owner: -
-- Name: item; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.item AS
CREATE VIEW public.item AS
 SELECT item_id,
 SELECT item_id,
    company_id,
    company_id,
    item_code,
    item_code,
    item_name,
    item_name,
    item_category_id,
    item_category_id,
    uom,
    uom,
    is_active,
    is_active,
    created_at
    created_at
   FROM sales.item;
   FROM sales.item;




--
--
-- Name: item_category; Type: TABLE; Schema: sales; Owner: -
-- Name: item_category; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.item_category (
CREATE TABLE sales.item_category (
    item_category_id bigint NOT NULL,
    item_category_id bigint NOT NULL,
    company_id uuid,
    company_id uuid,
    category_code text NOT NULL,
    category_code text NOT NULL,
    category_name text NOT NULL,
    category_name text NOT NULL,
    parent_category_id bigint,
    parent_category_id bigint,
    category_level integer DEFAULT 1 NOT NULL
    category_level integer DEFAULT 1 NOT NULL
);
);






--
--
-- Name: item_category; Type: VIEW; Schema: public; Owner: -
-- Name: item_category; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.item_category AS
CREATE VIEW public.item_category AS
 SELECT item_category_id,
 SELECT item_category_id,
    company_id,
    company_id,
    category_code,
    category_code,
    category_name,
    category_name,
    parent_category_id,
    parent_category_id,
    category_level
    category_level
   FROM sales.item_category;
   FROM sales.item_category;




--
--
-- Name: item_price_master; Type: TABLE; Schema: sales; Owner: -
-- Name: item_price_master; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.item_price_master (
CREATE TABLE sales.item_price_master (
    item_price_id bigint NOT NULL,
    item_price_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    price_type text DEFAULT 'STD'::text NOT NULL,
    price_type text DEFAULT 'STD'::text NOT NULL,
    price numeric(18,2) NOT NULL,
    price numeric(18,2) NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_to date,
    valid_to date,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: item_price_master; Type: VIEW; Schema: public; Owner: -
-- Name: item_price_master; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.item_price_master AS
CREATE VIEW public.item_price_master AS
 SELECT item_price_id,
 SELECT item_price_id,
    company_id,
    company_id,
    item_id,
    item_id,
    price_type,
    price_type,
    price,
    price,
    currency_code,
    currency_code,
    valid_from,
    valid_from,
    valid_to,
    valid_to,
    is_active,
    is_active,
    created_at
    created_at
   FROM sales.item_price_master;
   FROM sales.item_price_master;




--
--
-- Name: journal_entries; Type: VIEW; Schema: public; Owner: -
-- Name: journal_entries; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.journal_entries AS
CREATE VIEW public.journal_entries AS
 SELECT journal_id,
 SELECT journal_id,
    company_id,
    company_id,
    period_id,
    period_id,
    journal_date,
    journal_date,
    description,
    description,
    source_type,
    source_type,
    source_id,
    source_id,
    created_by,
    created_by,
    created_at
    created_at
   FROM core.journal_entries;
   FROM core.journal_entries;




--
--
-- Name: journal_lines; Type: VIEW; Schema: public; Owner: -
-- Name: journal_lines; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.journal_lines AS
CREATE VIEW public.journal_lines AS
 SELECT journal_line_id,
 SELECT journal_line_id,
    journal_id,
    journal_id,
    line_no,
    line_no,
    account_id,
    account_id,
    debit_amount,
    debit_amount,
    credit_amount,
    credit_amount,
    memo
    memo
   FROM core.journal_lines;
   FROM core.journal_lines;




--
--
-- Name: leave_request; Type: VIEW; Schema: public; Owner: -
-- Name: leave_request; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.leave_request AS
CREATE VIEW public.leave_request AS
 SELECT leave_request_id,
 SELECT leave_request_id,
    company_id,
    company_id,
    employee_id,
    employee_id,
    leave_type_code,
    leave_type_code,
    start_date,
    start_date,
    end_date,
    end_date,
    status_code,
    status_code,
    approved_by,
    approved_by,
    created_at
    created_at
   FROM hr.leave_request;
   FROM hr.leave_request;




--
--
-- Name: leave_type; Type: VIEW; Schema: public; Owner: -
-- Name: leave_type; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.leave_type AS
CREATE VIEW public.leave_type AS
 SELECT leave_type_code,
 SELECT leave_type_code,
    leave_type_name
    leave_type_name
   FROM hr.leave_type;
   FROM hr.leave_type;




--
--
-- Name: license_master; Type: VIEW; Schema: public; Owner: -
-- Name: license_master; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.license_master AS
CREATE VIEW public.license_master AS
 SELECT code,
 SELECT code,
    name,
    name,
    description,
    description,
    is_active
    is_active
   FROM core.license_master;
   FROM core.license_master;




--
--
-- Name: login_history; Type: VIEW; Schema: public; Owner: -
-- Name: login_history; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.login_history AS
CREATE VIEW public.login_history AS
 SELECT login_id,
 SELECT login_id,
    user_id,
    user_id,
    logged_in_at,
    logged_in_at,
    ip_addr,
    ip_addr,
    user_agent
    user_agent
   FROM core.login_history;
   FROM core.login_history;




--
--
-- Name: manufacturing_cost_snapshot; Type: VIEW; Schema: public; Owner: -
-- Name: manufacturing_cost_snapshot; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.manufacturing_cost_snapshot AS
CREATE VIEW public.manufacturing_cost_snapshot AS
 SELECT manufacturing_cost_snapshot_id,
 SELECT manufacturing_cost_snapshot_id,
    company_id,
    company_id,
    work_order_id,
    work_order_id,
    total_cost,
    total_cost,
    snapshot_at
    snapshot_at
   FROM manufacturing.manufacturing_cost_snapshot;
   FROM manufacturing.manufacturing_cost_snapshot;




--
--
-- Name: manufacturing_execution; Type: VIEW; Schema: public; Owner: -
-- Name: manufacturing_execution; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.manufacturing_execution AS
CREATE VIEW public.manufacturing_execution AS
 SELECT execution_id,
 SELECT execution_id,
    company_id,
    company_id,
    work_order_id,
    work_order_id,
    warehouse_id,
    warehouse_id,
    executed_at,
    executed_at,
    status_code
    status_code
   FROM manufacturing.manufacturing_execution;
   FROM manufacturing.manufacturing_execution;




--
--
-- Name: manufacturing_execution_detail; Type: VIEW; Schema: public; Owner: -
-- Name: manufacturing_execution_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.manufacturing_execution_detail AS
CREATE VIEW public.manufacturing_execution_detail AS
 SELECT execution_detail_id,
 SELECT execution_detail_id,
    execution_id,
    execution_id,
    item_id,
    item_id,
    qty,
    qty,
    movement_type
    movement_type
   FROM manufacturing.manufacturing_execution_detail;
   FROM manufacturing.manufacturing_execution_detail;




--
--
-- Name: mps_plan; Type: VIEW; Schema: public; Owner: -
-- Name: mps_plan; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.mps_plan AS
CREATE VIEW public.mps_plan AS
 SELECT mps_plan_id,
 SELECT mps_plan_id,
    mps_run_id,
    mps_run_id,
    item_id,
    item_id,
    plan_date,
    plan_date,
    plan_qty
    plan_qty
   FROM manufacturing.mps_plan;
   FROM manufacturing.mps_plan;




--
--
-- Name: mps_run; Type: VIEW; Schema: public; Owner: -
-- Name: mps_run; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.mps_run AS
CREATE VIEW public.mps_run AS
 SELECT mps_run_id,
 SELECT mps_run_id,
    company_id,
    company_id,
    run_type,
    run_type,
    run_at
    run_at
   FROM manufacturing.mps_run;
   FROM manufacturing.mps_run;




--
--
-- Name: mrp_allocation; Type: VIEW; Schema: public; Owner: -
-- Name: mrp_allocation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.mrp_allocation AS
CREATE VIEW public.mrp_allocation AS
 SELECT mrp_allocation_id,
 SELECT mrp_allocation_id,
    mrp_requirement_id,
    mrp_requirement_id,
    source_type,
    source_type,
    source_id,
    source_id,
    qty_allocated
    qty_allocated
   FROM manufacturing.mrp_allocation;
   FROM manufacturing.mrp_allocation;




--
--
-- Name: mrp_requirement; Type: VIEW; Schema: public; Owner: -
-- Name: mrp_requirement; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.mrp_requirement AS
CREATE VIEW public.mrp_requirement AS
 SELECT mrp_requirement_id,
 SELECT mrp_requirement_id,
    mrp_run_id,
    mrp_run_id,
    item_id,
    item_id,
    requirement_date,
    requirement_date,
    qty_required,
    qty_required,
    supply_type
    supply_type
   FROM manufacturing.mrp_requirement;
   FROM manufacturing.mrp_requirement;




--
--
-- Name: mrp_run; Type: VIEW; Schema: public; Owner: -
-- Name: mrp_run; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.mrp_run AS
CREATE VIEW public.mrp_run AS
 SELECT mrp_run_id,
 SELECT mrp_run_id,
    company_id,
    company_id,
    run_type,
    run_type,
    run_at
    run_at
   FROM manufacturing.mrp_run;
   FROM manufacturing.mrp_run;




--
--
-- Name: order_detail; Type: VIEW; Schema: public; Owner: -
-- Name: order_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.order_detail AS
CREATE VIEW public.order_detail AS
 SELECT order_detail_id,
 SELECT order_detail_id,
    order_id,
    order_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    requested_ship_date
    requested_ship_date
   FROM sales.order_detail;
   FROM sales.order_detail;




--
--
-- Name: order_header; Type: VIEW; Schema: public; Owner: -
-- Name: order_header; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.order_header AS
CREATE VIEW public.order_header AS
 SELECT order_id,
 SELECT order_id,
    company_id,
    company_id,
    order_no,
    order_no,
    customer_id,
    customer_id,
    order_date,
    order_date,
    status_code,
    status_code,
    remarks,
    remarks,
    created_by,
    created_by,
    created_at
    created_at
   FROM sales.order_header;
   FROM sales.order_header;




--
--
-- Name: payment; Type: VIEW; Schema: public; Owner: -
-- Name: payment; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.payment AS
CREATE VIEW public.payment AS
 SELECT payment_id,
 SELECT payment_id,
    company_id,
    company_id,
    payment_type,
    payment_type,
    partner_type,
    partner_type,
    partner_id,
    partner_id,
    payment_date,
    payment_date,
    amount,
    amount,
    bank_account_id,
    bank_account_id,
    status_code,
    status_code,
    created_at
    created_at
   FROM finance.payment;
   FROM finance.payment;




--
--
-- Name: payroll_run; Type: VIEW; Schema: public; Owner: -
-- Name: payroll_run; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.payroll_run AS
CREATE VIEW public.payroll_run AS
 SELECT payroll_run_id,
 SELECT payroll_run_id,
    company_id,
    company_id,
    pay_month,
    pay_month,
    status_code,
    status_code,
    created_at
    created_at
   FROM hr.payroll_run;
   FROM hr.payroll_run;




--
--
-- Name: payroll_slip; Type: VIEW; Schema: public; Owner: -
-- Name: payroll_slip; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.payroll_slip AS
CREATE VIEW public.payroll_slip AS
 SELECT payroll_slip_id,
 SELECT payroll_slip_id,
    payroll_run_id,
    payroll_run_id,
    employee_id,
    employee_id,
    gross_pay,
    gross_pay,
    net_pay,
    net_pay,
    created_at
    created_at
   FROM hr.payroll_slip;
   FROM hr.payroll_slip;




--
--
-- Name: permission_groups; Type: VIEW; Schema: public; Owner: -
-- Name: permission_groups; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.permission_groups AS
CREATE VIEW public.permission_groups AS
 SELECT group_id,
 SELECT group_id,
    company_id,
    company_id,
    group_code,
    group_code,
    group_name,
    group_name,
    created_at
    created_at
   FROM core.permission_groups;
   FROM core.permission_groups;




--
--
-- Name: permissions; Type: VIEW; Schema: public; Owner: -
-- Name: permissions; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.permissions AS
CREATE VIEW public.permissions AS
 SELECT permission_id,
 SELECT permission_id,
    company_id,
    company_id,
    code,
    code,
    name,
    name,
    description,
    description,
    is_active,
    is_active,
    created_at
    created_at
   FROM core.permissions;
   FROM core.permissions;




--
--
-- Name: process_master; Type: VIEW; Schema: public; Owner: -
-- Name: process_master; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.process_master AS
CREATE VIEW public.process_master AS
 SELECT process_id,
 SELECT process_id,
    company_id,
    company_id,
    process_code,
    process_code,
    process_name
    process_name
   FROM manufacturing.process_master;
   FROM manufacturing.process_master;




--
--
-- Name: purchase_invoice; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_invoice; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_invoice (
CREATE TABLE purchase.purchase_invoice (
    purchase_invoice_id bigint NOT NULL,
    purchase_invoice_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    supplier_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    invoice_no text NOT NULL,
    invoice_no text NOT NULL,
    invoice_date date DEFAULT CURRENT_DATE NOT NULL,
    invoice_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'POSTED'::text NOT NULL,
    status_code text DEFAULT 'POSTED'::text NOT NULL,
    total_amount numeric(18,2) DEFAULT 0 NOT NULL,
    total_amount numeric(18,2) DEFAULT 0 NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: purchase_invoice; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_invoice; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_invoice AS
CREATE VIEW public.purchase_invoice AS
 SELECT purchase_invoice_id,
 SELECT purchase_invoice_id,
    company_id,
    company_id,
    supplier_id,
    supplier_id,
    invoice_no,
    invoice_no,
    invoice_date,
    invoice_date,
    status_code,
    status_code,
    total_amount,
    total_amount,
    created_at
    created_at
   FROM purchase.purchase_invoice;
   FROM purchase.purchase_invoice;




--
--
-- Name: purchase_invoice_detail; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_invoice_detail (
CREATE TABLE purchase.purchase_invoice_detail (
    purchase_invoice_detail_id bigint NOT NULL,
    purchase_invoice_detail_id bigint NOT NULL,
    purchase_invoice_id bigint NOT NULL,
    purchase_invoice_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    receipt_detail_id bigint,
    receipt_detail_id bigint,
    purchase_order_detail_id bigint
    purchase_order_detail_id bigint
);
);




--
--
-- Name: purchase_invoice_detail; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_invoice_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_invoice_detail AS
CREATE VIEW public.purchase_invoice_detail AS
 SELECT purchase_invoice_detail_id,
 SELECT purchase_invoice_detail_id,
    purchase_invoice_id,
    purchase_invoice_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    receipt_detail_id,
    receipt_detail_id,
    purchase_order_detail_id
    purchase_order_detail_id
   FROM purchase.purchase_invoice_detail;
   FROM purchase.purchase_invoice_detail;




--
--
-- Name: purchase_order_detail; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_order_detail; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_order_detail (
CREATE TABLE purchase.purchase_order_detail (
    purchase_order_detail_id bigint NOT NULL,
    purchase_order_detail_id bigint NOT NULL,
    purchase_order_id bigint NOT NULL,
    purchase_order_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    promised_date date
    promised_date date
);
);




--
--
-- Name: purchase_order_detail; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_order_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_order_detail AS
CREATE VIEW public.purchase_order_detail AS
 SELECT purchase_order_detail_id,
 SELECT purchase_order_detail_id,
    purchase_order_id,
    purchase_order_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    promised_date
    promised_date
   FROM purchase.purchase_order_detail;
   FROM purchase.purchase_order_detail;




--
--
-- Name: purchase_order_header; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_order_header; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_order_header (
CREATE TABLE purchase.purchase_order_header (
    purchase_order_id bigint NOT NULL,
    purchase_order_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    purchase_order_no text NOT NULL,
    purchase_order_no text NOT NULL,
    supplier_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    order_date date DEFAULT CURRENT_DATE NOT NULL,
    order_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'OPEN'::text NOT NULL,
    status_code text DEFAULT 'OPEN'::text NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: purchase_order_header; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_order_header; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_order_header AS
CREATE VIEW public.purchase_order_header AS
 SELECT purchase_order_id,
 SELECT purchase_order_id,
    company_id,
    company_id,
    purchase_order_no,
    purchase_order_no,
    supplier_id,
    supplier_id,
    order_date,
    order_date,
    status_code,
    status_code,
    created_by,
    created_by,
    created_at
    created_at
   FROM purchase.purchase_order_header;
   FROM purchase.purchase_order_header;




--
--
-- Name: purchase_quotation; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_quotation; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_quotation (
CREATE TABLE purchase.purchase_quotation (
    purchase_quotation_id bigint NOT NULL,
    purchase_quotation_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    supplier_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    quotation_no text NOT NULL,
    quotation_no text NOT NULL,
    quotation_date date DEFAULT CURRENT_DATE NOT NULL,
    quotation_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'RECEIVED'::text NOT NULL,
    status_code text DEFAULT 'RECEIVED'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: purchase_quotation; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_quotation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_quotation AS
CREATE VIEW public.purchase_quotation AS
 SELECT purchase_quotation_id,
 SELECT purchase_quotation_id,
    company_id,
    company_id,
    supplier_id,
    supplier_id,
    quotation_no,
    quotation_no,
    quotation_date,
    quotation_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM purchase.purchase_quotation;
   FROM purchase.purchase_quotation;




--
--
-- Name: purchase_quotation_detail; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_quotation_detail (
CREATE TABLE purchase.purchase_quotation_detail (
    purchase_quotation_detail_id bigint NOT NULL,
    purchase_quotation_detail_id bigint NOT NULL,
    purchase_quotation_id bigint NOT NULL,
    purchase_quotation_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL
    amount numeric(18,2) NOT NULL
);
);




--
--
-- Name: purchase_quotation_detail; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_quotation_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_quotation_detail AS
CREATE VIEW public.purchase_quotation_detail AS
 SELECT purchase_quotation_detail_id,
 SELECT purchase_quotation_detail_id,
    purchase_quotation_id,
    purchase_quotation_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount
    amount
   FROM purchase.purchase_quotation_detail;
   FROM purchase.purchase_quotation_detail;




--
--
-- Name: purchase_receipt; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_receipt; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_receipt (
CREATE TABLE purchase.purchase_receipt (
    receipt_id bigint NOT NULL,
    receipt_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    purchase_order_id bigint NOT NULL,
    purchase_order_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    warehouse_id bigint NOT NULL,
    receipt_date date DEFAULT CURRENT_DATE NOT NULL,
    receipt_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'RECEIVED'::text NOT NULL,
    status_code text DEFAULT 'RECEIVED'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: purchase_receipt; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_receipt; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_receipt AS
CREATE VIEW public.purchase_receipt AS
 SELECT receipt_id,
 SELECT receipt_id,
    company_id,
    company_id,
    purchase_order_id,
    purchase_order_id,
    warehouse_id,
    warehouse_id,
    receipt_date,
    receipt_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM purchase.purchase_receipt;
   FROM purchase.purchase_receipt;




--
--
-- Name: purchase_receipt_detail; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_receipt_detail (
CREATE TABLE purchase.purchase_receipt_detail (
    receipt_detail_id bigint NOT NULL,
    receipt_detail_id bigint NOT NULL,
    receipt_id bigint NOT NULL,
    receipt_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty_received numeric(18,3) NOT NULL,
    qty_received numeric(18,3) NOT NULL,
    purchase_order_detail_id bigint
    purchase_order_detail_id bigint
);
);




--
--
-- Name: purchase_receipt_detail; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_receipt_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_receipt_detail AS
CREATE VIEW public.purchase_receipt_detail AS
 SELECT receipt_detail_id,
 SELECT receipt_detail_id,
    receipt_id,
    receipt_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty_received,
    qty_received,
    purchase_order_detail_id
    purchase_order_detail_id
   FROM purchase.purchase_receipt_detail;
   FROM purchase.purchase_receipt_detail;




--
--
-- Name: purchase_requisition; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_requisition; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_requisition (
CREATE TABLE purchase.purchase_requisition (
    purchase_requisition_id bigint NOT NULL,
    purchase_requisition_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    requisition_no text NOT NULL,
    requisition_no text NOT NULL,
    requester_id uuid NOT NULL,
    requester_id uuid NOT NULL,
    requisition_date date DEFAULT CURRENT_DATE NOT NULL,
    requisition_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'DRAFT'::text NOT NULL,
    status_code text DEFAULT 'DRAFT'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: purchase_requisition; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_requisition; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_requisition AS
CREATE VIEW public.purchase_requisition AS
 SELECT purchase_requisition_id,
 SELECT purchase_requisition_id,
    company_id,
    company_id,
    requisition_no,
    requisition_no,
    requester_id,
    requester_id,
    requisition_date,
    requisition_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM purchase.purchase_requisition;
   FROM purchase.purchase_requisition;




--
--
-- Name: purchase_requisition_detail; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_requisition_detail (
CREATE TABLE purchase.purchase_requisition_detail (
    purchase_requisition_detail_id bigint NOT NULL,
    purchase_requisition_detail_id bigint NOT NULL,
    purchase_requisition_id bigint NOT NULL,
    purchase_requisition_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    required_date date
    required_date date
);
);




--
--
-- Name: purchase_requisition_detail; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_requisition_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_requisition_detail AS
CREATE VIEW public.purchase_requisition_detail AS
 SELECT purchase_requisition_detail_id,
 SELECT purchase_requisition_detail_id,
    purchase_requisition_id,
    purchase_requisition_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    required_date
    required_date
   FROM purchase.purchase_requisition_detail;
   FROM purchase.purchase_requisition_detail;




--
--
-- Name: purchase_three_way_match; Type: TABLE; Schema: purchase; Owner: -
-- Name: purchase_three_way_match; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.purchase_three_way_match (
CREATE TABLE purchase.purchase_three_way_match (
    purchase_three_way_match_id bigint NOT NULL,
    purchase_three_way_match_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    purchase_order_detail_id bigint NOT NULL,
    purchase_order_detail_id bigint NOT NULL,
    receipt_detail_id bigint NOT NULL,
    receipt_detail_id bigint NOT NULL,
    purchase_invoice_detail_id bigint NOT NULL,
    purchase_invoice_detail_id bigint NOT NULL,
    matched_at timestamp with time zone DEFAULT now() NOT NULL,
    matched_at timestamp with time zone DEFAULT now() NOT NULL,
    status_code text DEFAULT 'MATCHED'::text NOT NULL
    status_code text DEFAULT 'MATCHED'::text NOT NULL
);
);






--
--
-- Name: purchase_three_way_match; Type: VIEW; Schema: public; Owner: -
-- Name: purchase_three_way_match; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.purchase_three_way_match AS
CREATE VIEW public.purchase_three_way_match AS
 SELECT purchase_three_way_match_id,
 SELECT purchase_three_way_match_id,
    company_id,
    company_id,
    purchase_order_detail_id,
    purchase_order_detail_id,
    receipt_detail_id,
    receipt_detail_id,
    purchase_invoice_detail_id,
    purchase_invoice_detail_id,
    matched_at,
    matched_at,
    status_code
    status_code
   FROM purchase.purchase_three_way_match;
   FROM purchase.purchase_three_way_match;




--
--
-- Name: return_detail; Type: TABLE; Schema: sales; Owner: -
-- Name: return_detail; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.return_detail (
CREATE TABLE sales.return_detail (
    return_detail_id bigint NOT NULL,
    return_detail_id bigint NOT NULL,
    return_id bigint NOT NULL,
    return_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    reason_code text
    reason_code text
);
);




--
--
-- Name: return_detail; Type: VIEW; Schema: public; Owner: -
-- Name: return_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.return_detail AS
CREATE VIEW public.return_detail AS
 SELECT return_detail_id,
 SELECT return_detail_id,
    return_id,
    return_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    reason_code
    reason_code
   FROM sales.return_detail;
   FROM sales.return_detail;




--
--
-- Name: return_header; Type: TABLE; Schema: sales; Owner: -
-- Name: return_header; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.return_header (
CREATE TABLE sales.return_header (
    return_id bigint NOT NULL,
    return_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    return_no text NOT NULL,
    return_no text NOT NULL,
    billing_id bigint,
    billing_id bigint,
    return_date date DEFAULT CURRENT_DATE NOT NULL,
    return_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'REQUESTED'::text NOT NULL,
    status_code text DEFAULT 'REQUESTED'::text NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: return_header; Type: VIEW; Schema: public; Owner: -
-- Name: return_header; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.return_header AS
CREATE VIEW public.return_header AS
 SELECT return_id,
 SELECT return_id,
    company_id,
    company_id,
    return_no,
    return_no,
    billing_id,
    billing_id,
    return_date,
    return_date,
    status_code,
    status_code,
    created_by,
    created_by,
    created_at
    created_at
   FROM sales.return_header;
   FROM sales.return_header;




--
--
-- Name: routing_header; Type: VIEW; Schema: public; Owner: -
-- Name: routing_header; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.routing_header AS
CREATE VIEW public.routing_header AS
 SELECT routing_id,
 SELECT routing_id,
    company_id,
    company_id,
    item_id,
    item_id,
    version,
    version,
    is_active,
    is_active,
    created_at
    created_at
   FROM manufacturing.routing_header;
   FROM manufacturing.routing_header;




--
--
-- Name: routing_operation; Type: VIEW; Schema: public; Owner: -
-- Name: routing_operation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.routing_operation AS
CREATE VIEW public.routing_operation AS
 SELECT routing_operation_id,
 SELECT routing_operation_id,
    routing_id,
    routing_id,
    operation_no,
    operation_no,
    process_id,
    process_id,
    std_time_minutes
    std_time_minutes
   FROM manufacturing.routing_operation;
   FROM manufacturing.routing_operation;




--
--
-- Name: sales_quotation; Type: TABLE; Schema: sales; Owner: -
-- Name: sales_quotation; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.sales_quotation (
CREATE TABLE sales.sales_quotation (
    sales_quotation_id bigint NOT NULL,
    sales_quotation_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    quotation_no text NOT NULL,
    quotation_no text NOT NULL,
    customer_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    quotation_date date DEFAULT CURRENT_DATE NOT NULL,
    quotation_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'DRAFT'::text NOT NULL,
    status_code text DEFAULT 'DRAFT'::text NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: sales_quotation; Type: VIEW; Schema: public; Owner: -
-- Name: sales_quotation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.sales_quotation AS
CREATE VIEW public.sales_quotation AS
 SELECT sales_quotation_id,
 SELECT sales_quotation_id,
    company_id,
    company_id,
    quotation_no,
    quotation_no,
    customer_id,
    customer_id,
    quotation_date,
    quotation_date,
    status_code,
    status_code,
    created_by,
    created_by,
    created_at
    created_at
   FROM sales.sales_quotation;
   FROM sales.sales_quotation;




--
--
-- Name: sales_quotation_detail; Type: TABLE; Schema: sales; Owner: -
-- Name: sales_quotation_detail; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.sales_quotation_detail (
CREATE TABLE sales.sales_quotation_detail (
    sales_quotation_detail_id bigint NOT NULL,
    sales_quotation_detail_id bigint NOT NULL,
    sales_quotation_id bigint NOT NULL,
    sales_quotation_id bigint NOT NULL,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL,
    qty numeric(18,3) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    unit_price numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    amount numeric(18,2) NOT NULL,
    tax_category_code text
    tax_category_code text
);
);




--
--
-- Name: sales_quotation_detail; Type: VIEW; Schema: public; Owner: -
-- Name: sales_quotation_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.sales_quotation_detail AS
CREATE VIEW public.sales_quotation_detail AS
 SELECT sales_quotation_detail_id,
 SELECT sales_quotation_detail_id,
    sales_quotation_id,
    sales_quotation_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    tax_category_code
    tax_category_code
   FROM sales.sales_quotation_detail;
   FROM sales.sales_quotation_detail;




--
--
-- Name: shipping_detail; Type: TABLE; Schema: sales; Owner: -
-- Name: shipping_detail; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.shipping_detail (
CREATE TABLE sales.shipping_detail (
    shipping_detail_id bigint NOT NULL,
    shipping_detail_id bigint NOT NULL,
    shipping_id bigint NOT NULL,
    shipping_id bigint NOT NULL,
    order_detail_id bigint,
    order_detail_id bigint,
    line_no integer NOT NULL,
    line_no integer NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    qty numeric(18,3) NOT NULL
    qty numeric(18,3) NOT NULL
);
);




--
--
-- Name: shipping_detail; Type: VIEW; Schema: public; Owner: -
-- Name: shipping_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.shipping_detail AS
CREATE VIEW public.shipping_detail AS
 SELECT shipping_detail_id,
 SELECT shipping_detail_id,
    shipping_id,
    shipping_id,
    order_detail_id,
    order_detail_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty
    qty
   FROM sales.shipping_detail;
   FROM sales.shipping_detail;




--
--
-- Name: shipping_header; Type: TABLE; Schema: sales; Owner: -
-- Name: shipping_header; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.shipping_header (
CREATE TABLE sales.shipping_header (
    shipping_id bigint NOT NULL,
    shipping_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    shipping_no text NOT NULL,
    shipping_no text NOT NULL,
    order_id bigint NOT NULL,
    order_id bigint NOT NULL,
    shipping_date date DEFAULT CURRENT_DATE NOT NULL,
    shipping_date date DEFAULT CURRENT_DATE NOT NULL,
    status_code text DEFAULT 'PICKING'::text NOT NULL,
    status_code text DEFAULT 'PICKING'::text NOT NULL,
    shipping_fee numeric(18,2) DEFAULT 0 NOT NULL,
    shipping_fee numeric(18,2) DEFAULT 0 NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: shipping_header; Type: VIEW; Schema: public; Owner: -
-- Name: shipping_header; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.shipping_header AS
CREATE VIEW public.shipping_header AS
 SELECT shipping_id,
 SELECT shipping_id,
    company_id,
    company_id,
    shipping_no,
    shipping_no,
    order_id,
    order_id,
    shipping_date,
    shipping_date,
    status_code,
    status_code,
    shipping_fee,
    shipping_fee,
    created_by,
    created_by,
    created_at
    created_at
   FROM sales.shipping_header;
   FROM sales.shipping_header;




--
--
-- Name: status_history; Type: VIEW; Schema: public; Owner: -
-- Name: status_history; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.status_history AS
CREATE VIEW public.status_history AS
 SELECT status_history_id,
 SELECT status_history_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    from_status_code,
    from_status_code,
    to_status_code,
    to_status_code,
    changed_by,
    changed_by,
    changed_at,
    changed_at,
    reason
    reason
   FROM core.status_history;
   FROM core.status_history;




--
--
-- Name: status_master; Type: VIEW; Schema: public; Owner: -
-- Name: status_master; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.status_master AS
CREATE VIEW public.status_master AS
 SELECT status_id,
 SELECT status_id,
    entity_type,
    entity_type,
    status_code,
    status_code,
    status_name,
    status_name,
    sort_order,
    sort_order,
    is_terminal
    is_terminal
   FROM core.status_master;
   FROM core.status_master;




--
--
-- Name: stock_balance; Type: VIEW; Schema: public; Owner: -
-- Name: stock_balance; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.stock_balance AS
CREATE VIEW public.stock_balance AS
 SELECT stock_balance_id,
 SELECT stock_balance_id,
    company_id,
    company_id,
    warehouse_id,
    warehouse_id,
    location_id,
    location_id,
    bin_id,
    bin_id,
    item_id,
    item_id,
    qty_on_hand,
    qty_on_hand,
    qty_reserved,
    qty_reserved,
    updated_at
    updated_at
   FROM inventory.stock_balance;
   FROM inventory.stock_balance;




--
--
-- Name: stock_bin; Type: VIEW; Schema: public; Owner: -
-- Name: stock_bin; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.stock_bin AS
CREATE VIEW public.stock_bin AS
 SELECT bin_id,
 SELECT bin_id,
    company_id,
    company_id,
    location_id,
    location_id,
    bin_code,
    bin_code,
    is_active
    is_active
   FROM inventory.stock_bin;
   FROM inventory.stock_bin;




--
--
-- Name: stock_lot; Type: VIEW; Schema: public; Owner: -
-- Name: stock_lot; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.stock_lot AS
CREATE VIEW public.stock_lot AS
 SELECT stock_lot_id,
 SELECT stock_lot_id,
    company_id,
    company_id,
    item_id,
    item_id,
    lot_no,
    lot_no,
    serial_no,
    serial_no,
    expiry_date
    expiry_date
   FROM inventory.stock_lot;
   FROM inventory.stock_lot;




--
--
-- Name: stock_lot_balance; Type: VIEW; Schema: public; Owner: -
-- Name: stock_lot_balance; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.stock_lot_balance AS
CREATE VIEW public.stock_lot_balance AS
 SELECT stock_lot_balance_id,
 SELECT stock_lot_balance_id,
    company_id,
    company_id,
    warehouse_id,
    warehouse_id,
    location_id,
    location_id,
    bin_id,
    bin_id,
    item_id,
    item_id,
    stock_lot_id,
    stock_lot_id,
    qty_on_hand,
    qty_on_hand,
    qty_reserved,
    qty_reserved,
    updated_at
    updated_at
   FROM inventory.stock_lot_balance;
   FROM inventory.stock_lot_balance;




--
--
-- Name: stock_reservation; Type: VIEW; Schema: public; Owner: -
-- Name: stock_reservation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.stock_reservation AS
CREATE VIEW public.stock_reservation AS
 SELECT stock_reservation_id,
 SELECT stock_reservation_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    item_id,
    item_id,
    stock_lot_id,
    stock_lot_id,
    qty_reserved,
    qty_reserved,
    reserved_at
    reserved_at
   FROM inventory.stock_reservation;
   FROM inventory.stock_reservation;




--
--
-- Name: stock_transaction; Type: VIEW; Schema: public; Owner: -
-- Name: stock_transaction; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.stock_transaction AS
CREATE VIEW public.stock_transaction AS
 SELECT stock_tx_id,
 SELECT stock_tx_id,
    company_id,
    company_id,
    tx_type,
    tx_type,
    warehouse_id,
    warehouse_id,
    item_id,
    item_id,
    stock_lot_id,
    stock_lot_id,
    from_bin_id,
    from_bin_id,
    to_bin_id,
    to_bin_id,
    qty,
    qty,
    reference_type,
    reference_type,
    reference_id,
    reference_id,
    occurred_at
    occurred_at
   FROM inventory.stock_transaction;
   FROM inventory.stock_transaction;




--
--
-- Name: stocktaking_plan; Type: VIEW; Schema: public; Owner: -
-- Name: stocktaking_plan; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.stocktaking_plan AS
CREATE VIEW public.stocktaking_plan AS
 SELECT stocktaking_plan_id,
 SELECT stocktaking_plan_id,
    company_id,
    company_id,
    warehouse_id,
    warehouse_id,
    plan_date,
    plan_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM inventory.stocktaking_plan;
   FROM inventory.stocktaking_plan;




--
--
-- Name: stocktaking_result; Type: VIEW; Schema: public; Owner: -
-- Name: stocktaking_result; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.stocktaking_result AS
CREATE VIEW public.stocktaking_result AS
 SELECT stocktaking_result_id,
 SELECT stocktaking_result_id,
    stocktaking_plan_id,
    stocktaking_plan_id,
    company_id,
    company_id,
    bin_id,
    bin_id,
    item_id,
    item_id,
    counted_qty,
    counted_qty,
    system_qty,
    system_qty,
    difference_qty,
    difference_qty,
    created_at
    created_at
   FROM inventory.stocktaking_result;
   FROM inventory.stocktaking_result;




--
--
-- Name: storage_location; Type: VIEW; Schema: public; Owner: -
-- Name: storage_location; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.storage_location AS
CREATE VIEW public.storage_location AS
 SELECT location_id,
 SELECT location_id,
    company_id,
    company_id,
    warehouse_id,
    warehouse_id,
    location_code,
    location_code,
    location_name,
    location_name,
    is_active
    is_active
   FROM inventory.storage_location;
   FROM inventory.storage_location;




--
--
-- Name: supplier_item_price; Type: TABLE; Schema: purchase; Owner: -
-- Name: supplier_item_price; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.supplier_item_price (
CREATE TABLE purchase.supplier_item_price (
    supplier_item_price_id bigint NOT NULL,
    supplier_item_price_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    supplier_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    price numeric(18,2) NOT NULL,
    price numeric(18,2) NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    currency_code text DEFAULT 'JPY'::text NOT NULL,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_to date,
    valid_to date,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);






--
--
-- Name: supplier_item_price; Type: VIEW; Schema: public; Owner: -
-- Name: supplier_item_price; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.supplier_item_price AS
CREATE VIEW public.supplier_item_price AS
 SELECT supplier_item_price_id,
 SELECT supplier_item_price_id,
    company_id,
    company_id,
    supplier_id,
    supplier_id,
    item_id,
    item_id,
    price,
    price,
    currency_code,
    currency_code,
    valid_from,
    valid_from,
    valid_to,
    valid_to,
    is_active
    is_active
   FROM purchase.supplier_item_price;
   FROM purchase.supplier_item_price;




--
--
-- Name: supplier_master; Type: TABLE; Schema: purchase; Owner: -
-- Name: supplier_master; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.supplier_master (
CREATE TABLE purchase.supplier_master (
    supplier_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    supplier_code text NOT NULL,
    supplier_code text NOT NULL,
    supplier_name text NOT NULL,
    supplier_name text NOT NULL,
    tax_handling text DEFAULT 'EXCLUSIVE'::text NOT NULL,
    tax_handling text DEFAULT 'EXCLUSIVE'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);






--
--
-- Name: supplier_master; Type: VIEW; Schema: public; Owner: -
-- Name: supplier_master; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.supplier_master AS
CREATE VIEW public.supplier_master AS
 SELECT supplier_id,
 SELECT supplier_id,
    company_id,
    company_id,
    supplier_code,
    supplier_code,
    supplier_name,
    supplier_name,
    tax_handling,
    tax_handling,
    is_active,
    is_active,
    created_at
    created_at
   FROM purchase.supplier_master;
   FROM purchase.supplier_master;




--
--
-- Name: sync_queue; Type: VIEW; Schema: public; Owner: -
-- Name: sync_queue; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.sync_queue AS
CREATE VIEW public.sync_queue AS
 SELECT sync_id,
 SELECT sync_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    payload,
    payload,
    status,
    status,
    retry_count,
    retry_count,
    last_error,
    last_error,
    created_at,
    created_at,
    updated_at
    updated_at
   FROM core.sync_queue;
   FROM core.sync_queue;




--
--
-- Name: user_permissions; Type: VIEW; Schema: public; Owner: -
-- Name: user_permissions; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.user_permissions AS
CREATE VIEW public.user_permissions AS
 SELECT user_id,
 SELECT user_id,
    permission_id,
    permission_id,
    granted_at
    granted_at
   FROM core.user_permissions;
   FROM core.user_permissions;




--
--
-- Name: v_approval_log; Type: VIEW; Schema: public; Owner: -
-- Name: v_approval_log; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_approval_log AS
CREATE VIEW public.v_approval_log AS
 SELECT approval_log_id,
 SELECT approval_log_id,
    approval_request_id,
    approval_request_id,
    action,
    action,
    actor,
    actor,
    note,
    note,
    acted_at
    acted_at
   FROM audit.approval_log;
   FROM audit.approval_log;




--
--
-- Name: v_approval_request; Type: VIEW; Schema: public; Owner: -
-- Name: v_approval_request; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_approval_request AS
CREATE VIEW public.v_approval_request AS
 SELECT request_id,
 SELECT request_id,
    company_id,
    company_id,
    domain,
    domain,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    order_id,
    order_id,
    reason,
    reason,
    detected_at,
    detected_at,
    status,
    status,
    decided_at,
    decided_at,
    decided_by,
    decided_by,
    decision_note,
    decision_note,
    policy_id,
    policy_id,
    severity
    severity
   FROM audit.approval_request;
   FROM audit.approval_request;




--
--
-- Name: v_audit_kpi_summary; Type: VIEW; Schema: public; Owner: -
-- Name: v_audit_kpi_summary; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_audit_kpi_summary AS
CREATE VIEW public.v_audit_kpi_summary AS
 SELECT company_id,
 SELECT company_id,
    business_domain,
    business_domain,
    audit_scope,
    audit_scope,
    severity,
    severity,
    count(*) AS event_count,
    count(*) AS event_count,
    count(*) FILTER (WHERE (auto_fixed = true)) AS auto_fixed_count,
    count(*) FILTER (WHERE (auto_fixed = true)) AS auto_fixed_count,
    count(*) FILTER (WHERE (quarantined = true)) AS quarantined_count,
    count(*) FILTER (WHERE (quarantined = true)) AS quarantined_count,
    max(occurred_at) AS last_occurred_at
    max(occurred_at) AS last_occurred_at
   FROM audit.ng_event
   FROM audit.ng_event
  GROUP BY company_id, business_domain, audit_scope, severity;
  GROUP BY company_id, business_domain, audit_scope, severity;




--
--
-- Name: v_audit_kpi_weekly; Type: VIEW; Schema: public; Owner: -
-- Name: v_audit_kpi_weekly; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_audit_kpi_weekly AS
CREATE VIEW public.v_audit_kpi_weekly AS
 SELECT company_id,
 SELECT company_id,
    business_domain,
    business_domain,
    date_trunc('week'::text, occurred_at) AS week,
    date_trunc('week'::text, occurred_at) AS week,
    severity,
    severity,
    count(*) AS event_count
    count(*) AS event_count
   FROM audit.ng_event
   FROM audit.ng_event
  GROUP BY company_id, business_domain, (date_trunc('week'::text, occurred_at)), severity;
  GROUP BY company_id, business_domain, (date_trunc('week'::text, occurred_at)), severity;




--
--
-- Name: v_core_audit_trail; Type: VIEW; Schema: public; Owner: -
-- Name: v_core_audit_trail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_core_audit_trail AS
CREATE VIEW public.v_core_audit_trail AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail;
   FROM core.audit_trail;




--
--
-- Name: v_core_company; Type: VIEW; Schema: public; Owner: -
-- Name: v_core_company; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_core_company AS
CREATE VIEW public.v_core_company AS
 SELECT company_id,
 SELECT company_id,
    company_code,
    company_code,
    company_name,
    company_name,
    currency_code,
    currency_code,
    timezone,
    timezone,
    is_active,
    is_active,
    created_at,
    created_at,
    updated_at
    updated_at
   FROM core.company;
   FROM core.company;




--
--
-- Name: v_core_company_license; Type: VIEW; Schema: public; Owner: -
-- Name: v_core_company_license; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_core_company_license AS
CREATE VIEW public.v_core_company_license AS
 SELECT company_license_id,
 SELECT company_license_id,
    company_id,
    company_id,
    license_code,
    license_code,
    purchased_at,
    purchased_at,
    expires_at,
    expires_at,
    is_active
    is_active
   FROM core.company_license;
   FROM core.company_license;




--
--
-- Name: v_core_company_permission; Type: VIEW; Schema: public; Owner: -
-- Name: v_core_company_permission; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_core_company_permission AS
CREATE VIEW public.v_core_company_permission AS
 SELECT company_permission_id,
 SELECT company_permission_id,
    company_id,
    company_id,
    permission_code,
    permission_code,
    enabled,
    enabled,
    created_at
    created_at
   FROM core.company_permission;
   FROM core.company_permission;




--
--
-- Name: v_core_journal_source_link; Type: VIEW; Schema: public; Owner: -
-- Name: v_core_journal_source_link; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_core_journal_source_link AS
CREATE VIEW public.v_core_journal_source_link AS
 SELECT journal_source_link_id,
 SELECT journal_source_link_id,
    journal_id,
    journal_id,
    source_type,
    source_type,
    source_id,
    source_id,
    created_at
    created_at
   FROM core.journal_source_link;
   FROM core.journal_source_link;




--
--
-- Name: v_core_payment_term; Type: VIEW; Schema: public; Owner: -
-- Name: v_core_payment_term; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_core_payment_term AS
CREATE VIEW public.v_core_payment_term AS
 SELECT payment_term_id,
 SELECT payment_term_id,
    term_code,
    term_code,
    term_name,
    term_name,
    closing_day,
    closing_day,
    payment_offset_month,
    payment_offset_month,
    payment_day,
    payment_day,
    description,
    description,
    is_active
    is_active
   FROM core.payment_term;
   FROM core.payment_term;




--
--
-- Name: v_core_posting_profile; Type: VIEW; Schema: public; Owner: -
-- Name: v_core_posting_profile; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_core_posting_profile AS
CREATE VIEW public.v_core_posting_profile AS
 SELECT posting_profile_id,
 SELECT posting_profile_id,
    company_id,
    company_id,
    profile_code,
    profile_code,
    source_type,
    source_type,
    debit_account_id,
    debit_account_id,
    credit_account_id,
    credit_account_id,
    description,
    description,
    is_active
    is_active
   FROM core.posting_profile;
   FROM core.posting_profile;




--
--
-- Name: v_core_status_history; Type: VIEW; Schema: public; Owner: -
-- Name: v_core_status_history; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_core_status_history AS
CREATE VIEW public.v_core_status_history AS
 SELECT status_history_id,
 SELECT status_history_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    from_status_code,
    from_status_code,
    to_status_code,
    to_status_code,
    changed_by,
    changed_by,
    changed_at,
    changed_at,
    reason
    reason
   FROM core.status_history;
   FROM core.status_history;




--
--
-- Name: v_finance_bank_account; Type: VIEW; Schema: public; Owner: -
-- Name: v_finance_bank_account; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_finance_bank_account AS
CREATE VIEW public.v_finance_bank_account AS
 SELECT bank_account_id,
 SELECT bank_account_id,
    company_id,
    company_id,
    bank_name,
    bank_name,
    branch_name,
    branch_name,
    account_type,
    account_type,
    account_number,
    account_number,
    account_name,
    account_name,
    currency_code,
    currency_code,
    is_active
    is_active
   FROM finance.bank_account;
   FROM finance.bank_account;




--
--
-- Name: v_finance_bank_statement_line; Type: VIEW; Schema: public; Owner: -
-- Name: v_finance_bank_statement_line; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_finance_bank_statement_line AS
CREATE VIEW public.v_finance_bank_statement_line AS
 SELECT bank_statement_line_id,
 SELECT bank_statement_line_id,
    bank_statement_id,
    bank_statement_id,
    line_no,
    line_no,
    transaction_date,
    transaction_date,
    description,
    description,
    debit_amount,
    debit_amount,
    credit_amount,
    credit_amount,
    balance_amount
    balance_amount
   FROM finance.bank_statement_line;
   FROM finance.bank_statement_line;




--
--
-- Name: v_finance_payment; Type: VIEW; Schema: public; Owner: -
-- Name: v_finance_payment; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_finance_payment AS
CREATE VIEW public.v_finance_payment AS
 SELECT payment_id,
 SELECT payment_id,
    company_id,
    company_id,
    payment_type,
    payment_type,
    partner_type,
    partner_type,
    partner_id,
    partner_id,
    payment_date,
    payment_date,
    amount,
    amount,
    bank_account_id,
    bank_account_id,
    status_code,
    status_code,
    created_at
    created_at
   FROM finance.payment;
   FROM finance.payment;




--
--
-- Name: v_finance_payment_allocation; Type: VIEW; Schema: public; Owner: -
-- Name: v_finance_payment_allocation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_finance_payment_allocation AS
CREATE VIEW public.v_finance_payment_allocation AS
 SELECT payment_allocation_id,
 SELECT payment_allocation_id,
    payment_id,
    payment_id,
    source_type,
    source_type,
    source_id,
    source_id,
    allocated_amount,
    allocated_amount,
    allocated_at
    allocated_at
   FROM finance.payment_allocation;
   FROM finance.payment_allocation;




--
--
-- Name: v_hr_attendance_log; Type: VIEW; Schema: public; Owner: -
-- Name: v_hr_attendance_log; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_hr_attendance_log AS
CREATE VIEW public.v_hr_attendance_log AS
 SELECT attendance_log_id,
 SELECT attendance_log_id,
    company_id,
    company_id,
    employee_id,
    employee_id,
    work_date,
    work_date,
    clock_in,
    clock_in,
    clock_out,
    clock_out,
    work_minutes
    work_minutes
   FROM hr.attendance_log;
   FROM hr.attendance_log;




--
--
-- Name: v_hr_employee; Type: VIEW; Schema: public; Owner: -
-- Name: v_hr_employee; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_hr_employee AS
CREATE VIEW public.v_hr_employee AS
 SELECT employee_id,
 SELECT employee_id,
    company_id,
    company_id,
    employee_code,
    employee_code,
    employee_name,
    employee_name,
    department_id,
    department_id,
    position_id,
    position_id,
    hired_date,
    hired_date,
    is_active
    is_active
   FROM hr.employee;
   FROM hr.employee;




--
--
-- Name: v_hr_employment_contract; Type: VIEW; Schema: public; Owner: -
-- Name: v_hr_employment_contract; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_hr_employment_contract AS
CREATE VIEW public.v_hr_employment_contract AS
 SELECT employment_contract_id,
 SELECT employment_contract_id,
    company_id,
    company_id,
    employee_id,
    employee_id,
    employment_type,
    employment_type,
    start_date,
    start_date,
    end_date,
    end_date,
    base_salary,
    base_salary,
    created_at
    created_at
   FROM hr.employment_contract;
   FROM hr.employment_contract;




--
--
-- Name: v_hr_leave_request; Type: VIEW; Schema: public; Owner: -
-- Name: v_hr_leave_request; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_hr_leave_request AS
CREATE VIEW public.v_hr_leave_request AS
 SELECT leave_request_id,
 SELECT leave_request_id,
    company_id,
    company_id,
    employee_id,
    employee_id,
    leave_type_code,
    leave_type_code,
    start_date,
    start_date,
    end_date,
    end_date,
    status_code,
    status_code,
    approved_by,
    approved_by,
    created_at
    created_at
   FROM hr.leave_request;
   FROM hr.leave_request;




--
--
-- Name: v_hr_payroll_run; Type: VIEW; Schema: public; Owner: -
-- Name: v_hr_payroll_run; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_hr_payroll_run AS
CREATE VIEW public.v_hr_payroll_run AS
 SELECT payroll_run_id,
 SELECT payroll_run_id,
    company_id,
    company_id,
    pay_month,
    pay_month,
    status_code,
    status_code,
    created_at
    created_at
   FROM hr.payroll_run;
   FROM hr.payroll_run;




--
--
-- Name: v_hr_payroll_slip; Type: VIEW; Schema: public; Owner: -
-- Name: v_hr_payroll_slip; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_hr_payroll_slip AS
CREATE VIEW public.v_hr_payroll_slip AS
 SELECT payroll_slip_id,
 SELECT payroll_slip_id,
    payroll_run_id,
    payroll_run_id,
    employee_id,
    employee_id,
    gross_pay,
    gross_pay,
    net_pay,
    net_pay,
    created_at
    created_at
   FROM hr.payroll_slip;
   FROM hr.payroll_slip;




--
--
-- Name: v_inventory_inventory_valuation; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_inventory_valuation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_inventory_valuation AS
CREATE VIEW public.v_inventory_inventory_valuation AS
 SELECT inventory_valuation_id,
 SELECT inventory_valuation_id,
    company_id,
    company_id,
    item_id,
    item_id,
    valuation_date,
    valuation_date,
    method,
    method,
    unit_cost,
    unit_cost,
    created_at
    created_at
   FROM inventory.inventory_valuation;
   FROM inventory.inventory_valuation;




--
--
-- Name: v_inventory_stock_balance; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_stock_balance; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_stock_balance AS
CREATE VIEW public.v_inventory_stock_balance AS
 SELECT stock_balance_id,
 SELECT stock_balance_id,
    company_id,
    company_id,
    warehouse_id,
    warehouse_id,
    location_id,
    location_id,
    bin_id,
    bin_id,
    item_id,
    item_id,
    qty_on_hand,
    qty_on_hand,
    qty_reserved,
    qty_reserved,
    updated_at
    updated_at
   FROM inventory.stock_balance;
   FROM inventory.stock_balance;




--
--
-- Name: v_inventory_stock_lot; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_stock_lot; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_stock_lot AS
CREATE VIEW public.v_inventory_stock_lot AS
 SELECT stock_lot_id,
 SELECT stock_lot_id,
    company_id,
    company_id,
    item_id,
    item_id,
    lot_no,
    lot_no,
    serial_no,
    serial_no,
    expiry_date
    expiry_date
   FROM inventory.stock_lot;
   FROM inventory.stock_lot;




--
--
-- Name: v_inventory_stock_lot_balance; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_stock_lot_balance; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_stock_lot_balance AS
CREATE VIEW public.v_inventory_stock_lot_balance AS
 SELECT stock_lot_balance_id,
 SELECT stock_lot_balance_id,
    company_id,
    company_id,
    warehouse_id,
    warehouse_id,
    location_id,
    location_id,
    bin_id,
    bin_id,
    item_id,
    item_id,
    stock_lot_id,
    stock_lot_id,
    qty_on_hand,
    qty_on_hand,
    qty_reserved,
    qty_reserved,
    updated_at
    updated_at
   FROM inventory.stock_lot_balance;
   FROM inventory.stock_lot_balance;




--
--
-- Name: v_inventory_stock_reservation; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_stock_reservation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_stock_reservation AS
CREATE VIEW public.v_inventory_stock_reservation AS
 SELECT stock_reservation_id,
 SELECT stock_reservation_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    item_id,
    item_id,
    stock_lot_id,
    stock_lot_id,
    qty_reserved,
    qty_reserved,
    reserved_at
    reserved_at
   FROM inventory.stock_reservation;
   FROM inventory.stock_reservation;




--
--
-- Name: v_inventory_stock_transfer_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_stock_transfer_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_stock_transfer_detail AS
CREATE VIEW public.v_inventory_stock_transfer_detail AS
 SELECT stock_transfer_detail_id,
 SELECT stock_transfer_detail_id,
    stock_transfer_id,
    stock_transfer_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    from_location_id,
    from_location_id,
    to_location_id,
    to_location_id,
    from_bin_id,
    from_bin_id,
    to_bin_id,
    to_bin_id,
    stock_lot_id
    stock_lot_id
   FROM inventory.stock_transfer_detail;
   FROM inventory.stock_transfer_detail;




--
--
-- Name: v_inventory_stocktaking_plan; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_stocktaking_plan; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_stocktaking_plan AS
CREATE VIEW public.v_inventory_stocktaking_plan AS
 SELECT stocktaking_plan_id,
 SELECT stocktaking_plan_id,
    company_id,
    company_id,
    warehouse_id,
    warehouse_id,
    plan_date,
    plan_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM inventory.stocktaking_plan;
   FROM inventory.stocktaking_plan;




--
--
-- Name: v_inventory_stocktaking_result; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_stocktaking_result; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_stocktaking_result AS
CREATE VIEW public.v_inventory_stocktaking_result AS
 SELECT stocktaking_result_id,
 SELECT stocktaking_result_id,
    stocktaking_plan_id,
    stocktaking_plan_id,
    company_id,
    company_id,
    bin_id,
    bin_id,
    item_id,
    item_id,
    counted_qty,
    counted_qty,
    system_qty,
    system_qty,
    difference_qty,
    difference_qty,
    created_at
    created_at
   FROM inventory.stocktaking_result;
   FROM inventory.stocktaking_result;




--
--
-- Name: v_inventory_warehouse; Type: VIEW; Schema: public; Owner: -
-- Name: v_inventory_warehouse; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_inventory_warehouse AS
CREATE VIEW public.v_inventory_warehouse AS
 SELECT warehouse_id,
 SELECT warehouse_id,
    company_id,
    company_id,
    warehouse_code,
    warehouse_code,
    warehouse_name,
    warehouse_name,
    is_active,
    is_active,
    created_at
    created_at
   FROM inventory.warehouse;
   FROM inventory.warehouse;




--
--
-- Name: v_manufacturing_bom_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_bom_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_bom_detail AS
CREATE VIEW public.v_manufacturing_bom_detail AS
 SELECT bom_detail_id,
 SELECT bom_detail_id,
    bom_id,
    bom_id,
    component_item_id,
    component_item_id,
    qty_per,
    qty_per,
    issue_method,
    issue_method,
    created_at
    created_at
   FROM manufacturing.bom_detail;
   FROM manufacturing.bom_detail;




--
--
-- Name: v_manufacturing_manufacturing_cost_snapshot; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_manufacturing_cost_snapshot; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_manufacturing_cost_snapshot AS
CREATE VIEW public.v_manufacturing_manufacturing_cost_snapshot AS
 SELECT manufacturing_cost_snapshot_id,
 SELECT manufacturing_cost_snapshot_id,
    company_id,
    company_id,
    work_order_id,
    work_order_id,
    total_cost,
    total_cost,
    snapshot_at
    snapshot_at
   FROM manufacturing.manufacturing_cost_snapshot;
   FROM manufacturing.manufacturing_cost_snapshot;




--
--
-- Name: v_manufacturing_mps_plan; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_mps_plan; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_mps_plan AS
CREATE VIEW public.v_manufacturing_mps_plan AS
 SELECT mps_plan_id,
 SELECT mps_plan_id,
    mps_run_id,
    mps_run_id,
    item_id,
    item_id,
    plan_date,
    plan_date,
    plan_qty
    plan_qty
   FROM manufacturing.mps_plan;
   FROM manufacturing.mps_plan;




--
--
-- Name: v_manufacturing_mps_run; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_mps_run; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_mps_run AS
CREATE VIEW public.v_manufacturing_mps_run AS
 SELECT mps_run_id,
 SELECT mps_run_id,
    company_id,
    company_id,
    run_type,
    run_type,
    run_at
    run_at
   FROM manufacturing.mps_run;
   FROM manufacturing.mps_run;




--
--
-- Name: v_manufacturing_mrp_allocation; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_mrp_allocation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_mrp_allocation AS
CREATE VIEW public.v_manufacturing_mrp_allocation AS
 SELECT mrp_allocation_id,
 SELECT mrp_allocation_id,
    mrp_requirement_id,
    mrp_requirement_id,
    source_type,
    source_type,
    source_id,
    source_id,
    qty_allocated
    qty_allocated
   FROM manufacturing.mrp_allocation;
   FROM manufacturing.mrp_allocation;




--
--
-- Name: v_manufacturing_mrp_requirement; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_mrp_requirement; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_mrp_requirement AS
CREATE VIEW public.v_manufacturing_mrp_requirement AS
 SELECT mrp_requirement_id,
 SELECT mrp_requirement_id,
    mrp_run_id,
    mrp_run_id,
    item_id,
    item_id,
    requirement_date,
    requirement_date,
    qty_required,
    qty_required,
    supply_type
    supply_type
   FROM manufacturing.mrp_requirement;
   FROM manufacturing.mrp_requirement;




--
--
-- Name: v_manufacturing_mrp_run; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_mrp_run; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_mrp_run AS
CREATE VIEW public.v_manufacturing_mrp_run AS
 SELECT mrp_run_id,
 SELECT mrp_run_id,
    company_id,
    company_id,
    run_type,
    run_type,
    run_at
    run_at
   FROM manufacturing.mrp_run;
   FROM manufacturing.mrp_run;




--
--
-- Name: v_manufacturing_routing_operation; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_routing_operation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_routing_operation AS
CREATE VIEW public.v_manufacturing_routing_operation AS
 SELECT routing_operation_id,
 SELECT routing_operation_id,
    routing_id,
    routing_id,
    operation_no,
    operation_no,
    process_id,
    process_id,
    std_time_minutes
    std_time_minutes
   FROM manufacturing.routing_operation;
   FROM manufacturing.routing_operation;




--
--
-- Name: v_manufacturing_work_order; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_work_order; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_work_order AS
CREATE VIEW public.v_manufacturing_work_order AS
 SELECT work_order_id,
 SELECT work_order_id,
    company_id,
    company_id,
    wo_no,
    wo_no,
    item_id,
    item_id,
    bom_id,
    bom_id,
    routing_id,
    routing_id,
    warehouse_id,
    warehouse_id,
    plan_qty,
    plan_qty,
    plan_start_date,
    plan_start_date,
    plan_end_date,
    plan_end_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM manufacturing.work_order;
   FROM manufacturing.work_order;




--
--
-- Name: v_manufacturing_yield_metric; Type: VIEW; Schema: public; Owner: -
-- Name: v_manufacturing_yield_metric; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_manufacturing_yield_metric AS
CREATE VIEW public.v_manufacturing_yield_metric AS
 SELECT yield_metric_id,
 SELECT yield_metric_id,
    company_id,
    company_id,
    process_id,
    process_id,
    metric_date,
    metric_date,
    yield_rate
    yield_rate
   FROM manufacturing.yield_metric;
   FROM manufacturing.yield_metric;




--
--
-- Name: v_ng_daily_trend; Type: VIEW; Schema: public; Owner: -
-- Name: v_ng_daily_trend; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_ng_daily_trend AS
CREATE VIEW public.v_ng_daily_trend AS
 SELECT company_id,
 SELECT company_id,
    date_trunc('day'::text, occurred_at) AS day,
    date_trunc('day'::text, occurred_at) AS day,
    severity,
    severity,
    count(*) AS event_count
    count(*) AS event_count
   FROM audit.ng_event
   FROM audit.ng_event
  GROUP BY company_id, (date_trunc('day'::text, occurred_at)), severity;
  GROUP BY company_id, (date_trunc('day'::text, occurred_at)), severity;




--
--
-- Name: v_ng_event; Type: VIEW; Schema: public; Owner: -
-- Name: v_ng_event; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_ng_event AS
CREATE VIEW public.v_ng_event AS
 SELECT ng_event_id,
 SELECT ng_event_id,
    company_id,
    company_id,
    occurred_at,
    occurred_at,
    event_key,
    event_key,
    task_name,
    task_name,
    audit_scope,
    audit_scope,
    severity,
    severity,
    reason_code,
    reason_code,
    phase,
    phase,
    retry_count,
    retry_count,
    auto_fixed,
    auto_fixed,
    quarantined,
    quarantined,
    approval_required,
    approval_required,
    approved_by,
    approved_by,
    approved_at,
    approved_at,
    business_domain,
    business_domain,
    context
    context
   FROM audit.ng_event;
   FROM audit.ng_event;




--
--
-- Name: v_ng_event_list; Type: VIEW; Schema: public; Owner: -
-- Name: v_ng_event_list; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_ng_event_list AS
CREATE VIEW public.v_ng_event_list AS
 SELECT ng_event_id,
 SELECT ng_event_id,
    company_id,
    company_id,
    occurred_at,
    occurred_at,
    business_domain,
    business_domain,
    event_key,
    event_key,
    task_name,
    task_name,
    audit_scope,
    audit_scope,
    severity,
    severity,
    reason_code,
    reason_code,
    phase,
    phase,
    retry_count,
    retry_count,
    auto_fixed,
    auto_fixed,
    quarantined,
    quarantined,
    approval_required,
    approval_required,
    approved_at
    approved_at
   FROM audit.ng_event;
   FROM audit.ng_event;




--
--
-- Name: v_ng_reason_stats; Type: VIEW; Schema: public; Owner: -
-- Name: v_ng_reason_stats; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_ng_reason_stats AS
CREATE VIEW public.v_ng_reason_stats AS
 SELECT company_id,
 SELECT company_id,
    reason_code,
    reason_code,
    severity,
    severity,
    count(*) AS event_count
    count(*) AS event_count
   FROM audit.ng_event
   FROM audit.ng_event
  GROUP BY company_id, reason_code, severity;
  GROUP BY company_id, reason_code, severity;




--
--
-- Name: v_policy_update_candidate; Type: VIEW; Schema: public; Owner: -
-- Name: v_policy_update_candidate; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_policy_update_candidate AS
CREATE VIEW public.v_policy_update_candidate AS
 SELECT business_domain,
 SELECT business_domain,
    event_key,
    event_key,
    reason_code,
    reason_code,
    count(*) AS ng_count,
    count(*) AS ng_count,
    max(occurred_at) AS last_occurred_at
    max(occurred_at) AS last_occurred_at
   FROM audit.ng_event
   FROM audit.ng_event
  WHERE (severity = ANY (ARRAY['ng'::text, 'critical'::text]))
  WHERE (severity = ANY (ARRAY['ng'::text, 'critical'::text]))
  GROUP BY business_domain, event_key, reason_code;
  GROUP BY business_domain, event_key, reason_code;




--
--
-- Name: v_purchase_purchase_invoice; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_purchase_invoice; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_purchase_invoice AS
CREATE VIEW public.v_purchase_purchase_invoice AS
 SELECT purchase_invoice_id,
 SELECT purchase_invoice_id,
    company_id,
    company_id,
    supplier_id,
    supplier_id,
    invoice_no,
    invoice_no,
    invoice_date,
    invoice_date,
    status_code,
    status_code,
    total_amount,
    total_amount,
    created_at
    created_at
   FROM purchase.purchase_invoice;
   FROM purchase.purchase_invoice;




--
--
-- Name: v_purchase_purchase_invoice_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_purchase_invoice_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_purchase_invoice_detail AS
CREATE VIEW public.v_purchase_purchase_invoice_detail AS
 SELECT purchase_invoice_detail_id,
 SELECT purchase_invoice_detail_id,
    purchase_invoice_id,
    purchase_invoice_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    receipt_detail_id,
    receipt_detail_id,
    purchase_order_detail_id
    purchase_order_detail_id
   FROM purchase.purchase_invoice_detail;
   FROM purchase.purchase_invoice_detail;




--
--
-- Name: v_purchase_purchase_order_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_purchase_order_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_purchase_order_detail AS
CREATE VIEW public.v_purchase_purchase_order_detail AS
 SELECT purchase_order_detail_id,
 SELECT purchase_order_detail_id,
    purchase_order_id,
    purchase_order_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    promised_date
    promised_date
   FROM purchase.purchase_order_detail;
   FROM purchase.purchase_order_detail;




--
--
-- Name: v_purchase_purchase_quotation; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_purchase_quotation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_purchase_quotation AS
CREATE VIEW public.v_purchase_purchase_quotation AS
 SELECT purchase_quotation_id,
 SELECT purchase_quotation_id,
    company_id,
    company_id,
    supplier_id,
    supplier_id,
    quotation_no,
    quotation_no,
    quotation_date,
    quotation_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM purchase.purchase_quotation;
   FROM purchase.purchase_quotation;




--
--
-- Name: v_purchase_purchase_quotation_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_purchase_quotation_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_purchase_quotation_detail AS
CREATE VIEW public.v_purchase_purchase_quotation_detail AS
 SELECT purchase_quotation_detail_id,
 SELECT purchase_quotation_detail_id,
    purchase_quotation_id,
    purchase_quotation_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount
    amount
   FROM purchase.purchase_quotation_detail;
   FROM purchase.purchase_quotation_detail;




--
--
-- Name: v_purchase_purchase_requisition; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_purchase_requisition; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_purchase_requisition AS
CREATE VIEW public.v_purchase_purchase_requisition AS
 SELECT purchase_requisition_id,
 SELECT purchase_requisition_id,
    company_id,
    company_id,
    requisition_no,
    requisition_no,
    requester_id,
    requester_id,
    requisition_date,
    requisition_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM purchase.purchase_requisition;
   FROM purchase.purchase_requisition;




--
--
-- Name: v_purchase_purchase_requisition_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_purchase_requisition_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_purchase_requisition_detail AS
CREATE VIEW public.v_purchase_purchase_requisition_detail AS
 SELECT purchase_requisition_detail_id,
 SELECT purchase_requisition_detail_id,
    purchase_requisition_id,
    purchase_requisition_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    required_date
    required_date
   FROM purchase.purchase_requisition_detail;
   FROM purchase.purchase_requisition_detail;




--
--
-- Name: v_purchase_purchase_three_way_match; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_purchase_three_way_match; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_purchase_three_way_match AS
CREATE VIEW public.v_purchase_purchase_three_way_match AS
 SELECT purchase_three_way_match_id,
 SELECT purchase_three_way_match_id,
    company_id,
    company_id,
    purchase_order_detail_id,
    purchase_order_detail_id,
    receipt_detail_id,
    receipt_detail_id,
    purchase_invoice_detail_id,
    purchase_invoice_detail_id,
    matched_at,
    matched_at,
    status_code
    status_code
   FROM purchase.purchase_three_way_match;
   FROM purchase.purchase_three_way_match;




--
--
-- Name: supplier_address; Type: TABLE; Schema: purchase; Owner: -
-- Name: supplier_address; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.supplier_address (
CREATE TABLE purchase.supplier_address (
    supplier_address_id bigint NOT NULL,
    supplier_address_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    address_type text NOT NULL,
    address_type text NOT NULL,
    postal_code text,
    postal_code text,
    country_code text DEFAULT 'JP'::text NOT NULL,
    country_code text DEFAULT 'JP'::text NOT NULL,
    prefecture text,
    prefecture text,
    city text,
    city text,
    address_line1 text NOT NULL,
    address_line1 text NOT NULL,
    address_line2 text,
    address_line2 text,
    is_default boolean DEFAULT false NOT NULL,
    is_default boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_purchase_supplier_address; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_supplier_address; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_supplier_address AS
CREATE VIEW public.v_purchase_supplier_address AS
 SELECT supplier_address_id,
 SELECT supplier_address_id,
    supplier_id,
    supplier_id,
    address_type,
    address_type,
    postal_code,
    postal_code,
    country_code,
    country_code,
    prefecture,
    prefecture,
    city,
    city,
    address_line1,
    address_line1,
    address_line2,
    address_line2,
    is_default,
    is_default,
    created_at
    created_at
   FROM purchase.supplier_address;
   FROM purchase.supplier_address;




--
--
-- Name: supplier_contact; Type: TABLE; Schema: purchase; Owner: -
-- Name: supplier_contact; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.supplier_contact (
CREATE TABLE purchase.supplier_contact (
    supplier_contact_id bigint NOT NULL,
    supplier_contact_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    contact_name text NOT NULL,
    contact_name text NOT NULL,
    department_name text,
    department_name text,
    email text,
    email text,
    phone text,
    phone text,
    mobile text,
    mobile text,
    is_primary boolean DEFAULT false NOT NULL,
    is_primary boolean DEFAULT false NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_purchase_supplier_contact; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_supplier_contact; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_supplier_contact AS
CREATE VIEW public.v_purchase_supplier_contact AS
 SELECT supplier_contact_id,
 SELECT supplier_contact_id,
    supplier_id,
    supplier_id,
    contact_name,
    contact_name,
    department_name,
    department_name,
    email,
    email,
    phone,
    phone,
    mobile,
    mobile,
    is_primary,
    is_primary,
    is_active,
    is_active,
    created_at
    created_at
   FROM purchase.supplier_contact;
   FROM purchase.supplier_contact;




--
--
-- Name: v_purchase_supplier_item_price; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_supplier_item_price; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_supplier_item_price AS
CREATE VIEW public.v_purchase_supplier_item_price AS
 SELECT supplier_item_price_id,
 SELECT supplier_item_price_id,
    company_id,
    company_id,
    supplier_id,
    supplier_id,
    item_id,
    item_id,
    price,
    price,
    currency_code,
    currency_code,
    valid_from,
    valid_from,
    valid_to,
    valid_to,
    is_active
    is_active
   FROM purchase.supplier_item_price;
   FROM purchase.supplier_item_price;




--
--
-- Name: supplier_payment_term; Type: TABLE; Schema: purchase; Owner: -
-- Name: supplier_payment_term; Type: TABLE; Schema: purchase; Owner: -
--
--


CREATE TABLE purchase.supplier_payment_term (
CREATE TABLE purchase.supplier_payment_term (
    supplier_payment_term_id bigint NOT NULL,
    supplier_payment_term_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    supplier_id bigint NOT NULL,
    payment_term_id bigint NOT NULL,
    payment_term_id bigint NOT NULL,
    payment_method_code text,
    payment_method_code text,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_to date,
    valid_to date,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: v_purchase_supplier_payment_term; Type: VIEW; Schema: public; Owner: -
-- Name: v_purchase_supplier_payment_term; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_purchase_supplier_payment_term AS
CREATE VIEW public.v_purchase_supplier_payment_term AS
 SELECT supplier_payment_term_id,
 SELECT supplier_payment_term_id,
    supplier_id,
    supplier_id,
    payment_term_id,
    payment_term_id,
    payment_method_code,
    payment_method_code,
    valid_from,
    valid_from,
    valid_to,
    valid_to,
    is_active
    is_active
   FROM purchase.supplier_payment_term;
   FROM purchase.supplier_payment_term;




--
--
-- Name: v_rls_table_status; Type: VIEW; Schema: public; Owner: -
-- Name: v_rls_table_status; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_rls_table_status AS
CREATE VIEW public.v_rls_table_status AS
 SELECT n.nspname AS schema_name,
 SELECT n.nspname AS schema_name,
    c.relname AS table_name,
    c.relname AS table_name,
    c.relrowsecurity AS rls_enabled,
    c.relrowsecurity AS rls_enabled,
    c.relforcerowsecurity AS rls_forced,
    c.relforcerowsecurity AS rls_forced,
    (EXISTS ( SELECT 1
    (EXISTS ( SELECT 1
           FROM information_schema.columns col
           FROM information_schema.columns col
          WHERE (((col.table_schema)::name = n.nspname) AND ((col.table_name)::name = c.relname) AND ((col.column_name)::name = 'company_id'::name)))) AS has_company_id,
          WHERE (((col.table_schema)::name = n.nspname) AND ((col.table_name)::name = c.relname) AND ((col.column_name)::name = 'company_id'::name)))) AS has_company_id,
    (EXISTS ( SELECT 1
    (EXISTS ( SELECT 1
           FROM pg_policies p
           FROM pg_policies p
          WHERE ((p.schemaname = n.nspname) AND (p.tablename = c.relname) AND (p.policyname ~~ '%company_rls%'::text)))) AS has_company_policy,
          WHERE ((p.schemaname = n.nspname) AND (p.tablename = c.relname) AND (p.policyname ~~ '%company_rls%'::text)))) AS has_company_policy,
    (EXISTS ( SELECT 1
    (EXISTS ( SELECT 1
           FROM pg_policies p
           FROM pg_policies p
          WHERE ((p.schemaname = n.nspname) AND (p.tablename = c.relname) AND (p.policyname ~~ '%admin_bypass%'::text)))) AS has_admin_bypass,
          WHERE ((p.schemaname = n.nspname) AND (p.tablename = c.relname) AND (p.policyname ~~ '%admin_bypass%'::text)))) AS has_admin_bypass,
        CASE
        CASE
            WHEN (n.nspname = ANY (ARRAY['core'::name, 'sales'::name, 'purchase'::name, 'inventory'::name, 'manufacturing'::name, 'hr'::name, 'finance'::name])) THEN 'BUSINESS'::text
            WHEN (n.nspname = ANY (ARRAY['core'::name, 'sales'::name, 'purchase'::name, 'inventory'::name, 'manufacturing'::name, 'hr'::name, 'finance'::name])) THEN 'BUSINESS'::text
            WHEN (n.nspname = ANY (ARRAY['auth'::name, 'vault'::name, 'storage'::name, 'realtime'::name, 'pg_catalog'::name, 'information_schema'::name])) THEN 'INTERNAL'::text
            WHEN (n.nspname = ANY (ARRAY['auth'::name, 'vault'::name, 'storage'::name, 'realtime'::name, 'pg_catalog'::name, 'information_schema'::name])) THEN 'INTERNAL'::text
            ELSE 'NON_BUSINESS'::text
            ELSE 'NON_BUSINESS'::text
        END AS category
        END AS category
   FROM (pg_class c
   FROM (pg_class c
     JOIN pg_namespace n ON ((n.oid = c.relnamespace)))
     JOIN pg_namespace n ON ((n.oid = c.relnamespace)))
  WHERE (c.relkind = 'r'::"char")
  WHERE (c.relkind = 'r'::"char")
  ORDER BY
  ORDER BY
        CASE
        CASE
            WHEN (n.nspname = ANY (ARRAY['core'::name, 'sales'::name, 'purchase'::name, 'inventory'::name, 'manufacturing'::name, 'hr'::name, 'finance'::name])) THEN 'BUSINESS'::text
            WHEN (n.nspname = ANY (ARRAY['core'::name, 'sales'::name, 'purchase'::name, 'inventory'::name, 'manufacturing'::name, 'hr'::name, 'finance'::name])) THEN 'BUSINESS'::text
            WHEN (n.nspname = ANY (ARRAY['auth'::name, 'vault'::name, 'storage'::name, 'realtime'::name, 'pg_catalog'::name, 'information_schema'::name])) THEN 'INTERNAL'::text
            WHEN (n.nspname = ANY (ARRAY['auth'::name, 'vault'::name, 'storage'::name, 'realtime'::name, 'pg_catalog'::name, 'information_schema'::name])) THEN 'INTERNAL'::text
            ELSE 'NON_BUSINESS'::text
            ELSE 'NON_BUSINESS'::text
        END, n.nspname, c.relname;
        END, n.nspname, c.relname;




--
--
-- Name: v_sales_billing_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_billing_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_billing_detail AS
CREATE VIEW public.v_sales_billing_detail AS
 SELECT billing_detail_id,
 SELECT billing_detail_id,
    billing_id,
    billing_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    tax_category_code
    tax_category_code
   FROM sales.billing_detail;
   FROM sales.billing_detail;




--
--
-- Name: v_sales_customer; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_customer; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_customer AS
CREATE VIEW public.v_sales_customer AS
 SELECT customer_id,
 SELECT customer_id,
    company_id,
    company_id,
    customer_code,
    customer_code,
    customer_name,
    customer_name,
    billing_address,
    billing_address,
    shipping_address,
    shipping_address,
    payment_term,
    payment_term,
    credit_limit,
    credit_limit,
    is_active,
    is_active,
    created_at
    created_at
   FROM sales.customer;
   FROM sales.customer;




--
--
-- Name: customer_address; Type: TABLE; Schema: sales; Owner: -
-- Name: customer_address; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.customer_address (
CREATE TABLE sales.customer_address (
    customer_address_id bigint NOT NULL,
    customer_address_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    address_type text NOT NULL,
    address_type text NOT NULL,
    postal_code text,
    postal_code text,
    country_code text DEFAULT 'JP'::text NOT NULL,
    country_code text DEFAULT 'JP'::text NOT NULL,
    prefecture text,
    prefecture text,
    city text,
    city text,
    address_line1 text NOT NULL,
    address_line1 text NOT NULL,
    address_line2 text,
    address_line2 text,
    is_default boolean DEFAULT false NOT NULL,
    is_default boolean DEFAULT false NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_sales_customer_address; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_customer_address; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_customer_address AS
CREATE VIEW public.v_sales_customer_address AS
 SELECT customer_address_id,
 SELECT customer_address_id,
    customer_id,
    customer_id,
    address_type,
    address_type,
    postal_code,
    postal_code,
    country_code,
    country_code,
    prefecture,
    prefecture,
    city,
    city,
    address_line1,
    address_line1,
    address_line2,
    address_line2,
    is_default,
    is_default,
    created_at
    created_at
   FROM sales.customer_address;
   FROM sales.customer_address;




--
--
-- Name: customer_contact; Type: TABLE; Schema: sales; Owner: -
-- Name: customer_contact; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.customer_contact (
CREATE TABLE sales.customer_contact (
    customer_contact_id bigint NOT NULL,
    customer_contact_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    contact_name text NOT NULL,
    contact_name text NOT NULL,
    department_name text,
    department_name text,
    email text,
    email text,
    phone text,
    phone text,
    mobile text,
    mobile text,
    is_primary boolean DEFAULT false NOT NULL,
    is_primary boolean DEFAULT false NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: v_sales_customer_contact; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_customer_contact; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_customer_contact AS
CREATE VIEW public.v_sales_customer_contact AS
 SELECT customer_contact_id,
 SELECT customer_contact_id,
    customer_id,
    customer_id,
    contact_name,
    contact_name,
    department_name,
    department_name,
    email,
    email,
    phone,
    phone,
    mobile,
    mobile,
    is_primary,
    is_primary,
    is_active,
    is_active,
    created_at
    created_at
   FROM sales.customer_contact;
   FROM sales.customer_contact;




--
--
-- Name: customer_payment_term; Type: TABLE; Schema: sales; Owner: -
-- Name: customer_payment_term; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.customer_payment_term (
CREATE TABLE sales.customer_payment_term (
    customer_payment_term_id bigint NOT NULL,
    customer_payment_term_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    customer_id bigint NOT NULL,
    payment_term_id bigint NOT NULL,
    payment_term_id bigint NOT NULL,
    payment_method_code text,
    payment_method_code text,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_from date DEFAULT CURRENT_DATE NOT NULL,
    valid_to date,
    valid_to date,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: v_sales_customer_payment_term; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_customer_payment_term; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_customer_payment_term AS
CREATE VIEW public.v_sales_customer_payment_term AS
 SELECT customer_payment_term_id,
 SELECT customer_payment_term_id,
    customer_id,
    customer_id,
    payment_term_id,
    payment_term_id,
    payment_method_code,
    payment_method_code,
    valid_from,
    valid_from,
    valid_to,
    valid_to,
    is_active
    is_active
   FROM sales.customer_payment_term;
   FROM sales.customer_payment_term;




--
--
-- Name: v_sales_invoice_pdf; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_invoice_pdf; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_invoice_pdf AS
CREATE VIEW public.v_sales_invoice_pdf AS
 SELECT invoice_pdf_id,
 SELECT invoice_pdf_id,
    company_id,
    company_id,
    billing_id,
    billing_id,
    file_path,
    file_path,
    created_at
    created_at
   FROM sales.invoice_pdf;
   FROM sales.invoice_pdf;




--
--
-- Name: v_sales_item; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_item; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_item AS
CREATE VIEW public.v_sales_item AS
 SELECT item_id,
 SELECT item_id,
    company_id,
    company_id,
    item_code,
    item_code,
    item_name,
    item_name,
    item_category_id,
    item_category_id,
    uom,
    uom,
    is_active,
    is_active,
    created_at
    created_at
   FROM sales.item;
   FROM sales.item;




--
--
-- Name: v_sales_item_category; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_item_category; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_item_category AS
CREATE VIEW public.v_sales_item_category AS
 SELECT item_category_id,
 SELECT item_category_id,
    company_id,
    company_id,
    category_code,
    category_code,
    category_name,
    category_name,
    parent_category_id,
    parent_category_id,
    category_level
    category_level
   FROM sales.item_category;
   FROM sales.item_category;




--
--
-- Name: item_uom; Type: TABLE; Schema: sales; Owner: -
-- Name: item_uom; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.item_uom (
CREATE TABLE sales.item_uom (
    item_uom_id bigint NOT NULL,
    item_uom_id bigint NOT NULL,
    item_id bigint NOT NULL,
    item_id bigint NOT NULL,
    uom_code text NOT NULL,
    uom_code text NOT NULL,
    usage_type text NOT NULL,
    usage_type text NOT NULL,
    is_primary boolean DEFAULT false NOT NULL
    is_primary boolean DEFAULT false NOT NULL
);
);




--
--
-- Name: v_sales_item_uom; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_item_uom; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_item_uom AS
CREATE VIEW public.v_sales_item_uom AS
 SELECT item_uom_id,
 SELECT item_uom_id,
    item_id,
    item_id,
    uom_code,
    uom_code,
    usage_type,
    usage_type,
    is_primary
    is_primary
   FROM sales.item_uom;
   FROM sales.item_uom;




--
--
-- Name: v_sales_order_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_order_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_order_detail AS
CREATE VIEW public.v_sales_order_detail AS
 SELECT order_detail_id,
 SELECT order_detail_id,
    order_id,
    order_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    requested_ship_date
    requested_ship_date
   FROM sales.order_detail;
   FROM sales.order_detail;




--
--
-- Name: v_sales_return_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_return_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_return_detail AS
CREATE VIEW public.v_sales_return_detail AS
 SELECT return_detail_id,
 SELECT return_detail_id,
    return_id,
    return_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    reason_code
    reason_code
   FROM sales.return_detail;
   FROM sales.return_detail;




--
--
-- Name: v_sales_sales_quotation; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_sales_quotation; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_sales_quotation AS
CREATE VIEW public.v_sales_sales_quotation AS
 SELECT sales_quotation_id,
 SELECT sales_quotation_id,
    company_id,
    company_id,
    quotation_no,
    quotation_no,
    customer_id,
    customer_id,
    quotation_date,
    quotation_date,
    status_code,
    status_code,
    created_by,
    created_by,
    created_at
    created_at
   FROM sales.sales_quotation;
   FROM sales.sales_quotation;




--
--
-- Name: v_sales_sales_quotation_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_sales_quotation_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_sales_quotation_detail AS
CREATE VIEW public.v_sales_sales_quotation_detail AS
 SELECT sales_quotation_detail_id,
 SELECT sales_quotation_detail_id,
    sales_quotation_id,
    sales_quotation_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty,
    qty,
    unit_price,
    unit_price,
    amount,
    amount,
    tax_category_code
    tax_category_code
   FROM sales.sales_quotation_detail;
   FROM sales.sales_quotation_detail;




--
--
-- Name: v_sales_shipping_detail; Type: VIEW; Schema: public; Owner: -
-- Name: v_sales_shipping_detail; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.v_sales_shipping_detail AS
CREATE VIEW public.v_sales_shipping_detail AS
 SELECT shipping_detail_id,
 SELECT shipping_detail_id,
    shipping_id,
    shipping_id,
    order_detail_id,
    order_detail_id,
    line_no,
    line_no,
    item_id,
    item_id,
    qty
    qty
   FROM sales.shipping_detail;
   FROM sales.shipping_detail;




--
--
-- Name: warehouse; Type: VIEW; Schema: public; Owner: -
-- Name: warehouse; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.warehouse AS
CREATE VIEW public.warehouse AS
 SELECT warehouse_id,
 SELECT warehouse_id,
    company_id,
    company_id,
    warehouse_code,
    warehouse_code,
    warehouse_name,
    warehouse_name,
    is_active,
    is_active,
    created_at
    created_at
   FROM inventory.warehouse;
   FROM inventory.warehouse;




--
--
-- Name: work_order; Type: VIEW; Schema: public; Owner: -
-- Name: work_order; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.work_order AS
CREATE VIEW public.work_order AS
 SELECT work_order_id,
 SELECT work_order_id,
    company_id,
    company_id,
    wo_no,
    wo_no,
    item_id,
    item_id,
    bom_id,
    bom_id,
    routing_id,
    routing_id,
    warehouse_id,
    warehouse_id,
    plan_qty,
    plan_qty,
    plan_start_date,
    plan_start_date,
    plan_end_date,
    plan_end_date,
    status_code,
    status_code,
    created_at
    created_at
   FROM manufacturing.work_order;
   FROM manufacturing.work_order;




--
--
-- Name: yield_metric; Type: VIEW; Schema: public; Owner: -
-- Name: yield_metric; Type: VIEW; Schema: public; Owner: -
--
--


CREATE VIEW public.yield_metric AS
CREATE VIEW public.yield_metric AS
 SELECT yield_metric_id,
 SELECT yield_metric_id,
    company_id,
    company_id,
    process_id,
    process_id,
    metric_date,
    metric_date,
    yield_rate
    yield_rate
   FROM manufacturing.yield_metric;
   FROM manufacturing.yield_metric;




--
--
-- Name: purchase_invoice_detail_purchase_invoice_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail_purchase_invoice_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_invoice_detail_purchase_invoice_detail_id_seq
CREATE SEQUENCE purchase.purchase_invoice_detail_purchase_invoice_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_invoice_detail_purchase_invoice_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail_purchase_invoice_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_invoice_detail_purchase_invoice_detail_id_seq OWNED BY purchase.purchase_invoice_detail.purchase_invoice_detail_id;
ALTER SEQUENCE purchase.purchase_invoice_detail_purchase_invoice_detail_id_seq OWNED BY purchase.purchase_invoice_detail.purchase_invoice_detail_id;




--
--
-- Name: purchase_invoice_purchase_invoice_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_invoice_purchase_invoice_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_invoice_purchase_invoice_id_seq
CREATE SEQUENCE purchase.purchase_invoice_purchase_invoice_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_invoice_purchase_invoice_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_invoice_purchase_invoice_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_invoice_purchase_invoice_id_seq OWNED BY purchase.purchase_invoice.purchase_invoice_id;
ALTER SEQUENCE purchase.purchase_invoice_purchase_invoice_id_seq OWNED BY purchase.purchase_invoice.purchase_invoice_id;




--
--
-- Name: purchase_order_detail_purchase_order_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_order_detail_purchase_order_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_order_detail_purchase_order_detail_id_seq
CREATE SEQUENCE purchase.purchase_order_detail_purchase_order_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_order_detail_purchase_order_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_order_detail_purchase_order_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_order_detail_purchase_order_detail_id_seq OWNED BY purchase.purchase_order_detail.purchase_order_detail_id;
ALTER SEQUENCE purchase.purchase_order_detail_purchase_order_detail_id_seq OWNED BY purchase.purchase_order_detail.purchase_order_detail_id;




--
--
-- Name: purchase_order_header_purchase_order_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_order_header_purchase_order_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_order_header_purchase_order_id_seq
CREATE SEQUENCE purchase.purchase_order_header_purchase_order_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_order_header_purchase_order_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_order_header_purchase_order_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_order_header_purchase_order_id_seq OWNED BY purchase.purchase_order_header.purchase_order_id;
ALTER SEQUENCE purchase.purchase_order_header_purchase_order_id_seq OWNED BY purchase.purchase_order_header.purchase_order_id;




--
--
-- Name: purchase_quotation_detail_purchase_quotation_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail_purchase_quotation_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_quotation_detail_purchase_quotation_detail_id_seq
CREATE SEQUENCE purchase.purchase_quotation_detail_purchase_quotation_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_quotation_detail_purchase_quotation_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail_purchase_quotation_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_quotation_detail_purchase_quotation_detail_id_seq OWNED BY purchase.purchase_quotation_detail.purchase_quotation_detail_id;
ALTER SEQUENCE purchase.purchase_quotation_detail_purchase_quotation_detail_id_seq OWNED BY purchase.purchase_quotation_detail.purchase_quotation_detail_id;




--
--
-- Name: purchase_quotation_purchase_quotation_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_quotation_purchase_quotation_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_quotation_purchase_quotation_id_seq
CREATE SEQUENCE purchase.purchase_quotation_purchase_quotation_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_quotation_purchase_quotation_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_quotation_purchase_quotation_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_quotation_purchase_quotation_id_seq OWNED BY purchase.purchase_quotation.purchase_quotation_id;
ALTER SEQUENCE purchase.purchase_quotation_purchase_quotation_id_seq OWNED BY purchase.purchase_quotation.purchase_quotation_id;




--
--
-- Name: purchase_receipt_detail_receipt_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail_receipt_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_receipt_detail_receipt_detail_id_seq
CREATE SEQUENCE purchase.purchase_receipt_detail_receipt_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_receipt_detail_receipt_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail_receipt_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_receipt_detail_receipt_detail_id_seq OWNED BY purchase.purchase_receipt_detail.receipt_detail_id;
ALTER SEQUENCE purchase.purchase_receipt_detail_receipt_detail_id_seq OWNED BY purchase.purchase_receipt_detail.receipt_detail_id;




--
--
-- Name: purchase_receipt_receipt_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_receipt_receipt_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_receipt_receipt_id_seq
CREATE SEQUENCE purchase.purchase_receipt_receipt_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_receipt_receipt_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_receipt_receipt_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_receipt_receipt_id_seq OWNED BY purchase.purchase_receipt.receipt_id;
ALTER SEQUENCE purchase.purchase_receipt_receipt_id_seq OWNED BY purchase.purchase_receipt.receipt_id;




--
--
-- Name: purchase_requisition_detail_purchase_requisition_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail_purchase_requisition_detail_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_requisition_detail_purchase_requisition_detail_id_seq
CREATE SEQUENCE purchase.purchase_requisition_detail_purchase_requisition_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_requisition_detail_purchase_requisition_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail_purchase_requisition_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_requisition_detail_purchase_requisition_detail_id_seq OWNED BY purchase.purchase_requisition_detail.purchase_requisition_detail_id;
ALTER SEQUENCE purchase.purchase_requisition_detail_purchase_requisition_detail_id_seq OWNED BY purchase.purchase_requisition_detail.purchase_requisition_detail_id;




--
--
-- Name: purchase_requisition_purchase_requisition_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_requisition_purchase_requisition_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_requisition_purchase_requisition_id_seq
CREATE SEQUENCE purchase.purchase_requisition_purchase_requisition_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_requisition_purchase_requisition_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_requisition_purchase_requisition_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_requisition_purchase_requisition_id_seq OWNED BY purchase.purchase_requisition.purchase_requisition_id;
ALTER SEQUENCE purchase.purchase_requisition_purchase_requisition_id_seq OWNED BY purchase.purchase_requisition.purchase_requisition_id;




--
--
-- Name: purchase_three_way_match_purchase_three_way_match_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: purchase_three_way_match_purchase_three_way_match_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.purchase_three_way_match_purchase_three_way_match_id_seq
CREATE SEQUENCE purchase.purchase_three_way_match_purchase_three_way_match_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: purchase_three_way_match_purchase_three_way_match_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: purchase_three_way_match_purchase_three_way_match_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.purchase_three_way_match_purchase_three_way_match_id_seq OWNED BY purchase.purchase_three_way_match.purchase_three_way_match_id;
ALTER SEQUENCE purchase.purchase_three_way_match_purchase_three_way_match_id_seq OWNED BY purchase.purchase_three_way_match.purchase_three_way_match_id;




--
--
-- Name: supplier_address_supplier_address_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: supplier_address_supplier_address_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.supplier_address_supplier_address_id_seq
CREATE SEQUENCE purchase.supplier_address_supplier_address_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: supplier_address_supplier_address_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: supplier_address_supplier_address_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.supplier_address_supplier_address_id_seq OWNED BY purchase.supplier_address.supplier_address_id;
ALTER SEQUENCE purchase.supplier_address_supplier_address_id_seq OWNED BY purchase.supplier_address.supplier_address_id;




--
--
-- Name: supplier_contact_supplier_contact_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: supplier_contact_supplier_contact_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.supplier_contact_supplier_contact_id_seq
CREATE SEQUENCE purchase.supplier_contact_supplier_contact_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: supplier_contact_supplier_contact_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: supplier_contact_supplier_contact_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.supplier_contact_supplier_contact_id_seq OWNED BY purchase.supplier_contact.supplier_contact_id;
ALTER SEQUENCE purchase.supplier_contact_supplier_contact_id_seq OWNED BY purchase.supplier_contact.supplier_contact_id;




--
--
-- Name: supplier_item_price_supplier_item_price_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: supplier_item_price_supplier_item_price_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.supplier_item_price_supplier_item_price_id_seq
CREATE SEQUENCE purchase.supplier_item_price_supplier_item_price_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: supplier_item_price_supplier_item_price_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: supplier_item_price_supplier_item_price_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.supplier_item_price_supplier_item_price_id_seq OWNED BY purchase.supplier_item_price.supplier_item_price_id;
ALTER SEQUENCE purchase.supplier_item_price_supplier_item_price_id_seq OWNED BY purchase.supplier_item_price.supplier_item_price_id;




--
--
-- Name: supplier_master_supplier_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: supplier_master_supplier_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.supplier_master_supplier_id_seq
CREATE SEQUENCE purchase.supplier_master_supplier_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: supplier_master_supplier_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: supplier_master_supplier_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.supplier_master_supplier_id_seq OWNED BY purchase.supplier_master.supplier_id;
ALTER SEQUENCE purchase.supplier_master_supplier_id_seq OWNED BY purchase.supplier_master.supplier_id;




--
--
-- Name: supplier_payment_term_supplier_payment_term_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
-- Name: supplier_payment_term_supplier_payment_term_id_seq; Type: SEQUENCE; Schema: purchase; Owner: -
--
--


CREATE SEQUENCE purchase.supplier_payment_term_supplier_payment_term_id_seq
CREATE SEQUENCE purchase.supplier_payment_term_supplier_payment_term_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: supplier_payment_term_supplier_payment_term_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
-- Name: supplier_payment_term_supplier_payment_term_id_seq; Type: SEQUENCE OWNED BY; Schema: purchase; Owner: -
--
--


ALTER SEQUENCE purchase.supplier_payment_term_supplier_payment_term_id_seq OWNED BY purchase.supplier_payment_term.supplier_payment_term_id;
ALTER SEQUENCE purchase.supplier_payment_term_supplier_payment_term_id_seq OWNED BY purchase.supplier_payment_term.supplier_payment_term_id;




--
--
-- Name: v_change_history; Type: VIEW; Schema: purchase; Owner: -
-- Name: v_change_history; Type: VIEW; Schema: purchase; Owner: -
--
--


CREATE VIEW purchase.v_change_history AS
CREATE VIEW purchase.v_change_history AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail
   FROM core.audit_trail
  WHERE (entity_type ~~ 'purchase.%'::text);
  WHERE (entity_type ~~ 'purchase.%'::text);




--
--
-- Name: messages; Type: TABLE; Schema: realtime; Owner: -
-- Name: messages; Type: TABLE; Schema: realtime; Owner: -
--
--


    topic text NOT NULL,
    topic text NOT NULL,
    extension text NOT NULL,
    extension text NOT NULL,
    payload jsonb,
    payload jsonb,
    event text,
    event text,
    private boolean DEFAULT false,
    private boolean DEFAULT false,
    updated_at timestamp without time zone DEFAULT now() NOT NULL,
    updated_at timestamp without time zone DEFAULT now() NOT NULL,
    inserted_at timestamp without time zone DEFAULT now() NOT NULL,
    inserted_at timestamp without time zone DEFAULT now() NOT NULL,
    id uuid DEFAULT gen_random_uuid() NOT NULL
    id uuid DEFAULT gen_random_uuid() NOT NULL
)
)
PARTITION BY RANGE (inserted_at);
PARTITION BY RANGE (inserted_at);




--
--
-- Name: schema_migrations; Type: TABLE; Schema: realtime; Owner: -
-- Name: schema_migrations; Type: TABLE; Schema: realtime; Owner: -
--
--


    version bigint NOT NULL,
    version bigint NOT NULL,
    inserted_at timestamp(0) without time zone
    inserted_at timestamp(0) without time zone
);
);




--
--
-- Name: subscription; Type: TABLE; Schema: realtime; Owner: -
-- Name: subscription; Type: TABLE; Schema: realtime; Owner: -
--
--


    id bigint NOT NULL,
    id bigint NOT NULL,
    subscription_id uuid NOT NULL,
    subscription_id uuid NOT NULL,
    entity regclass NOT NULL,
    entity regclass NOT NULL,
    filters realtime.user_defined_filter[] DEFAULT '{}'::realtime.user_defined_filter[] NOT NULL,
    filters realtime.user_defined_filter[] DEFAULT '{}'::realtime.user_defined_filter[] NOT NULL,
    claims jsonb NOT NULL,
    claims jsonb NOT NULL,
    claims_role regrole GENERATED ALWAYS AS (realtime.to_regrole((claims ->> 'role'::text))) STORED NOT NULL,
    claims_role regrole GENERATED ALWAYS AS (realtime.to_regrole((claims ->> 'role'::text))) STORED NOT NULL,
    created_at timestamp without time zone DEFAULT timezone('utc'::text, now()) NOT NULL
    created_at timestamp without time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);
);




--
--
-- Name: subscription_id_seq; Type: SEQUENCE; Schema: realtime; Owner: -
-- Name: subscription_id_seq; Type: SEQUENCE; Schema: realtime; Owner: -
--
--


    SEQUENCE NAME realtime.subscription_id_seq
    SEQUENCE NAME realtime.subscription_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1
    CACHE 1
);
);




--
--
-- Name: billing_detail_billing_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: billing_detail_billing_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.billing_detail_billing_detail_id_seq
CREATE SEQUENCE sales.billing_detail_billing_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: billing_detail_billing_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: billing_detail_billing_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.billing_detail_billing_detail_id_seq OWNED BY sales.billing_detail.billing_detail_id;
ALTER SEQUENCE sales.billing_detail_billing_detail_id_seq OWNED BY sales.billing_detail.billing_detail_id;




--
--
-- Name: billing_header_billing_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: billing_header_billing_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.billing_header_billing_id_seq
CREATE SEQUENCE sales.billing_header_billing_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: billing_header_billing_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: billing_header_billing_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.billing_header_billing_id_seq OWNED BY sales.billing_header.billing_id;
ALTER SEQUENCE sales.billing_header_billing_id_seq OWNED BY sales.billing_header.billing_id;




--
--
-- Name: customer_address_customer_address_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: customer_address_customer_address_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.customer_address_customer_address_id_seq
CREATE SEQUENCE sales.customer_address_customer_address_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: customer_address_customer_address_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: customer_address_customer_address_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.customer_address_customer_address_id_seq OWNED BY sales.customer_address.customer_address_id;
ALTER SEQUENCE sales.customer_address_customer_address_id_seq OWNED BY sales.customer_address.customer_address_id;




--
--
-- Name: customer_contact_customer_contact_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: customer_contact_customer_contact_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.customer_contact_customer_contact_id_seq
CREATE SEQUENCE sales.customer_contact_customer_contact_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: customer_contact_customer_contact_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: customer_contact_customer_contact_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.customer_contact_customer_contact_id_seq OWNED BY sales.customer_contact.customer_contact_id;
ALTER SEQUENCE sales.customer_contact_customer_contact_id_seq OWNED BY sales.customer_contact.customer_contact_id;




--
--
-- Name: customer_customer_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: customer_customer_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.customer_customer_id_seq
CREATE SEQUENCE sales.customer_customer_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: customer_customer_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: customer_customer_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.customer_customer_id_seq OWNED BY sales.customer.customer_id;
ALTER SEQUENCE sales.customer_customer_id_seq OWNED BY sales.customer.customer_id;




--
--
-- Name: customer_payment_term_customer_payment_term_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: customer_payment_term_customer_payment_term_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.customer_payment_term_customer_payment_term_id_seq
CREATE SEQUENCE sales.customer_payment_term_customer_payment_term_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: customer_payment_term_customer_payment_term_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: customer_payment_term_customer_payment_term_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.customer_payment_term_customer_payment_term_id_seq OWNED BY sales.customer_payment_term.customer_payment_term_id;
ALTER SEQUENCE sales.customer_payment_term_customer_payment_term_id_seq OWNED BY sales.customer_payment_term.customer_payment_term_id;




--
--
-- Name: invoice_pdf_invoice_pdf_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: invoice_pdf_invoice_pdf_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.invoice_pdf_invoice_pdf_id_seq
CREATE SEQUENCE sales.invoice_pdf_invoice_pdf_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: invoice_pdf_invoice_pdf_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: invoice_pdf_invoice_pdf_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.invoice_pdf_invoice_pdf_id_seq OWNED BY sales.invoice_pdf.invoice_pdf_id;
ALTER SEQUENCE sales.invoice_pdf_invoice_pdf_id_seq OWNED BY sales.invoice_pdf.invoice_pdf_id;




--
--
-- Name: item_category_item_category_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: item_category_item_category_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.item_category_item_category_id_seq
CREATE SEQUENCE sales.item_category_item_category_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: item_category_item_category_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: item_category_item_category_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.item_category_item_category_id_seq OWNED BY sales.item_category.item_category_id;
ALTER SEQUENCE sales.item_category_item_category_id_seq OWNED BY sales.item_category.item_category_id;




--
--
-- Name: item_item_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: item_item_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.item_item_id_seq
CREATE SEQUENCE sales.item_item_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: item_item_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: item_item_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.item_item_id_seq OWNED BY sales.item.item_id;
ALTER SEQUENCE sales.item_item_id_seq OWNED BY sales.item.item_id;




--
--
-- Name: item_price_master_item_price_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: item_price_master_item_price_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.item_price_master_item_price_id_seq
CREATE SEQUENCE sales.item_price_master_item_price_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: item_price_master_item_price_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: item_price_master_item_price_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.item_price_master_item_price_id_seq OWNED BY sales.item_price_master.item_price_id;
ALTER SEQUENCE sales.item_price_master_item_price_id_seq OWNED BY sales.item_price_master.item_price_id;




--
--
-- Name: item_uom_item_uom_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: item_uom_item_uom_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.item_uom_item_uom_id_seq
CREATE SEQUENCE sales.item_uom_item_uom_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: item_uom_item_uom_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: item_uom_item_uom_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.item_uom_item_uom_id_seq OWNED BY sales.item_uom.item_uom_id;
ALTER SEQUENCE sales.item_uom_item_uom_id_seq OWNED BY sales.item_uom.item_uom_id;




--
--
-- Name: order_detail_order_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: order_detail_order_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.order_detail_order_detail_id_seq
CREATE SEQUENCE sales.order_detail_order_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: order_detail_order_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: order_detail_order_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.order_detail_order_detail_id_seq OWNED BY sales.order_detail.order_detail_id;
ALTER SEQUENCE sales.order_detail_order_detail_id_seq OWNED BY sales.order_detail.order_detail_id;




--
--
-- Name: order_header_order_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: order_header_order_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.order_header_order_id_seq
CREATE SEQUENCE sales.order_header_order_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: order_header_order_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: order_header_order_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.order_header_order_id_seq OWNED BY sales.order_header.order_id;
ALTER SEQUENCE sales.order_header_order_id_seq OWNED BY sales.order_header.order_id;




--
--
-- Name: quotation_order_link; Type: TABLE; Schema: sales; Owner: -
-- Name: quotation_order_link; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.quotation_order_link (
CREATE TABLE sales.quotation_order_link (
    quotation_order_link_id bigint NOT NULL,
    quotation_order_link_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    quotation_id bigint NOT NULL,
    quotation_id bigint NOT NULL,
    order_id bigint NOT NULL,
    order_id bigint NOT NULL,
    converted_by uuid,
    converted_by uuid,
    converted_at timestamp with time zone DEFAULT now() NOT NULL,
    converted_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: quotation_order_link_quotation_order_link_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: quotation_order_link_quotation_order_link_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.quotation_order_link_quotation_order_link_id_seq
CREATE SEQUENCE sales.quotation_order_link_quotation_order_link_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: quotation_order_link_quotation_order_link_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: quotation_order_link_quotation_order_link_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.quotation_order_link_quotation_order_link_id_seq OWNED BY sales.quotation_order_link.quotation_order_link_id;
ALTER SEQUENCE sales.quotation_order_link_quotation_order_link_id_seq OWNED BY sales.quotation_order_link.quotation_order_link_id;




--
--
-- Name: return_detail_return_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: return_detail_return_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.return_detail_return_detail_id_seq
CREATE SEQUENCE sales.return_detail_return_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: return_detail_return_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: return_detail_return_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.return_detail_return_detail_id_seq OWNED BY sales.return_detail.return_detail_id;
ALTER SEQUENCE sales.return_detail_return_detail_id_seq OWNED BY sales.return_detail.return_detail_id;




--
--
-- Name: return_header_return_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: return_header_return_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.return_header_return_id_seq
CREATE SEQUENCE sales.return_header_return_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: return_header_return_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: return_header_return_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.return_header_return_id_seq OWNED BY sales.return_header.return_id;
ALTER SEQUENCE sales.return_header_return_id_seq OWNED BY sales.return_header.return_id;




--
--
-- Name: sales_quotation_detail_sales_quotation_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: sales_quotation_detail_sales_quotation_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.sales_quotation_detail_sales_quotation_detail_id_seq
CREATE SEQUENCE sales.sales_quotation_detail_sales_quotation_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: sales_quotation_detail_sales_quotation_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: sales_quotation_detail_sales_quotation_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.sales_quotation_detail_sales_quotation_detail_id_seq OWNED BY sales.sales_quotation_detail.sales_quotation_detail_id;
ALTER SEQUENCE sales.sales_quotation_detail_sales_quotation_detail_id_seq OWNED BY sales.sales_quotation_detail.sales_quotation_detail_id;




--
--
-- Name: sales_quotation_sales_quotation_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: sales_quotation_sales_quotation_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.sales_quotation_sales_quotation_id_seq
CREATE SEQUENCE sales.sales_quotation_sales_quotation_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: sales_quotation_sales_quotation_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: sales_quotation_sales_quotation_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.sales_quotation_sales_quotation_id_seq OWNED BY sales.sales_quotation.sales_quotation_id;
ALTER SEQUENCE sales.sales_quotation_sales_quotation_id_seq OWNED BY sales.sales_quotation.sales_quotation_id;




--
--
-- Name: shipping_detail_shipping_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: shipping_detail_shipping_detail_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.shipping_detail_shipping_detail_id_seq
CREATE SEQUENCE sales.shipping_detail_shipping_detail_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: shipping_detail_shipping_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: shipping_detail_shipping_detail_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.shipping_detail_shipping_detail_id_seq OWNED BY sales.shipping_detail.shipping_detail_id;
ALTER SEQUENCE sales.shipping_detail_shipping_detail_id_seq OWNED BY sales.shipping_detail.shipping_detail_id;




--
--
-- Name: shipping_header_shipping_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: shipping_header_shipping_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.shipping_header_shipping_id_seq
CREATE SEQUENCE sales.shipping_header_shipping_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: shipping_header_shipping_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: shipping_header_shipping_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.shipping_header_shipping_id_seq OWNED BY sales.shipping_header.shipping_id;
ALTER SEQUENCE sales.shipping_header_shipping_id_seq OWNED BY sales.shipping_header.shipping_id;




--
--
-- Name: shipping_revision; Type: TABLE; Schema: sales; Owner: -
-- Name: shipping_revision; Type: TABLE; Schema: sales; Owner: -
--
--


CREATE TABLE sales.shipping_revision (
CREATE TABLE sales.shipping_revision (
    shipping_revision_id bigint NOT NULL,
    shipping_revision_id bigint NOT NULL,
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    shipping_id bigint NOT NULL,
    shipping_id bigint NOT NULL,
    revision_no integer NOT NULL,
    revision_no integer NOT NULL,
    before_qty numeric NOT NULL,
    before_qty numeric NOT NULL,
    after_qty numeric NOT NULL,
    after_qty numeric NOT NULL,
    before_unit_price numeric NOT NULL,
    before_unit_price numeric NOT NULL,
    after_unit_price numeric NOT NULL,
    after_unit_price numeric NOT NULL,
    reason text NOT NULL,
    reason text NOT NULL,
    revised_by uuid,
    revised_by uuid,
    revised_at timestamp with time zone DEFAULT now() NOT NULL,
    revised_at timestamp with time zone DEFAULT now() NOT NULL,
    approved_by uuid,
    approved_by uuid,
    approved_at timestamp with time zone,
    approved_at timestamp with time zone,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: shipping_revision_shipping_revision_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
-- Name: shipping_revision_shipping_revision_id_seq; Type: SEQUENCE; Schema: sales; Owner: -
--
--


CREATE SEQUENCE sales.shipping_revision_shipping_revision_id_seq
CREATE SEQUENCE sales.shipping_revision_shipping_revision_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: shipping_revision_shipping_revision_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
-- Name: shipping_revision_shipping_revision_id_seq; Type: SEQUENCE OWNED BY; Schema: sales; Owner: -
--
--


ALTER SEQUENCE sales.shipping_revision_shipping_revision_id_seq OWNED BY sales.shipping_revision.shipping_revision_id;
ALTER SEQUENCE sales.shipping_revision_shipping_revision_id_seq OWNED BY sales.shipping_revision.shipping_revision_id;




--
--
-- Name: v_change_history; Type: VIEW; Schema: sales; Owner: -
-- Name: v_change_history; Type: VIEW; Schema: sales; Owner: -
--
--


CREATE VIEW sales.v_change_history AS
CREATE VIEW sales.v_change_history AS
 SELECT audit_trail_id,
 SELECT audit_trail_id,
    company_id,
    company_id,
    entity_type,
    entity_type,
    entity_id,
    entity_id,
    action,
    action,
    action_category,
    action_category,
    detail,
    detail,
    performed_by,
    performed_by,
    performed_at
    performed_at
   FROM core.audit_trail
   FROM core.audit_trail
  WHERE (entity_type ~~ 'sales.%'::text);
  WHERE (entity_type ~~ 'sales.%'::text);




--
--
-- Name: v_order_header_read; Type: VIEW; Schema: sales; Owner: -
-- Name: v_order_header_read; Type: VIEW; Schema: sales; Owner: -
--
--


CREATE VIEW sales.v_order_header_read WITH (security_barrier='true') AS
CREATE VIEW sales.v_order_header_read WITH (security_barrier='true') AS
 SELECT order_id,
 SELECT order_id,
    company_id,
    company_id,
    order_no,
    order_no,
    customer_id,
    customer_id,
    order_date,
    order_date,
    status_code,
    status_code,
    remarks,
    remarks,
    created_by,
    created_by,
    created_at
    created_at
   FROM sales.order_header oh
   FROM sales.order_header oh
  WHERE (company_id = public.my_company_id());
  WHERE (company_id = public.my_company_id());




--
--
-- Name: buckets; Type: TABLE; Schema: storage; Owner: -
-- Name: buckets; Type: TABLE; Schema: storage; Owner: -
--
--


    id text NOT NULL,
    id text NOT NULL,
    name text NOT NULL,
    name text NOT NULL,
    owner uuid,
    owner uuid,
    created_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    public boolean DEFAULT false,
    public boolean DEFAULT false,
    avif_autodetection boolean DEFAULT false,
    avif_autodetection boolean DEFAULT false,
    file_size_limit bigint,
    file_size_limit bigint,
    allowed_mime_types text[],
    allowed_mime_types text[],
    owner_id text,
    owner_id text,
    type storage.buckettype DEFAULT 'STANDARD'::storage.buckettype NOT NULL
    type storage.buckettype DEFAULT 'STANDARD'::storage.buckettype NOT NULL
);
);




--
--
-- Name: COLUMN buckets.owner; Type: COMMENT; Schema: storage; Owner: -
-- Name: COLUMN buckets.owner; Type: COMMENT; Schema: storage; Owner: -
--
--


COMMENT ON COLUMN storage.buckets.owner IS 'Field is deprecated, use owner_id instead';
COMMENT ON COLUMN storage.buckets.owner IS 'Field is deprecated, use owner_id instead';




--
--
-- Name: buckets_analytics; Type: TABLE; Schema: storage; Owner: -
-- Name: buckets_analytics; Type: TABLE; Schema: storage; Owner: -
--
--


    name text NOT NULL,
    name text NOT NULL,
    type storage.buckettype DEFAULT 'ANALYTICS'::storage.buckettype NOT NULL,
    type storage.buckettype DEFAULT 'ANALYTICS'::storage.buckettype NOT NULL,
    format text DEFAULT 'ICEBERG'::text NOT NULL,
    format text DEFAULT 'ICEBERG'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    deleted_at timestamp with time zone
    deleted_at timestamp with time zone
);
);




--
--
-- Name: buckets_vectors; Type: TABLE; Schema: storage; Owner: -
-- Name: buckets_vectors; Type: TABLE; Schema: storage; Owner: -
--
--


    id text NOT NULL,
    id text NOT NULL,
    type storage.buckettype DEFAULT 'VECTOR'::storage.buckettype NOT NULL,
    type storage.buckettype DEFAULT 'VECTOR'::storage.buckettype NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: migrations; Type: TABLE; Schema: storage; Owner: -
-- Name: migrations; Type: TABLE; Schema: storage; Owner: -
--
--


    id integer NOT NULL,
    id integer NOT NULL,
    name character varying(100) NOT NULL,
    name character varying(100) NOT NULL,
    hash character varying(40) NOT NULL,
    hash character varying(40) NOT NULL,
    executed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
    executed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
);




--
--
-- Name: objects; Type: TABLE; Schema: storage; Owner: -
-- Name: objects; Type: TABLE; Schema: storage; Owner: -
--
--


    id uuid DEFAULT gen_random_uuid() NOT NULL,
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    bucket_id text,
    bucket_id text,
    name text,
    name text,
    owner uuid,
    owner uuid,
    created_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    last_accessed_at timestamp with time zone DEFAULT now(),
    last_accessed_at timestamp with time zone DEFAULT now(),
    metadata jsonb,
    metadata jsonb,
    path_tokens text[] GENERATED ALWAYS AS (string_to_array(name, '/'::text)) STORED,
    path_tokens text[] GENERATED ALWAYS AS (string_to_array(name, '/'::text)) STORED,
    version text,
    version text,
    owner_id text,
    owner_id text,
    user_metadata jsonb,
    user_metadata jsonb,
    level integer
    level integer
);
);




--
--
-- Name: COLUMN objects.owner; Type: COMMENT; Schema: storage; Owner: -
-- Name: COLUMN objects.owner; Type: COMMENT; Schema: storage; Owner: -
--
--


COMMENT ON COLUMN storage.objects.owner IS 'Field is deprecated, use owner_id instead';
COMMENT ON COLUMN storage.objects.owner IS 'Field is deprecated, use owner_id instead';




--
--
-- Name: prefixes; Type: TABLE; Schema: storage; Owner: -
-- Name: prefixes; Type: TABLE; Schema: storage; Owner: -
--
--


    bucket_id text NOT NULL,
    bucket_id text NOT NULL,
    name text NOT NULL COLLATE pg_catalog."C",
    name text NOT NULL COLLATE pg_catalog."C",
    level integer GENERATED ALWAYS AS (storage.get_level(name)) STORED NOT NULL,
    level integer GENERATED ALWAYS AS (storage.get_level(name)) STORED NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
    updated_at timestamp with time zone DEFAULT now()
);
);




--
--
-- Name: s3_multipart_uploads; Type: TABLE; Schema: storage; Owner: -
-- Name: s3_multipart_uploads; Type: TABLE; Schema: storage; Owner: -
--
--


    id text NOT NULL,
    id text NOT NULL,
    in_progress_size bigint DEFAULT 0 NOT NULL,
    in_progress_size bigint DEFAULT 0 NOT NULL,
    upload_signature text NOT NULL,
    upload_signature text NOT NULL,
    bucket_id text NOT NULL,
    bucket_id text NOT NULL,
    key text NOT NULL COLLATE pg_catalog."C",
    key text NOT NULL COLLATE pg_catalog."C",
    version text NOT NULL,
    version text NOT NULL,
    owner_id text,
    owner_id text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    user_metadata jsonb
    user_metadata jsonb
);
);




--
--
-- Name: s3_multipart_uploads_parts; Type: TABLE; Schema: storage; Owner: -
-- Name: s3_multipart_uploads_parts; Type: TABLE; Schema: storage; Owner: -
--
--


    id uuid DEFAULT gen_random_uuid() NOT NULL,
    id uuid DEFAULT gen_random_uuid() NOT NULL,
    upload_id text NOT NULL,
    upload_id text NOT NULL,
    size bigint DEFAULT 0 NOT NULL,
    size bigint DEFAULT 0 NOT NULL,
    part_number integer NOT NULL,
    part_number integer NOT NULL,
    bucket_id text NOT NULL,
    bucket_id text NOT NULL,
    key text NOT NULL COLLATE pg_catalog."C",
    key text NOT NULL COLLATE pg_catalog."C",
    etag text NOT NULL,
    etag text NOT NULL,
    owner_id text,
    owner_id text,
    version text NOT NULL,
    version text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: vector_indexes; Type: TABLE; Schema: storage; Owner: -
-- Name: vector_indexes; Type: TABLE; Schema: storage; Owner: -
--
--


    id text DEFAULT gen_random_uuid() NOT NULL,
    id text DEFAULT gen_random_uuid() NOT NULL,
    name text NOT NULL COLLATE pg_catalog."C",
    name text NOT NULL COLLATE pg_catalog."C",
    bucket_id text NOT NULL,
    bucket_id text NOT NULL,
    data_type text NOT NULL,
    data_type text NOT NULL,
    dimension integer NOT NULL,
    dimension integer NOT NULL,
    distance_metric text NOT NULL,
    distance_metric text NOT NULL,
    metadata_configuration jsonb,
    metadata_configuration jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: action_approval_map; Type: TABLE; Schema: system; Owner: -
-- Name: action_approval_map; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.action_approval_map (
CREATE TABLE system.action_approval_map (
    action_code text NOT NULL,
    action_code text NOT NULL,
    function_code text NOT NULL,
    function_code text NOT NULL,
    approval_flow_code text NOT NULL
    approval_flow_code text NOT NULL
);
);




--
--
-- Name: ai_agent; Type: TABLE; Schema: system; Owner: -
-- Name: ai_agent; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.ai_agent (
CREATE TABLE system.ai_agent (
    agent_code text NOT NULL,
    agent_code text NOT NULL,
    agent_name text NOT NULL,
    agent_name text NOT NULL,
    agent_role text DEFAULT 'GENERAL'::text NOT NULL,
    agent_role text DEFAULT 'GENERAL'::text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: ai_signal; Type: TABLE; Schema: system; Owner: -
-- Name: ai_signal; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.ai_signal (
CREATE TABLE system.ai_signal (
    signal_id bigint NOT NULL,
    signal_id bigint NOT NULL,
    signal_type text NOT NULL,
    signal_type text NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT ai_signal_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'DONE'::text, 'FAILED'::text])))
    CONSTRAINT ai_signal_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'DONE'::text, 'FAILED'::text])))
);
);




--
--
-- Name: ai_signal_signal_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: ai_signal_signal_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.ai_signal_signal_id_seq
CREATE SEQUENCE system.ai_signal_signal_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ai_signal_signal_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: ai_signal_signal_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.ai_signal_signal_id_seq OWNED BY system.ai_signal.signal_id;
ALTER SEQUENCE system.ai_signal_signal_id_seq OWNED BY system.ai_signal.signal_id;




--
--
-- Name: ai_task; Type: TABLE; Schema: system; Owner: -
-- Name: ai_task; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.ai_task (
CREATE TABLE system.ai_task (
    task_id bigint NOT NULL,
    task_id bigint NOT NULL,
    agent_code text NOT NULL,
    agent_code text NOT NULL,
    task_type text NOT NULL,
    task_type text NOT NULL,
    input_json jsonb DEFAULT '{}'::jsonb NOT NULL,
    input_json jsonb DEFAULT '{}'::jsonb NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    requested_by uuid,
    requested_by uuid,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    started_at timestamp with time zone,
    started_at timestamp with time zone,
    completed_at timestamp with time zone,
    completed_at timestamp with time zone,
    result_json jsonb,
    result_json jsonb,
    error_text text,
    error_text text,
    CONSTRAINT ai_task_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'RUNNING'::text, 'DONE'::text, 'FAILED'::text, 'CANCELLED'::text])))
    CONSTRAINT ai_task_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'RUNNING'::text, 'DONE'::text, 'FAILED'::text, 'CANCELLED'::text])))
);
);




--
--
-- Name: ai_task_run; Type: TABLE; Schema: system; Owner: -
-- Name: ai_task_run; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.ai_task_run (
CREATE TABLE system.ai_task_run (
    run_id bigint NOT NULL,
    run_id bigint NOT NULL,
    task_id bigint NOT NULL,
    task_id bigint NOT NULL,
    run_status text NOT NULL,
    run_status text NOT NULL,
    note text,
    note text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT ai_task_run_run_status_check CHECK ((run_status = ANY (ARRAY['START'::text, 'DONE'::text, 'FAIL'::text])))
    CONSTRAINT ai_task_run_run_status_check CHECK ((run_status = ANY (ARRAY['START'::text, 'DONE'::text, 'FAIL'::text])))
);
);




--
--
-- Name: ai_task_run_run_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: ai_task_run_run_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.ai_task_run_run_id_seq
CREATE SEQUENCE system.ai_task_run_run_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ai_task_run_run_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: ai_task_run_run_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.ai_task_run_run_id_seq OWNED BY system.ai_task_run.run_id;
ALTER SEQUENCE system.ai_task_run_run_id_seq OWNED BY system.ai_task_run.run_id;




--
--
-- Name: ai_task_task_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: ai_task_task_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.ai_task_task_id_seq
CREATE SEQUENCE system.ai_task_task_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: ai_task_task_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: ai_task_task_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.ai_task_task_id_seq OWNED BY system.ai_task.task_id;
ALTER SEQUENCE system.ai_task_task_id_seq OWNED BY system.ai_task.task_id;




--
--
-- Name: approval_action_log; Type: TABLE; Schema: system; Owner: -
-- Name: approval_action_log; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.approval_action_log (
CREATE TABLE system.approval_action_log (
    approval_action_id bigint NOT NULL,
    approval_action_id bigint NOT NULL,
    approval_request_id bigint,
    approval_request_id bigint,
    step_no integer NOT NULL,
    step_no integer NOT NULL,
    action text NOT NULL,
    action text NOT NULL,
    action_by uuid,
    action_by uuid,
    action_at timestamp with time zone DEFAULT now() NOT NULL,
    action_at timestamp with time zone DEFAULT now() NOT NULL,
    comment text,
    comment text,
    CONSTRAINT approval_action_log_action_check CHECK ((action = ANY (ARRAY['APPROVE'::text, 'REJECT'::text, 'RETURN'::text])))
    CONSTRAINT approval_action_log_action_check CHECK ((action = ANY (ARRAY['APPROVE'::text, 'REJECT'::text, 'RETURN'::text])))
);
);




--
--
-- Name: approval_action_log_approval_action_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: approval_action_log_approval_action_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.approval_action_log_approval_action_id_seq
CREATE SEQUENCE system.approval_action_log_approval_action_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: approval_action_log_approval_action_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: approval_action_log_approval_action_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.approval_action_log_approval_action_id_seq OWNED BY system.approval_action_log.approval_action_id;
ALTER SEQUENCE system.approval_action_log_approval_action_id_seq OWNED BY system.approval_action_log.approval_action_id;




--
--
-- Name: approval_exec_map; Type: TABLE; Schema: system; Owner: -
-- Name: approval_exec_map; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.approval_exec_map (
CREATE TABLE system.approval_exec_map (
    approval_flow_code text NOT NULL,
    approval_flow_code text NOT NULL,
    command_code text NOT NULL,
    command_code text NOT NULL,
    worker_tag text
    worker_tag text
);
);




--
--
-- Name: approval_finalize_rule; Type: TABLE; Schema: system; Owner: -
-- Name: approval_finalize_rule; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.approval_finalize_rule (
CREATE TABLE system.approval_finalize_rule (
    function_code text NOT NULL,
    function_code text NOT NULL,
    finalize_status text NOT NULL
    finalize_status text NOT NULL
);
);




--
--
-- Name: approval_flow_def; Type: TABLE; Schema: system; Owner: -
-- Name: approval_flow_def; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.approval_flow_def (
CREATE TABLE system.approval_flow_def (
    approval_flow_code text NOT NULL,
    approval_flow_code text NOT NULL,
    module_code text NOT NULL,
    module_code text NOT NULL,
    function_code text NOT NULL,
    function_code text NOT NULL,
    flow_name text NOT NULL,
    flow_name text NOT NULL,
    allow_direct boolean DEFAULT false NOT NULL,
    allow_direct boolean DEFAULT false NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: approval_request; Type: TABLE; Schema: system; Owner: -
-- Name: approval_request; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.approval_request (
CREATE TABLE system.approval_request (
    approval_request_id bigint NOT NULL,
    approval_request_id bigint NOT NULL,
    approval_flow_code text NOT NULL,
    approval_flow_code text NOT NULL,
    function_code text NOT NULL,
    function_code text NOT NULL,
    business_table text NOT NULL,
    business_table text NOT NULL,
    business_id bigint NOT NULL,
    business_id bigint NOT NULL,
    current_step integer DEFAULT 1 NOT NULL,
    current_step integer DEFAULT 1 NOT NULL,
    approval_status text NOT NULL,
    approval_status text NOT NULL,
    requested_by uuid,
    requested_by uuid,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    approved_at timestamp with time zone,
    approved_at timestamp with time zone,
    CONSTRAINT approval_request_approval_status_check CHECK ((approval_status = ANY (ARRAY['REQUESTED'::text, 'APPROVED'::text, 'REJECTED'::text])))
    CONSTRAINT approval_request_approval_status_check CHECK ((approval_status = ANY (ARRAY['REQUESTED'::text, 'APPROVED'::text, 'REJECTED'::text])))
);
);




--
--
-- Name: approval_request_approval_request_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: approval_request_approval_request_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.approval_request_approval_request_id_seq
CREATE SEQUENCE system.approval_request_approval_request_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: approval_request_approval_request_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: approval_request_approval_request_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.approval_request_approval_request_id_seq OWNED BY system.approval_request.approval_request_id;
ALTER SEQUENCE system.approval_request_approval_request_id_seq OWNED BY system.approval_request.approval_request_id;




--
--
-- Name: approval_step_def; Type: TABLE; Schema: system; Owner: -
-- Name: approval_step_def; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.approval_step_def (
CREATE TABLE system.approval_step_def (
    approval_flow_code text NOT NULL,
    approval_flow_code text NOT NULL,
    step_no integer NOT NULL,
    step_no integer NOT NULL,
    step_name text NOT NULL
    step_name text NOT NULL
);
);




--
--
-- Name: business_finalize_event; Type: TABLE; Schema: system; Owner: -
-- Name: business_finalize_event; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.business_finalize_event (
CREATE TABLE system.business_finalize_event (
    function_code text NOT NULL,
    function_code text NOT NULL,
    requires_approval boolean NOT NULL,
    requires_approval boolean NOT NULL,
    generates_document boolean NOT NULL,
    generates_document boolean NOT NULL,
    sends_document boolean NOT NULL
    sends_document boolean NOT NULL
);
);




--
--
-- Name: business_ops_map; Type: TABLE; Schema: system; Owner: -
-- Name: business_ops_map; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.business_ops_map (
CREATE TABLE system.business_ops_map (
    function_code text NOT NULL,
    function_code text NOT NULL,
    document_type_code text NOT NULL,
    document_type_code text NOT NULL,
    generate_pdf boolean DEFAULT true NOT NULL,
    generate_pdf boolean DEFAULT true NOT NULL,
    auto_send boolean DEFAULT true NOT NULL
    auto_send boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: db_session; Type: TABLE; Schema: system; Owner: -
-- Name: db_session; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.db_session (
CREATE TABLE system.db_session (
    session_id uuid DEFAULT gen_random_uuid() NOT NULL,
    session_id uuid DEFAULT gen_random_uuid() NOT NULL,
    user_id uuid NOT NULL,
    user_id uuid NOT NULL,
    started_at timestamp with time zone DEFAULT now() NOT NULL,
    started_at timestamp with time zone DEFAULT now() NOT NULL,
    ended_at timestamp with time zone,
    ended_at timestamp with time zone,
    client_info text,
    client_info text,
    started_by uuid,
    started_by uuid,
    ended_by uuid
    ended_by uuid
);
);




--
--
-- Name: exec_command; Type: TABLE; Schema: system; Owner: -
-- Name: exec_command; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.exec_command (
CREATE TABLE system.exec_command (
    command_code text NOT NULL,
    command_code text NOT NULL,
    description text DEFAULT ''::text NOT NULL,
    description text DEFAULT ''::text NOT NULL,
    command_text text NOT NULL,
    command_text text NOT NULL,
    run_as text DEFAULT 'termux'::text NOT NULL,
    run_as text DEFAULT 'termux'::text NOT NULL,
    requires_approval boolean DEFAULT true NOT NULL,
    requires_approval boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_by uuid,
    created_by uuid,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    command_kind text DEFAULT 'SHELL'::text NOT NULL,
    command_kind text DEFAULT 'SHELL'::text NOT NULL,
    template_vars jsonb DEFAULT '{}'::jsonb NOT NULL,
    template_vars jsonb DEFAULT '{}'::jsonb NOT NULL,
    CONSTRAINT exec_command_command_kind_check CHECK ((command_kind = ANY (ARRAY['SHELL'::text, 'SQL'::text, 'PYTHON'::text, 'HTTP'::text, 'INTERNAL'::text])))
    CONSTRAINT exec_command_command_kind_check CHECK ((command_kind = ANY (ARRAY['SHELL'::text, 'SQL'::text, 'PYTHON'::text, 'HTTP'::text, 'INTERNAL'::text])))
);
);




--
--
-- Name: exec_run_request; Type: TABLE; Schema: system; Owner: -
-- Name: exec_run_request; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.exec_run_request (
CREATE TABLE system.exec_run_request (
    request_id bigint NOT NULL,
    request_id bigint NOT NULL,
    command_code text NOT NULL,
    command_code text NOT NULL,
    args_json jsonb DEFAULT '{}'::jsonb NOT NULL,
    args_json jsonb DEFAULT '{}'::jsonb NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    priority integer DEFAULT 100 NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    status text DEFAULT 'PENDING'::text NOT NULL,
    requested_by uuid,
    requested_by uuid,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    requested_at timestamp with time zone DEFAULT now() NOT NULL,
    picked_by uuid,
    picked_by uuid,
    picked_at timestamp with time zone,
    picked_at timestamp with time zone,
    completed_at timestamp with time zone,
    completed_at timestamp with time zone,
    exit_code integer,
    exit_code integer,
    stdout_text text,
    stdout_text text,
    stderr_text text,
    stderr_text text,
    rendered_command text,
    rendered_command text,
    worker_tag text,
    worker_tag text,
    CONSTRAINT exec_run_request_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'RUNNING'::text, 'DONE'::text, 'FAILED'::text, 'CANCELLED'::text])))
    CONSTRAINT exec_run_request_status_check CHECK ((status = ANY (ARRAY['PENDING'::text, 'RUNNING'::text, 'DONE'::text, 'FAILED'::text, 'CANCELLED'::text])))
);
);




--
--
-- Name: exec_run_request_request_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: exec_run_request_request_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.exec_run_request_request_id_seq
CREATE SEQUENCE system.exec_run_request_request_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: exec_run_request_request_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: exec_run_request_request_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.exec_run_request_request_id_seq OWNED BY system.exec_run_request.request_id;
ALTER SEQUENCE system.exec_run_request_request_id_seq OWNED BY system.exec_run_request.request_id;




--
--
-- Name: function_def; Type: TABLE; Schema: system; Owner: -
-- Name: function_def; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.function_def (
CREATE TABLE system.function_def (
    function_code text NOT NULL,
    function_code text NOT NULL,
    module_code text NOT NULL,
    module_code text NOT NULL,
    function_name text NOT NULL,
    function_name text NOT NULL,
    requires_approval boolean DEFAULT true NOT NULL,
    requires_approval boolean DEFAULT true NOT NULL,
    allow_direct boolean DEFAULT false NOT NULL
    allow_direct boolean DEFAULT false NOT NULL
);
);




--
--
-- Name: loop_autotune_rule; Type: TABLE; Schema: system; Owner: -
-- Name: loop_autotune_rule; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.loop_autotune_rule (
CREATE TABLE system.loop_autotune_rule (
    rule_id bigint NOT NULL,
    rule_id bigint NOT NULL,
    loop_code text NOT NULL,
    loop_code text NOT NULL,
    fail_ratio_threshold numeric DEFAULT 0.20 NOT NULL,
    fail_ratio_threshold numeric DEFAULT 0.20 NOT NULL,
    interval_min_sec integer DEFAULT 10 NOT NULL,
    interval_min_sec integer DEFAULT 10 NOT NULL,
    interval_max_sec integer DEFAULT 600 NOT NULL,
    interval_max_sec integer DEFAULT 600 NOT NULL,
    step_up_sec integer DEFAULT 10 NOT NULL,
    step_up_sec integer DEFAULT 10 NOT NULL,
    step_down_sec integer DEFAULT 5 NOT NULL,
    step_down_sec integer DEFAULT 5 NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: loop_autotune_rule_rule_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: loop_autotune_rule_rule_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.loop_autotune_rule_rule_id_seq
CREATE SEQUENCE system.loop_autotune_rule_rule_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: loop_autotune_rule_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: loop_autotune_rule_rule_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.loop_autotune_rule_rule_id_seq OWNED BY system.loop_autotune_rule.rule_id;
ALTER SEQUENCE system.loop_autotune_rule_rule_id_seq OWNED BY system.loop_autotune_rule.rule_id;




--
--
-- Name: loop_config; Type: TABLE; Schema: system; Owner: -
-- Name: loop_config; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.loop_config (
CREATE TABLE system.loop_config (
    loop_code text NOT NULL,
    loop_code text NOT NULL,
    command_code text NOT NULL,
    command_code text NOT NULL,
    interval_sec integer DEFAULT 60 NOT NULL,
    interval_sec integer DEFAULT 60 NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    jitter_sec integer DEFAULT 0 NOT NULL,
    jitter_sec integer DEFAULT 0 NOT NULL,
    last_run_at timestamp with time zone,
    last_run_at timestamp with time zone,
    next_run_at timestamp with time zone,
    next_run_at timestamp with time zone,
    note text,
    note text,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: loop_sla_stat; Type: TABLE; Schema: system; Owner: -
-- Name: loop_sla_stat; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.loop_sla_stat (
CREATE TABLE system.loop_sla_stat (
    stat_id bigint NOT NULL,
    stat_id bigint NOT NULL,
    loop_code text NOT NULL,
    loop_code text NOT NULL,
    window_start timestamp with time zone NOT NULL,
    window_start timestamp with time zone NOT NULL,
    window_end timestamp with time zone NOT NULL,
    window_end timestamp with time zone NOT NULL,
    tick_count integer NOT NULL,
    tick_count integer NOT NULL,
    fail_count integer NOT NULL,
    fail_count integer NOT NULL,
    computed_at timestamp with time zone DEFAULT now() NOT NULL
    computed_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: loop_sla_stat_stat_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: loop_sla_stat_stat_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.loop_sla_stat_stat_id_seq
CREATE SEQUENCE system.loop_sla_stat_stat_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: loop_sla_stat_stat_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: loop_sla_stat_stat_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.loop_sla_stat_stat_id_seq OWNED BY system.loop_sla_stat.stat_id;
ALTER SEQUENCE system.loop_sla_stat_stat_id_seq OWNED BY system.loop_sla_stat.stat_id;




--
--
-- Name: loop_tick_log; Type: TABLE; Schema: system; Owner: -
-- Name: loop_tick_log; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.loop_tick_log (
CREATE TABLE system.loop_tick_log (
    tick_id bigint NOT NULL,
    tick_id bigint NOT NULL,
    loop_code text NOT NULL,
    loop_code text NOT NULL,
    tick_status text NOT NULL,
    tick_status text NOT NULL,
    note text,
    note text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT loop_tick_log_tick_status_check CHECK ((tick_status = ANY (ARRAY['START'::text, 'DONE'::text, 'SKIP'::text, 'FAIL'::text])))
    CONSTRAINT loop_tick_log_tick_status_check CHECK ((tick_status = ANY (ARRAY['START'::text, 'DONE'::text, 'SKIP'::text, 'FAIL'::text])))
);
);




--
--
-- Name: loop_tick_log_tick_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: loop_tick_log_tick_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.loop_tick_log_tick_id_seq
CREATE SEQUENCE system.loop_tick_log_tick_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: loop_tick_log_tick_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: loop_tick_log_tick_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.loop_tick_log_tick_id_seq OWNED BY system.loop_tick_log.tick_id;
ALTER SEQUENCE system.loop_tick_log_tick_id_seq OWNED BY system.loop_tick_log.tick_id;




--
--
-- Name: module_def; Type: TABLE; Schema: system; Owner: -
-- Name: module_def; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.module_def (
CREATE TABLE system.module_def (
    module_code text NOT NULL,
    module_code text NOT NULL,
    module_name text NOT NULL,
    module_name text NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: notification_endpoint; Type: TABLE; Schema: system; Owner: -
-- Name: notification_endpoint; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.notification_endpoint (
CREATE TABLE system.notification_endpoint (
    endpoint_code text NOT NULL,
    endpoint_code text NOT NULL,
    channel_type text NOT NULL,
    channel_type text NOT NULL,
    destination text NOT NULL,
    destination text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT notification_endpoint_channel_type_check CHECK ((channel_type = ANY (ARRAY['WEBHOOK'::text, 'SLACK'::text, 'LINE'::text])))
    CONSTRAINT notification_endpoint_channel_type_check CHECK ((channel_type = ANY (ARRAY['WEBHOOK'::text, 'SLACK'::text, 'LINE'::text])))
);
);




--
--
-- Name: notification_subscription; Type: TABLE; Schema: system; Owner: -
-- Name: notification_subscription; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.notification_subscription (
CREATE TABLE system.notification_subscription (
    event_type text NOT NULL,
    event_type text NOT NULL,
    endpoint_code text NOT NULL,
    endpoint_code text NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: operation_log; Type: TABLE; Schema: system; Owner: -
-- Name: operation_log; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.operation_log (
CREATE TABLE system.operation_log (
    operation_log_id bigint NOT NULL,
    operation_log_id bigint NOT NULL,
    session_id uuid,
    session_id uuid,
    role_code text,
    role_code text,
    module_code text NOT NULL,
    module_code text NOT NULL,
    function_code text NOT NULL,
    function_code text NOT NULL,
    screen_code text,
    screen_code text,
    operation_type text NOT NULL,
    operation_type text NOT NULL,
    target_table text,
    target_table text,
    target_id text,
    target_id text,
    operation_status text NOT NULL,
    operation_status text NOT NULL,
    operated_by uuid,
    operated_by uuid,
    operated_at timestamp with time zone DEFAULT now() NOT NULL,
    operated_at timestamp with time zone DEFAULT now() NOT NULL,
    error_message text,
    error_message text,
    CONSTRAINT operation_log_operation_status_check CHECK ((operation_status = ANY (ARRAY['SUCCESS'::text, 'FAILED'::text])))
    CONSTRAINT operation_log_operation_status_check CHECK ((operation_status = ANY (ARRAY['SUCCESS'::text, 'FAILED'::text])))
);
);




--
--
-- Name: operation_log_operation_log_id_seq; Type: SEQUENCE; Schema: system; Owner: -
-- Name: operation_log_operation_log_id_seq; Type: SEQUENCE; Schema: system; Owner: -
--
--


CREATE SEQUENCE system.operation_log_operation_log_id_seq
CREATE SEQUENCE system.operation_log_operation_log_id_seq
    START WITH 1
    START WITH 1
    INCREMENT BY 1
    INCREMENT BY 1
    NO MINVALUE
    NO MINVALUE
    NO MAXVALUE
    NO MAXVALUE
    CACHE 1;
    CACHE 1;




--
--
-- Name: operation_log_operation_log_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
-- Name: operation_log_operation_log_id_seq; Type: SEQUENCE OWNED BY; Schema: system; Owner: -
--
--


ALTER SEQUENCE system.operation_log_operation_log_id_seq OWNED BY system.operation_log.operation_log_id;
ALTER SEQUENCE system.operation_log_operation_log_id_seq OWNED BY system.operation_log.operation_log_id;




--
--
-- Name: operation_type_def; Type: TABLE; Schema: system; Owner: -
-- Name: operation_type_def; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.operation_type_def (
CREATE TABLE system.operation_type_def (
    operation_type text NOT NULL,
    operation_type text NOT NULL,
    operation_name text NOT NULL
    operation_name text NOT NULL
);
);




--
--
-- Name: role_def; Type: TABLE; Schema: system; Owner: -
-- Name: role_def; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.role_def (
CREATE TABLE system.role_def (
    role_code text NOT NULL,
    role_code text NOT NULL,
    role_name text NOT NULL,
    role_name text NOT NULL,
    is_active boolean DEFAULT true NOT NULL
    is_active boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: role_screen_permission; Type: TABLE; Schema: system; Owner: -
-- Name: role_screen_permission; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.role_screen_permission (
CREATE TABLE system.role_screen_permission (
    role_code text NOT NULL,
    role_code text NOT NULL,
    screen_code text NOT NULL,
    screen_code text NOT NULL,
    can_view boolean DEFAULT false NOT NULL,
    can_view boolean DEFAULT false NOT NULL,
    can_edit boolean DEFAULT false NOT NULL,
    can_edit boolean DEFAULT false NOT NULL,
    can_approve boolean DEFAULT false NOT NULL,
    can_approve boolean DEFAULT false NOT NULL,
    can_final boolean DEFAULT false NOT NULL
    can_final boolean DEFAULT false NOT NULL
);
);




--
--
-- Name: runtime_killswitch; Type: TABLE; Schema: system; Owner: -
-- Name: runtime_killswitch; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.runtime_killswitch (
CREATE TABLE system.runtime_killswitch (
    key text NOT NULL,
    key text NOT NULL,
    is_enabled boolean DEFAULT false NOT NULL,
    is_enabled boolean DEFAULT false NOT NULL,
    reason text,
    reason text,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: screen_action_map; Type: TABLE; Schema: system; Owner: -
-- Name: screen_action_map; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.screen_action_map (
CREATE TABLE system.screen_action_map (
    screen_code text NOT NULL,
    screen_code text NOT NULL,
    action_code text NOT NULL,
    action_code text NOT NULL,
    target_table text NOT NULL,
    target_table text NOT NULL,
    requires_confirmation boolean DEFAULT true NOT NULL,
    requires_confirmation boolean DEFAULT true NOT NULL,
    requires_approval boolean DEFAULT true NOT NULL
    requires_approval boolean DEFAULT true NOT NULL
);
);




--
--
-- Name: screen_master; Type: TABLE; Schema: system; Owner: -
-- Name: screen_master; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.screen_master (
CREATE TABLE system.screen_master (
    screen_code text NOT NULL,
    screen_code text NOT NULL,
    module_code text NOT NULL,
    module_code text NOT NULL,
    function_code text NOT NULL,
    function_code text NOT NULL,
    screen_name text NOT NULL,
    screen_name text NOT NULL,
    screen_type text NOT NULL,
    screen_type text NOT NULL,
    sort_order integer NOT NULL,
    sort_order integer NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: screen_rule; Type: TABLE; Schema: system; Owner: -
-- Name: screen_rule; Type: TABLE; Schema: system; Owner: -
--
--


CREATE TABLE system.screen_rule (
CREATE TABLE system.screen_rule (
    screen_type text NOT NULL,
    screen_type text NOT NULL,
    sort_order integer NOT NULL
    sort_order integer NOT NULL
);
);




--
--
-- Name: v_business_ops_pipeline; Type: VIEW; Schema: system; Owner: -
-- Name: v_business_ops_pipeline; Type: VIEW; Schema: system; Owner: -
--
--


CREATE VIEW system.v_business_ops_pipeline AS
CREATE VIEW system.v_business_ops_pipeline AS
 SELECT b.function_code,
 SELECT b.function_code,
    b.generates_document,
    b.generates_document,
    b.sends_document,
    b.sends_document,
    o.document_type_code,
    o.document_type_code,
    o.generate_pdf,
    o.generate_pdf,
    o.auto_send
    o.auto_send
   FROM (system.business_finalize_event b
   FROM (system.business_finalize_event b
     LEFT JOIN system.business_ops_map o ON ((b.function_code = o.function_code)));
     LEFT JOIN system.business_ops_map o ON ((b.function_code = o.function_code)));




--
--
-- Name: v_business_ops_ready; Type: VIEW; Schema: system; Owner: -
-- Name: v_business_ops_ready; Type: VIEW; Schema: system; Owner: -
--
--


CREATE VIEW system.v_business_ops_ready AS
CREATE VIEW system.v_business_ops_ready AS
 SELECT b.function_code,
 SELECT b.function_code,
    b.document_type_code,
    b.document_type_code,
    d.document_type_name,
    d.document_type_name,
    b.generate_pdf,
    b.generate_pdf,
    b.auto_send
    b.auto_send
   FROM (system.business_ops_map b
   FROM (system.business_ops_map b
     JOIN ops.document_type_master d ON ((d.document_type_code = b.document_type_code)));
     JOIN ops.document_type_master d ON ((d.document_type_code = b.document_type_code)));




--
--
-- Name: v_exec_commands; Type: VIEW; Schema: system; Owner: -
-- Name: v_exec_commands; Type: VIEW; Schema: system; Owner: -
--
--


CREATE VIEW system.v_exec_commands AS
CREATE VIEW system.v_exec_commands AS
 SELECT command_code,
 SELECT command_code,
    description,
    description,
    run_as,
    run_as,
    requires_approval,
    requires_approval,
    is_active,
    is_active,
    updated_at
    updated_at
   FROM system.exec_command c;
   FROM system.exec_command c;




--
--
-- Name: v_exec_run_recent; Type: VIEW; Schema: system; Owner: -
-- Name: v_exec_run_recent; Type: VIEW; Schema: system; Owner: -
--
--


CREATE VIEW system.v_exec_run_recent AS
CREATE VIEW system.v_exec_run_recent AS
 SELECT request_id,
 SELECT request_id,
    command_code,
    command_code,
    status,
    status,
    priority,
    priority,
    requested_at,
    requested_at,
    picked_at,
    picked_at,
    completed_at,
    completed_at,
    exit_code,
    exit_code,
    "left"(COALESCE(stdout_text, ''::text), 200) AS stdout_head,
    "left"(COALESCE(stdout_text, ''::text), 200) AS stdout_head,
    "left"(COALESCE(stderr_text, ''::text), 200) AS stderr_head
    "left"(COALESCE(stderr_text, ''::text), 200) AS stderr_head
   FROM system.exec_run_request r
   FROM system.exec_run_request r
  ORDER BY requested_at DESC;
  ORDER BY requested_at DESC;




--
--
-- Name: v_loop_configs; Type: VIEW; Schema: system; Owner: -
-- Name: v_loop_configs; Type: VIEW; Schema: system; Owner: -
--
--


CREATE VIEW system.v_loop_configs AS
CREATE VIEW system.v_loop_configs AS
 SELECT loop_code,
 SELECT loop_code,
    command_code,
    command_code,
    interval_sec,
    interval_sec,
    jitter_sec,
    jitter_sec,
    is_enabled,
    is_enabled,
    last_run_at,
    last_run_at,
    next_run_at,
    next_run_at,
    updated_at
    updated_at
   FROM system.loop_config lc;
   FROM system.loop_config lc;




--
--
-- Name: v_operation_log_audit; Type: VIEW; Schema: system; Owner: -
-- Name: v_operation_log_audit; Type: VIEW; Schema: system; Owner: -
--
--


CREATE VIEW system.v_operation_log_audit AS
CREATE VIEW system.v_operation_log_audit AS
 SELECT o.operated_at,
 SELECT o.operated_at,
    r.role_name,
    r.role_name,
    o.module_code,
    o.module_code,
    o.function_code,
    o.function_code,
    s.screen_name,
    s.screen_name,
    o.operation_type,
    o.operation_type,
    o.target_table,
    o.target_table,
    o.target_id,
    o.target_id,
    o.operation_status,
    o.operation_status,
    o.error_message,
    o.error_message,
    o.operated_by
    o.operated_by
   FROM ((system.operation_log o
   FROM ((system.operation_log o
     LEFT JOIN system.role_def r ON ((r.role_code = o.role_code)))
     LEFT JOIN system.role_def r ON ((r.role_code = o.role_code)))
     LEFT JOIN system.screen_master s ON ((s.screen_code = o.screen_code)))
     LEFT JOIN system.screen_master s ON ((s.screen_code = o.screen_code)))
  ORDER BY o.operated_at DESC;
  ORDER BY o.operated_at DESC;




--
--
-- Name: company_license; Type: TABLE; Schema: tenant; Owner: -
-- Name: company_license; Type: TABLE; Schema: tenant; Owner: -
--
--


CREATE TABLE tenant.company_license (
CREATE TABLE tenant.company_license (
    company_id uuid NOT NULL,
    company_id uuid NOT NULL,
    license_code text NOT NULL,
    license_code text NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    is_enabled boolean DEFAULT true NOT NULL,
    granted_at timestamp with time zone DEFAULT now() NOT NULL
    granted_at timestamp with time zone DEFAULT now() NOT NULL
);
);




--
--
-- Name: license_master; Type: TABLE; Schema: tenant; Owner: -
-- Name: license_master; Type: TABLE; Schema: tenant; Owner: -
--
--


CREATE TABLE tenant.license_master (
CREATE TABLE tenant.license_master (
    license_code text NOT NULL,
    license_code text NOT NULL,
    description text NOT NULL,
    description text NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    company_id uuid
    company_id uuid
);
);




--
--
-- Name: audit_trail_2025_12; Type: TABLE ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2025_12; Type: TABLE ATTACH; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2025_12 FOR VALUES FROM ('2025-12-01 00:00:00+00') TO ('2026-01-01 00:00:00+00');
ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2025_12 FOR VALUES FROM ('2025-12-01 00:00:00+00') TO ('2026-01-01 00:00:00+00');




--
--
-- Name: audit_trail_2026_01; Type: TABLE ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_01; Type: TABLE ATTACH; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_01 FOR VALUES FROM ('2026-01-01 00:00:00+00') TO ('2026-02-01 00:00:00+00');
ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_01 FOR VALUES FROM ('2026-01-01 00:00:00+00') TO ('2026-02-01 00:00:00+00');




--
--
-- Name: audit_trail_2026_02; Type: TABLE ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_02; Type: TABLE ATTACH; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_02 FOR VALUES FROM ('2026-02-01 00:00:00+00') TO ('2026-03-01 00:00:00+00');
ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_02 FOR VALUES FROM ('2026-02-01 00:00:00+00') TO ('2026-03-01 00:00:00+00');




--
--
-- Name: audit_trail_2026_03; Type: TABLE ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_03; Type: TABLE ATTACH; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_03 FOR VALUES FROM ('2026-03-01 00:00:00+00') TO ('2026-04-01 00:00:00+00');
ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_03 FOR VALUES FROM ('2026-03-01 00:00:00+00') TO ('2026-04-01 00:00:00+00');




--
--
-- Name: audit_trail_2026_04; Type: TABLE ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_04; Type: TABLE ATTACH; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_04 FOR VALUES FROM ('2026-04-01 00:00:00+00') TO ('2026-05-01 00:00:00+00');
ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_04 FOR VALUES FROM ('2026-04-01 00:00:00+00') TO ('2026-05-01 00:00:00+00');




--
--
-- Name: audit_trail_2026_05; Type: TABLE ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_05; Type: TABLE ATTACH; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_05 FOR VALUES FROM ('2026-05-01 00:00:00+00') TO ('2026-06-01 00:00:00+00');
ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_05 FOR VALUES FROM ('2026-05-01 00:00:00+00') TO ('2026-06-01 00:00:00+00');




--
--
-- Name: audit_trail_2026_06; Type: TABLE ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_06; Type: TABLE ATTACH; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_06 FOR VALUES FROM ('2026-06-01 00:00:00+00') TO ('2026-07-01 00:00:00+00');
ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_06 FOR VALUES FROM ('2026-06-01 00:00:00+00') TO ('2026-07-01 00:00:00+00');




--
--
-- Name: audit_trail_2026_07; Type: TABLE ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_07; Type: TABLE ATTACH; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_07 FOR VALUES FROM ('2026-07-01 00:00:00+00') TO ('2026-08-01 00:00:00+00');
ALTER TABLE ONLY core.audit_trail ATTACH PARTITION core.audit_trail_2026_07 FOR VALUES FROM ('2026-07-01 00:00:00+00') TO ('2026-08-01 00:00:00+00');




--
--
-- Name: paper_send_fee_journal journal_id; Type: DEFAULT; Schema: accounting; Owner: -
-- Name: paper_send_fee_journal journal_id; Type: DEFAULT; Schema: accounting; Owner: -
--
--


ALTER TABLE ONLY accounting.paper_send_fee_journal ALTER COLUMN journal_id SET DEFAULT nextval('accounting.paper_send_fee_journal_journal_id_seq'::regclass);
ALTER TABLE ONLY accounting.paper_send_fee_journal ALTER COLUMN journal_id SET DEFAULT nextval('accounting.paper_send_fee_journal_journal_id_seq'::regclass);




--
--
-- Name: ai_event ai_event_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: ai_event ai_event_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_event ALTER COLUMN ai_event_id SET DEFAULT nextval('analytics.ai_event_ai_event_id_seq'::regclass);
ALTER TABLE ONLY analytics.ai_event ALTER COLUMN ai_event_id SET DEFAULT nextval('analytics.ai_event_ai_event_id_seq'::regclass);




--
--
-- Name: ai_job ai_job_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: ai_job ai_job_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_job ALTER COLUMN ai_job_id SET DEFAULT nextval('analytics.ai_job_ai_job_id_seq'::regclass);
ALTER TABLE ONLY analytics.ai_job ALTER COLUMN ai_job_id SET DEFAULT nextval('analytics.ai_job_ai_job_id_seq'::regclass);




--
--
-- Name: audit_ai_feedback feedback_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: audit_ai_feedback feedback_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_feedback ALTER COLUMN feedback_id SET DEFAULT nextval('analytics.audit_ai_feedback_feedback_id_seq'::regclass);
ALTER TABLE ONLY analytics.audit_ai_feedback ALTER COLUMN feedback_id SET DEFAULT nextval('analytics.audit_ai_feedback_feedback_id_seq'::regclass);




--
--
-- Name: audit_ai_job job_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: audit_ai_job job_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_job ALTER COLUMN job_id SET DEFAULT nextval('analytics.audit_ai_job_job_id_seq'::regclass);
ALTER TABLE ONLY analytics.audit_ai_job ALTER COLUMN job_id SET DEFAULT nextval('analytics.audit_ai_job_job_id_seq'::regclass);




--
--
-- Name: audit_ai_llm_result llm_result_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: audit_ai_llm_result llm_result_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_llm_result ALTER COLUMN llm_result_id SET DEFAULT nextval('analytics.audit_ai_llm_result_llm_result_id_seq'::regclass);
ALTER TABLE ONLY analytics.audit_ai_llm_result ALTER COLUMN llm_result_id SET DEFAULT nextval('analytics.audit_ai_llm_result_llm_result_id_seq'::regclass);




--
--
-- Name: audit_alert_ai_judgement judgement_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement judgement_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_ai_judgement ALTER COLUMN judgement_id SET DEFAULT nextval('analytics.audit_alert_ai_judgement_judgement_id_seq'::regclass);
ALTER TABLE ONLY analytics.audit_alert_ai_judgement ALTER COLUMN judgement_id SET DEFAULT nextval('analytics.audit_alert_ai_judgement_judgement_id_seq'::regclass);




--
--
-- Name: audit_alert_event alert_event_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: audit_alert_event alert_event_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_event ALTER COLUMN alert_event_id SET DEFAULT nextval('analytics.audit_alert_event_alert_event_id_seq'::regclass);
ALTER TABLE ONLY analytics.audit_alert_event ALTER COLUMN alert_event_id SET DEFAULT nextval('analytics.audit_alert_event_alert_event_id_seq'::regclass);




--
--
-- Name: audit_alert_notification notification_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: audit_alert_notification notification_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_notification ALTER COLUMN notification_id SET DEFAULT nextval('analytics.audit_alert_notification_notification_id_seq'::regclass);
ALTER TABLE ONLY analytics.audit_alert_notification ALTER COLUMN notification_id SET DEFAULT nextval('analytics.audit_alert_notification_notification_id_seq'::regclass);




--
--
-- Name: audit_alert_rule rule_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: audit_alert_rule rule_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_rule ALTER COLUMN rule_id SET DEFAULT nextval('analytics.audit_alert_rule_rule_id_seq'::regclass);
ALTER TABLE ONLY analytics.audit_alert_rule ALTER COLUMN rule_id SET DEFAULT nextval('analytics.audit_alert_rule_rule_id_seq'::regclass);




--
--
-- Name: fact_metric fact_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: fact_metric fact_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.fact_metric ALTER COLUMN fact_id SET DEFAULT nextval('analytics.fact_metric_fact_id_seq'::regclass);
ALTER TABLE ONLY analytics.fact_metric ALTER COLUMN fact_id SET DEFAULT nextval('analytics.fact_metric_fact_id_seq'::regclass);




--
--
-- Name: notification_queue notification_id; Type: DEFAULT; Schema: analytics; Owner: -
-- Name: notification_queue notification_id; Type: DEFAULT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.notification_queue ALTER COLUMN notification_id SET DEFAULT nextval('analytics.notification_queue_notification_id_seq'::regclass);
ALTER TABLE ONLY analytics.notification_queue ALTER COLUMN notification_id SET DEFAULT nextval('analytics.notification_queue_notification_id_seq'::regclass);




--
--
-- Name: audit_event audit_event_id; Type: DEFAULT; Schema: audit; Owner: -
-- Name: audit_event audit_event_id; Type: DEFAULT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.audit_event ALTER COLUMN audit_event_id SET DEFAULT nextval('audit.audit_event_audit_event_id_seq'::regclass);
ALTER TABLE ONLY audit.audit_event ALTER COLUMN audit_event_id SET DEFAULT nextval('audit.audit_event_audit_event_id_seq'::regclass);




--
--
-- Name: audit_trail_db audit_trail_db_id; Type: DEFAULT; Schema: audit; Owner: -
-- Name: audit_trail_db audit_trail_db_id; Type: DEFAULT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.audit_trail_db ALTER COLUMN audit_trail_db_id SET DEFAULT nextval('audit.audit_trail_db_audit_trail_db_id_seq'::regclass);
ALTER TABLE ONLY audit.audit_trail_db ALTER COLUMN audit_trail_db_id SET DEFAULT nextval('audit.audit_trail_db_audit_trail_db_id_seq'::regclass);




--
--
-- Name: entity_status_history status_history_id; Type: DEFAULT; Schema: audit; Owner: -
-- Name: entity_status_history status_history_id; Type: DEFAULT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.entity_status_history ALTER COLUMN status_history_id SET DEFAULT nextval('audit.entity_status_history_status_history_id_seq'::regclass);
ALTER TABLE ONLY audit.entity_status_history ALTER COLUMN status_history_id SET DEFAULT nextval('audit.entity_status_history_status_history_id_seq'::regclass);




--
--
-- Name: exec_audit_event audit_event_id; Type: DEFAULT; Schema: audit; Owner: -
-- Name: exec_audit_event audit_event_id; Type: DEFAULT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.exec_audit_event ALTER COLUMN audit_event_id SET DEFAULT nextval('audit.exec_audit_event_audit_event_id_seq'::regclass);
ALTER TABLE ONLY audit.exec_audit_event ALTER COLUMN audit_event_id SET DEFAULT nextval('audit.exec_audit_event_audit_event_id_seq'::regclass);




--
--
-- Name: ng_event ng_event_id; Type: DEFAULT; Schema: audit; Owner: -
-- Name: ng_event ng_event_id; Type: DEFAULT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.ng_event ALTER COLUMN ng_event_id SET DEFAULT nextval('audit.ng_event_ng_event_id_seq'::regclass);
ALTER TABLE ONLY audit.ng_event ALTER COLUMN ng_event_id SET DEFAULT nextval('audit.ng_event_ng_event_id_seq'::regclass);




--
--
-- Name: ops_audit_log audit_id; Type: DEFAULT; Schema: audit; Owner: -
-- Name: ops_audit_log audit_id; Type: DEFAULT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.ops_audit_log ALTER COLUMN audit_id SET DEFAULT nextval('audit.ops_audit_log_audit_id_seq'::regclass);
ALTER TABLE ONLY audit.ops_audit_log ALTER COLUMN audit_id SET DEFAULT nextval('audit.ops_audit_log_audit_id_seq'::regclass);




--
--
-- Name: refresh_tokens id; Type: DEFAULT; Schema: auth; Owner: -
-- Name: refresh_tokens id; Type: DEFAULT; Schema: auth; Owner: -
--
--






--
--
-- Name: audit_action audit_action_id; Type: DEFAULT; Schema: compliance; Owner: -
-- Name: audit_action audit_action_id; Type: DEFAULT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_action ALTER COLUMN audit_action_id SET DEFAULT nextval('compliance.audit_action_audit_action_id_seq'::regclass);
ALTER TABLE ONLY compliance.audit_action ALTER COLUMN audit_action_id SET DEFAULT nextval('compliance.audit_action_audit_action_id_seq'::regclass);




--
--
-- Name: audit_event audit_event_id; Type: DEFAULT; Schema: compliance; Owner: -
-- Name: audit_event audit_event_id; Type: DEFAULT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_event ALTER COLUMN audit_event_id SET DEFAULT nextval('compliance.audit_event_audit_event_id_seq'::regclass);
ALTER TABLE ONLY compliance.audit_event ALTER COLUMN audit_event_id SET DEFAULT nextval('compliance.audit_event_audit_event_id_seq'::regclass);




--
--
-- Name: audit_issue audit_issue_id; Type: DEFAULT; Schema: compliance; Owner: -
-- Name: audit_issue audit_issue_id; Type: DEFAULT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_issue ALTER COLUMN audit_issue_id SET DEFAULT nextval('compliance.audit_issue_audit_issue_id_seq'::regclass);
ALTER TABLE ONLY compliance.audit_issue ALTER COLUMN audit_issue_id SET DEFAULT nextval('compliance.audit_issue_audit_issue_id_seq'::regclass);




--
--
-- Name: iso_clause iso_clause_id; Type: DEFAULT; Schema: compliance; Owner: -
-- Name: iso_clause iso_clause_id; Type: DEFAULT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.iso_clause ALTER COLUMN iso_clause_id SET DEFAULT nextval('compliance.iso_clause_iso_clause_id_seq'::regclass);
ALTER TABLE ONLY compliance.iso_clause ALTER COLUMN iso_clause_id SET DEFAULT nextval('compliance.iso_clause_iso_clause_id_seq'::regclass);




--
--
-- Name: iso_standard iso_standard_id; Type: DEFAULT; Schema: compliance; Owner: -
-- Name: iso_standard iso_standard_id; Type: DEFAULT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.iso_standard ALTER COLUMN iso_standard_id SET DEFAULT nextval('compliance.iso_standard_iso_standard_id_seq'::regclass);
ALTER TABLE ONLY compliance.iso_standard ALTER COLUMN iso_standard_id SET DEFAULT nextval('compliance.iso_standard_iso_standard_id_seq'::regclass);




--
--
-- Name: accounting_period period_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: accounting_period period_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.accounting_period ALTER COLUMN period_id SET DEFAULT nextval('core.accounting_period_period_id_seq'::regclass);
ALTER TABLE ONLY core.accounting_period ALTER COLUMN period_id SET DEFAULT nextval('core.accounting_period_period_id_seq'::regclass);




--
--
-- Name: accounts account_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: accounts account_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.accounts ALTER COLUMN account_id SET DEFAULT nextval('core.accounts_account_id_seq'::regclass);
ALTER TABLE ONLY core.accounts ALTER COLUMN account_id SET DEFAULT nextval('core.accounts_account_id_seq'::regclass);




--
--
-- Name: audit_column_weight column_weight_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: audit_column_weight column_weight_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_column_weight ALTER COLUMN column_weight_id SET DEFAULT nextval('core.audit_column_weight_column_weight_id_seq'::regclass);
ALTER TABLE ONLY core.audit_column_weight ALTER COLUMN column_weight_id SET DEFAULT nextval('core.audit_column_weight_column_weight_id_seq'::regclass);




--
--
-- Name: audit_impact_rule rule_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: audit_impact_rule rule_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_impact_rule ALTER COLUMN rule_id SET DEFAULT nextval('core.audit_impact_rule_rule_id_seq'::regclass);
ALTER TABLE ONLY core.audit_impact_rule ALTER COLUMN rule_id SET DEFAULT nextval('core.audit_impact_rule_rule_id_seq'::regclass);




--
--
-- Name: audit_trail audit_trail_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: audit_trail audit_trail_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail ALTER COLUMN audit_trail_id SET DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass);
ALTER TABLE ONLY core.audit_trail ALTER COLUMN audit_trail_id SET DEFAULT nextval('core.audit_trail_audit_trail_id_seq'::regclass);




--
--
-- Name: company_license company_license_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: company_license company_license_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_license ALTER COLUMN company_license_id SET DEFAULT nextval('core.company_license_company_license_id_seq'::regclass);
ALTER TABLE ONLY core.company_license ALTER COLUMN company_license_id SET DEFAULT nextval('core.company_license_company_license_id_seq'::regclass);




--
--
-- Name: company_permission company_permission_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: company_permission company_permission_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_permission ALTER COLUMN company_permission_id SET DEFAULT nextval('core.company_permission_company_permission_id_seq'::regclass);
ALTER TABLE ONLY core.company_permission ALTER COLUMN company_permission_id SET DEFAULT nextval('core.company_permission_company_permission_id_seq'::regclass);




--
--
-- Name: company_users company_user_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: company_users company_user_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_users ALTER COLUMN company_user_id SET DEFAULT nextval('core.company_users_company_user_id_seq'::regclass);
ALTER TABLE ONLY core.company_users ALTER COLUMN company_user_id SET DEFAULT nextval('core.company_users_company_user_id_seq'::regclass);




--
--
-- Name: document_sequence sequence_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: document_sequence sequence_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.document_sequence ALTER COLUMN sequence_id SET DEFAULT nextval('core.document_sequence_sequence_id_seq'::regclass);
ALTER TABLE ONLY core.document_sequence ALTER COLUMN sequence_id SET DEFAULT nextval('core.document_sequence_sequence_id_seq'::regclass);




--
--
-- Name: entity_attribute_def attribute_def_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: entity_attribute_def attribute_def_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.entity_attribute_def ALTER COLUMN attribute_def_id SET DEFAULT nextval('core.entity_attribute_def_attribute_def_id_seq'::regclass);
ALTER TABLE ONLY core.entity_attribute_def ALTER COLUMN attribute_def_id SET DEFAULT nextval('core.entity_attribute_def_attribute_def_id_seq'::regclass);




--
--
-- Name: entity_attribute_value attribute_value_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: entity_attribute_value attribute_value_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.entity_attribute_value ALTER COLUMN attribute_value_id SET DEFAULT nextval('core.entity_attribute_value_attribute_value_id_seq'::regclass);
ALTER TABLE ONLY core.entity_attribute_value ALTER COLUMN attribute_value_id SET DEFAULT nextval('core.entity_attribute_value_attribute_value_id_seq'::regclass);




--
--
-- Name: journal_entries journal_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: journal_entries journal_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_entries ALTER COLUMN journal_id SET DEFAULT nextval('core.journal_entries_journal_id_seq'::regclass);
ALTER TABLE ONLY core.journal_entries ALTER COLUMN journal_id SET DEFAULT nextval('core.journal_entries_journal_id_seq'::regclass);




--
--
-- Name: journal_lines journal_line_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: journal_lines journal_line_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_lines ALTER COLUMN journal_line_id SET DEFAULT nextval('core.journal_lines_journal_line_id_seq'::regclass);
ALTER TABLE ONLY core.journal_lines ALTER COLUMN journal_line_id SET DEFAULT nextval('core.journal_lines_journal_line_id_seq'::regclass);




--
--
-- Name: journal_source_link journal_source_link_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: journal_source_link journal_source_link_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_source_link ALTER COLUMN journal_source_link_id SET DEFAULT nextval('core.journal_source_link_journal_source_link_id_seq'::regclass);
ALTER TABLE ONLY core.journal_source_link ALTER COLUMN journal_source_link_id SET DEFAULT nextval('core.journal_source_link_journal_source_link_id_seq'::regclass);




--
--
-- Name: login_history login_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: login_history login_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.login_history ALTER COLUMN login_id SET DEFAULT nextval('core.login_history_login_id_seq'::regclass);
ALTER TABLE ONLY core.login_history ALTER COLUMN login_id SET DEFAULT nextval('core.login_history_login_id_seq'::regclass);




--
--
-- Name: payment_term payment_term_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: payment_term payment_term_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.payment_term ALTER COLUMN payment_term_id SET DEFAULT nextval('core.payment_term_payment_term_id_seq'::regclass);
ALTER TABLE ONLY core.payment_term ALTER COLUMN payment_term_id SET DEFAULT nextval('core.payment_term_payment_term_id_seq'::regclass);




--
--
-- Name: permission_groups group_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: permission_groups group_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permission_groups ALTER COLUMN group_id SET DEFAULT nextval('core.permission_groups_group_id_seq'::regclass);
ALTER TABLE ONLY core.permission_groups ALTER COLUMN group_id SET DEFAULT nextval('core.permission_groups_group_id_seq'::regclass);




--
--
-- Name: permissions permission_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: permissions permission_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permissions ALTER COLUMN permission_id SET DEFAULT nextval('core.permissions_permission_id_seq'::regclass);
ALTER TABLE ONLY core.permissions ALTER COLUMN permission_id SET DEFAULT nextval('core.permissions_permission_id_seq'::regclass);




--
--
-- Name: posting_profile posting_profile_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: posting_profile posting_profile_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.posting_profile ALTER COLUMN posting_profile_id SET DEFAULT nextval('core.posting_profile_posting_profile_id_seq'::regclass);
ALTER TABLE ONLY core.posting_profile ALTER COLUMN posting_profile_id SET DEFAULT nextval('core.posting_profile_posting_profile_id_seq'::regclass);




--
--
-- Name: status_history status_history_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: status_history status_history_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.status_history ALTER COLUMN status_history_id SET DEFAULT nextval('core.status_history_status_history_id_seq'::regclass);
ALTER TABLE ONLY core.status_history ALTER COLUMN status_history_id SET DEFAULT nextval('core.status_history_status_history_id_seq'::regclass);




--
--
-- Name: status_master status_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: status_master status_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.status_master ALTER COLUMN status_id SET DEFAULT nextval('core.status_master_status_id_seq'::regclass);
ALTER TABLE ONLY core.status_master ALTER COLUMN status_id SET DEFAULT nextval('core.status_master_status_id_seq'::regclass);




--
--
-- Name: sync_queue sync_id; Type: DEFAULT; Schema: core; Owner: -
-- Name: sync_queue sync_id; Type: DEFAULT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.sync_queue ALTER COLUMN sync_id SET DEFAULT nextval('core.sync_queue_sync_id_seq'::regclass);
ALTER TABLE ONLY core.sync_queue ALTER COLUMN sync_id SET DEFAULT nextval('core.sync_queue_sync_id_seq'::regclass);




--
--
-- Name: bank_account bank_account_id; Type: DEFAULT; Schema: finance; Owner: -
-- Name: bank_account bank_account_id; Type: DEFAULT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_account ALTER COLUMN bank_account_id SET DEFAULT nextval('finance.bank_account_bank_account_id_seq'::regclass);
ALTER TABLE ONLY finance.bank_account ALTER COLUMN bank_account_id SET DEFAULT nextval('finance.bank_account_bank_account_id_seq'::regclass);




--
--
-- Name: bank_statement_header bank_statement_id; Type: DEFAULT; Schema: finance; Owner: -
-- Name: bank_statement_header bank_statement_id; Type: DEFAULT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_statement_header ALTER COLUMN bank_statement_id SET DEFAULT nextval('finance.bank_statement_header_bank_statement_id_seq'::regclass);
ALTER TABLE ONLY finance.bank_statement_header ALTER COLUMN bank_statement_id SET DEFAULT nextval('finance.bank_statement_header_bank_statement_id_seq'::regclass);




--
--
-- Name: bank_statement_line bank_statement_line_id; Type: DEFAULT; Schema: finance; Owner: -
-- Name: bank_statement_line bank_statement_line_id; Type: DEFAULT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_statement_line ALTER COLUMN bank_statement_line_id SET DEFAULT nextval('finance.bank_statement_line_bank_statement_line_id_seq'::regclass);
ALTER TABLE ONLY finance.bank_statement_line ALTER COLUMN bank_statement_line_id SET DEFAULT nextval('finance.bank_statement_line_bank_statement_line_id_seq'::regclass);




--
--
-- Name: payment payment_id; Type: DEFAULT; Schema: finance; Owner: -
-- Name: payment payment_id; Type: DEFAULT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.payment ALTER COLUMN payment_id SET DEFAULT nextval('finance.payment_payment_id_seq'::regclass);
ALTER TABLE ONLY finance.payment ALTER COLUMN payment_id SET DEFAULT nextval('finance.payment_payment_id_seq'::regclass);




--
--
-- Name: payment_allocation payment_allocation_id; Type: DEFAULT; Schema: finance; Owner: -
-- Name: payment_allocation payment_allocation_id; Type: DEFAULT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.payment_allocation ALTER COLUMN payment_allocation_id SET DEFAULT nextval('finance.payment_allocation_payment_allocation_id_seq'::regclass);
ALTER TABLE ONLY finance.payment_allocation ALTER COLUMN payment_allocation_id SET DEFAULT nextval('finance.payment_allocation_payment_allocation_id_seq'::regclass);




--
--
-- Name: business_rule business_rule_id; Type: DEFAULT; Schema: governance; Owner: -
-- Name: business_rule business_rule_id; Type: DEFAULT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule ALTER COLUMN business_rule_id SET DEFAULT nextval('governance.business_rule_business_rule_id_seq'::regclass);
ALTER TABLE ONLY governance.business_rule ALTER COLUMN business_rule_id SET DEFAULT nextval('governance.business_rule_business_rule_id_seq'::regclass);




--
--
-- Name: business_rule_action rule_action_id; Type: DEFAULT; Schema: governance; Owner: -
-- Name: business_rule_action rule_action_id; Type: DEFAULT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule_action ALTER COLUMN rule_action_id SET DEFAULT nextval('governance.business_rule_action_rule_action_id_seq'::regclass);
ALTER TABLE ONLY governance.business_rule_action ALTER COLUMN rule_action_id SET DEFAULT nextval('governance.business_rule_action_rule_action_id_seq'::regclass);




--
--
-- Name: business_rule_condition rule_condition_id; Type: DEFAULT; Schema: governance; Owner: -
-- Name: business_rule_condition rule_condition_id; Type: DEFAULT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule_condition ALTER COLUMN rule_condition_id SET DEFAULT nextval('governance.business_rule_condition_rule_condition_id_seq'::regclass);
ALTER TABLE ONLY governance.business_rule_condition ALTER COLUMN rule_condition_id SET DEFAULT nextval('governance.business_rule_condition_rule_condition_id_seq'::regclass);




--
--
-- Name: contract_header contract_id; Type: DEFAULT; Schema: governance; Owner: -
-- Name: contract_header contract_id; Type: DEFAULT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.contract_header ALTER COLUMN contract_id SET DEFAULT nextval('governance.contract_header_contract_id_seq'::regclass);
ALTER TABLE ONLY governance.contract_header ALTER COLUMN contract_id SET DEFAULT nextval('governance.contract_header_contract_id_seq'::regclass);




--
--
-- Name: contract_item_price contract_item_price_id; Type: DEFAULT; Schema: governance; Owner: -
-- Name: contract_item_price contract_item_price_id; Type: DEFAULT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.contract_item_price ALTER COLUMN contract_item_price_id SET DEFAULT nextval('governance.contract_item_price_contract_item_price_id_seq'::regclass);
ALTER TABLE ONLY governance.contract_item_price ALTER COLUMN contract_item_price_id SET DEFAULT nextval('governance.contract_item_price_contract_item_price_id_seq'::regclass);




--
--
-- Name: document_archive document_archive_id; Type: DEFAULT; Schema: governance; Owner: -
-- Name: document_archive document_archive_id; Type: DEFAULT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.document_archive ALTER COLUMN document_archive_id SET DEFAULT nextval('governance.document_archive_document_archive_id_seq'::regclass);
ALTER TABLE ONLY governance.document_archive ALTER COLUMN document_archive_id SET DEFAULT nextval('governance.document_archive_document_archive_id_seq'::regclass);




--
--
-- Name: document_category document_category_id; Type: DEFAULT; Schema: governance; Owner: -
-- Name: document_category document_category_id; Type: DEFAULT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.document_category ALTER COLUMN document_category_id SET DEFAULT nextval('governance.document_category_document_category_id_seq'::regclass);
ALTER TABLE ONLY governance.document_category ALTER COLUMN document_category_id SET DEFAULT nextval('governance.document_category_document_category_id_seq'::regclass);




--
--
-- Name: policy_change_queue policy_change_id; Type: DEFAULT; Schema: governance; Owner: -
-- Name: policy_change_queue policy_change_id; Type: DEFAULT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.policy_change_queue ALTER COLUMN policy_change_id SET DEFAULT nextval('governance.policy_change_queue_policy_change_id_seq'::regclass);
ALTER TABLE ONLY governance.policy_change_queue ALTER COLUMN policy_change_id SET DEFAULT nextval('governance.policy_change_queue_policy_change_id_seq'::regclass);




--
--
-- Name: attendance_log attendance_log_id; Type: DEFAULT; Schema: hr; Owner: -
-- Name: attendance_log attendance_log_id; Type: DEFAULT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.attendance_log ALTER COLUMN attendance_log_id SET DEFAULT nextval('hr.attendance_log_attendance_log_id_seq'::regclass);
ALTER TABLE ONLY hr.attendance_log ALTER COLUMN attendance_log_id SET DEFAULT nextval('hr.attendance_log_attendance_log_id_seq'::regclass);




--
--
-- Name: employee employee_id; Type: DEFAULT; Schema: hr; Owner: -
-- Name: employee employee_id; Type: DEFAULT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employee ALTER COLUMN employee_id SET DEFAULT nextval('hr.employee_employee_id_seq'::regclass);
ALTER TABLE ONLY hr.employee ALTER COLUMN employee_id SET DEFAULT nextval('hr.employee_employee_id_seq'::regclass);




--
--
-- Name: employment_contract employment_contract_id; Type: DEFAULT; Schema: hr; Owner: -
-- Name: employment_contract employment_contract_id; Type: DEFAULT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employment_contract ALTER COLUMN employment_contract_id SET DEFAULT nextval('hr.employment_contract_employment_contract_id_seq'::regclass);
ALTER TABLE ONLY hr.employment_contract ALTER COLUMN employment_contract_id SET DEFAULT nextval('hr.employment_contract_employment_contract_id_seq'::regclass);




--
--
-- Name: hr_department department_id; Type: DEFAULT; Schema: hr; Owner: -
-- Name: hr_department department_id; Type: DEFAULT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.hr_department ALTER COLUMN department_id SET DEFAULT nextval('hr.hr_department_department_id_seq'::regclass);
ALTER TABLE ONLY hr.hr_department ALTER COLUMN department_id SET DEFAULT nextval('hr.hr_department_department_id_seq'::regclass);




--
--
-- Name: hr_position position_id; Type: DEFAULT; Schema: hr; Owner: -
-- Name: hr_position position_id; Type: DEFAULT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.hr_position ALTER COLUMN position_id SET DEFAULT nextval('hr.hr_position_position_id_seq'::regclass);
ALTER TABLE ONLY hr.hr_position ALTER COLUMN position_id SET DEFAULT nextval('hr.hr_position_position_id_seq'::regclass);




--
--
-- Name: leave_request leave_request_id; Type: DEFAULT; Schema: hr; Owner: -
-- Name: leave_request leave_request_id; Type: DEFAULT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.leave_request ALTER COLUMN leave_request_id SET DEFAULT nextval('hr.leave_request_leave_request_id_seq'::regclass);
ALTER TABLE ONLY hr.leave_request ALTER COLUMN leave_request_id SET DEFAULT nextval('hr.leave_request_leave_request_id_seq'::regclass);




--
--
-- Name: payroll_run payroll_run_id; Type: DEFAULT; Schema: hr; Owner: -
-- Name: payroll_run payroll_run_id; Type: DEFAULT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_run ALTER COLUMN payroll_run_id SET DEFAULT nextval('hr.payroll_run_payroll_run_id_seq'::regclass);
ALTER TABLE ONLY hr.payroll_run ALTER COLUMN payroll_run_id SET DEFAULT nextval('hr.payroll_run_payroll_run_id_seq'::regclass);




--
--
-- Name: payroll_slip payroll_slip_id; Type: DEFAULT; Schema: hr; Owner: -
-- Name: payroll_slip payroll_slip_id; Type: DEFAULT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_slip ALTER COLUMN payroll_slip_id SET DEFAULT nextval('hr.payroll_slip_payroll_slip_id_seq'::regclass);
ALTER TABLE ONLY hr.payroll_slip ALTER COLUMN payroll_slip_id SET DEFAULT nextval('hr.payroll_slip_payroll_slip_id_seq'::regclass);




--
--
-- Name: api_credential api_credential_id; Type: DEFAULT; Schema: integration; Owner: -
-- Name: api_credential api_credential_id; Type: DEFAULT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.api_credential ALTER COLUMN api_credential_id SET DEFAULT nextval('integration.api_credential_api_credential_id_seq'::regclass);
ALTER TABLE ONLY integration.api_credential ALTER COLUMN api_credential_id SET DEFAULT nextval('integration.api_credential_api_credential_id_seq'::regclass);




--
--
-- Name: audit_export_queue export_id; Type: DEFAULT; Schema: integration; Owner: -
-- Name: audit_export_queue export_id; Type: DEFAULT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.audit_export_queue ALTER COLUMN export_id SET DEFAULT nextval('integration.audit_export_queue_export_id_seq'::regclass);
ALTER TABLE ONLY integration.audit_export_queue ALTER COLUMN export_id SET DEFAULT nextval('integration.audit_export_queue_export_id_seq'::regclass);




--
--
-- Name: external_system external_system_id; Type: DEFAULT; Schema: integration; Owner: -
-- Name: external_system external_system_id; Type: DEFAULT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.external_system ALTER COLUMN external_system_id SET DEFAULT nextval('integration.external_system_external_system_id_seq'::regclass);
ALTER TABLE ONLY integration.external_system ALTER COLUMN external_system_id SET DEFAULT nextval('integration.external_system_external_system_id_seq'::regclass);




--
--
-- Name: integration_job integration_job_id; Type: DEFAULT; Schema: integration; Owner: -
-- Name: integration_job integration_job_id; Type: DEFAULT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.integration_job ALTER COLUMN integration_job_id SET DEFAULT nextval('integration.integration_job_integration_job_id_seq'::regclass);
ALTER TABLE ONLY integration.integration_job ALTER COLUMN integration_job_id SET DEFAULT nextval('integration.integration_job_integration_job_id_seq'::regclass);




--
--
-- Name: integration_log integration_log_id; Type: DEFAULT; Schema: integration; Owner: -
-- Name: integration_log integration_log_id; Type: DEFAULT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.integration_log ALTER COLUMN integration_log_id SET DEFAULT nextval('integration.integration_log_integration_log_id_seq'::regclass);
ALTER TABLE ONLY integration.integration_log ALTER COLUMN integration_log_id SET DEFAULT nextval('integration.integration_log_integration_log_id_seq'::regclass);




--
--
-- Name: siem_delivery_queue delivery_id; Type: DEFAULT; Schema: integration; Owner: -
-- Name: siem_delivery_queue delivery_id; Type: DEFAULT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.siem_delivery_queue ALTER COLUMN delivery_id SET DEFAULT nextval('integration.siem_delivery_queue_delivery_id_seq'::regclass);
ALTER TABLE ONLY integration.siem_delivery_queue ALTER COLUMN delivery_id SET DEFAULT nextval('integration.siem_delivery_queue_delivery_id_seq'::regclass);




--
--
-- Name: siem_endpoint endpoint_id; Type: DEFAULT; Schema: integration; Owner: -
-- Name: siem_endpoint endpoint_id; Type: DEFAULT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.siem_endpoint ALTER COLUMN endpoint_id SET DEFAULT nextval('integration.siem_endpoint_endpoint_id_seq'::regclass);
ALTER TABLE ONLY integration.siem_endpoint ALTER COLUMN endpoint_id SET DEFAULT nextval('integration.siem_endpoint_endpoint_id_seq'::regclass);




--
--
-- Name: inventory_valuation inventory_valuation_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: inventory_valuation inventory_valuation_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.inventory_valuation ALTER COLUMN inventory_valuation_id SET DEFAULT nextval('inventory.inventory_valuation_inventory_valuation_id_seq'::regclass);
ALTER TABLE ONLY inventory.inventory_valuation ALTER COLUMN inventory_valuation_id SET DEFAULT nextval('inventory.inventory_valuation_inventory_valuation_id_seq'::regclass);




--
--
-- Name: stock_balance stock_balance_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stock_balance stock_balance_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_balance ALTER COLUMN stock_balance_id SET DEFAULT nextval('inventory.stock_balance_stock_balance_id_seq'::regclass);
ALTER TABLE ONLY inventory.stock_balance ALTER COLUMN stock_balance_id SET DEFAULT nextval('inventory.stock_balance_stock_balance_id_seq'::regclass);




--
--
-- Name: stock_bin bin_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stock_bin bin_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_bin ALTER COLUMN bin_id SET DEFAULT nextval('inventory.stock_bin_bin_id_seq'::regclass);
ALTER TABLE ONLY inventory.stock_bin ALTER COLUMN bin_id SET DEFAULT nextval('inventory.stock_bin_bin_id_seq'::regclass);




--
--
-- Name: stock_lot stock_lot_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stock_lot stock_lot_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot ALTER COLUMN stock_lot_id SET DEFAULT nextval('inventory.stock_lot_stock_lot_id_seq'::regclass);
ALTER TABLE ONLY inventory.stock_lot ALTER COLUMN stock_lot_id SET DEFAULT nextval('inventory.stock_lot_stock_lot_id_seq'::regclass);




--
--
-- Name: stock_lot_balance stock_lot_balance_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance ALTER COLUMN stock_lot_balance_id SET DEFAULT nextval('inventory.stock_lot_balance_stock_lot_balance_id_seq'::regclass);
ALTER TABLE ONLY inventory.stock_lot_balance ALTER COLUMN stock_lot_balance_id SET DEFAULT nextval('inventory.stock_lot_balance_stock_lot_balance_id_seq'::regclass);




--
--
-- Name: stock_reservation stock_reservation_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stock_reservation stock_reservation_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_reservation ALTER COLUMN stock_reservation_id SET DEFAULT nextval('inventory.stock_reservation_stock_reservation_id_seq'::regclass);
ALTER TABLE ONLY inventory.stock_reservation ALTER COLUMN stock_reservation_id SET DEFAULT nextval('inventory.stock_reservation_stock_reservation_id_seq'::regclass);




--
--
-- Name: stock_transaction stock_tx_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stock_transaction stock_tx_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transaction ALTER COLUMN stock_tx_id SET DEFAULT nextval('inventory.stock_transaction_stock_tx_id_seq'::regclass);
ALTER TABLE ONLY inventory.stock_transaction ALTER COLUMN stock_tx_id SET DEFAULT nextval('inventory.stock_transaction_stock_tx_id_seq'::regclass);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail ALTER COLUMN stock_transfer_detail_id SET DEFAULT nextval('inventory.stock_transfer_detail_stock_transfer_detail_id_seq'::regclass);
ALTER TABLE ONLY inventory.stock_transfer_detail ALTER COLUMN stock_transfer_detail_id SET DEFAULT nextval('inventory.stock_transfer_detail_stock_transfer_detail_id_seq'::regclass);




--
--
-- Name: stock_transfer_header stock_transfer_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stock_transfer_header stock_transfer_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_header ALTER COLUMN stock_transfer_id SET DEFAULT nextval('inventory.stock_transfer_header_stock_transfer_id_seq'::regclass);
ALTER TABLE ONLY inventory.stock_transfer_header ALTER COLUMN stock_transfer_id SET DEFAULT nextval('inventory.stock_transfer_header_stock_transfer_id_seq'::regclass);




--
--
-- Name: stocktaking_plan stocktaking_plan_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stocktaking_plan stocktaking_plan_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_plan ALTER COLUMN stocktaking_plan_id SET DEFAULT nextval('inventory.stocktaking_plan_stocktaking_plan_id_seq'::regclass);
ALTER TABLE ONLY inventory.stocktaking_plan ALTER COLUMN stocktaking_plan_id SET DEFAULT nextval('inventory.stocktaking_plan_stocktaking_plan_id_seq'::regclass);




--
--
-- Name: stocktaking_result stocktaking_result_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: stocktaking_result stocktaking_result_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_result ALTER COLUMN stocktaking_result_id SET DEFAULT nextval('inventory.stocktaking_result_stocktaking_result_id_seq'::regclass);
ALTER TABLE ONLY inventory.stocktaking_result ALTER COLUMN stocktaking_result_id SET DEFAULT nextval('inventory.stocktaking_result_stocktaking_result_id_seq'::regclass);




--
--
-- Name: storage_location location_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: storage_location location_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.storage_location ALTER COLUMN location_id SET DEFAULT nextval('inventory.storage_location_location_id_seq'::regclass);
ALTER TABLE ONLY inventory.storage_location ALTER COLUMN location_id SET DEFAULT nextval('inventory.storage_location_location_id_seq'::regclass);




--
--
-- Name: warehouse warehouse_id; Type: DEFAULT; Schema: inventory; Owner: -
-- Name: warehouse warehouse_id; Type: DEFAULT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.warehouse ALTER COLUMN warehouse_id SET DEFAULT nextval('inventory.warehouse_warehouse_id_seq'::regclass);
ALTER TABLE ONLY inventory.warehouse ALTER COLUMN warehouse_id SET DEFAULT nextval('inventory.warehouse_warehouse_id_seq'::regclass);




--
--
-- Name: bom_detail bom_detail_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: bom_detail bom_detail_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_detail ALTER COLUMN bom_detail_id SET DEFAULT nextval('manufacturing.bom_detail_bom_detail_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.bom_detail ALTER COLUMN bom_detail_id SET DEFAULT nextval('manufacturing.bom_detail_bom_detail_id_seq'::regclass);




--
--
-- Name: bom_header bom_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: bom_header bom_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_header ALTER COLUMN bom_id SET DEFAULT nextval('manufacturing.bom_header_bom_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.bom_header ALTER COLUMN bom_id SET DEFAULT nextval('manufacturing.bom_header_bom_id_seq'::regclass);




--
--
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot ALTER COLUMN manufacturing_cost_snapshot_id SET DEFAULT nextval('manufacturing.manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot ALTER COLUMN manufacturing_cost_snapshot_id SET DEFAULT nextval('manufacturing.manufacturing_cost_snapshot_manufacturing_cost_snapshot_id_seq'::regclass);




--
--
-- Name: manufacturing_execution execution_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution execution_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution ALTER COLUMN execution_id SET DEFAULT nextval('manufacturing.manufacturing_execution_execution_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.manufacturing_execution ALTER COLUMN execution_id SET DEFAULT nextval('manufacturing.manufacturing_execution_execution_id_seq'::regclass);




--
--
-- Name: manufacturing_execution_detail execution_detail_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail execution_detail_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution_detail ALTER COLUMN execution_detail_id SET DEFAULT nextval('manufacturing.manufacturing_execution_detail_execution_detail_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.manufacturing_execution_detail ALTER COLUMN execution_detail_id SET DEFAULT nextval('manufacturing.manufacturing_execution_detail_execution_detail_id_seq'::regclass);




--
--
-- Name: mps_plan mps_plan_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: mps_plan mps_plan_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mps_plan ALTER COLUMN mps_plan_id SET DEFAULT nextval('manufacturing.mps_plan_mps_plan_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.mps_plan ALTER COLUMN mps_plan_id SET DEFAULT nextval('manufacturing.mps_plan_mps_plan_id_seq'::regclass);




--
--
-- Name: mps_run mps_run_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: mps_run mps_run_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mps_run ALTER COLUMN mps_run_id SET DEFAULT nextval('manufacturing.mps_run_mps_run_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.mps_run ALTER COLUMN mps_run_id SET DEFAULT nextval('manufacturing.mps_run_mps_run_id_seq'::regclass);




--
--
-- Name: mrp_allocation mrp_allocation_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: mrp_allocation mrp_allocation_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_allocation ALTER COLUMN mrp_allocation_id SET DEFAULT nextval('manufacturing.mrp_allocation_mrp_allocation_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.mrp_allocation ALTER COLUMN mrp_allocation_id SET DEFAULT nextval('manufacturing.mrp_allocation_mrp_allocation_id_seq'::regclass);




--
--
-- Name: mrp_requirement mrp_requirement_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: mrp_requirement mrp_requirement_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_requirement ALTER COLUMN mrp_requirement_id SET DEFAULT nextval('manufacturing.mrp_requirement_mrp_requirement_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.mrp_requirement ALTER COLUMN mrp_requirement_id SET DEFAULT nextval('manufacturing.mrp_requirement_mrp_requirement_id_seq'::regclass);




--
--
-- Name: mrp_run mrp_run_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: mrp_run mrp_run_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_run ALTER COLUMN mrp_run_id SET DEFAULT nextval('manufacturing.mrp_run_mrp_run_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.mrp_run ALTER COLUMN mrp_run_id SET DEFAULT nextval('manufacturing.mrp_run_mrp_run_id_seq'::regclass);




--
--
-- Name: process_master process_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: process_master process_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.process_master ALTER COLUMN process_id SET DEFAULT nextval('manufacturing.process_master_process_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.process_master ALTER COLUMN process_id SET DEFAULT nextval('manufacturing.process_master_process_id_seq'::regclass);




--
--
-- Name: routing_header routing_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: routing_header routing_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_header ALTER COLUMN routing_id SET DEFAULT nextval('manufacturing.routing_header_routing_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.routing_header ALTER COLUMN routing_id SET DEFAULT nextval('manufacturing.routing_header_routing_id_seq'::regclass);




--
--
-- Name: routing_operation routing_operation_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: routing_operation routing_operation_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_operation ALTER COLUMN routing_operation_id SET DEFAULT nextval('manufacturing.routing_operation_routing_operation_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.routing_operation ALTER COLUMN routing_operation_id SET DEFAULT nextval('manufacturing.routing_operation_routing_operation_id_seq'::regclass);




--
--
-- Name: work_order work_order_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: work_order work_order_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.work_order ALTER COLUMN work_order_id SET DEFAULT nextval('manufacturing.work_order_work_order_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.work_order ALTER COLUMN work_order_id SET DEFAULT nextval('manufacturing.work_order_work_order_id_seq'::regclass);




--
--
-- Name: yield_metric yield_metric_id; Type: DEFAULT; Schema: manufacturing; Owner: -
-- Name: yield_metric yield_metric_id; Type: DEFAULT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.yield_metric ALTER COLUMN yield_metric_id SET DEFAULT nextval('manufacturing.yield_metric_yield_metric_id_seq'::regclass);
ALTER TABLE ONLY manufacturing.yield_metric ALTER COLUMN yield_metric_id SET DEFAULT nextval('manufacturing.yield_metric_yield_metric_id_seq'::regclass);




--
--
-- Name: asset asset_id; Type: DEFAULT; Schema: media; Owner: -
-- Name: asset asset_id; Type: DEFAULT; Schema: media; Owner: -
--
--


ALTER TABLE ONLY media.asset ALTER COLUMN asset_id SET DEFAULT nextval('media.asset_asset_id_seq'::regclass);
ALTER TABLE ONLY media.asset ALTER COLUMN asset_id SET DEFAULT nextval('media.asset_asset_id_seq'::regclass);




--
--
-- Name: ai_event ai_event_id; Type: DEFAULT; Schema: notify; Owner: -
-- Name: ai_event ai_event_id; Type: DEFAULT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.ai_event ALTER COLUMN ai_event_id SET DEFAULT nextval('notify.ai_event_ai_event_id_seq'::regclass);
ALTER TABLE ONLY notify.ai_event ALTER COLUMN ai_event_id SET DEFAULT nextval('notify.ai_event_ai_event_id_seq'::regclass);




--
--
-- Name: ai_rule ai_rule_id; Type: DEFAULT; Schema: notify; Owner: -
-- Name: ai_rule ai_rule_id; Type: DEFAULT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.ai_rule ALTER COLUMN ai_rule_id SET DEFAULT nextval('notify.ai_rule_ai_rule_id_seq'::regclass);
ALTER TABLE ONLY notify.ai_rule ALTER COLUMN ai_rule_id SET DEFAULT nextval('notify.ai_rule_ai_rule_id_seq'::regclass);




--
--
-- Name: approval_action_log action_log_id; Type: DEFAULT; Schema: notify; Owner: -
-- Name: approval_action_log action_log_id; Type: DEFAULT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.approval_action_log ALTER COLUMN action_log_id SET DEFAULT nextval('notify.approval_action_log_action_log_id_seq'::regclass);
ALTER TABLE ONLY notify.approval_action_log ALTER COLUMN action_log_id SET DEFAULT nextval('notify.approval_action_log_action_log_id_seq'::regclass);




--
--
-- Name: approval_request approval_request_id; Type: DEFAULT; Schema: notify; Owner: -
-- Name: approval_request approval_request_id; Type: DEFAULT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.approval_request ALTER COLUMN approval_request_id SET DEFAULT nextval('notify.approval_request_approval_request_id_seq'::regclass);
ALTER TABLE ONLY notify.approval_request ALTER COLUMN approval_request_id SET DEFAULT nextval('notify.approval_request_approval_request_id_seq'::regclass);




--
--
-- Name: audit_trail audit_id; Type: DEFAULT; Schema: notify; Owner: -
-- Name: audit_trail audit_id; Type: DEFAULT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.audit_trail ALTER COLUMN audit_id SET DEFAULT nextval('notify.audit_trail_audit_id_seq'::regclass);
ALTER TABLE ONLY notify.audit_trail ALTER COLUMN audit_id SET DEFAULT nextval('notify.audit_trail_audit_id_seq'::regclass);




--
--
-- Name: notification_log notification_id; Type: DEFAULT; Schema: notify; Owner: -
-- Name: notification_log notification_id; Type: DEFAULT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.notification_log ALTER COLUMN notification_id SET DEFAULT nextval('notify.notification_log_notification_id_seq'::regclass);
ALTER TABLE ONLY notify.notification_log ALTER COLUMN notification_id SET DEFAULT nextval('notify.notification_log_notification_id_seq'::regclass);




--
--
-- Name: notification_route route_id; Type: DEFAULT; Schema: notify; Owner: -
-- Name: notification_route route_id; Type: DEFAULT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.notification_route ALTER COLUMN route_id SET DEFAULT nextval('notify.notification_route_route_id_seq'::regclass);
ALTER TABLE ONLY notify.notification_route ALTER COLUMN route_id SET DEFAULT nextval('notify.notification_route_route_id_seq'::regclass);




--
--
-- Name: notification_template template_id; Type: DEFAULT; Schema: notify; Owner: -
-- Name: notification_template template_id; Type: DEFAULT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.notification_template ALTER COLUMN template_id SET DEFAULT nextval('notify.notification_template_template_id_seq'::regclass);
ALTER TABLE ONLY notify.notification_template ALTER COLUMN template_id SET DEFAULT nextval('notify.notification_template_template_id_seq'::regclass);




--
--
-- Name: document_file document_file_id; Type: DEFAULT; Schema: ops; Owner: -
-- Name: document_file document_file_id; Type: DEFAULT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_file ALTER COLUMN document_file_id SET DEFAULT nextval('ops.document_file_document_file_id_seq'::regclass);
ALTER TABLE ONLY ops.document_file ALTER COLUMN document_file_id SET DEFAULT nextval('ops.document_file_document_file_id_seq'::regclass);




--
--
-- Name: document_send_history send_history_id; Type: DEFAULT; Schema: ops; Owner: -
-- Name: document_send_history send_history_id; Type: DEFAULT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_send_history ALTER COLUMN send_history_id SET DEFAULT nextval('ops.document_send_history_send_history_id_seq'::regclass);
ALTER TABLE ONLY ops.document_send_history ALTER COLUMN send_history_id SET DEFAULT nextval('ops.document_send_history_send_history_id_seq'::regclass);




--
--
-- Name: document_send_queue send_queue_id; Type: DEFAULT; Schema: ops; Owner: -
-- Name: document_send_queue send_queue_id; Type: DEFAULT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_send_queue ALTER COLUMN send_queue_id SET DEFAULT nextval('ops.document_send_queue_send_queue_id_seq'::regclass);
ALTER TABLE ONLY ops.document_send_queue ALTER COLUMN send_queue_id SET DEFAULT nextval('ops.document_send_queue_send_queue_id_seq'::regclass);




--
--
-- Name: notification_outbox notification_id; Type: DEFAULT; Schema: ops; Owner: -
-- Name: notification_outbox notification_id; Type: DEFAULT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.notification_outbox ALTER COLUMN notification_id SET DEFAULT nextval('ops.notification_outbox_notification_id_seq'::regclass);
ALTER TABLE ONLY ops.notification_outbox ALTER COLUMN notification_id SET DEFAULT nextval('ops.notification_outbox_notification_id_seq'::regclass);




--
--
-- Name: ops_job_queue job_id; Type: DEFAULT; Schema: ops; Owner: -
-- Name: ops_job_queue job_id; Type: DEFAULT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.ops_job_queue ALTER COLUMN job_id SET DEFAULT nextval('ops.ops_job_queue_job_id_seq'::regclass);
ALTER TABLE ONLY ops.ops_job_queue ALTER COLUMN job_id SET DEFAULT nextval('ops.ops_job_queue_job_id_seq'::regclass);




--
--
-- Name: pdf_generate_queue queue_id; Type: DEFAULT; Schema: ops; Owner: -
-- Name: pdf_generate_queue queue_id; Type: DEFAULT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.pdf_generate_queue ALTER COLUMN queue_id SET DEFAULT nextval('ops.pdf_generate_queue_queue_id_seq'::regclass);
ALTER TABLE ONLY ops.pdf_generate_queue ALTER COLUMN queue_id SET DEFAULT nextval('ops.pdf_generate_queue_queue_id_seq'::regclass);




--
--
-- Name: send_fee_master fee_id; Type: DEFAULT; Schema: ops; Owner: -
-- Name: send_fee_master fee_id; Type: DEFAULT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.send_fee_master ALTER COLUMN fee_id SET DEFAULT nextval('ops.send_fee_master_fee_id_seq'::regclass);
ALTER TABLE ONLY ops.send_fee_master ALTER COLUMN fee_id SET DEFAULT nextval('ops.send_fee_master_fee_id_seq'::regclass);




--
--
-- Name: purchase_invoice purchase_invoice_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_invoice purchase_invoice_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice ALTER COLUMN purchase_invoice_id SET DEFAULT nextval('purchase.purchase_invoice_purchase_invoice_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_invoice ALTER COLUMN purchase_invoice_id SET DEFAULT nextval('purchase.purchase_invoice_purchase_invoice_id_seq'::regclass);




--
--
-- Name: purchase_invoice_detail purchase_invoice_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail purchase_invoice_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice_detail ALTER COLUMN purchase_invoice_detail_id SET DEFAULT nextval('purchase.purchase_invoice_detail_purchase_invoice_detail_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_invoice_detail ALTER COLUMN purchase_invoice_detail_id SET DEFAULT nextval('purchase.purchase_invoice_detail_purchase_invoice_detail_id_seq'::regclass);




--
--
-- Name: purchase_order_detail purchase_order_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_order_detail purchase_order_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_detail ALTER COLUMN purchase_order_detail_id SET DEFAULT nextval('purchase.purchase_order_detail_purchase_order_detail_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_order_detail ALTER COLUMN purchase_order_detail_id SET DEFAULT nextval('purchase.purchase_order_detail_purchase_order_detail_id_seq'::regclass);




--
--
-- Name: purchase_order_header purchase_order_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_order_header purchase_order_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_header ALTER COLUMN purchase_order_id SET DEFAULT nextval('purchase.purchase_order_header_purchase_order_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_order_header ALTER COLUMN purchase_order_id SET DEFAULT nextval('purchase.purchase_order_header_purchase_order_id_seq'::regclass);




--
--
-- Name: purchase_quotation purchase_quotation_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_quotation purchase_quotation_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation ALTER COLUMN purchase_quotation_id SET DEFAULT nextval('purchase.purchase_quotation_purchase_quotation_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_quotation ALTER COLUMN purchase_quotation_id SET DEFAULT nextval('purchase.purchase_quotation_purchase_quotation_id_seq'::regclass);




--
--
-- Name: purchase_quotation_detail purchase_quotation_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail purchase_quotation_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation_detail ALTER COLUMN purchase_quotation_detail_id SET DEFAULT nextval('purchase.purchase_quotation_detail_purchase_quotation_detail_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_quotation_detail ALTER COLUMN purchase_quotation_detail_id SET DEFAULT nextval('purchase.purchase_quotation_detail_purchase_quotation_detail_id_seq'::regclass);




--
--
-- Name: purchase_receipt receipt_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_receipt receipt_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt ALTER COLUMN receipt_id SET DEFAULT nextval('purchase.purchase_receipt_receipt_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_receipt ALTER COLUMN receipt_id SET DEFAULT nextval('purchase.purchase_receipt_receipt_id_seq'::regclass);




--
--
-- Name: purchase_receipt_detail receipt_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail receipt_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt_detail ALTER COLUMN receipt_detail_id SET DEFAULT nextval('purchase.purchase_receipt_detail_receipt_detail_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_receipt_detail ALTER COLUMN receipt_detail_id SET DEFAULT nextval('purchase.purchase_receipt_detail_receipt_detail_id_seq'::regclass);




--
--
-- Name: purchase_requisition purchase_requisition_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_requisition purchase_requisition_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition ALTER COLUMN purchase_requisition_id SET DEFAULT nextval('purchase.purchase_requisition_purchase_requisition_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_requisition ALTER COLUMN purchase_requisition_id SET DEFAULT nextval('purchase.purchase_requisition_purchase_requisition_id_seq'::regclass);




--
--
-- Name: purchase_requisition_detail purchase_requisition_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail purchase_requisition_detail_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition_detail ALTER COLUMN purchase_requisition_detail_id SET DEFAULT nextval('purchase.purchase_requisition_detail_purchase_requisition_detail_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_requisition_detail ALTER COLUMN purchase_requisition_detail_id SET DEFAULT nextval('purchase.purchase_requisition_detail_purchase_requisition_detail_id_seq'::regclass);




--
--
-- Name: purchase_three_way_match purchase_three_way_match_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: purchase_three_way_match purchase_three_way_match_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_three_way_match ALTER COLUMN purchase_three_way_match_id SET DEFAULT nextval('purchase.purchase_three_way_match_purchase_three_way_match_id_seq'::regclass);
ALTER TABLE ONLY purchase.purchase_three_way_match ALTER COLUMN purchase_three_way_match_id SET DEFAULT nextval('purchase.purchase_three_way_match_purchase_three_way_match_id_seq'::regclass);




--
--
-- Name: supplier_address supplier_address_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: supplier_address supplier_address_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_address ALTER COLUMN supplier_address_id SET DEFAULT nextval('purchase.supplier_address_supplier_address_id_seq'::regclass);
ALTER TABLE ONLY purchase.supplier_address ALTER COLUMN supplier_address_id SET DEFAULT nextval('purchase.supplier_address_supplier_address_id_seq'::regclass);




--
--
-- Name: supplier_contact supplier_contact_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: supplier_contact supplier_contact_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_contact ALTER COLUMN supplier_contact_id SET DEFAULT nextval('purchase.supplier_contact_supplier_contact_id_seq'::regclass);
ALTER TABLE ONLY purchase.supplier_contact ALTER COLUMN supplier_contact_id SET DEFAULT nextval('purchase.supplier_contact_supplier_contact_id_seq'::regclass);




--
--
-- Name: supplier_item_price supplier_item_price_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: supplier_item_price supplier_item_price_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_item_price ALTER COLUMN supplier_item_price_id SET DEFAULT nextval('purchase.supplier_item_price_supplier_item_price_id_seq'::regclass);
ALTER TABLE ONLY purchase.supplier_item_price ALTER COLUMN supplier_item_price_id SET DEFAULT nextval('purchase.supplier_item_price_supplier_item_price_id_seq'::regclass);




--
--
-- Name: supplier_master supplier_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: supplier_master supplier_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_master ALTER COLUMN supplier_id SET DEFAULT nextval('purchase.supplier_master_supplier_id_seq'::regclass);
ALTER TABLE ONLY purchase.supplier_master ALTER COLUMN supplier_id SET DEFAULT nextval('purchase.supplier_master_supplier_id_seq'::regclass);




--
--
-- Name: supplier_payment_term supplier_payment_term_id; Type: DEFAULT; Schema: purchase; Owner: -
-- Name: supplier_payment_term supplier_payment_term_id; Type: DEFAULT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_payment_term ALTER COLUMN supplier_payment_term_id SET DEFAULT nextval('purchase.supplier_payment_term_supplier_payment_term_id_seq'::regclass);
ALTER TABLE ONLY purchase.supplier_payment_term ALTER COLUMN supplier_payment_term_id SET DEFAULT nextval('purchase.supplier_payment_term_supplier_payment_term_id_seq'::regclass);




--
--
-- Name: billing_detail billing_detail_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: billing_detail billing_detail_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_detail ALTER COLUMN billing_detail_id SET DEFAULT nextval('sales.billing_detail_billing_detail_id_seq'::regclass);
ALTER TABLE ONLY sales.billing_detail ALTER COLUMN billing_detail_id SET DEFAULT nextval('sales.billing_detail_billing_detail_id_seq'::regclass);




--
--
-- Name: billing_header billing_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: billing_header billing_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_header ALTER COLUMN billing_id SET DEFAULT nextval('sales.billing_header_billing_id_seq'::regclass);
ALTER TABLE ONLY sales.billing_header ALTER COLUMN billing_id SET DEFAULT nextval('sales.billing_header_billing_id_seq'::regclass);




--
--
-- Name: customer customer_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: customer customer_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer ALTER COLUMN customer_id SET DEFAULT nextval('sales.customer_customer_id_seq'::regclass);
ALTER TABLE ONLY sales.customer ALTER COLUMN customer_id SET DEFAULT nextval('sales.customer_customer_id_seq'::regclass);




--
--
-- Name: customer_address customer_address_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: customer_address customer_address_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_address ALTER COLUMN customer_address_id SET DEFAULT nextval('sales.customer_address_customer_address_id_seq'::regclass);
ALTER TABLE ONLY sales.customer_address ALTER COLUMN customer_address_id SET DEFAULT nextval('sales.customer_address_customer_address_id_seq'::regclass);




--
--
-- Name: customer_contact customer_contact_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: customer_contact customer_contact_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_contact ALTER COLUMN customer_contact_id SET DEFAULT nextval('sales.customer_contact_customer_contact_id_seq'::regclass);
ALTER TABLE ONLY sales.customer_contact ALTER COLUMN customer_contact_id SET DEFAULT nextval('sales.customer_contact_customer_contact_id_seq'::regclass);




--
--
-- Name: customer_payment_term customer_payment_term_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: customer_payment_term customer_payment_term_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_payment_term ALTER COLUMN customer_payment_term_id SET DEFAULT nextval('sales.customer_payment_term_customer_payment_term_id_seq'::regclass);
ALTER TABLE ONLY sales.customer_payment_term ALTER COLUMN customer_payment_term_id SET DEFAULT nextval('sales.customer_payment_term_customer_payment_term_id_seq'::regclass);




--
--
-- Name: invoice_pdf invoice_pdf_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: invoice_pdf invoice_pdf_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.invoice_pdf ALTER COLUMN invoice_pdf_id SET DEFAULT nextval('sales.invoice_pdf_invoice_pdf_id_seq'::regclass);
ALTER TABLE ONLY sales.invoice_pdf ALTER COLUMN invoice_pdf_id SET DEFAULT nextval('sales.invoice_pdf_invoice_pdf_id_seq'::regclass);




--
--
-- Name: item item_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: item item_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item ALTER COLUMN item_id SET DEFAULT nextval('sales.item_item_id_seq'::regclass);
ALTER TABLE ONLY sales.item ALTER COLUMN item_id SET DEFAULT nextval('sales.item_item_id_seq'::regclass);




--
--
-- Name: item_category item_category_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: item_category item_category_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_category ALTER COLUMN item_category_id SET DEFAULT nextval('sales.item_category_item_category_id_seq'::regclass);
ALTER TABLE ONLY sales.item_category ALTER COLUMN item_category_id SET DEFAULT nextval('sales.item_category_item_category_id_seq'::regclass);




--
--
-- Name: item_price_master item_price_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: item_price_master item_price_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_price_master ALTER COLUMN item_price_id SET DEFAULT nextval('sales.item_price_master_item_price_id_seq'::regclass);
ALTER TABLE ONLY sales.item_price_master ALTER COLUMN item_price_id SET DEFAULT nextval('sales.item_price_master_item_price_id_seq'::regclass);




--
--
-- Name: item_uom item_uom_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: item_uom item_uom_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_uom ALTER COLUMN item_uom_id SET DEFAULT nextval('sales.item_uom_item_uom_id_seq'::regclass);
ALTER TABLE ONLY sales.item_uom ALTER COLUMN item_uom_id SET DEFAULT nextval('sales.item_uom_item_uom_id_seq'::regclass);




--
--
-- Name: order_detail order_detail_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: order_detail order_detail_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_detail ALTER COLUMN order_detail_id SET DEFAULT nextval('sales.order_detail_order_detail_id_seq'::regclass);
ALTER TABLE ONLY sales.order_detail ALTER COLUMN order_detail_id SET DEFAULT nextval('sales.order_detail_order_detail_id_seq'::regclass);




--
--
-- Name: order_header order_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: order_header order_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_header ALTER COLUMN order_id SET DEFAULT nextval('sales.order_header_order_id_seq'::regclass);
ALTER TABLE ONLY sales.order_header ALTER COLUMN order_id SET DEFAULT nextval('sales.order_header_order_id_seq'::regclass);




--
--
-- Name: quotation_order_link quotation_order_link_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: quotation_order_link quotation_order_link_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.quotation_order_link ALTER COLUMN quotation_order_link_id SET DEFAULT nextval('sales.quotation_order_link_quotation_order_link_id_seq'::regclass);
ALTER TABLE ONLY sales.quotation_order_link ALTER COLUMN quotation_order_link_id SET DEFAULT nextval('sales.quotation_order_link_quotation_order_link_id_seq'::regclass);




--
--
-- Name: return_detail return_detail_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: return_detail return_detail_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_detail ALTER COLUMN return_detail_id SET DEFAULT nextval('sales.return_detail_return_detail_id_seq'::regclass);
ALTER TABLE ONLY sales.return_detail ALTER COLUMN return_detail_id SET DEFAULT nextval('sales.return_detail_return_detail_id_seq'::regclass);




--
--
-- Name: return_header return_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: return_header return_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_header ALTER COLUMN return_id SET DEFAULT nextval('sales.return_header_return_id_seq'::regclass);
ALTER TABLE ONLY sales.return_header ALTER COLUMN return_id SET DEFAULT nextval('sales.return_header_return_id_seq'::regclass);




--
--
-- Name: sales_quotation sales_quotation_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: sales_quotation sales_quotation_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation ALTER COLUMN sales_quotation_id SET DEFAULT nextval('sales.sales_quotation_sales_quotation_id_seq'::regclass);
ALTER TABLE ONLY sales.sales_quotation ALTER COLUMN sales_quotation_id SET DEFAULT nextval('sales.sales_quotation_sales_quotation_id_seq'::regclass);




--
--
-- Name: sales_quotation_detail sales_quotation_detail_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: sales_quotation_detail sales_quotation_detail_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation_detail ALTER COLUMN sales_quotation_detail_id SET DEFAULT nextval('sales.sales_quotation_detail_sales_quotation_detail_id_seq'::regclass);
ALTER TABLE ONLY sales.sales_quotation_detail ALTER COLUMN sales_quotation_detail_id SET DEFAULT nextval('sales.sales_quotation_detail_sales_quotation_detail_id_seq'::regclass);




--
--
-- Name: shipping_detail shipping_detail_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: shipping_detail shipping_detail_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_detail ALTER COLUMN shipping_detail_id SET DEFAULT nextval('sales.shipping_detail_shipping_detail_id_seq'::regclass);
ALTER TABLE ONLY sales.shipping_detail ALTER COLUMN shipping_detail_id SET DEFAULT nextval('sales.shipping_detail_shipping_detail_id_seq'::regclass);




--
--
-- Name: shipping_header shipping_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: shipping_header shipping_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_header ALTER COLUMN shipping_id SET DEFAULT nextval('sales.shipping_header_shipping_id_seq'::regclass);
ALTER TABLE ONLY sales.shipping_header ALTER COLUMN shipping_id SET DEFAULT nextval('sales.shipping_header_shipping_id_seq'::regclass);




--
--
-- Name: shipping_revision shipping_revision_id; Type: DEFAULT; Schema: sales; Owner: -
-- Name: shipping_revision shipping_revision_id; Type: DEFAULT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_revision ALTER COLUMN shipping_revision_id SET DEFAULT nextval('sales.shipping_revision_shipping_revision_id_seq'::regclass);
ALTER TABLE ONLY sales.shipping_revision ALTER COLUMN shipping_revision_id SET DEFAULT nextval('sales.shipping_revision_shipping_revision_id_seq'::regclass);




--
--
-- Name: ai_signal signal_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: ai_signal signal_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_signal ALTER COLUMN signal_id SET DEFAULT nextval('system.ai_signal_signal_id_seq'::regclass);
ALTER TABLE ONLY system.ai_signal ALTER COLUMN signal_id SET DEFAULT nextval('system.ai_signal_signal_id_seq'::regclass);




--
--
-- Name: ai_task task_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: ai_task task_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_task ALTER COLUMN task_id SET DEFAULT nextval('system.ai_task_task_id_seq'::regclass);
ALTER TABLE ONLY system.ai_task ALTER COLUMN task_id SET DEFAULT nextval('system.ai_task_task_id_seq'::regclass);




--
--
-- Name: ai_task_run run_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: ai_task_run run_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_task_run ALTER COLUMN run_id SET DEFAULT nextval('system.ai_task_run_run_id_seq'::regclass);
ALTER TABLE ONLY system.ai_task_run ALTER COLUMN run_id SET DEFAULT nextval('system.ai_task_run_run_id_seq'::regclass);




--
--
-- Name: approval_action_log approval_action_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: approval_action_log approval_action_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_action_log ALTER COLUMN approval_action_id SET DEFAULT nextval('system.approval_action_log_approval_action_id_seq'::regclass);
ALTER TABLE ONLY system.approval_action_log ALTER COLUMN approval_action_id SET DEFAULT nextval('system.approval_action_log_approval_action_id_seq'::regclass);




--
--
-- Name: approval_request approval_request_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: approval_request approval_request_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_request ALTER COLUMN approval_request_id SET DEFAULT nextval('system.approval_request_approval_request_id_seq'::regclass);
ALTER TABLE ONLY system.approval_request ALTER COLUMN approval_request_id SET DEFAULT nextval('system.approval_request_approval_request_id_seq'::regclass);




--
--
-- Name: exec_run_request request_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: exec_run_request request_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.exec_run_request ALTER COLUMN request_id SET DEFAULT nextval('system.exec_run_request_request_id_seq'::regclass);
ALTER TABLE ONLY system.exec_run_request ALTER COLUMN request_id SET DEFAULT nextval('system.exec_run_request_request_id_seq'::regclass);




--
--
-- Name: loop_autotune_rule rule_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: loop_autotune_rule rule_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_autotune_rule ALTER COLUMN rule_id SET DEFAULT nextval('system.loop_autotune_rule_rule_id_seq'::regclass);
ALTER TABLE ONLY system.loop_autotune_rule ALTER COLUMN rule_id SET DEFAULT nextval('system.loop_autotune_rule_rule_id_seq'::regclass);




--
--
-- Name: loop_sla_stat stat_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: loop_sla_stat stat_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_sla_stat ALTER COLUMN stat_id SET DEFAULT nextval('system.loop_sla_stat_stat_id_seq'::regclass);
ALTER TABLE ONLY system.loop_sla_stat ALTER COLUMN stat_id SET DEFAULT nextval('system.loop_sla_stat_stat_id_seq'::regclass);




--
--
-- Name: loop_tick_log tick_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: loop_tick_log tick_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_tick_log ALTER COLUMN tick_id SET DEFAULT nextval('system.loop_tick_log_tick_id_seq'::regclass);
ALTER TABLE ONLY system.loop_tick_log ALTER COLUMN tick_id SET DEFAULT nextval('system.loop_tick_log_tick_id_seq'::regclass);




--
--
-- Name: operation_log operation_log_id; Type: DEFAULT; Schema: system; Owner: -
-- Name: operation_log operation_log_id; Type: DEFAULT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.operation_log ALTER COLUMN operation_log_id SET DEFAULT nextval('system.operation_log_operation_log_id_seq'::regclass);
ALTER TABLE ONLY system.operation_log ALTER COLUMN operation_log_id SET DEFAULT nextval('system.operation_log_operation_log_id_seq'::regclass);




--
--
-- Name: paper_send_fee_journal paper_send_fee_journal_pkey; Type: CONSTRAINT; Schema: accounting; Owner: -
-- Name: paper_send_fee_journal paper_send_fee_journal_pkey; Type: CONSTRAINT; Schema: accounting; Owner: -
--
--


ALTER TABLE ONLY accounting.paper_send_fee_journal
ALTER TABLE ONLY accounting.paper_send_fee_journal
    ADD CONSTRAINT paper_send_fee_journal_pkey PRIMARY KEY (journal_id);
    ADD CONSTRAINT paper_send_fee_journal_pkey PRIMARY KEY (journal_id);




--
--
-- Name: ai_apply_audit ai_apply_audit_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: ai_apply_audit ai_apply_audit_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_apply_audit
ALTER TABLE ONLY analytics.ai_apply_audit
    ADD CONSTRAINT ai_apply_audit_pkey PRIMARY KEY (audit_id);
    ADD CONSTRAINT ai_apply_audit_pkey PRIMARY KEY (audit_id);




--
--
-- Name: ai_event ai_event_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: ai_event ai_event_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_event
ALTER TABLE ONLY analytics.ai_event
    ADD CONSTRAINT ai_event_pkey PRIMARY KEY (ai_event_id);
    ADD CONSTRAINT ai_event_pkey PRIMARY KEY (ai_event_id);




--
--
-- Name: ai_insight_job ai_insight_job_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: ai_insight_job ai_insight_job_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_insight_job
ALTER TABLE ONLY analytics.ai_insight_job
    ADD CONSTRAINT ai_insight_job_pkey PRIMARY KEY (job_id);
    ADD CONSTRAINT ai_insight_job_pkey PRIMARY KEY (job_id);




--
--
-- Name: ai_job ai_job_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: ai_job ai_job_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_job
ALTER TABLE ONLY analytics.ai_job
    ADD CONSTRAINT ai_job_pkey PRIMARY KEY (ai_job_id);
    ADD CONSTRAINT ai_job_pkey PRIMARY KEY (ai_job_id);




--
--
-- Name: ai_job_type_master ai_job_type_master_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: ai_job_type_master ai_job_type_master_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_job_type_master
ALTER TABLE ONLY analytics.ai_job_type_master
    ADD CONSTRAINT ai_job_type_master_pkey PRIMARY KEY (job_type);
    ADD CONSTRAINT ai_job_type_master_pkey PRIMARY KEY (job_type);




--
--
-- Name: ai_kill_switch ai_kill_switch_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: ai_kill_switch ai_kill_switch_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_kill_switch
ALTER TABLE ONLY analytics.ai_kill_switch
    ADD CONSTRAINT ai_kill_switch_pkey PRIMARY KEY (scope);
    ADD CONSTRAINT ai_kill_switch_pkey PRIMARY KEY (scope);




--
--
-- Name: ai_module_manifest ai_module_manifest_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: ai_module_manifest ai_module_manifest_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_module_manifest
ALTER TABLE ONLY analytics.ai_module_manifest
    ADD CONSTRAINT ai_module_manifest_pkey PRIMARY KEY (module_name);
    ADD CONSTRAINT ai_module_manifest_pkey PRIMARY KEY (module_name);




--
--
-- Name: ai_rate_limit ai_rate_limit_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: ai_rate_limit ai_rate_limit_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.ai_rate_limit
ALTER TABLE ONLY analytics.ai_rate_limit
    ADD CONSTRAINT ai_rate_limit_pkey PRIMARY KEY (job_type);
    ADD CONSTRAINT ai_rate_limit_pkey PRIMARY KEY (job_type);




--
--
-- Name: audit_ai_feedback audit_ai_feedback_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_ai_feedback audit_ai_feedback_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_feedback
ALTER TABLE ONLY analytics.audit_ai_feedback
    ADD CONSTRAINT audit_ai_feedback_pkey PRIMARY KEY (feedback_id);
    ADD CONSTRAINT audit_ai_feedback_pkey PRIMARY KEY (feedback_id);




--
--
-- Name: audit_ai_job audit_ai_job_alert_event_id_key; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_ai_job audit_ai_job_alert_event_id_key; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_job
ALTER TABLE ONLY analytics.audit_ai_job
    ADD CONSTRAINT audit_ai_job_alert_event_id_key UNIQUE (alert_event_id);
    ADD CONSTRAINT audit_ai_job_alert_event_id_key UNIQUE (alert_event_id);




--
--
-- Name: audit_ai_job audit_ai_job_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_ai_job audit_ai_job_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_job
ALTER TABLE ONLY analytics.audit_ai_job
    ADD CONSTRAINT audit_ai_job_pkey PRIMARY KEY (job_id);
    ADD CONSTRAINT audit_ai_job_pkey PRIMARY KEY (job_id);




--
--
-- Name: audit_ai_llm_result audit_ai_llm_result_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_ai_llm_result audit_ai_llm_result_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_llm_result
ALTER TABLE ONLY analytics.audit_ai_llm_result
    ADD CONSTRAINT audit_ai_llm_result_pkey PRIMARY KEY (llm_result_id);
    ADD CONSTRAINT audit_ai_llm_result_pkey PRIMARY KEY (llm_result_id);




--
--
-- Name: audit_alert_ai_judgement audit_alert_ai_judgement_alert_event_id_key; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement audit_alert_ai_judgement_alert_event_id_key; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_ai_judgement
ALTER TABLE ONLY analytics.audit_alert_ai_judgement
    ADD CONSTRAINT audit_alert_ai_judgement_alert_event_id_key UNIQUE (alert_event_id);
    ADD CONSTRAINT audit_alert_ai_judgement_alert_event_id_key UNIQUE (alert_event_id);




--
--
-- Name: audit_alert_ai_judgement audit_alert_ai_judgement_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement audit_alert_ai_judgement_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_ai_judgement
ALTER TABLE ONLY analytics.audit_alert_ai_judgement
    ADD CONSTRAINT audit_alert_ai_judgement_pkey PRIMARY KEY (judgement_id);
    ADD CONSTRAINT audit_alert_ai_judgement_pkey PRIMARY KEY (judgement_id);




--
--
-- Name: audit_alert_event audit_alert_event_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_alert_event audit_alert_event_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_event
ALTER TABLE ONLY analytics.audit_alert_event
    ADD CONSTRAINT audit_alert_event_pkey PRIMARY KEY (alert_event_id);
    ADD CONSTRAINT audit_alert_event_pkey PRIMARY KEY (alert_event_id);




--
--
-- Name: audit_alert_notification audit_alert_notification_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_alert_notification audit_alert_notification_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_notification
ALTER TABLE ONLY analytics.audit_alert_notification
    ADD CONSTRAINT audit_alert_notification_pkey PRIMARY KEY (notification_id);
    ADD CONSTRAINT audit_alert_notification_pkey PRIMARY KEY (notification_id);




--
--
-- Name: audit_alert_rule audit_alert_rule_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_alert_rule audit_alert_rule_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_rule
ALTER TABLE ONLY analytics.audit_alert_rule
    ADD CONSTRAINT audit_alert_rule_pkey PRIMARY KEY (rule_id);
    ADD CONSTRAINT audit_alert_rule_pkey PRIMARY KEY (rule_id);




--
--
-- Name: fact_metric fact_metric_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: fact_metric fact_metric_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.fact_metric
ALTER TABLE ONLY analytics.fact_metric
    ADD CONSTRAINT fact_metric_pkey PRIMARY KEY (fact_id);
    ADD CONSTRAINT fact_metric_pkey PRIMARY KEY (fact_id);




--
--
-- Name: notification_queue notification_queue_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: notification_queue notification_queue_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.notification_queue
ALTER TABLE ONLY analytics.notification_queue
    ADD CONSTRAINT notification_queue_pkey PRIMARY KEY (notification_id);
    ADD CONSTRAINT notification_queue_pkey PRIMARY KEY (notification_id);




--
--
-- Name: sla_breach_event sla_breach_event_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: sla_breach_event sla_breach_event_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.sla_breach_event
ALTER TABLE ONLY analytics.sla_breach_event
    ADD CONSTRAINT sla_breach_event_pkey PRIMARY KEY (breach_id);
    ADD CONSTRAINT sla_breach_event_pkey PRIMARY KEY (breach_id);




--
--
-- Name: sla_definition sla_definition_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: sla_definition sla_definition_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.sla_definition
ALTER TABLE ONLY analytics.sla_definition
    ADD CONSTRAINT sla_definition_pkey PRIMARY KEY (domain);
    ADD CONSTRAINT sla_definition_pkey PRIMARY KEY (domain);




--
--
-- Name: sla_escalation_target sla_escalation_target_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
-- Name: sla_escalation_target sla_escalation_target_pkey; Type: CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.sla_escalation_target
ALTER TABLE ONLY analytics.sla_escalation_target
    ADD CONSTRAINT sla_escalation_target_pkey PRIMARY KEY (domain);
    ADD CONSTRAINT sla_escalation_target_pkey PRIMARY KEY (domain);




--
--
-- Name: ai_improvement_proposal ai_improvement_proposal_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: ai_improvement_proposal ai_improvement_proposal_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.ai_improvement_proposal
ALTER TABLE ONLY approval.ai_improvement_proposal
    ADD CONSTRAINT ai_improvement_proposal_pkey PRIMARY KEY (proposal_id);
    ADD CONSTRAINT ai_improvement_proposal_pkey PRIMARY KEY (proposal_id);




--
--
-- Name: approver approver_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: approver approver_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.approver
ALTER TABLE ONLY approval.approver
    ADD CONSTRAINT approver_pkey PRIMARY KEY (company_id, user_id);
    ADD CONSTRAINT approver_pkey PRIMARY KEY (company_id, user_id);




--
--
-- Name: billing_customer billing_customer_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: billing_customer billing_customer_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.billing_customer
ALTER TABLE ONLY approval.billing_customer
    ADD CONSTRAINT billing_customer_pkey PRIMARY KEY (customer_code);
    ADD CONSTRAINT billing_customer_pkey PRIMARY KEY (customer_code);




--
--
-- Name: billing_invoice billing_invoice_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: billing_invoice billing_invoice_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.billing_invoice
ALTER TABLE ONLY approval.billing_invoice
    ADD CONSTRAINT billing_invoice_pkey PRIMARY KEY (invoice_id);
    ADD CONSTRAINT billing_invoice_pkey PRIMARY KEY (invoice_id);




--
--
-- Name: billing_payment billing_payment_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: billing_payment billing_payment_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.billing_payment
ALTER TABLE ONLY approval.billing_payment
    ADD CONSTRAINT billing_payment_pkey PRIMARY KEY (payment_id);
    ADD CONSTRAINT billing_payment_pkey PRIMARY KEY (payment_id);




--
--
-- Name: company_cost company_cost_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: company_cost company_cost_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.company_cost
ALTER TABLE ONLY approval.company_cost
    ADD CONSTRAINT company_cost_pkey PRIMARY KEY (company_id);
    ADD CONSTRAINT company_cost_pkey PRIMARY KEY (company_id);




--
--
-- Name: company_plan company_plan_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: company_plan company_plan_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.company_plan
ALTER TABLE ONLY approval.company_plan
    ADD CONSTRAINT company_plan_pkey PRIMARY KEY (company_id);
    ADD CONSTRAINT company_plan_pkey PRIMARY KEY (company_id);




--
--
-- Name: feature_flag feature_flag_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: feature_flag feature_flag_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.feature_flag
ALTER TABLE ONLY approval.feature_flag
    ADD CONSTRAINT feature_flag_pkey PRIMARY KEY (company_id, feature_key);
    ADD CONSTRAINT feature_flag_pkey PRIMARY KEY (company_id, feature_key);




--
--
-- Name: invoice_delivery_log invoice_delivery_log_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: invoice_delivery_log invoice_delivery_log_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.invoice_delivery_log
ALTER TABLE ONLY approval.invoice_delivery_log
    ADD CONSTRAINT invoice_delivery_log_pkey PRIMARY KEY (delivery_id);
    ADD CONSTRAINT invoice_delivery_log_pkey PRIMARY KEY (delivery_id);




--
--
-- Name: jsox_control jsox_control_control_code_key; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: jsox_control jsox_control_control_code_key; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.jsox_control
ALTER TABLE ONLY approval.jsox_control
    ADD CONSTRAINT jsox_control_control_code_key UNIQUE (control_code);
    ADD CONSTRAINT jsox_control_control_code_key UNIQUE (control_code);




--
--
-- Name: jsox_control jsox_control_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: jsox_control jsox_control_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.jsox_control
ALTER TABLE ONLY approval.jsox_control
    ADD CONSTRAINT jsox_control_pkey PRIMARY KEY (control_id);
    ADD CONSTRAINT jsox_control_pkey PRIMARY KEY (control_id);




--
--
-- Name: jsox_evidence_log jsox_evidence_log_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: jsox_evidence_log jsox_evidence_log_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.jsox_evidence_log
ALTER TABLE ONLY approval.jsox_evidence_log
    ADD CONSTRAINT jsox_evidence_log_pkey PRIMARY KEY (evidence_id);
    ADD CONSTRAINT jsox_evidence_log_pkey PRIMARY KEY (evidence_id);




--
--
-- Name: lp_copy_i18n lp_copy_i18n_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: lp_copy_i18n lp_copy_i18n_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.lp_copy_i18n
ALTER TABLE ONLY approval.lp_copy_i18n
    ADD CONSTRAINT lp_copy_i18n_pkey PRIMARY KEY (lang, copy_key);
    ADD CONSTRAINT lp_copy_i18n_pkey PRIMARY KEY (lang, copy_key);




--
--
-- Name: payment_provider payment_provider_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: payment_provider payment_provider_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.payment_provider
ALTER TABLE ONLY approval.payment_provider
    ADD CONSTRAINT payment_provider_pkey PRIMARY KEY (provider_code);
    ADD CONSTRAINT payment_provider_pkey PRIMARY KEY (provider_code);




--
--
-- Name: plan_master plan_master_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: plan_master plan_master_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.plan_master
ALTER TABLE ONLY approval.plan_master
    ADD CONSTRAINT plan_master_pkey PRIMARY KEY (plan_code);
    ADD CONSTRAINT plan_master_pkey PRIMARY KEY (plan_code);




--
--
-- Name: policy_activation_log policy_activation_log_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: policy_activation_log policy_activation_log_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.policy_activation_log
ALTER TABLE ONLY approval.policy_activation_log
    ADD CONSTRAINT policy_activation_log_pkey PRIMARY KEY (log_id);
    ADD CONSTRAINT policy_activation_log_pkey PRIMARY KEY (log_id);




--
--
-- Name: policy_auto_generated policy_auto_generated_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: policy_auto_generated policy_auto_generated_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.policy_auto_generated
ALTER TABLE ONLY approval.policy_auto_generated
    ADD CONSTRAINT policy_auto_generated_pkey PRIMARY KEY (auto_policy_id);
    ADD CONSTRAINT policy_auto_generated_pkey PRIMARY KEY (auto_policy_id);




--
--
-- Name: policy_eval_event policy_eval_event_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: policy_eval_event policy_eval_event_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.policy_eval_event
ALTER TABLE ONLY approval.policy_eval_event
    ADD CONSTRAINT policy_eval_event_pkey PRIMARY KEY (eval_id);
    ADD CONSTRAINT policy_eval_event_pkey PRIMARY KEY (eval_id);




--
--
-- Name: policy_rollout_log policy_rollout_log_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: policy_rollout_log policy_rollout_log_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.policy_rollout_log
ALTER TABLE ONLY approval.policy_rollout_log
    ADD CONSTRAINT policy_rollout_log_pkey PRIMARY KEY (log_id);
    ADD CONSTRAINT policy_rollout_log_pkey PRIMARY KEY (log_id);




--
--
-- Name: policy_rollout policy_rollout_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: policy_rollout policy_rollout_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.policy_rollout
ALTER TABLE ONLY approval.policy_rollout
    ADD CONSTRAINT policy_rollout_pkey PRIMARY KEY (auto_policy_id);
    ADD CONSTRAINT policy_rollout_pkey PRIMARY KEY (auto_policy_id);




--
--
-- Name: public_pricing public_pricing_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: public_pricing public_pricing_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.public_pricing
ALTER TABLE ONLY approval.public_pricing
    ADD CONSTRAINT public_pricing_pkey PRIMARY KEY (plan_code);
    ADD CONSTRAINT public_pricing_pkey PRIMARY KEY (plan_code);




--
--
-- Name: rework_task rework_task_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: rework_task rework_task_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.rework_task
ALTER TABLE ONLY approval.rework_task
    ADD CONSTRAINT rework_task_pkey PRIMARY KEY (task_id);
    ADD CONSTRAINT rework_task_pkey PRIMARY KEY (task_id);




--
--
-- Name: saas_company_map saas_company_map_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: saas_company_map saas_company_map_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.saas_company_map
ALTER TABLE ONLY approval.saas_company_map
    ADD CONSTRAINT saas_company_map_pkey PRIMARY KEY (subscription_id, company_id);
    ADD CONSTRAINT saas_company_map_pkey PRIMARY KEY (subscription_id, company_id);




--
--
-- Name: saas_plan_limit saas_plan_limit_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: saas_plan_limit saas_plan_limit_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.saas_plan_limit
ALTER TABLE ONLY approval.saas_plan_limit
    ADD CONSTRAINT saas_plan_limit_pkey PRIMARY KEY (plan_code);
    ADD CONSTRAINT saas_plan_limit_pkey PRIMARY KEY (plan_code);




--
--
-- Name: saas_plan saas_plan_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: saas_plan saas_plan_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.saas_plan
ALTER TABLE ONLY approval.saas_plan
    ADD CONSTRAINT saas_plan_pkey PRIMARY KEY (plan_code);
    ADD CONSTRAINT saas_plan_pkey PRIMARY KEY (plan_code);




--
--
-- Name: saas_subscription saas_subscription_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: saas_subscription saas_subscription_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.saas_subscription
ALTER TABLE ONLY approval.saas_subscription
    ADD CONSTRAINT saas_subscription_pkey PRIMARY KEY (subscription_id);
    ADD CONSTRAINT saas_subscription_pkey PRIMARY KEY (subscription_id);




--
--
-- Name: saas_usage_daily saas_usage_daily_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: saas_usage_daily saas_usage_daily_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.saas_usage_daily
ALTER TABLE ONLY approval.saas_usage_daily
    ADD CONSTRAINT saas_usage_daily_pkey PRIMARY KEY (company_id, day);
    ADD CONSTRAINT saas_usage_daily_pkey PRIMARY KEY (company_id, day);




--
--
-- Name: saas_usage_monthly saas_usage_monthly_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: saas_usage_monthly saas_usage_monthly_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.saas_usage_monthly
ALTER TABLE ONLY approval.saas_usage_monthly
    ADD CONSTRAINT saas_usage_monthly_pkey PRIMARY KEY (subscription_id, ym);
    ADD CONSTRAINT saas_usage_monthly_pkey PRIMARY KEY (subscription_id, ym);




--
--
-- Name: stripe_webhook_event stripe_webhook_event_event_id_key; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: stripe_webhook_event stripe_webhook_event_event_id_key; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.stripe_webhook_event
ALTER TABLE ONLY approval.stripe_webhook_event
    ADD CONSTRAINT stripe_webhook_event_event_id_key UNIQUE (event_id);
    ADD CONSTRAINT stripe_webhook_event_event_id_key UNIQUE (event_id);




--
--
-- Name: stripe_webhook_event stripe_webhook_event_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
-- Name: stripe_webhook_event stripe_webhook_event_pkey; Type: CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.stripe_webhook_event
ALTER TABLE ONLY approval.stripe_webhook_event
    ADD CONSTRAINT stripe_webhook_event_pkey PRIMARY KEY (id);
    ADD CONSTRAINT stripe_webhook_event_pkey PRIMARY KEY (id);




--
--
-- Name: approval_log approval_log_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: approval_log approval_log_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.approval_log
ALTER TABLE ONLY audit.approval_log
    ADD CONSTRAINT approval_log_pkey PRIMARY KEY (approval_log_id);
    ADD CONSTRAINT approval_log_pkey PRIMARY KEY (approval_log_id);




--
--
-- Name: approval_notify_queue approval_notify_queue_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: approval_notify_queue approval_notify_queue_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.approval_notify_queue
ALTER TABLE ONLY audit.approval_notify_queue
    ADD CONSTRAINT approval_notify_queue_pkey PRIMARY KEY (notify_id);
    ADD CONSTRAINT approval_notify_queue_pkey PRIMARY KEY (notify_id);




--
--
-- Name: approval_reason_template approval_reason_template_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: approval_reason_template approval_reason_template_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.approval_reason_template
ALTER TABLE ONLY audit.approval_reason_template
    ADD CONSTRAINT approval_reason_template_pkey PRIMARY KEY (template_id);
    ADD CONSTRAINT approval_reason_template_pkey PRIMARY KEY (template_id);




--
--
-- Name: approval_request approval_request_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: approval_request approval_request_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.approval_request
ALTER TABLE ONLY audit.approval_request
    ADD CONSTRAINT approval_request_pkey PRIMARY KEY (request_id);
    ADD CONSTRAINT approval_request_pkey PRIMARY KEY (request_id);




--
--
-- Name: audit_event audit_event_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: audit_event audit_event_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.audit_event
ALTER TABLE ONLY audit.audit_event
    ADD CONSTRAINT audit_event_pkey PRIMARY KEY (audit_event_id);
    ADD CONSTRAINT audit_event_pkey PRIMARY KEY (audit_event_id);




--
--
-- Name: audit_reason_policy audit_reason_policy_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: audit_reason_policy audit_reason_policy_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.audit_reason_policy
ALTER TABLE ONLY audit.audit_reason_policy
    ADD CONSTRAINT audit_reason_policy_pkey PRIMARY KEY (reason_code);
    ADD CONSTRAINT audit_reason_policy_pkey PRIMARY KEY (reason_code);




--
--
-- Name: audit_target_table audit_target_table_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: audit_target_table audit_target_table_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.audit_target_table
ALTER TABLE ONLY audit.audit_target_table
    ADD CONSTRAINT audit_target_table_pkey PRIMARY KEY (table_schema, table_name);
    ADD CONSTRAINT audit_target_table_pkey PRIMARY KEY (table_schema, table_name);




--
--
-- Name: audit_trail_db audit_trail_db_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: audit_trail_db audit_trail_db_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.audit_trail_db
ALTER TABLE ONLY audit.audit_trail_db
    ADD CONSTRAINT audit_trail_db_pkey PRIMARY KEY (audit_trail_db_id);
    ADD CONSTRAINT audit_trail_db_pkey PRIMARY KEY (audit_trail_db_id);




--
--
-- Name: entity_status_history entity_status_history_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: entity_status_history entity_status_history_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.entity_status_history
ALTER TABLE ONLY audit.entity_status_history
    ADD CONSTRAINT entity_status_history_pkey PRIMARY KEY (status_history_id);
    ADD CONSTRAINT entity_status_history_pkey PRIMARY KEY (status_history_id);




--
--
-- Name: exec_audit_event exec_audit_event_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: exec_audit_event exec_audit_event_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.exec_audit_event
ALTER TABLE ONLY audit.exec_audit_event
    ADD CONSTRAINT exec_audit_event_pkey PRIMARY KEY (audit_event_id);
    ADD CONSTRAINT exec_audit_event_pkey PRIMARY KEY (audit_event_id);




--
--
-- Name: ng_event ng_event_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: ng_event ng_event_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.ng_event
ALTER TABLE ONLY audit.ng_event
    ADD CONSTRAINT ng_event_pkey PRIMARY KEY (ng_event_id);
    ADD CONSTRAINT ng_event_pkey PRIMARY KEY (ng_event_id);




--
--
-- Name: notification_channel notification_channel_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: notification_channel notification_channel_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.notification_channel
ALTER TABLE ONLY audit.notification_channel
    ADD CONSTRAINT notification_channel_pkey PRIMARY KEY (channel_id);
    ADD CONSTRAINT notification_channel_pkey PRIMARY KEY (channel_id);




--
--
-- Name: ops_audit_log ops_audit_log_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: ops_audit_log ops_audit_log_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.ops_audit_log
ALTER TABLE ONLY audit.ops_audit_log
    ADD CONSTRAINT ops_audit_log_pkey PRIMARY KEY (audit_id);
    ADD CONSTRAINT ops_audit_log_pkey PRIMARY KEY (audit_id);




--
--
-- Name: slack_interaction_log slack_interaction_log_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
-- Name: slack_interaction_log slack_interaction_log_pkey; Type: CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.slack_interaction_log
ALTER TABLE ONLY audit.slack_interaction_log
    ADD CONSTRAINT slack_interaction_log_pkey PRIMARY KEY (interaction_id);
    ADD CONSTRAINT slack_interaction_log_pkey PRIMARY KEY (interaction_id);




--
--
-- Name: mfa_amr_claims amr_id_pk; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: mfa_amr_claims amr_id_pk; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT amr_id_pk PRIMARY KEY (id);
    ADD CONSTRAINT amr_id_pk PRIMARY KEY (id);




--
--
-- Name: audit_log_entries audit_log_entries_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: audit_log_entries audit_log_entries_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT audit_log_entries_pkey PRIMARY KEY (id);
    ADD CONSTRAINT audit_log_entries_pkey PRIMARY KEY (id);




--
--
-- Name: flow_state flow_state_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: flow_state flow_state_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT flow_state_pkey PRIMARY KEY (id);
    ADD CONSTRAINT flow_state_pkey PRIMARY KEY (id);




--
--
-- Name: identities identities_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: identities identities_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT identities_pkey PRIMARY KEY (id);
    ADD CONSTRAINT identities_pkey PRIMARY KEY (id);




--
--
-- Name: identities identities_provider_id_provider_unique; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: identities identities_provider_id_provider_unique; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT identities_provider_id_provider_unique UNIQUE (provider_id, provider);
    ADD CONSTRAINT identities_provider_id_provider_unique UNIQUE (provider_id, provider);




--
--
-- Name: instances instances_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: instances instances_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT instances_pkey PRIMARY KEY (id);
    ADD CONSTRAINT instances_pkey PRIMARY KEY (id);




--
--
-- Name: mfa_amr_claims mfa_amr_claims_session_id_authentication_method_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: mfa_amr_claims mfa_amr_claims_session_id_authentication_method_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT mfa_amr_claims_session_id_authentication_method_pkey UNIQUE (session_id, authentication_method);
    ADD CONSTRAINT mfa_amr_claims_session_id_authentication_method_pkey UNIQUE (session_id, authentication_method);




--
--
-- Name: mfa_challenges mfa_challenges_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: mfa_challenges mfa_challenges_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT mfa_challenges_pkey PRIMARY KEY (id);
    ADD CONSTRAINT mfa_challenges_pkey PRIMARY KEY (id);




--
--
-- Name: mfa_factors mfa_factors_last_challenged_at_key; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: mfa_factors mfa_factors_last_challenged_at_key; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT mfa_factors_last_challenged_at_key UNIQUE (last_challenged_at);
    ADD CONSTRAINT mfa_factors_last_challenged_at_key UNIQUE (last_challenged_at);




--
--
-- Name: mfa_factors mfa_factors_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: mfa_factors mfa_factors_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT mfa_factors_pkey PRIMARY KEY (id);
    ADD CONSTRAINT mfa_factors_pkey PRIMARY KEY (id);




--
--
-- Name: oauth_authorizations oauth_authorizations_authorization_code_key; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_authorizations oauth_authorizations_authorization_code_key; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_authorizations_authorization_code_key UNIQUE (authorization_code);
    ADD CONSTRAINT oauth_authorizations_authorization_code_key UNIQUE (authorization_code);




--
--
-- Name: oauth_authorizations oauth_authorizations_authorization_id_key; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_authorizations oauth_authorizations_authorization_id_key; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_authorizations_authorization_id_key UNIQUE (authorization_id);
    ADD CONSTRAINT oauth_authorizations_authorization_id_key UNIQUE (authorization_id);




--
--
-- Name: oauth_authorizations oauth_authorizations_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_authorizations oauth_authorizations_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_authorizations_pkey PRIMARY KEY (id);
    ADD CONSTRAINT oauth_authorizations_pkey PRIMARY KEY (id);




--
--
-- Name: oauth_client_states oauth_client_states_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_client_states oauth_client_states_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_client_states_pkey PRIMARY KEY (id);
    ADD CONSTRAINT oauth_client_states_pkey PRIMARY KEY (id);




--
--
-- Name: oauth_clients oauth_clients_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_clients oauth_clients_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_clients_pkey PRIMARY KEY (id);
    ADD CONSTRAINT oauth_clients_pkey PRIMARY KEY (id);




--
--
-- Name: oauth_consents oauth_consents_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_consents oauth_consents_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_consents_pkey PRIMARY KEY (id);
    ADD CONSTRAINT oauth_consents_pkey PRIMARY KEY (id);




--
--
-- Name: oauth_consents oauth_consents_user_client_unique; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_consents oauth_consents_user_client_unique; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_consents_user_client_unique UNIQUE (user_id, client_id);
    ADD CONSTRAINT oauth_consents_user_client_unique UNIQUE (user_id, client_id);




--
--
-- Name: one_time_tokens one_time_tokens_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: one_time_tokens one_time_tokens_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT one_time_tokens_pkey PRIMARY KEY (id);
    ADD CONSTRAINT one_time_tokens_pkey PRIMARY KEY (id);




--
--
-- Name: refresh_tokens refresh_tokens_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: refresh_tokens refresh_tokens_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT refresh_tokens_pkey PRIMARY KEY (id);
    ADD CONSTRAINT refresh_tokens_pkey PRIMARY KEY (id);




--
--
-- Name: refresh_tokens refresh_tokens_token_unique; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: refresh_tokens refresh_tokens_token_unique; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT refresh_tokens_token_unique UNIQUE (token);
    ADD CONSTRAINT refresh_tokens_token_unique UNIQUE (token);




--
--
-- Name: saml_providers saml_providers_entity_id_key; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: saml_providers saml_providers_entity_id_key; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT saml_providers_entity_id_key UNIQUE (entity_id);
    ADD CONSTRAINT saml_providers_entity_id_key UNIQUE (entity_id);




--
--
-- Name: saml_providers saml_providers_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: saml_providers saml_providers_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT saml_providers_pkey PRIMARY KEY (id);
    ADD CONSTRAINT saml_providers_pkey PRIMARY KEY (id);




--
--
-- Name: saml_relay_states saml_relay_states_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: saml_relay_states saml_relay_states_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT saml_relay_states_pkey PRIMARY KEY (id);
    ADD CONSTRAINT saml_relay_states_pkey PRIMARY KEY (id);




--
--
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);
    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);




--
--
-- Name: sessions sessions_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: sessions sessions_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT sessions_pkey PRIMARY KEY (id);
    ADD CONSTRAINT sessions_pkey PRIMARY KEY (id);




--
--
-- Name: sso_domains sso_domains_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: sso_domains sso_domains_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT sso_domains_pkey PRIMARY KEY (id);
    ADD CONSTRAINT sso_domains_pkey PRIMARY KEY (id);




--
--
-- Name: sso_providers sso_providers_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: sso_providers sso_providers_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT sso_providers_pkey PRIMARY KEY (id);
    ADD CONSTRAINT sso_providers_pkey PRIMARY KEY (id);




--
--
-- Name: users users_phone_key; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: users users_phone_key; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT users_phone_key UNIQUE (phone);
    ADD CONSTRAINT users_phone_key UNIQUE (phone);




--
--
-- Name: users users_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
-- Name: users users_pkey; Type: CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT users_pkey PRIMARY KEY (id);
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);




--
--
-- Name: checkout_session checkout_session_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
-- Name: checkout_session checkout_session_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.checkout_session
ALTER TABLE ONLY billing.checkout_session
    ADD CONSTRAINT checkout_session_pkey PRIMARY KEY (checkout_id);
    ADD CONSTRAINT checkout_session_pkey PRIMARY KEY (checkout_id);




--
--
-- Name: customer_profile customer_profile_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
-- Name: customer_profile customer_profile_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.customer_profile
ALTER TABLE ONLY billing.customer_profile
    ADD CONSTRAINT customer_profile_pkey PRIMARY KEY (customer_code);
    ADD CONSTRAINT customer_profile_pkey PRIMARY KEY (customer_code);




--
--
-- Name: invoice_line invoice_line_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
-- Name: invoice_line invoice_line_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.invoice_line
ALTER TABLE ONLY billing.invoice_line
    ADD CONSTRAINT invoice_line_pkey PRIMARY KEY (invoice_line_id);
    ADD CONSTRAINT invoice_line_pkey PRIMARY KEY (invoice_line_id);




--
--
-- Name: invoice invoice_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
-- Name: invoice invoice_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.invoice
ALTER TABLE ONLY billing.invoice
    ADD CONSTRAINT invoice_pkey PRIMARY KEY (invoice_id);
    ADD CONSTRAINT invoice_pkey PRIMARY KEY (invoice_id);




--
--
-- Name: invoice_send_audit invoice_send_audit_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
-- Name: invoice_send_audit invoice_send_audit_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.invoice_send_audit
ALTER TABLE ONLY billing.invoice_send_audit
    ADD CONSTRAINT invoice_send_audit_pkey PRIMARY KEY (audit_id);
    ADD CONSTRAINT invoice_send_audit_pkey PRIMARY KEY (audit_id);




--
--
-- Name: invoice_send_retry invoice_send_retry_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
-- Name: invoice_send_retry invoice_send_retry_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.invoice_send_retry
ALTER TABLE ONLY billing.invoice_send_retry
    ADD CONSTRAINT invoice_send_retry_pkey PRIMARY KEY (retry_id);
    ADD CONSTRAINT invoice_send_retry_pkey PRIMARY KEY (retry_id);




--
--
-- Name: invoice_template invoice_template_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
-- Name: invoice_template invoice_template_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.invoice_template
ALTER TABLE ONLY billing.invoice_template
    ADD CONSTRAINT invoice_template_pkey PRIMARY KEY (template_code);
    ADD CONSTRAINT invoice_template_pkey PRIMARY KEY (template_code);




--
--
-- Name: issuer_profile issuer_profile_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
-- Name: issuer_profile issuer_profile_pkey; Type: CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.issuer_profile
ALTER TABLE ONLY billing.issuer_profile
    ADD CONSTRAINT issuer_profile_pkey PRIMARY KEY (company_id);
    ADD CONSTRAINT issuer_profile_pkey PRIMARY KEY (company_id);




--
--
-- Name: escalation_outbox escalation_outbox_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: escalation_outbox escalation_outbox_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.escalation_outbox
ALTER TABLE ONLY ci.escalation_outbox
    ADD CONSTRAINT escalation_outbox_pkey PRIMARY KEY (outbox_id);
    ADD CONSTRAINT escalation_outbox_pkey PRIMARY KEY (outbox_id);




--
--
-- Name: json_schema_check_log json_schema_check_log_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: json_schema_check_log json_schema_check_log_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.json_schema_check_log
ALTER TABLE ONLY ci.json_schema_check_log
    ADD CONSTRAINT json_schema_check_log_pkey PRIMARY KEY (check_id);
    ADD CONSTRAINT json_schema_check_log_pkey PRIMARY KEY (check_id);




--
--
-- Name: kill_switch kill_switch_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: kill_switch kill_switch_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.kill_switch
ALTER TABLE ONLY ci.kill_switch
    ADD CONSTRAINT kill_switch_pkey PRIMARY KEY (switch_name);
    ADD CONSTRAINT kill_switch_pkey PRIMARY KEY (switch_name);




--
--
-- Name: ops_notification_queue ops_notification_queue_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: ops_notification_queue ops_notification_queue_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.ops_notification_queue
ALTER TABLE ONLY ci.ops_notification_queue
    ADD CONSTRAINT ops_notification_queue_pkey PRIMARY KEY (notification_id);
    ADD CONSTRAINT ops_notification_queue_pkey PRIMARY KEY (notification_id);




--
--
-- Name: schema_ai_review_job schema_ai_review_job_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: schema_ai_review_job schema_ai_review_job_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.schema_ai_review_job
ALTER TABLE ONLY ci.schema_ai_review_job
    ADD CONSTRAINT schema_ai_review_job_pkey PRIMARY KEY (job_id);
    ADD CONSTRAINT schema_ai_review_job_pkey PRIMARY KEY (job_id);




--
--
-- Name: schema_ai_review_job schema_ai_review_job_request_id_key; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: schema_ai_review_job schema_ai_review_job_request_id_key; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.schema_ai_review_job
ALTER TABLE ONLY ci.schema_ai_review_job
    ADD CONSTRAINT schema_ai_review_job_request_id_key UNIQUE (request_id);
    ADD CONSTRAINT schema_ai_review_job_request_id_key UNIQUE (request_id);




--
--
-- Name: schema_change_request schema_change_request_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: schema_change_request schema_change_request_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.schema_change_request
ALTER TABLE ONLY ci.schema_change_request
    ADD CONSTRAINT schema_change_request_pkey PRIMARY KEY (request_id);
    ADD CONSTRAINT schema_change_request_pkey PRIMARY KEY (request_id);




--
--
-- Name: schema_review_prompt_template schema_review_prompt_template_domain_schema_name_key; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: schema_review_prompt_template schema_review_prompt_template_domain_schema_name_key; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.schema_review_prompt_template
ALTER TABLE ONLY ci.schema_review_prompt_template
    ADD CONSTRAINT schema_review_prompt_template_domain_schema_name_key UNIQUE (domain, schema_name);
    ADD CONSTRAINT schema_review_prompt_template_domain_schema_name_key UNIQUE (domain, schema_name);




--
--
-- Name: schema_review_prompt_template schema_review_prompt_template_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: schema_review_prompt_template schema_review_prompt_template_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.schema_review_prompt_template
ALTER TABLE ONLY ci.schema_review_prompt_template
    ADD CONSTRAINT schema_review_prompt_template_pkey PRIMARY KEY (template_id);
    ADD CONSTRAINT schema_review_prompt_template_pkey PRIMARY KEY (template_id);




--
--
-- Name: schema_review_summary schema_review_summary_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: schema_review_summary schema_review_summary_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.schema_review_summary
ALTER TABLE ONLY ci.schema_review_summary
    ADD CONSTRAINT schema_review_summary_pkey PRIMARY KEY (request_id);
    ADD CONSTRAINT schema_review_summary_pkey PRIMARY KEY (request_id);




--
--
-- Name: sla_escalation_policy sla_escalation_policy_domain_key; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: sla_escalation_policy sla_escalation_policy_domain_key; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.sla_escalation_policy
ALTER TABLE ONLY ci.sla_escalation_policy
    ADD CONSTRAINT sla_escalation_policy_domain_key UNIQUE (domain);
    ADD CONSTRAINT sla_escalation_policy_domain_key UNIQUE (domain);




--
--
-- Name: sla_escalation_policy sla_escalation_policy_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: sla_escalation_policy sla_escalation_policy_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.sla_escalation_policy
ALTER TABLE ONLY ci.sla_escalation_policy
    ADD CONSTRAINT sla_escalation_policy_pkey PRIMARY KEY (policy_id);
    ADD CONSTRAINT sla_escalation_policy_pkey PRIMARY KEY (policy_id);




--
--
-- Name: slack_approval_audit slack_approval_audit_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: slack_approval_audit slack_approval_audit_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.slack_approval_audit
ALTER TABLE ONLY ci.slack_approval_audit
    ADD CONSTRAINT slack_approval_audit_pkey PRIMARY KEY (audit_id);
    ADD CONSTRAINT slack_approval_audit_pkey PRIMARY KEY (audit_id);




--
--
-- Name: slack_interaction_log slack_interaction_log_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
-- Name: slack_interaction_log slack_interaction_log_pkey; Type: CONSTRAINT; Schema: ci; Owner: -
--
--


ALTER TABLE ONLY ci.slack_interaction_log
ALTER TABLE ONLY ci.slack_interaction_log
    ADD CONSTRAINT slack_interaction_log_pkey PRIMARY KEY (interaction_id);
    ADD CONSTRAINT slack_interaction_log_pkey PRIMARY KEY (interaction_id);




--
--
-- Name: audit_action audit_action_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_action audit_action_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_action
ALTER TABLE ONLY compliance.audit_action
    ADD CONSTRAINT audit_action_pkey PRIMARY KEY (audit_action_id);
    ADD CONSTRAINT audit_action_pkey PRIMARY KEY (audit_action_id);




--
--
-- Name: audit_event audit_event_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_event audit_event_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_event
ALTER TABLE ONLY compliance.audit_event
    ADD CONSTRAINT audit_event_pkey PRIMARY KEY (audit_event_id);
    ADD CONSTRAINT audit_event_pkey PRIMARY KEY (audit_event_id);




--
--
-- Name: audit_issue audit_issue_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_issue audit_issue_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_issue
ALTER TABLE ONLY compliance.audit_issue
    ADD CONSTRAINT audit_issue_pkey PRIMARY KEY (audit_issue_id);
    ADD CONSTRAINT audit_issue_pkey PRIMARY KEY (audit_issue_id);




--
--
-- Name: iso_clause iso_clause_iso_standard_id_clause_code_key; Type: CONSTRAINT; Schema: compliance; Owner: -
-- Name: iso_clause iso_clause_iso_standard_id_clause_code_key; Type: CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.iso_clause
ALTER TABLE ONLY compliance.iso_clause
    ADD CONSTRAINT iso_clause_iso_standard_id_clause_code_key UNIQUE (iso_standard_id, clause_code);
    ADD CONSTRAINT iso_clause_iso_standard_id_clause_code_key UNIQUE (iso_standard_id, clause_code);




--
--
-- Name: iso_clause iso_clause_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
-- Name: iso_clause iso_clause_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.iso_clause
ALTER TABLE ONLY compliance.iso_clause
    ADD CONSTRAINT iso_clause_pkey PRIMARY KEY (iso_clause_id);
    ADD CONSTRAINT iso_clause_pkey PRIMARY KEY (iso_clause_id);




--
--
-- Name: iso_standard iso_standard_iso_code_key; Type: CONSTRAINT; Schema: compliance; Owner: -
-- Name: iso_standard iso_standard_iso_code_key; Type: CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.iso_standard
ALTER TABLE ONLY compliance.iso_standard
    ADD CONSTRAINT iso_standard_iso_code_key UNIQUE (iso_code);
    ADD CONSTRAINT iso_standard_iso_code_key UNIQUE (iso_code);




--
--
-- Name: iso_standard iso_standard_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
-- Name: iso_standard iso_standard_pkey; Type: CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.iso_standard
ALTER TABLE ONLY compliance.iso_standard
    ADD CONSTRAINT iso_standard_pkey PRIMARY KEY (iso_standard_id);
    ADD CONSTRAINT iso_standard_pkey PRIMARY KEY (iso_standard_id);




--
--
-- Name: accounting_period accounting_period_company_id_period_year_period_month_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: accounting_period accounting_period_company_id_period_year_period_month_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.accounting_period
ALTER TABLE ONLY core.accounting_period
    ADD CONSTRAINT accounting_period_company_id_period_year_period_month_key UNIQUE (company_id, period_year, period_month);
    ADD CONSTRAINT accounting_period_company_id_period_year_period_month_key UNIQUE (company_id, period_year, period_month);




--
--
-- Name: accounting_period accounting_period_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: accounting_period accounting_period_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.accounting_period
ALTER TABLE ONLY core.accounting_period
    ADD CONSTRAINT accounting_period_pkey PRIMARY KEY (period_id);
    ADD CONSTRAINT accounting_period_pkey PRIMARY KEY (period_id);




--
--
-- Name: accounts accounts_company_id_account_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: accounts accounts_company_id_account_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.accounts
ALTER TABLE ONLY core.accounts
    ADD CONSTRAINT accounts_company_id_account_code_key UNIQUE (company_id, account_code);
    ADD CONSTRAINT accounts_company_id_account_code_key UNIQUE (company_id, account_code);




--
--
-- Name: accounts accounts_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: accounts accounts_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.accounts
ALTER TABLE ONLY core.accounts
    ADD CONSTRAINT accounts_pkey PRIMARY KEY (account_id);
    ADD CONSTRAINT accounts_pkey PRIMARY KEY (account_id);




--
--
-- Name: app_user app_user_email_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: app_user app_user_email_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.app_user
ALTER TABLE ONLY core.app_user
    ADD CONSTRAINT app_user_email_key UNIQUE (email);
    ADD CONSTRAINT app_user_email_key UNIQUE (email);




--
--
-- Name: app_user app_user_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: app_user app_user_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.app_user
ALTER TABLE ONLY core.app_user
    ADD CONSTRAINT app_user_pkey PRIMARY KEY (user_id);
    ADD CONSTRAINT app_user_pkey PRIMARY KEY (user_id);




--
--
-- Name: audit_column_weight audit_column_weight_company_id_entity_type_like_column_name_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_column_weight audit_column_weight_company_id_entity_type_like_column_name_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_column_weight
ALTER TABLE ONLY core.audit_column_weight
    ADD CONSTRAINT audit_column_weight_company_id_entity_type_like_column_name_key UNIQUE (company_id, entity_type_like, column_name);
    ADD CONSTRAINT audit_column_weight_company_id_entity_type_like_column_name_key UNIQUE (company_id, entity_type_like, column_name);




--
--
-- Name: audit_column_weight audit_column_weight_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_column_weight audit_column_weight_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_column_weight
ALTER TABLE ONLY core.audit_column_weight
    ADD CONSTRAINT audit_column_weight_pkey PRIMARY KEY (column_weight_id);
    ADD CONSTRAINT audit_column_weight_pkey PRIMARY KEY (column_weight_id);




--
--
-- Name: audit_entity_pk_map audit_entity_pk_map_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_entity_pk_map audit_entity_pk_map_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_entity_pk_map
ALTER TABLE ONLY core.audit_entity_pk_map
    ADD CONSTRAINT audit_entity_pk_map_pkey PRIMARY KEY (schema_name, table_name);
    ADD CONSTRAINT audit_entity_pk_map_pkey PRIMARY KEY (schema_name, table_name);




--
--
-- Name: audit_impact_rule audit_impact_rule_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_impact_rule audit_impact_rule_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_impact_rule
ALTER TABLE ONLY core.audit_impact_rule
    ADD CONSTRAINT audit_impact_rule_pkey PRIMARY KEY (rule_id);
    ADD CONSTRAINT audit_impact_rule_pkey PRIMARY KEY (rule_id);




--
--
-- Name: audit_trail audit_trail_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail audit_trail_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail
ALTER TABLE ONLY core.audit_trail
    ADD CONSTRAINT audit_trail_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: audit_trail_2025_12 audit_trail_2025_12_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail_2025_12 audit_trail_2025_12_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail_2025_12
ALTER TABLE ONLY core.audit_trail_2025_12
    ADD CONSTRAINT audit_trail_2025_12_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_2025_12_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: audit_trail_2026_01 audit_trail_2026_01_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail_2026_01 audit_trail_2026_01_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail_2026_01
ALTER TABLE ONLY core.audit_trail_2026_01
    ADD CONSTRAINT audit_trail_2026_01_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_2026_01_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: audit_trail_2026_02 audit_trail_2026_02_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail_2026_02 audit_trail_2026_02_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail_2026_02
ALTER TABLE ONLY core.audit_trail_2026_02
    ADD CONSTRAINT audit_trail_2026_02_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_2026_02_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: audit_trail_2026_03 audit_trail_2026_03_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail_2026_03 audit_trail_2026_03_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail_2026_03
ALTER TABLE ONLY core.audit_trail_2026_03
    ADD CONSTRAINT audit_trail_2026_03_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_2026_03_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: audit_trail_2026_04 audit_trail_2026_04_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail_2026_04 audit_trail_2026_04_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail_2026_04
ALTER TABLE ONLY core.audit_trail_2026_04
    ADD CONSTRAINT audit_trail_2026_04_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_2026_04_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: audit_trail_2026_05 audit_trail_2026_05_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail_2026_05 audit_trail_2026_05_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail_2026_05
ALTER TABLE ONLY core.audit_trail_2026_05
    ADD CONSTRAINT audit_trail_2026_05_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_2026_05_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: audit_trail_2026_06 audit_trail_2026_06_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail_2026_06 audit_trail_2026_06_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail_2026_06
ALTER TABLE ONLY core.audit_trail_2026_06
    ADD CONSTRAINT audit_trail_2026_06_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_2026_06_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: audit_trail_2026_07 audit_trail_2026_07_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: audit_trail_2026_07 audit_trail_2026_07_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.audit_trail_2026_07
ALTER TABLE ONLY core.audit_trail_2026_07
    ADD CONSTRAINT audit_trail_2026_07_pkey PRIMARY KEY (audit_trail_id, performed_at);
    ADD CONSTRAINT audit_trail_2026_07_pkey PRIMARY KEY (audit_trail_id, performed_at);




--
--
-- Name: company company_company_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: company company_company_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company
ALTER TABLE ONLY core.company
    ADD CONSTRAINT company_company_code_key UNIQUE (company_code);
    ADD CONSTRAINT company_company_code_key UNIQUE (company_code);




--
--
-- Name: company_license company_license_company_id_license_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: company_license company_license_company_id_license_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_license
ALTER TABLE ONLY core.company_license
    ADD CONSTRAINT company_license_company_id_license_code_key UNIQUE (company_id, license_code);
    ADD CONSTRAINT company_license_company_id_license_code_key UNIQUE (company_id, license_code);




--
--
-- Name: company_license company_license_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: company_license company_license_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_license
ALTER TABLE ONLY core.company_license
    ADD CONSTRAINT company_license_pkey PRIMARY KEY (company_license_id);
    ADD CONSTRAINT company_license_pkey PRIMARY KEY (company_license_id);




--
--
-- Name: company_permission company_permission_company_id_permission_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: company_permission company_permission_company_id_permission_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_permission
ALTER TABLE ONLY core.company_permission
    ADD CONSTRAINT company_permission_company_id_permission_code_key UNIQUE (company_id, permission_code);
    ADD CONSTRAINT company_permission_company_id_permission_code_key UNIQUE (company_id, permission_code);




--
--
-- Name: company_permission company_permission_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: company_permission company_permission_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_permission
ALTER TABLE ONLY core.company_permission
    ADD CONSTRAINT company_permission_pkey PRIMARY KEY (company_permission_id);
    ADD CONSTRAINT company_permission_pkey PRIMARY KEY (company_permission_id);




--
--
-- Name: company company_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: company company_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company
ALTER TABLE ONLY core.company
    ADD CONSTRAINT company_pkey PRIMARY KEY (company_id);
    ADD CONSTRAINT company_pkey PRIMARY KEY (company_id);




--
--
-- Name: company_users company_users_company_id_user_id_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: company_users company_users_company_id_user_id_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_users
ALTER TABLE ONLY core.company_users
    ADD CONSTRAINT company_users_company_id_user_id_key UNIQUE (company_id, user_id);
    ADD CONSTRAINT company_users_company_id_user_id_key UNIQUE (company_id, user_id);




--
--
-- Name: company_users company_users_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: company_users company_users_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_users
ALTER TABLE ONLY core.company_users
    ADD CONSTRAINT company_users_pkey PRIMARY KEY (company_user_id);
    ADD CONSTRAINT company_users_pkey PRIMARY KEY (company_user_id);




--
--
-- Name: document_sequence document_sequence_company_id_doc_type_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: document_sequence document_sequence_company_id_doc_type_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.document_sequence
ALTER TABLE ONLY core.document_sequence
    ADD CONSTRAINT document_sequence_company_id_doc_type_key UNIQUE (company_id, doc_type);
    ADD CONSTRAINT document_sequence_company_id_doc_type_key UNIQUE (company_id, doc_type);




--
--
-- Name: document_sequence document_sequence_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: document_sequence document_sequence_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.document_sequence
ALTER TABLE ONLY core.document_sequence
    ADD CONSTRAINT document_sequence_pkey PRIMARY KEY (sequence_id);
    ADD CONSTRAINT document_sequence_pkey PRIMARY KEY (sequence_id);




--
--
-- Name: entity_attribute_def entity_attribute_def_entity_type_attribute_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: entity_attribute_def entity_attribute_def_entity_type_attribute_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.entity_attribute_def
ALTER TABLE ONLY core.entity_attribute_def
    ADD CONSTRAINT entity_attribute_def_entity_type_attribute_code_key UNIQUE (entity_type, attribute_code);
    ADD CONSTRAINT entity_attribute_def_entity_type_attribute_code_key UNIQUE (entity_type, attribute_code);




--
--
-- Name: entity_attribute_def entity_attribute_def_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: entity_attribute_def entity_attribute_def_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.entity_attribute_def
ALTER TABLE ONLY core.entity_attribute_def
    ADD CONSTRAINT entity_attribute_def_pkey PRIMARY KEY (attribute_def_id);
    ADD CONSTRAINT entity_attribute_def_pkey PRIMARY KEY (attribute_def_id);




--
--
-- Name: entity_attribute_value entity_attribute_value_entity_type_entity_id_attribute_def__key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: entity_attribute_value entity_attribute_value_entity_type_entity_id_attribute_def__key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.entity_attribute_value
ALTER TABLE ONLY core.entity_attribute_value
    ADD CONSTRAINT entity_attribute_value_entity_type_entity_id_attribute_def__key UNIQUE (entity_type, entity_id, attribute_def_id);
    ADD CONSTRAINT entity_attribute_value_entity_type_entity_id_attribute_def__key UNIQUE (entity_type, entity_id, attribute_def_id);




--
--
-- Name: entity_attribute_value entity_attribute_value_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: entity_attribute_value entity_attribute_value_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.entity_attribute_value
ALTER TABLE ONLY core.entity_attribute_value
    ADD CONSTRAINT entity_attribute_value_pkey PRIMARY KEY (attribute_value_id);
    ADD CONSTRAINT entity_attribute_value_pkey PRIMARY KEY (attribute_value_id);




--
--
-- Name: journal_entries journal_entries_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: journal_entries journal_entries_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_entries
ALTER TABLE ONLY core.journal_entries
    ADD CONSTRAINT journal_entries_pkey PRIMARY KEY (journal_id);
    ADD CONSTRAINT journal_entries_pkey PRIMARY KEY (journal_id);




--
--
-- Name: journal_lines journal_lines_journal_id_line_no_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: journal_lines journal_lines_journal_id_line_no_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_lines
ALTER TABLE ONLY core.journal_lines
    ADD CONSTRAINT journal_lines_journal_id_line_no_key UNIQUE (journal_id, line_no);
    ADD CONSTRAINT journal_lines_journal_id_line_no_key UNIQUE (journal_id, line_no);




--
--
-- Name: journal_lines journal_lines_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: journal_lines journal_lines_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_lines
ALTER TABLE ONLY core.journal_lines
    ADD CONSTRAINT journal_lines_pkey PRIMARY KEY (journal_line_id);
    ADD CONSTRAINT journal_lines_pkey PRIMARY KEY (journal_line_id);




--
--
-- Name: journal_source_link journal_source_link_journal_id_source_type_source_id_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: journal_source_link journal_source_link_journal_id_source_type_source_id_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_source_link
ALTER TABLE ONLY core.journal_source_link
    ADD CONSTRAINT journal_source_link_journal_id_source_type_source_id_key UNIQUE (journal_id, source_type, source_id);
    ADD CONSTRAINT journal_source_link_journal_id_source_type_source_id_key UNIQUE (journal_id, source_type, source_id);




--
--
-- Name: journal_source_link journal_source_link_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: journal_source_link journal_source_link_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_source_link
ALTER TABLE ONLY core.journal_source_link
    ADD CONSTRAINT journal_source_link_pkey PRIMARY KEY (journal_source_link_id);
    ADD CONSTRAINT journal_source_link_pkey PRIMARY KEY (journal_source_link_id);




--
--
-- Name: license_master license_master_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: license_master license_master_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.license_master
ALTER TABLE ONLY core.license_master
    ADD CONSTRAINT license_master_pkey PRIMARY KEY (code);
    ADD CONSTRAINT license_master_pkey PRIMARY KEY (code);




--
--
-- Name: login_history login_history_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: login_history login_history_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.login_history
ALTER TABLE ONLY core.login_history
    ADD CONSTRAINT login_history_pkey PRIMARY KEY (login_id);
    ADD CONSTRAINT login_history_pkey PRIMARY KEY (login_id);




--
--
-- Name: payment_method payment_method_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: payment_method payment_method_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.payment_method
ALTER TABLE ONLY core.payment_method
    ADD CONSTRAINT payment_method_pkey PRIMARY KEY (payment_method_code);
    ADD CONSTRAINT payment_method_pkey PRIMARY KEY (payment_method_code);




--
--
-- Name: payment_term payment_term_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: payment_term payment_term_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.payment_term
ALTER TABLE ONLY core.payment_term
    ADD CONSTRAINT payment_term_pkey PRIMARY KEY (payment_term_id);
    ADD CONSTRAINT payment_term_pkey PRIMARY KEY (payment_term_id);




--
--
-- Name: payment_term payment_term_term_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: payment_term payment_term_term_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.payment_term
ALTER TABLE ONLY core.payment_term
    ADD CONSTRAINT payment_term_term_code_key UNIQUE (term_code);
    ADD CONSTRAINT payment_term_term_code_key UNIQUE (term_code);




--
--
-- Name: permission_group_permissions permission_group_permissions_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: permission_group_permissions permission_group_permissions_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permission_group_permissions
ALTER TABLE ONLY core.permission_group_permissions
    ADD CONSTRAINT permission_group_permissions_pkey PRIMARY KEY (group_id, permission_id);
    ADD CONSTRAINT permission_group_permissions_pkey PRIMARY KEY (group_id, permission_id);




--
--
-- Name: permission_groups permission_groups_company_id_group_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: permission_groups permission_groups_company_id_group_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permission_groups
ALTER TABLE ONLY core.permission_groups
    ADD CONSTRAINT permission_groups_company_id_group_code_key UNIQUE (company_id, group_code);
    ADD CONSTRAINT permission_groups_company_id_group_code_key UNIQUE (company_id, group_code);




--
--
-- Name: permission_groups permission_groups_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: permission_groups permission_groups_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permission_groups
ALTER TABLE ONLY core.permission_groups
    ADD CONSTRAINT permission_groups_pkey PRIMARY KEY (group_id);
    ADD CONSTRAINT permission_groups_pkey PRIMARY KEY (group_id);




--
--
-- Name: permissions permissions_company_id_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: permissions permissions_company_id_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permissions
ALTER TABLE ONLY core.permissions
    ADD CONSTRAINT permissions_company_id_code_key UNIQUE (company_id, code);
    ADD CONSTRAINT permissions_company_id_code_key UNIQUE (company_id, code);




--
--
-- Name: permissions permissions_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: permissions permissions_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permissions
ALTER TABLE ONLY core.permissions
    ADD CONSTRAINT permissions_pkey PRIMARY KEY (permission_id);
    ADD CONSTRAINT permissions_pkey PRIMARY KEY (permission_id);




--
--
-- Name: posting_profile posting_profile_company_id_profile_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: posting_profile posting_profile_company_id_profile_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.posting_profile
ALTER TABLE ONLY core.posting_profile
    ADD CONSTRAINT posting_profile_company_id_profile_code_key UNIQUE (company_id, profile_code);
    ADD CONSTRAINT posting_profile_company_id_profile_code_key UNIQUE (company_id, profile_code);




--
--
-- Name: posting_profile posting_profile_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: posting_profile posting_profile_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.posting_profile
ALTER TABLE ONLY core.posting_profile
    ADD CONSTRAINT posting_profile_pkey PRIMARY KEY (posting_profile_id);
    ADD CONSTRAINT posting_profile_pkey PRIMARY KEY (posting_profile_id);




--
--
-- Name: reason_code_master reason_code_master_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: reason_code_master reason_code_master_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.reason_code_master
ALTER TABLE ONLY core.reason_code_master
    ADD CONSTRAINT reason_code_master_pkey PRIMARY KEY (reason_code);
    ADD CONSTRAINT reason_code_master_pkey PRIMARY KEY (reason_code);




--
--
-- Name: status_history status_history_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: status_history status_history_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.status_history
ALTER TABLE ONLY core.status_history
    ADD CONSTRAINT status_history_pkey PRIMARY KEY (status_history_id);
    ADD CONSTRAINT status_history_pkey PRIMARY KEY (status_history_id);




--
--
-- Name: status_master status_master_entity_type_status_code_key; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: status_master status_master_entity_type_status_code_key; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.status_master
ALTER TABLE ONLY core.status_master
    ADD CONSTRAINT status_master_entity_type_status_code_key UNIQUE (entity_type, status_code);
    ADD CONSTRAINT status_master_entity_type_status_code_key UNIQUE (entity_type, status_code);




--
--
-- Name: status_master status_master_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: status_master status_master_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.status_master
ALTER TABLE ONLY core.status_master
    ADD CONSTRAINT status_master_pkey PRIMARY KEY (status_id);
    ADD CONSTRAINT status_master_pkey PRIMARY KEY (status_id);




--
--
-- Name: sync_queue sync_queue_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: sync_queue sync_queue_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.sync_queue
ALTER TABLE ONLY core.sync_queue
    ADD CONSTRAINT sync_queue_pkey PRIMARY KEY (sync_id);
    ADD CONSTRAINT sync_queue_pkey PRIMARY KEY (sync_id);




--
--
-- Name: uom_conversion uom_conversion_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: uom_conversion uom_conversion_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.uom_conversion
ALTER TABLE ONLY core.uom_conversion
    ADD CONSTRAINT uom_conversion_pkey PRIMARY KEY (from_uom_code, to_uom_code);
    ADD CONSTRAINT uom_conversion_pkey PRIMARY KEY (from_uom_code, to_uom_code);




--
--
-- Name: uom uom_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: uom uom_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.uom
ALTER TABLE ONLY core.uom
    ADD CONSTRAINT uom_pkey PRIMARY KEY (uom_code);
    ADD CONSTRAINT uom_pkey PRIMARY KEY (uom_code);




--
--
-- Name: user_permissions user_permissions_pkey; Type: CONSTRAINT; Schema: core; Owner: -
-- Name: user_permissions user_permissions_pkey; Type: CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.user_permissions
ALTER TABLE ONLY core.user_permissions
    ADD CONSTRAINT user_permissions_pkey PRIMARY KEY (user_id, permission_id);
    ADD CONSTRAINT user_permissions_pkey PRIMARY KEY (user_id, permission_id);




--
--
-- Name: codegen_artifact codegen_artifact_pkey; Type: CONSTRAINT; Schema: devops; Owner: -
-- Name: codegen_artifact codegen_artifact_pkey; Type: CONSTRAINT; Schema: devops; Owner: -
--
--


ALTER TABLE ONLY devops.codegen_artifact
ALTER TABLE ONLY devops.codegen_artifact
    ADD CONSTRAINT codegen_artifact_pkey PRIMARY KEY (artifact_id);
    ADD CONSTRAINT codegen_artifact_pkey PRIMARY KEY (artifact_id);




--
--
-- Name: codegen_run codegen_run_pkey; Type: CONSTRAINT; Schema: devops; Owner: -
-- Name: codegen_run codegen_run_pkey; Type: CONSTRAINT; Schema: devops; Owner: -
--
--


ALTER TABLE ONLY devops.codegen_run
ALTER TABLE ONLY devops.codegen_run
    ADD CONSTRAINT codegen_run_pkey PRIMARY KEY (run_id);
    ADD CONSTRAINT codegen_run_pkey PRIMARY KEY (run_id);




--
--
-- Name: bank_account bank_account_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
-- Name: bank_account bank_account_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_account
ALTER TABLE ONLY finance.bank_account
    ADD CONSTRAINT bank_account_pkey PRIMARY KEY (bank_account_id);
    ADD CONSTRAINT bank_account_pkey PRIMARY KEY (bank_account_id);




--
--
-- Name: bank_statement_header bank_statement_header_bank_account_id_statement_date_key; Type: CONSTRAINT; Schema: finance; Owner: -
-- Name: bank_statement_header bank_statement_header_bank_account_id_statement_date_key; Type: CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_statement_header
ALTER TABLE ONLY finance.bank_statement_header
    ADD CONSTRAINT bank_statement_header_bank_account_id_statement_date_key UNIQUE (bank_account_id, statement_date);
    ADD CONSTRAINT bank_statement_header_bank_account_id_statement_date_key UNIQUE (bank_account_id, statement_date);




--
--
-- Name: bank_statement_header bank_statement_header_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
-- Name: bank_statement_header bank_statement_header_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_statement_header
ALTER TABLE ONLY finance.bank_statement_header
    ADD CONSTRAINT bank_statement_header_pkey PRIMARY KEY (bank_statement_id);
    ADD CONSTRAINT bank_statement_header_pkey PRIMARY KEY (bank_statement_id);




--
--
-- Name: bank_statement_line bank_statement_line_bank_statement_id_line_no_key; Type: CONSTRAINT; Schema: finance; Owner: -
-- Name: bank_statement_line bank_statement_line_bank_statement_id_line_no_key; Type: CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_statement_line
ALTER TABLE ONLY finance.bank_statement_line
    ADD CONSTRAINT bank_statement_line_bank_statement_id_line_no_key UNIQUE (bank_statement_id, line_no);
    ADD CONSTRAINT bank_statement_line_bank_statement_id_line_no_key UNIQUE (bank_statement_id, line_no);




--
--
-- Name: bank_statement_line bank_statement_line_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
-- Name: bank_statement_line bank_statement_line_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_statement_line
ALTER TABLE ONLY finance.bank_statement_line
    ADD CONSTRAINT bank_statement_line_pkey PRIMARY KEY (bank_statement_line_id);
    ADD CONSTRAINT bank_statement_line_pkey PRIMARY KEY (bank_statement_line_id);




--
--
-- Name: payment_allocation payment_allocation_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
-- Name: payment_allocation payment_allocation_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.payment_allocation
ALTER TABLE ONLY finance.payment_allocation
    ADD CONSTRAINT payment_allocation_pkey PRIMARY KEY (payment_allocation_id);
    ADD CONSTRAINT payment_allocation_pkey PRIMARY KEY (payment_allocation_id);




--
--
-- Name: payment payment_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
-- Name: payment payment_pkey; Type: CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.payment
ALTER TABLE ONLY finance.payment
    ADD CONSTRAINT payment_pkey PRIMARY KEY (payment_id);
    ADD CONSTRAINT payment_pkey PRIMARY KEY (payment_id);




--
--
-- Name: business_rule_action business_rule_action_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: business_rule_action business_rule_action_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule_action
ALTER TABLE ONLY governance.business_rule_action
    ADD CONSTRAINT business_rule_action_pkey PRIMARY KEY (rule_action_id);
    ADD CONSTRAINT business_rule_action_pkey PRIMARY KEY (rule_action_id);




--
--
-- Name: business_rule business_rule_company_id_rule_code_key; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: business_rule business_rule_company_id_rule_code_key; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule
ALTER TABLE ONLY governance.business_rule
    ADD CONSTRAINT business_rule_company_id_rule_code_key UNIQUE (company_id, rule_code);
    ADD CONSTRAINT business_rule_company_id_rule_code_key UNIQUE (company_id, rule_code);




--
--
-- Name: business_rule_condition business_rule_condition_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: business_rule_condition business_rule_condition_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule_condition
ALTER TABLE ONLY governance.business_rule_condition
    ADD CONSTRAINT business_rule_condition_pkey PRIMARY KEY (rule_condition_id);
    ADD CONSTRAINT business_rule_condition_pkey PRIMARY KEY (rule_condition_id);




--
--
-- Name: business_rule business_rule_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: business_rule business_rule_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule
ALTER TABLE ONLY governance.business_rule
    ADD CONSTRAINT business_rule_pkey PRIMARY KEY (business_rule_id);
    ADD CONSTRAINT business_rule_pkey PRIMARY KEY (business_rule_id);




--
--
-- Name: contract_header contract_header_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: contract_header contract_header_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.contract_header
ALTER TABLE ONLY governance.contract_header
    ADD CONSTRAINT contract_header_pkey PRIMARY KEY (contract_id);
    ADD CONSTRAINT contract_header_pkey PRIMARY KEY (contract_id);




--
--
-- Name: contract_item_price contract_item_price_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: contract_item_price contract_item_price_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.contract_item_price
ALTER TABLE ONLY governance.contract_item_price
    ADD CONSTRAINT contract_item_price_pkey PRIMARY KEY (contract_item_price_id);
    ADD CONSTRAINT contract_item_price_pkey PRIMARY KEY (contract_item_price_id);




--
--
-- Name: document_archive document_archive_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: document_archive document_archive_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.document_archive
ALTER TABLE ONLY governance.document_archive
    ADD CONSTRAINT document_archive_pkey PRIMARY KEY (document_archive_id);
    ADD CONSTRAINT document_archive_pkey PRIMARY KEY (document_archive_id);




--
--
-- Name: document_category document_category_category_code_key; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: document_category document_category_category_code_key; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.document_category
ALTER TABLE ONLY governance.document_category
    ADD CONSTRAINT document_category_category_code_key UNIQUE (category_code);
    ADD CONSTRAINT document_category_category_code_key UNIQUE (category_code);




--
--
-- Name: document_category document_category_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: document_category document_category_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.document_category
ALTER TABLE ONLY governance.document_category
    ADD CONSTRAINT document_category_pkey PRIMARY KEY (document_category_id);
    ADD CONSTRAINT document_category_pkey PRIMARY KEY (document_category_id);




--
--
-- Name: policy_change_queue policy_change_queue_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
-- Name: policy_change_queue policy_change_queue_pkey; Type: CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.policy_change_queue
ALTER TABLE ONLY governance.policy_change_queue
    ADD CONSTRAINT policy_change_queue_pkey PRIMARY KEY (policy_change_id);
    ADD CONSTRAINT policy_change_queue_pkey PRIMARY KEY (policy_change_id);




--
--
-- Name: attendance_log attendance_log_company_id_employee_id_work_date_key; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: attendance_log attendance_log_company_id_employee_id_work_date_key; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.attendance_log
ALTER TABLE ONLY hr.attendance_log
    ADD CONSTRAINT attendance_log_company_id_employee_id_work_date_key UNIQUE (company_id, employee_id, work_date);
    ADD CONSTRAINT attendance_log_company_id_employee_id_work_date_key UNIQUE (company_id, employee_id, work_date);




--
--
-- Name: attendance_log attendance_log_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: attendance_log attendance_log_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.attendance_log
ALTER TABLE ONLY hr.attendance_log
    ADD CONSTRAINT attendance_log_pkey PRIMARY KEY (attendance_log_id);
    ADD CONSTRAINT attendance_log_pkey PRIMARY KEY (attendance_log_id);




--
--
-- Name: employee employee_company_id_employee_code_key; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: employee employee_company_id_employee_code_key; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employee
ALTER TABLE ONLY hr.employee
    ADD CONSTRAINT employee_company_id_employee_code_key UNIQUE (company_id, employee_code);
    ADD CONSTRAINT employee_company_id_employee_code_key UNIQUE (company_id, employee_code);




--
--
-- Name: employee employee_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: employee employee_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employee
ALTER TABLE ONLY hr.employee
    ADD CONSTRAINT employee_pkey PRIMARY KEY (employee_id);
    ADD CONSTRAINT employee_pkey PRIMARY KEY (employee_id);




--
--
-- Name: employment_contract employment_contract_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: employment_contract employment_contract_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employment_contract
ALTER TABLE ONLY hr.employment_contract
    ADD CONSTRAINT employment_contract_pkey PRIMARY KEY (employment_contract_id);
    ADD CONSTRAINT employment_contract_pkey PRIMARY KEY (employment_contract_id);




--
--
-- Name: hr_department hr_department_company_id_department_code_key; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: hr_department hr_department_company_id_department_code_key; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.hr_department
ALTER TABLE ONLY hr.hr_department
    ADD CONSTRAINT hr_department_company_id_department_code_key UNIQUE (company_id, department_code);
    ADD CONSTRAINT hr_department_company_id_department_code_key UNIQUE (company_id, department_code);




--
--
-- Name: hr_department hr_department_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: hr_department hr_department_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.hr_department
ALTER TABLE ONLY hr.hr_department
    ADD CONSTRAINT hr_department_pkey PRIMARY KEY (department_id);
    ADD CONSTRAINT hr_department_pkey PRIMARY KEY (department_id);




--
--
-- Name: hr_position hr_position_company_id_position_code_key; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: hr_position hr_position_company_id_position_code_key; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.hr_position
ALTER TABLE ONLY hr.hr_position
    ADD CONSTRAINT hr_position_company_id_position_code_key UNIQUE (company_id, position_code);
    ADD CONSTRAINT hr_position_company_id_position_code_key UNIQUE (company_id, position_code);




--
--
-- Name: hr_position hr_position_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: hr_position hr_position_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.hr_position
ALTER TABLE ONLY hr.hr_position
    ADD CONSTRAINT hr_position_pkey PRIMARY KEY (position_id);
    ADD CONSTRAINT hr_position_pkey PRIMARY KEY (position_id);




--
--
-- Name: leave_request leave_request_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: leave_request leave_request_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.leave_request
ALTER TABLE ONLY hr.leave_request
    ADD CONSTRAINT leave_request_pkey PRIMARY KEY (leave_request_id);
    ADD CONSTRAINT leave_request_pkey PRIMARY KEY (leave_request_id);




--
--
-- Name: leave_type leave_type_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: leave_type leave_type_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.leave_type
ALTER TABLE ONLY hr.leave_type
    ADD CONSTRAINT leave_type_pkey PRIMARY KEY (leave_type_code);
    ADD CONSTRAINT leave_type_pkey PRIMARY KEY (leave_type_code);




--
--
-- Name: payroll_run payroll_run_company_id_pay_month_key; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: payroll_run payroll_run_company_id_pay_month_key; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_run
ALTER TABLE ONLY hr.payroll_run
    ADD CONSTRAINT payroll_run_company_id_pay_month_key UNIQUE (company_id, pay_month);
    ADD CONSTRAINT payroll_run_company_id_pay_month_key UNIQUE (company_id, pay_month);




--
--
-- Name: payroll_run payroll_run_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: payroll_run payroll_run_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_run
ALTER TABLE ONLY hr.payroll_run
    ADD CONSTRAINT payroll_run_pkey PRIMARY KEY (payroll_run_id);
    ADD CONSTRAINT payroll_run_pkey PRIMARY KEY (payroll_run_id);




--
--
-- Name: payroll_slip payroll_slip_payroll_run_id_employee_id_key; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: payroll_slip payroll_slip_payroll_run_id_employee_id_key; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_slip
ALTER TABLE ONLY hr.payroll_slip
    ADD CONSTRAINT payroll_slip_payroll_run_id_employee_id_key UNIQUE (payroll_run_id, employee_id);
    ADD CONSTRAINT payroll_slip_payroll_run_id_employee_id_key UNIQUE (payroll_run_id, employee_id);




--
--
-- Name: payroll_slip payroll_slip_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
-- Name: payroll_slip payroll_slip_pkey; Type: CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_slip
ALTER TABLE ONLY hr.payroll_slip
    ADD CONSTRAINT payroll_slip_pkey PRIMARY KEY (payroll_slip_id);
    ADD CONSTRAINT payroll_slip_pkey PRIMARY KEY (payroll_slip_id);




--
--
-- Name: api_credential api_credential_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: api_credential api_credential_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.api_credential
ALTER TABLE ONLY integration.api_credential
    ADD CONSTRAINT api_credential_pkey PRIMARY KEY (api_credential_id);
    ADD CONSTRAINT api_credential_pkey PRIMARY KEY (api_credential_id);




--
--
-- Name: audit_export_queue audit_export_queue_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: audit_export_queue audit_export_queue_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.audit_export_queue
ALTER TABLE ONLY integration.audit_export_queue
    ADD CONSTRAINT audit_export_queue_pkey PRIMARY KEY (export_id);
    ADD CONSTRAINT audit_export_queue_pkey PRIMARY KEY (export_id);




--
--
-- Name: external_system external_system_company_id_system_code_key; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: external_system external_system_company_id_system_code_key; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.external_system
ALTER TABLE ONLY integration.external_system
    ADD CONSTRAINT external_system_company_id_system_code_key UNIQUE (company_id, system_code);
    ADD CONSTRAINT external_system_company_id_system_code_key UNIQUE (company_id, system_code);




--
--
-- Name: external_system external_system_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: external_system external_system_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.external_system
ALTER TABLE ONLY integration.external_system
    ADD CONSTRAINT external_system_pkey PRIMARY KEY (external_system_id);
    ADD CONSTRAINT external_system_pkey PRIMARY KEY (external_system_id);




--
--
-- Name: integration_job integration_job_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: integration_job integration_job_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.integration_job
ALTER TABLE ONLY integration.integration_job
    ADD CONSTRAINT integration_job_pkey PRIMARY KEY (integration_job_id);
    ADD CONSTRAINT integration_job_pkey PRIMARY KEY (integration_job_id);




--
--
-- Name: integration_log integration_log_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: integration_log integration_log_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.integration_log
ALTER TABLE ONLY integration.integration_log
    ADD CONSTRAINT integration_log_pkey PRIMARY KEY (integration_log_id);
    ADD CONSTRAINT integration_log_pkey PRIMARY KEY (integration_log_id);




--
--
-- Name: siem_delivery_queue siem_delivery_queue_endpoint_id_audit_trail_id_key; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: siem_delivery_queue siem_delivery_queue_endpoint_id_audit_trail_id_key; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.siem_delivery_queue
ALTER TABLE ONLY integration.siem_delivery_queue
    ADD CONSTRAINT siem_delivery_queue_endpoint_id_audit_trail_id_key UNIQUE (endpoint_id, audit_trail_id);
    ADD CONSTRAINT siem_delivery_queue_endpoint_id_audit_trail_id_key UNIQUE (endpoint_id, audit_trail_id);




--
--
-- Name: siem_delivery_queue siem_delivery_queue_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: siem_delivery_queue siem_delivery_queue_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.siem_delivery_queue
ALTER TABLE ONLY integration.siem_delivery_queue
    ADD CONSTRAINT siem_delivery_queue_pkey PRIMARY KEY (delivery_id);
    ADD CONSTRAINT siem_delivery_queue_pkey PRIMARY KEY (delivery_id);




--
--
-- Name: siem_endpoint siem_endpoint_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
-- Name: siem_endpoint siem_endpoint_pkey; Type: CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.siem_endpoint
ALTER TABLE ONLY integration.siem_endpoint
    ADD CONSTRAINT siem_endpoint_pkey PRIMARY KEY (endpoint_id);
    ADD CONSTRAINT siem_endpoint_pkey PRIMARY KEY (endpoint_id);




--
--
-- Name: inventory_valuation inventory_valuation_company_id_item_id_valuation_date_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: inventory_valuation inventory_valuation_company_id_item_id_valuation_date_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.inventory_valuation
ALTER TABLE ONLY inventory.inventory_valuation
    ADD CONSTRAINT inventory_valuation_company_id_item_id_valuation_date_key UNIQUE (company_id, item_id, valuation_date);
    ADD CONSTRAINT inventory_valuation_company_id_item_id_valuation_date_key UNIQUE (company_id, item_id, valuation_date);




--
--
-- Name: inventory_valuation inventory_valuation_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: inventory_valuation inventory_valuation_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.inventory_valuation
ALTER TABLE ONLY inventory.inventory_valuation
    ADD CONSTRAINT inventory_valuation_pkey PRIMARY KEY (inventory_valuation_id);
    ADD CONSTRAINT inventory_valuation_pkey PRIMARY KEY (inventory_valuation_id);




--
--
-- Name: stock_balance stock_balance_company_id_bin_id_item_id_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_balance stock_balance_company_id_bin_id_item_id_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_balance
ALTER TABLE ONLY inventory.stock_balance
    ADD CONSTRAINT stock_balance_company_id_bin_id_item_id_key UNIQUE (company_id, bin_id, item_id);
    ADD CONSTRAINT stock_balance_company_id_bin_id_item_id_key UNIQUE (company_id, bin_id, item_id);




--
--
-- Name: stock_balance stock_balance_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_balance stock_balance_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_balance
ALTER TABLE ONLY inventory.stock_balance
    ADD CONSTRAINT stock_balance_pkey PRIMARY KEY (stock_balance_id);
    ADD CONSTRAINT stock_balance_pkey PRIMARY KEY (stock_balance_id);




--
--
-- Name: stock_bin stock_bin_company_id_location_id_bin_code_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_bin stock_bin_company_id_location_id_bin_code_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_bin
ALTER TABLE ONLY inventory.stock_bin
    ADD CONSTRAINT stock_bin_company_id_location_id_bin_code_key UNIQUE (company_id, location_id, bin_code);
    ADD CONSTRAINT stock_bin_company_id_location_id_bin_code_key UNIQUE (company_id, location_id, bin_code);




--
--
-- Name: stock_bin stock_bin_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_bin stock_bin_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_bin
ALTER TABLE ONLY inventory.stock_bin
    ADD CONSTRAINT stock_bin_pkey PRIMARY KEY (bin_id);
    ADD CONSTRAINT stock_bin_pkey PRIMARY KEY (bin_id);




--
--
-- Name: stock_lot_balance stock_lot_balance_company_id_bin_id_item_id_stock_lot_id_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_company_id_bin_id_item_id_stock_lot_id_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance
ALTER TABLE ONLY inventory.stock_lot_balance
    ADD CONSTRAINT stock_lot_balance_company_id_bin_id_item_id_stock_lot_id_key UNIQUE (company_id, bin_id, item_id, stock_lot_id);
    ADD CONSTRAINT stock_lot_balance_company_id_bin_id_item_id_stock_lot_id_key UNIQUE (company_id, bin_id, item_id, stock_lot_id);




--
--
-- Name: stock_lot_balance stock_lot_balance_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance
ALTER TABLE ONLY inventory.stock_lot_balance
    ADD CONSTRAINT stock_lot_balance_pkey PRIMARY KEY (stock_lot_balance_id);
    ADD CONSTRAINT stock_lot_balance_pkey PRIMARY KEY (stock_lot_balance_id);




--
--
-- Name: stock_lot stock_lot_company_id_item_id_lot_no_serial_no_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot stock_lot_company_id_item_id_lot_no_serial_no_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot
ALTER TABLE ONLY inventory.stock_lot
    ADD CONSTRAINT stock_lot_company_id_item_id_lot_no_serial_no_key UNIQUE (company_id, item_id, lot_no, serial_no);
    ADD CONSTRAINT stock_lot_company_id_item_id_lot_no_serial_no_key UNIQUE (company_id, item_id, lot_no, serial_no);




--
--
-- Name: stock_lot stock_lot_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot stock_lot_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot
ALTER TABLE ONLY inventory.stock_lot
    ADD CONSTRAINT stock_lot_pkey PRIMARY KEY (stock_lot_id);
    ADD CONSTRAINT stock_lot_pkey PRIMARY KEY (stock_lot_id);




--
--
-- Name: stock_reservation stock_reservation_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_reservation stock_reservation_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_reservation
ALTER TABLE ONLY inventory.stock_reservation
    ADD CONSTRAINT stock_reservation_pkey PRIMARY KEY (stock_reservation_id);
    ADD CONSTRAINT stock_reservation_pkey PRIMARY KEY (stock_reservation_id);




--
--
-- Name: stock_transaction stock_transaction_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transaction stock_transaction_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transaction
ALTER TABLE ONLY inventory.stock_transaction
    ADD CONSTRAINT stock_transaction_pkey PRIMARY KEY (stock_tx_id);
    ADD CONSTRAINT stock_transaction_pkey PRIMARY KEY (stock_tx_id);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_pkey PRIMARY KEY (stock_transfer_detail_id);
    ADD CONSTRAINT stock_transfer_detail_pkey PRIMARY KEY (stock_transfer_detail_id);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_stock_transfer_id_line_no_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_stock_transfer_id_line_no_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_stock_transfer_id_line_no_key UNIQUE (stock_transfer_id, line_no);
    ADD CONSTRAINT stock_transfer_detail_stock_transfer_id_line_no_key UNIQUE (stock_transfer_id, line_no);




--
--
-- Name: stock_transfer_header stock_transfer_header_company_id_transfer_no_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_header stock_transfer_header_company_id_transfer_no_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_header
ALTER TABLE ONLY inventory.stock_transfer_header
    ADD CONSTRAINT stock_transfer_header_company_id_transfer_no_key UNIQUE (company_id, transfer_no);
    ADD CONSTRAINT stock_transfer_header_company_id_transfer_no_key UNIQUE (company_id, transfer_no);




--
--
-- Name: stock_transfer_header stock_transfer_header_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_header stock_transfer_header_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_header
ALTER TABLE ONLY inventory.stock_transfer_header
    ADD CONSTRAINT stock_transfer_header_pkey PRIMARY KEY (stock_transfer_id);
    ADD CONSTRAINT stock_transfer_header_pkey PRIMARY KEY (stock_transfer_id);




--
--
-- Name: stocktaking_plan stocktaking_plan_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stocktaking_plan stocktaking_plan_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_plan
ALTER TABLE ONLY inventory.stocktaking_plan
    ADD CONSTRAINT stocktaking_plan_pkey PRIMARY KEY (stocktaking_plan_id);
    ADD CONSTRAINT stocktaking_plan_pkey PRIMARY KEY (stocktaking_plan_id);




--
--
-- Name: stocktaking_result stocktaking_result_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: stocktaking_result stocktaking_result_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_result
ALTER TABLE ONLY inventory.stocktaking_result
    ADD CONSTRAINT stocktaking_result_pkey PRIMARY KEY (stocktaking_result_id);
    ADD CONSTRAINT stocktaking_result_pkey PRIMARY KEY (stocktaking_result_id);




--
--
-- Name: storage_location storage_location_company_id_warehouse_id_location_code_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: storage_location storage_location_company_id_warehouse_id_location_code_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.storage_location
ALTER TABLE ONLY inventory.storage_location
    ADD CONSTRAINT storage_location_company_id_warehouse_id_location_code_key UNIQUE (company_id, warehouse_id, location_code);
    ADD CONSTRAINT storage_location_company_id_warehouse_id_location_code_key UNIQUE (company_id, warehouse_id, location_code);




--
--
-- Name: storage_location storage_location_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: storage_location storage_location_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.storage_location
ALTER TABLE ONLY inventory.storage_location
    ADD CONSTRAINT storage_location_pkey PRIMARY KEY (location_id);
    ADD CONSTRAINT storage_location_pkey PRIMARY KEY (location_id);




--
--
-- Name: warehouse warehouse_company_id_warehouse_code_key; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: warehouse warehouse_company_id_warehouse_code_key; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.warehouse
ALTER TABLE ONLY inventory.warehouse
    ADD CONSTRAINT warehouse_company_id_warehouse_code_key UNIQUE (company_id, warehouse_code);
    ADD CONSTRAINT warehouse_company_id_warehouse_code_key UNIQUE (company_id, warehouse_code);




--
--
-- Name: warehouse warehouse_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
-- Name: warehouse warehouse_pkey; Type: CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.warehouse
ALTER TABLE ONLY inventory.warehouse
    ADD CONSTRAINT warehouse_pkey PRIMARY KEY (warehouse_id);
    ADD CONSTRAINT warehouse_pkey PRIMARY KEY (warehouse_id);




--
--
-- Name: bom_detail bom_detail_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: bom_detail bom_detail_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_detail
ALTER TABLE ONLY manufacturing.bom_detail
    ADD CONSTRAINT bom_detail_pkey PRIMARY KEY (bom_detail_id);
    ADD CONSTRAINT bom_detail_pkey PRIMARY KEY (bom_detail_id);




--
--
-- Name: bom_header bom_header_company_id_parent_item_id_version_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: bom_header bom_header_company_id_parent_item_id_version_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_header
ALTER TABLE ONLY manufacturing.bom_header
    ADD CONSTRAINT bom_header_company_id_parent_item_id_version_key UNIQUE (company_id, parent_item_id, version);
    ADD CONSTRAINT bom_header_company_id_parent_item_id_version_key UNIQUE (company_id, parent_item_id, version);




--
--
-- Name: bom_header bom_header_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: bom_header bom_header_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_header
ALTER TABLE ONLY manufacturing.bom_header
    ADD CONSTRAINT bom_header_pkey PRIMARY KEY (bom_id);
    ADD CONSTRAINT bom_header_pkey PRIMARY KEY (bom_id);




--
--
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot
ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot
    ADD CONSTRAINT manufacturing_cost_snapshot_pkey PRIMARY KEY (manufacturing_cost_snapshot_id);
    ADD CONSTRAINT manufacturing_cost_snapshot_pkey PRIMARY KEY (manufacturing_cost_snapshot_id);




--
--
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_work_order_id_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_work_order_id_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot
ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot
    ADD CONSTRAINT manufacturing_cost_snapshot_work_order_id_key UNIQUE (work_order_id);
    ADD CONSTRAINT manufacturing_cost_snapshot_work_order_id_key UNIQUE (work_order_id);




--
--
-- Name: manufacturing_execution_detail manufacturing_execution_detail_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail manufacturing_execution_detail_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution_detail
ALTER TABLE ONLY manufacturing.manufacturing_execution_detail
    ADD CONSTRAINT manufacturing_execution_detail_pkey PRIMARY KEY (execution_detail_id);
    ADD CONSTRAINT manufacturing_execution_detail_pkey PRIMARY KEY (execution_detail_id);




--
--
-- Name: manufacturing_execution manufacturing_execution_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution manufacturing_execution_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution
ALTER TABLE ONLY manufacturing.manufacturing_execution
    ADD CONSTRAINT manufacturing_execution_pkey PRIMARY KEY (execution_id);
    ADD CONSTRAINT manufacturing_execution_pkey PRIMARY KEY (execution_id);




--
--
-- Name: mps_plan mps_plan_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mps_plan mps_plan_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mps_plan
ALTER TABLE ONLY manufacturing.mps_plan
    ADD CONSTRAINT mps_plan_pkey PRIMARY KEY (mps_plan_id);
    ADD CONSTRAINT mps_plan_pkey PRIMARY KEY (mps_plan_id);




--
--
-- Name: mps_run mps_run_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mps_run mps_run_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mps_run
ALTER TABLE ONLY manufacturing.mps_run
    ADD CONSTRAINT mps_run_pkey PRIMARY KEY (mps_run_id);
    ADD CONSTRAINT mps_run_pkey PRIMARY KEY (mps_run_id);




--
--
-- Name: mrp_allocation mrp_allocation_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mrp_allocation mrp_allocation_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_allocation
ALTER TABLE ONLY manufacturing.mrp_allocation
    ADD CONSTRAINT mrp_allocation_pkey PRIMARY KEY (mrp_allocation_id);
    ADD CONSTRAINT mrp_allocation_pkey PRIMARY KEY (mrp_allocation_id);




--
--
-- Name: mrp_requirement mrp_requirement_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mrp_requirement mrp_requirement_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_requirement
ALTER TABLE ONLY manufacturing.mrp_requirement
    ADD CONSTRAINT mrp_requirement_pkey PRIMARY KEY (mrp_requirement_id);
    ADD CONSTRAINT mrp_requirement_pkey PRIMARY KEY (mrp_requirement_id);




--
--
-- Name: mrp_run mrp_run_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mrp_run mrp_run_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_run
ALTER TABLE ONLY manufacturing.mrp_run
    ADD CONSTRAINT mrp_run_pkey PRIMARY KEY (mrp_run_id);
    ADD CONSTRAINT mrp_run_pkey PRIMARY KEY (mrp_run_id);




--
--
-- Name: process_master process_master_company_id_process_code_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: process_master process_master_company_id_process_code_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.process_master
ALTER TABLE ONLY manufacturing.process_master
    ADD CONSTRAINT process_master_company_id_process_code_key UNIQUE (company_id, process_code);
    ADD CONSTRAINT process_master_company_id_process_code_key UNIQUE (company_id, process_code);




--
--
-- Name: process_master process_master_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: process_master process_master_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.process_master
ALTER TABLE ONLY manufacturing.process_master
    ADD CONSTRAINT process_master_pkey PRIMARY KEY (process_id);
    ADD CONSTRAINT process_master_pkey PRIMARY KEY (process_id);




--
--
-- Name: routing_header routing_header_company_id_item_id_version_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: routing_header routing_header_company_id_item_id_version_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_header
ALTER TABLE ONLY manufacturing.routing_header
    ADD CONSTRAINT routing_header_company_id_item_id_version_key UNIQUE (company_id, item_id, version);
    ADD CONSTRAINT routing_header_company_id_item_id_version_key UNIQUE (company_id, item_id, version);




--
--
-- Name: routing_header routing_header_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: routing_header routing_header_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_header
ALTER TABLE ONLY manufacturing.routing_header
    ADD CONSTRAINT routing_header_pkey PRIMARY KEY (routing_id);
    ADD CONSTRAINT routing_header_pkey PRIMARY KEY (routing_id);




--
--
-- Name: routing_operation routing_operation_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: routing_operation routing_operation_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_operation
ALTER TABLE ONLY manufacturing.routing_operation
    ADD CONSTRAINT routing_operation_pkey PRIMARY KEY (routing_operation_id);
    ADD CONSTRAINT routing_operation_pkey PRIMARY KEY (routing_operation_id);




--
--
-- Name: routing_operation routing_operation_routing_id_operation_no_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: routing_operation routing_operation_routing_id_operation_no_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_operation
ALTER TABLE ONLY manufacturing.routing_operation
    ADD CONSTRAINT routing_operation_routing_id_operation_no_key UNIQUE (routing_id, operation_no);
    ADD CONSTRAINT routing_operation_routing_id_operation_no_key UNIQUE (routing_id, operation_no);




--
--
-- Name: work_order work_order_company_id_wo_no_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: work_order work_order_company_id_wo_no_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.work_order
ALTER TABLE ONLY manufacturing.work_order
    ADD CONSTRAINT work_order_company_id_wo_no_key UNIQUE (company_id, wo_no);
    ADD CONSTRAINT work_order_company_id_wo_no_key UNIQUE (company_id, wo_no);




--
--
-- Name: work_order work_order_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: work_order work_order_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.work_order
ALTER TABLE ONLY manufacturing.work_order
    ADD CONSTRAINT work_order_pkey PRIMARY KEY (work_order_id);
    ADD CONSTRAINT work_order_pkey PRIMARY KEY (work_order_id);




--
--
-- Name: yield_metric yield_metric_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: yield_metric yield_metric_pkey; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.yield_metric
ALTER TABLE ONLY manufacturing.yield_metric
    ADD CONSTRAINT yield_metric_pkey PRIMARY KEY (yield_metric_id);
    ADD CONSTRAINT yield_metric_pkey PRIMARY KEY (yield_metric_id);




--
--
-- Name: yield_metric yield_metric_process_id_metric_date_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: yield_metric yield_metric_process_id_metric_date_key; Type: CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.yield_metric
ALTER TABLE ONLY manufacturing.yield_metric
    ADD CONSTRAINT yield_metric_process_id_metric_date_key UNIQUE (process_id, metric_date);
    ADD CONSTRAINT yield_metric_process_id_metric_date_key UNIQUE (process_id, metric_date);




--
--
-- Name: asset_link asset_link_pkey; Type: CONSTRAINT; Schema: media; Owner: -
-- Name: asset_link asset_link_pkey; Type: CONSTRAINT; Schema: media; Owner: -
--
--


ALTER TABLE ONLY media.asset_link
ALTER TABLE ONLY media.asset_link
    ADD CONSTRAINT asset_link_pkey PRIMARY KEY (asset_id, entity_table, entity_id, role);
    ADD CONSTRAINT asset_link_pkey PRIMARY KEY (asset_id, entity_table, entity_id, role);




--
--
-- Name: asset asset_pkey; Type: CONSTRAINT; Schema: media; Owner: -
-- Name: asset asset_pkey; Type: CONSTRAINT; Schema: media; Owner: -
--
--


ALTER TABLE ONLY media.asset
ALTER TABLE ONLY media.asset
    ADD CONSTRAINT asset_pkey PRIMARY KEY (asset_id);
    ADD CONSTRAINT asset_pkey PRIMARY KEY (asset_id);




--
--
-- Name: ai_event ai_event_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: ai_event ai_event_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.ai_event
ALTER TABLE ONLY notify.ai_event
    ADD CONSTRAINT ai_event_pkey PRIMARY KEY (ai_event_id);
    ADD CONSTRAINT ai_event_pkey PRIMARY KEY (ai_event_id);




--
--
-- Name: ai_rule ai_rule_company_id_rule_key_key; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: ai_rule ai_rule_company_id_rule_key_key; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.ai_rule
ALTER TABLE ONLY notify.ai_rule
    ADD CONSTRAINT ai_rule_company_id_rule_key_key UNIQUE (company_id, rule_key);
    ADD CONSTRAINT ai_rule_company_id_rule_key_key UNIQUE (company_id, rule_key);




--
--
-- Name: ai_rule ai_rule_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: ai_rule ai_rule_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.ai_rule
ALTER TABLE ONLY notify.ai_rule
    ADD CONSTRAINT ai_rule_pkey PRIMARY KEY (ai_rule_id);
    ADD CONSTRAINT ai_rule_pkey PRIMARY KEY (ai_rule_id);




--
--
-- Name: approval_action_log approval_action_log_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: approval_action_log approval_action_log_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.approval_action_log
ALTER TABLE ONLY notify.approval_action_log
    ADD CONSTRAINT approval_action_log_pkey PRIMARY KEY (action_log_id);
    ADD CONSTRAINT approval_action_log_pkey PRIMARY KEY (action_log_id);




--
--
-- Name: approval_request approval_request_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: approval_request approval_request_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.approval_request
ALTER TABLE ONLY notify.approval_request
    ADD CONSTRAINT approval_request_pkey PRIMARY KEY (approval_request_id);
    ADD CONSTRAINT approval_request_pkey PRIMARY KEY (approval_request_id);




--
--
-- Name: audit_trail audit_trail_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: audit_trail audit_trail_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.audit_trail
ALTER TABLE ONLY notify.audit_trail
    ADD CONSTRAINT audit_trail_pkey PRIMARY KEY (audit_id);
    ADD CONSTRAINT audit_trail_pkey PRIMARY KEY (audit_id);




--
--
-- Name: notification_log notification_log_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: notification_log notification_log_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.notification_log
ALTER TABLE ONLY notify.notification_log
    ADD CONSTRAINT notification_log_pkey PRIMARY KEY (notification_id);
    ADD CONSTRAINT notification_log_pkey PRIMARY KEY (notification_id);




--
--
-- Name: notification_route notification_route_company_id_route_key_line_user_id_key; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: notification_route notification_route_company_id_route_key_line_user_id_key; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.notification_route
ALTER TABLE ONLY notify.notification_route
    ADD CONSTRAINT notification_route_company_id_route_key_line_user_id_key UNIQUE (company_id, route_key, line_user_id);
    ADD CONSTRAINT notification_route_company_id_route_key_line_user_id_key UNIQUE (company_id, route_key, line_user_id);




--
--
-- Name: notification_route notification_route_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: notification_route notification_route_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.notification_route
ALTER TABLE ONLY notify.notification_route
    ADD CONSTRAINT notification_route_pkey PRIMARY KEY (route_id);
    ADD CONSTRAINT notification_route_pkey PRIMARY KEY (route_id);




--
--
-- Name: notification_template notification_template_company_id_template_key_key; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: notification_template notification_template_company_id_template_key_key; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.notification_template
ALTER TABLE ONLY notify.notification_template
    ADD CONSTRAINT notification_template_company_id_template_key_key UNIQUE (company_id, template_key);
    ADD CONSTRAINT notification_template_company_id_template_key_key UNIQUE (company_id, template_key);




--
--
-- Name: notification_template notification_template_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
-- Name: notification_template notification_template_pkey; Type: CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.notification_template
ALTER TABLE ONLY notify.notification_template
    ADD CONSTRAINT notification_template_pkey PRIMARY KEY (template_id);
    ADD CONSTRAINT notification_template_pkey PRIMARY KEY (template_id);




--
--
-- Name: approval_rule approval_rule_domain_event_type_key; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: approval_rule approval_rule_domain_event_type_key; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.approval_rule
ALTER TABLE ONLY ops.approval_rule
    ADD CONSTRAINT approval_rule_domain_event_type_key UNIQUE (domain, event_type);
    ADD CONSTRAINT approval_rule_domain_event_type_key UNIQUE (domain, event_type);




--
--
-- Name: approval_rule approval_rule_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: approval_rule approval_rule_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.approval_rule
ALTER TABLE ONLY ops.approval_rule
    ADD CONSTRAINT approval_rule_pkey PRIMARY KEY (rule_id);
    ADD CONSTRAINT approval_rule_pkey PRIMARY KEY (rule_id);




--
--
-- Name: backup_log backup_log_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: backup_log backup_log_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.backup_log
ALTER TABLE ONLY ops.backup_log
    ADD CONSTRAINT backup_log_pkey PRIMARY KEY (backup_id);
    ADD CONSTRAINT backup_log_pkey PRIMARY KEY (backup_id);




--
--
-- Name: business_event business_event_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: business_event business_event_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.business_event
ALTER TABLE ONLY ops.business_event
    ADD CONSTRAINT business_event_pkey PRIMARY KEY (event_id);
    ADD CONSTRAINT business_event_pkey PRIMARY KEY (event_id);




--
--
-- Name: document_file document_file_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: document_file document_file_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_file
ALTER TABLE ONLY ops.document_file
    ADD CONSTRAINT document_file_pkey PRIMARY KEY (document_file_id);
    ADD CONSTRAINT document_file_pkey PRIMARY KEY (document_file_id);




--
--
-- Name: document_send_history document_send_history_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: document_send_history document_send_history_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_send_history
ALTER TABLE ONLY ops.document_send_history
    ADD CONSTRAINT document_send_history_pkey PRIMARY KEY (send_history_id);
    ADD CONSTRAINT document_send_history_pkey PRIMARY KEY (send_history_id);




--
--
-- Name: document_send_queue document_send_queue_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: document_send_queue document_send_queue_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_send_queue
ALTER TABLE ONLY ops.document_send_queue
    ADD CONSTRAINT document_send_queue_pkey PRIMARY KEY (send_queue_id);
    ADD CONSTRAINT document_send_queue_pkey PRIMARY KEY (send_queue_id);




--
--
-- Name: document_type_master document_type_master_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: document_type_master document_type_master_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_type_master
ALTER TABLE ONLY ops.document_type_master
    ADD CONSTRAINT document_type_master_pkey PRIMARY KEY (document_type_code);
    ADD CONSTRAINT document_type_master_pkey PRIMARY KEY (document_type_code);




--
--
-- Name: notification_outbox notification_outbox_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: notification_outbox notification_outbox_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.notification_outbox
ALTER TABLE ONLY ops.notification_outbox
    ADD CONSTRAINT notification_outbox_pkey PRIMARY KEY (notification_id);
    ADD CONSTRAINT notification_outbox_pkey PRIMARY KEY (notification_id);




--
--
-- Name: ops_idempotency ops_idempotency_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: ops_idempotency ops_idempotency_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.ops_idempotency
ALTER TABLE ONLY ops.ops_idempotency
    ADD CONSTRAINT ops_idempotency_pkey PRIMARY KEY (idempotency_key);
    ADD CONSTRAINT ops_idempotency_pkey PRIMARY KEY (idempotency_key);




--
--
-- Name: ops_job_queue ops_job_queue_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: ops_job_queue ops_job_queue_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.ops_job_queue
ALTER TABLE ONLY ops.ops_job_queue
    ADD CONSTRAINT ops_job_queue_pkey PRIMARY KEY (job_id);
    ADD CONSTRAINT ops_job_queue_pkey PRIMARY KEY (job_id);




--
--
-- Name: ops_job_result ops_job_result_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: ops_job_result ops_job_result_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.ops_job_result
ALTER TABLE ONLY ops.ops_job_result
    ADD CONSTRAINT ops_job_result_pkey PRIMARY KEY (job_id);
    ADD CONSTRAINT ops_job_result_pkey PRIMARY KEY (job_id);




--
--
-- Name: pdf_generate_queue pdf_generate_queue_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: pdf_generate_queue pdf_generate_queue_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.pdf_generate_queue
ALTER TABLE ONLY ops.pdf_generate_queue
    ADD CONSTRAINT pdf_generate_queue_pkey PRIMARY KEY (queue_id);
    ADD CONSTRAINT pdf_generate_queue_pkey PRIMARY KEY (queue_id);




--
--
-- Name: resend_type_master resend_type_master_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: resend_type_master resend_type_master_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.resend_type_master
ALTER TABLE ONLY ops.resend_type_master
    ADD CONSTRAINT resend_type_master_pkey PRIMARY KEY (resend_type_code);
    ADD CONSTRAINT resend_type_master_pkey PRIMARY KEY (resend_type_code);




--
--
-- Name: runtime_flag runtime_flag_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: runtime_flag runtime_flag_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.runtime_flag
ALTER TABLE ONLY ops.runtime_flag
    ADD CONSTRAINT runtime_flag_pkey PRIMARY KEY (flag_key);
    ADD CONSTRAINT runtime_flag_pkey PRIMARY KEY (flag_key);




--
--
-- Name: runtime_health runtime_health_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: runtime_health runtime_health_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.runtime_health
ALTER TABLE ONLY ops.runtime_health
    ADD CONSTRAINT runtime_health_pkey PRIMARY KEY (health_id);
    ADD CONSTRAINT runtime_health_pkey PRIMARY KEY (health_id);




--
--
-- Name: send_channel_master send_channel_master_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: send_channel_master send_channel_master_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.send_channel_master
ALTER TABLE ONLY ops.send_channel_master
    ADD CONSTRAINT send_channel_master_pkey PRIMARY KEY (channel_code);
    ADD CONSTRAINT send_channel_master_pkey PRIMARY KEY (channel_code);




--
--
-- Name: send_fee_master send_fee_master_document_type_code_resend_type_code_key; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: send_fee_master send_fee_master_document_type_code_resend_type_code_key; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.send_fee_master
ALTER TABLE ONLY ops.send_fee_master
    ADD CONSTRAINT send_fee_master_document_type_code_resend_type_code_key UNIQUE (document_type_code, resend_type_code);
    ADD CONSTRAINT send_fee_master_document_type_code_resend_type_code_key UNIQUE (document_type_code, resend_type_code);




--
--
-- Name: send_fee_master send_fee_master_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
-- Name: send_fee_master send_fee_master_pkey; Type: CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.send_fee_master
ALTER TABLE ONLY ops.send_fee_master
    ADD CONSTRAINT send_fee_master_pkey PRIMARY KEY (fee_id);
    ADD CONSTRAINT send_fee_master_pkey PRIMARY KEY (fee_id);




--
--
-- Name: purchase_invoice purchase_invoice_company_id_invoice_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice purchase_invoice_company_id_invoice_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice
ALTER TABLE ONLY purchase.purchase_invoice
    ADD CONSTRAINT purchase_invoice_company_id_invoice_no_key UNIQUE (company_id, invoice_no);
    ADD CONSTRAINT purchase_invoice_company_id_invoice_no_key UNIQUE (company_id, invoice_no);




--
--
-- Name: purchase_invoice_detail purchase_invoice_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail purchase_invoice_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice_detail
ALTER TABLE ONLY purchase.purchase_invoice_detail
    ADD CONSTRAINT purchase_invoice_detail_pkey PRIMARY KEY (purchase_invoice_detail_id);
    ADD CONSTRAINT purchase_invoice_detail_pkey PRIMARY KEY (purchase_invoice_detail_id);




--
--
-- Name: purchase_invoice_detail purchase_invoice_detail_purchase_invoice_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail purchase_invoice_detail_purchase_invoice_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice_detail
ALTER TABLE ONLY purchase.purchase_invoice_detail
    ADD CONSTRAINT purchase_invoice_detail_purchase_invoice_id_line_no_key UNIQUE (purchase_invoice_id, line_no);
    ADD CONSTRAINT purchase_invoice_detail_purchase_invoice_id_line_no_key UNIQUE (purchase_invoice_id, line_no);




--
--
-- Name: purchase_invoice purchase_invoice_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice purchase_invoice_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice
ALTER TABLE ONLY purchase.purchase_invoice
    ADD CONSTRAINT purchase_invoice_pkey PRIMARY KEY (purchase_invoice_id);
    ADD CONSTRAINT purchase_invoice_pkey PRIMARY KEY (purchase_invoice_id);




--
--
-- Name: purchase_order_detail purchase_order_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_detail purchase_order_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_detail
ALTER TABLE ONLY purchase.purchase_order_detail
    ADD CONSTRAINT purchase_order_detail_pkey PRIMARY KEY (purchase_order_detail_id);
    ADD CONSTRAINT purchase_order_detail_pkey PRIMARY KEY (purchase_order_detail_id);




--
--
-- Name: purchase_order_detail purchase_order_detail_purchase_order_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_detail purchase_order_detail_purchase_order_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_detail
ALTER TABLE ONLY purchase.purchase_order_detail
    ADD CONSTRAINT purchase_order_detail_purchase_order_id_line_no_key UNIQUE (purchase_order_id, line_no);
    ADD CONSTRAINT purchase_order_detail_purchase_order_id_line_no_key UNIQUE (purchase_order_id, line_no);




--
--
-- Name: purchase_order_header purchase_order_header_company_id_purchase_order_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_header purchase_order_header_company_id_purchase_order_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_header
ALTER TABLE ONLY purchase.purchase_order_header
    ADD CONSTRAINT purchase_order_header_company_id_purchase_order_no_key UNIQUE (company_id, purchase_order_no);
    ADD CONSTRAINT purchase_order_header_company_id_purchase_order_no_key UNIQUE (company_id, purchase_order_no);




--
--
-- Name: purchase_order_header purchase_order_header_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_header purchase_order_header_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_header
ALTER TABLE ONLY purchase.purchase_order_header
    ADD CONSTRAINT purchase_order_header_pkey PRIMARY KEY (purchase_order_id);
    ADD CONSTRAINT purchase_order_header_pkey PRIMARY KEY (purchase_order_id);




--
--
-- Name: purchase_quotation_detail purchase_quotation_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail purchase_quotation_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation_detail
ALTER TABLE ONLY purchase.purchase_quotation_detail
    ADD CONSTRAINT purchase_quotation_detail_pkey PRIMARY KEY (purchase_quotation_detail_id);
    ADD CONSTRAINT purchase_quotation_detail_pkey PRIMARY KEY (purchase_quotation_detail_id);




--
--
-- Name: purchase_quotation_detail purchase_quotation_detail_purchase_quotation_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail purchase_quotation_detail_purchase_quotation_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation_detail
ALTER TABLE ONLY purchase.purchase_quotation_detail
    ADD CONSTRAINT purchase_quotation_detail_purchase_quotation_id_line_no_key UNIQUE (purchase_quotation_id, line_no);
    ADD CONSTRAINT purchase_quotation_detail_purchase_quotation_id_line_no_key UNIQUE (purchase_quotation_id, line_no);




--
--
-- Name: purchase_quotation purchase_quotation_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_quotation purchase_quotation_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation
ALTER TABLE ONLY purchase.purchase_quotation
    ADD CONSTRAINT purchase_quotation_pkey PRIMARY KEY (purchase_quotation_id);
    ADD CONSTRAINT purchase_quotation_pkey PRIMARY KEY (purchase_quotation_id);




--
--
-- Name: purchase_receipt_detail purchase_receipt_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail purchase_receipt_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt_detail
ALTER TABLE ONLY purchase.purchase_receipt_detail
    ADD CONSTRAINT purchase_receipt_detail_pkey PRIMARY KEY (receipt_detail_id);
    ADD CONSTRAINT purchase_receipt_detail_pkey PRIMARY KEY (receipt_detail_id);




--
--
-- Name: purchase_receipt_detail purchase_receipt_detail_receipt_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail purchase_receipt_detail_receipt_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt_detail
ALTER TABLE ONLY purchase.purchase_receipt_detail
    ADD CONSTRAINT purchase_receipt_detail_receipt_id_line_no_key UNIQUE (receipt_id, line_no);
    ADD CONSTRAINT purchase_receipt_detail_receipt_id_line_no_key UNIQUE (receipt_id, line_no);




--
--
-- Name: purchase_receipt purchase_receipt_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt purchase_receipt_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt
ALTER TABLE ONLY purchase.purchase_receipt
    ADD CONSTRAINT purchase_receipt_pkey PRIMARY KEY (receipt_id);
    ADD CONSTRAINT purchase_receipt_pkey PRIMARY KEY (receipt_id);




--
--
-- Name: purchase_requisition purchase_requisition_company_id_requisition_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_requisition purchase_requisition_company_id_requisition_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition
ALTER TABLE ONLY purchase.purchase_requisition
    ADD CONSTRAINT purchase_requisition_company_id_requisition_no_key UNIQUE (company_id, requisition_no);
    ADD CONSTRAINT purchase_requisition_company_id_requisition_no_key UNIQUE (company_id, requisition_no);




--
--
-- Name: purchase_requisition_detail purchase_requisition_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail purchase_requisition_detail_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition_detail
ALTER TABLE ONLY purchase.purchase_requisition_detail
    ADD CONSTRAINT purchase_requisition_detail_pkey PRIMARY KEY (purchase_requisition_detail_id);
    ADD CONSTRAINT purchase_requisition_detail_pkey PRIMARY KEY (purchase_requisition_detail_id);




--
--
-- Name: purchase_requisition_detail purchase_requisition_detail_purchase_requisition_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail purchase_requisition_detail_purchase_requisition_id_line_no_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition_detail
ALTER TABLE ONLY purchase.purchase_requisition_detail
    ADD CONSTRAINT purchase_requisition_detail_purchase_requisition_id_line_no_key UNIQUE (purchase_requisition_id, line_no);
    ADD CONSTRAINT purchase_requisition_detail_purchase_requisition_id_line_no_key UNIQUE (purchase_requisition_id, line_no);




--
--
-- Name: purchase_requisition purchase_requisition_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_requisition purchase_requisition_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition
ALTER TABLE ONLY purchase.purchase_requisition
    ADD CONSTRAINT purchase_requisition_pkey PRIMARY KEY (purchase_requisition_id);
    ADD CONSTRAINT purchase_requisition_pkey PRIMARY KEY (purchase_requisition_id);




--
--
-- Name: purchase_three_way_match purchase_three_way_match_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_three_way_match purchase_three_way_match_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_three_way_match
ALTER TABLE ONLY purchase.purchase_three_way_match
    ADD CONSTRAINT purchase_three_way_match_pkey PRIMARY KEY (purchase_three_way_match_id);
    ADD CONSTRAINT purchase_three_way_match_pkey PRIMARY KEY (purchase_three_way_match_id);




--
--
-- Name: supplier_address supplier_address_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_address supplier_address_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_address
ALTER TABLE ONLY purchase.supplier_address
    ADD CONSTRAINT supplier_address_pkey PRIMARY KEY (supplier_address_id);
    ADD CONSTRAINT supplier_address_pkey PRIMARY KEY (supplier_address_id);




--
--
-- Name: supplier_contact supplier_contact_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_contact supplier_contact_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_contact
ALTER TABLE ONLY purchase.supplier_contact
    ADD CONSTRAINT supplier_contact_pkey PRIMARY KEY (supplier_contact_id);
    ADD CONSTRAINT supplier_contact_pkey PRIMARY KEY (supplier_contact_id);




--
--
-- Name: supplier_item_price supplier_item_price_company_id_supplier_id_item_id_valid_fr_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_item_price supplier_item_price_company_id_supplier_id_item_id_valid_fr_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_item_price
ALTER TABLE ONLY purchase.supplier_item_price
    ADD CONSTRAINT supplier_item_price_company_id_supplier_id_item_id_valid_fr_key UNIQUE (company_id, supplier_id, item_id, valid_from);
    ADD CONSTRAINT supplier_item_price_company_id_supplier_id_item_id_valid_fr_key UNIQUE (company_id, supplier_id, item_id, valid_from);




--
--
-- Name: supplier_item_price supplier_item_price_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_item_price supplier_item_price_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_item_price
ALTER TABLE ONLY purchase.supplier_item_price
    ADD CONSTRAINT supplier_item_price_pkey PRIMARY KEY (supplier_item_price_id);
    ADD CONSTRAINT supplier_item_price_pkey PRIMARY KEY (supplier_item_price_id);




--
--
-- Name: supplier_master supplier_master_company_id_supplier_code_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_master supplier_master_company_id_supplier_code_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_master
ALTER TABLE ONLY purchase.supplier_master
    ADD CONSTRAINT supplier_master_company_id_supplier_code_key UNIQUE (company_id, supplier_code);
    ADD CONSTRAINT supplier_master_company_id_supplier_code_key UNIQUE (company_id, supplier_code);




--
--
-- Name: supplier_master supplier_master_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_master supplier_master_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_master
ALTER TABLE ONLY purchase.supplier_master
    ADD CONSTRAINT supplier_master_pkey PRIMARY KEY (supplier_id);
    ADD CONSTRAINT supplier_master_pkey PRIMARY KEY (supplier_id);




--
--
-- Name: supplier_payment_term supplier_payment_term_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_payment_term supplier_payment_term_pkey; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_payment_term
ALTER TABLE ONLY purchase.supplier_payment_term
    ADD CONSTRAINT supplier_payment_term_pkey PRIMARY KEY (supplier_payment_term_id);
    ADD CONSTRAINT supplier_payment_term_pkey PRIMARY KEY (supplier_payment_term_id);




--
--
-- Name: supplier_payment_term supplier_payment_term_supplier_id_valid_from_key; Type: CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_payment_term supplier_payment_term_supplier_id_valid_from_key; Type: CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_payment_term
ALTER TABLE ONLY purchase.supplier_payment_term
    ADD CONSTRAINT supplier_payment_term_supplier_id_valid_from_key UNIQUE (supplier_id, valid_from);
    ADD CONSTRAINT supplier_payment_term_supplier_id_valid_from_key UNIQUE (supplier_id, valid_from);




--
--
-- Name: messages messages_pkey; Type: CONSTRAINT; Schema: realtime; Owner: -
-- Name: messages messages_pkey; Type: CONSTRAINT; Schema: realtime; Owner: -
--
--


    ADD CONSTRAINT messages_pkey PRIMARY KEY (id, inserted_at);
    ADD CONSTRAINT messages_pkey PRIMARY KEY (id, inserted_at);




--
--
-- Name: subscription pk_subscription; Type: CONSTRAINT; Schema: realtime; Owner: -
-- Name: subscription pk_subscription; Type: CONSTRAINT; Schema: realtime; Owner: -
--
--


    ADD CONSTRAINT pk_subscription PRIMARY KEY (id);
    ADD CONSTRAINT pk_subscription PRIMARY KEY (id);




--
--
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: realtime; Owner: -
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: realtime; Owner: -
--
--


    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);
    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);




--
--
-- Name: billing_detail billing_detail_billing_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_detail billing_detail_billing_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_detail
ALTER TABLE ONLY sales.billing_detail
    ADD CONSTRAINT billing_detail_billing_id_line_no_key UNIQUE (billing_id, line_no);
    ADD CONSTRAINT billing_detail_billing_id_line_no_key UNIQUE (billing_id, line_no);




--
--
-- Name: billing_detail billing_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_detail billing_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_detail
ALTER TABLE ONLY sales.billing_detail
    ADD CONSTRAINT billing_detail_pkey PRIMARY KEY (billing_detail_id);
    ADD CONSTRAINT billing_detail_pkey PRIMARY KEY (billing_detail_id);




--
--
-- Name: billing_header billing_header_company_id_billing_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_header billing_header_company_id_billing_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_header
ALTER TABLE ONLY sales.billing_header
    ADD CONSTRAINT billing_header_company_id_billing_no_key UNIQUE (company_id, billing_no);
    ADD CONSTRAINT billing_header_company_id_billing_no_key UNIQUE (company_id, billing_no);




--
--
-- Name: billing_header billing_header_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_header billing_header_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_header
ALTER TABLE ONLY sales.billing_header
    ADD CONSTRAINT billing_header_pkey PRIMARY KEY (billing_id);
    ADD CONSTRAINT billing_header_pkey PRIMARY KEY (billing_id);




--
--
-- Name: customer_address customer_address_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_address customer_address_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_address
ALTER TABLE ONLY sales.customer_address
    ADD CONSTRAINT customer_address_pkey PRIMARY KEY (customer_address_id);
    ADD CONSTRAINT customer_address_pkey PRIMARY KEY (customer_address_id);




--
--
-- Name: customer customer_company_id_customer_code_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: customer customer_company_id_customer_code_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer
ALTER TABLE ONLY sales.customer
    ADD CONSTRAINT customer_company_id_customer_code_key UNIQUE (company_id, customer_code);
    ADD CONSTRAINT customer_company_id_customer_code_key UNIQUE (company_id, customer_code);




--
--
-- Name: customer_contact customer_contact_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_contact customer_contact_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_contact
ALTER TABLE ONLY sales.customer_contact
    ADD CONSTRAINT customer_contact_pkey PRIMARY KEY (customer_contact_id);
    ADD CONSTRAINT customer_contact_pkey PRIMARY KEY (customer_contact_id);




--
--
-- Name: customer_payment_term customer_payment_term_customer_id_valid_from_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_payment_term customer_payment_term_customer_id_valid_from_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_payment_term
ALTER TABLE ONLY sales.customer_payment_term
    ADD CONSTRAINT customer_payment_term_customer_id_valid_from_key UNIQUE (customer_id, valid_from);
    ADD CONSTRAINT customer_payment_term_customer_id_valid_from_key UNIQUE (customer_id, valid_from);




--
--
-- Name: customer_payment_term customer_payment_term_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_payment_term customer_payment_term_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_payment_term
ALTER TABLE ONLY sales.customer_payment_term
    ADD CONSTRAINT customer_payment_term_pkey PRIMARY KEY (customer_payment_term_id);
    ADD CONSTRAINT customer_payment_term_pkey PRIMARY KEY (customer_payment_term_id);




--
--
-- Name: customer customer_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: customer customer_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer
ALTER TABLE ONLY sales.customer
    ADD CONSTRAINT customer_pkey PRIMARY KEY (customer_id);
    ADD CONSTRAINT customer_pkey PRIMARY KEY (customer_id);




--
--
-- Name: invoice_pdf invoice_pdf_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: invoice_pdf invoice_pdf_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.invoice_pdf
ALTER TABLE ONLY sales.invoice_pdf
    ADD CONSTRAINT invoice_pdf_pkey PRIMARY KEY (invoice_pdf_id);
    ADD CONSTRAINT invoice_pdf_pkey PRIMARY KEY (invoice_pdf_id);




--
--
-- Name: item_category item_category_company_id_category_code_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: item_category item_category_company_id_category_code_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_category
ALTER TABLE ONLY sales.item_category
    ADD CONSTRAINT item_category_company_id_category_code_key UNIQUE (company_id, category_code);
    ADD CONSTRAINT item_category_company_id_category_code_key UNIQUE (company_id, category_code);




--
--
-- Name: item_category item_category_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: item_category item_category_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_category
ALTER TABLE ONLY sales.item_category
    ADD CONSTRAINT item_category_pkey PRIMARY KEY (item_category_id);
    ADD CONSTRAINT item_category_pkey PRIMARY KEY (item_category_id);




--
--
-- Name: item item_company_id_item_code_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: item item_company_id_item_code_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item
ALTER TABLE ONLY sales.item
    ADD CONSTRAINT item_company_id_item_code_key UNIQUE (company_id, item_code);
    ADD CONSTRAINT item_company_id_item_code_key UNIQUE (company_id, item_code);




--
--
-- Name: item item_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: item item_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item
ALTER TABLE ONLY sales.item
    ADD CONSTRAINT item_pkey PRIMARY KEY (item_id);
    ADD CONSTRAINT item_pkey PRIMARY KEY (item_id);




--
--
-- Name: item_price_master item_price_master_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: item_price_master item_price_master_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_price_master
ALTER TABLE ONLY sales.item_price_master
    ADD CONSTRAINT item_price_master_pkey PRIMARY KEY (item_price_id);
    ADD CONSTRAINT item_price_master_pkey PRIMARY KEY (item_price_id);




--
--
-- Name: item_uom item_uom_item_id_uom_code_usage_type_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: item_uom item_uom_item_id_uom_code_usage_type_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_uom
ALTER TABLE ONLY sales.item_uom
    ADD CONSTRAINT item_uom_item_id_uom_code_usage_type_key UNIQUE (item_id, uom_code, usage_type);
    ADD CONSTRAINT item_uom_item_id_uom_code_usage_type_key UNIQUE (item_id, uom_code, usage_type);




--
--
-- Name: item_uom item_uom_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: item_uom item_uom_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_uom
ALTER TABLE ONLY sales.item_uom
    ADD CONSTRAINT item_uom_pkey PRIMARY KEY (item_uom_id);
    ADD CONSTRAINT item_uom_pkey PRIMARY KEY (item_uom_id);




--
--
-- Name: order_detail order_detail_order_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: order_detail order_detail_order_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_detail
ALTER TABLE ONLY sales.order_detail
    ADD CONSTRAINT order_detail_order_id_line_no_key UNIQUE (order_id, line_no);
    ADD CONSTRAINT order_detail_order_id_line_no_key UNIQUE (order_id, line_no);




--
--
-- Name: order_detail order_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: order_detail order_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_detail
ALTER TABLE ONLY sales.order_detail
    ADD CONSTRAINT order_detail_pkey PRIMARY KEY (order_detail_id);
    ADD CONSTRAINT order_detail_pkey PRIMARY KEY (order_detail_id);




--
--
-- Name: order_header order_header_company_id_order_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: order_header order_header_company_id_order_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_header
ALTER TABLE ONLY sales.order_header
    ADD CONSTRAINT order_header_company_id_order_no_key UNIQUE (company_id, order_no);
    ADD CONSTRAINT order_header_company_id_order_no_key UNIQUE (company_id, order_no);




--
--
-- Name: order_header order_header_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: order_header order_header_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_header
ALTER TABLE ONLY sales.order_header
    ADD CONSTRAINT order_header_pkey PRIMARY KEY (order_id);
    ADD CONSTRAINT order_header_pkey PRIMARY KEY (order_id);




--
--
-- Name: quotation_order_link quotation_order_link_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: quotation_order_link quotation_order_link_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.quotation_order_link
ALTER TABLE ONLY sales.quotation_order_link
    ADD CONSTRAINT quotation_order_link_pkey PRIMARY KEY (quotation_order_link_id);
    ADD CONSTRAINT quotation_order_link_pkey PRIMARY KEY (quotation_order_link_id);




--
--
-- Name: quotation_order_link quotation_order_link_quotation_id_order_id_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: quotation_order_link quotation_order_link_quotation_id_order_id_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.quotation_order_link
ALTER TABLE ONLY sales.quotation_order_link
    ADD CONSTRAINT quotation_order_link_quotation_id_order_id_key UNIQUE (quotation_id, order_id);
    ADD CONSTRAINT quotation_order_link_quotation_id_order_id_key UNIQUE (quotation_id, order_id);




--
--
-- Name: return_detail return_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: return_detail return_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_detail
ALTER TABLE ONLY sales.return_detail
    ADD CONSTRAINT return_detail_pkey PRIMARY KEY (return_detail_id);
    ADD CONSTRAINT return_detail_pkey PRIMARY KEY (return_detail_id);




--
--
-- Name: return_detail return_detail_return_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: return_detail return_detail_return_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_detail
ALTER TABLE ONLY sales.return_detail
    ADD CONSTRAINT return_detail_return_id_line_no_key UNIQUE (return_id, line_no);
    ADD CONSTRAINT return_detail_return_id_line_no_key UNIQUE (return_id, line_no);




--
--
-- Name: return_header return_header_company_id_return_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: return_header return_header_company_id_return_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_header
ALTER TABLE ONLY sales.return_header
    ADD CONSTRAINT return_header_company_id_return_no_key UNIQUE (company_id, return_no);
    ADD CONSTRAINT return_header_company_id_return_no_key UNIQUE (company_id, return_no);




--
--
-- Name: return_header return_header_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: return_header return_header_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_header
ALTER TABLE ONLY sales.return_header
    ADD CONSTRAINT return_header_pkey PRIMARY KEY (return_id);
    ADD CONSTRAINT return_header_pkey PRIMARY KEY (return_id);




--
--
-- Name: sales_quotation sales_quotation_company_id_quotation_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation sales_quotation_company_id_quotation_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation
ALTER TABLE ONLY sales.sales_quotation
    ADD CONSTRAINT sales_quotation_company_id_quotation_no_key UNIQUE (company_id, quotation_no);
    ADD CONSTRAINT sales_quotation_company_id_quotation_no_key UNIQUE (company_id, quotation_no);




--
--
-- Name: sales_quotation_detail sales_quotation_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation_detail sales_quotation_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation_detail
ALTER TABLE ONLY sales.sales_quotation_detail
    ADD CONSTRAINT sales_quotation_detail_pkey PRIMARY KEY (sales_quotation_detail_id);
    ADD CONSTRAINT sales_quotation_detail_pkey PRIMARY KEY (sales_quotation_detail_id);




--
--
-- Name: sales_quotation_detail sales_quotation_detail_sales_quotation_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation_detail sales_quotation_detail_sales_quotation_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation_detail
ALTER TABLE ONLY sales.sales_quotation_detail
    ADD CONSTRAINT sales_quotation_detail_sales_quotation_id_line_no_key UNIQUE (sales_quotation_id, line_no);
    ADD CONSTRAINT sales_quotation_detail_sales_quotation_id_line_no_key UNIQUE (sales_quotation_id, line_no);




--
--
-- Name: sales_quotation sales_quotation_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation sales_quotation_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation
ALTER TABLE ONLY sales.sales_quotation
    ADD CONSTRAINT sales_quotation_pkey PRIMARY KEY (sales_quotation_id);
    ADD CONSTRAINT sales_quotation_pkey PRIMARY KEY (sales_quotation_id);




--
--
-- Name: shipping_detail shipping_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_detail shipping_detail_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_detail
ALTER TABLE ONLY sales.shipping_detail
    ADD CONSTRAINT shipping_detail_pkey PRIMARY KEY (shipping_detail_id);
    ADD CONSTRAINT shipping_detail_pkey PRIMARY KEY (shipping_detail_id);




--
--
-- Name: shipping_detail shipping_detail_shipping_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_detail shipping_detail_shipping_id_line_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_detail
ALTER TABLE ONLY sales.shipping_detail
    ADD CONSTRAINT shipping_detail_shipping_id_line_no_key UNIQUE (shipping_id, line_no);
    ADD CONSTRAINT shipping_detail_shipping_id_line_no_key UNIQUE (shipping_id, line_no);




--
--
-- Name: shipping_header shipping_header_company_id_shipping_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_header shipping_header_company_id_shipping_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_header
ALTER TABLE ONLY sales.shipping_header
    ADD CONSTRAINT shipping_header_company_id_shipping_no_key UNIQUE (company_id, shipping_no);
    ADD CONSTRAINT shipping_header_company_id_shipping_no_key UNIQUE (company_id, shipping_no);




--
--
-- Name: shipping_header shipping_header_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_header shipping_header_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_header
ALTER TABLE ONLY sales.shipping_header
    ADD CONSTRAINT shipping_header_pkey PRIMARY KEY (shipping_id);
    ADD CONSTRAINT shipping_header_pkey PRIMARY KEY (shipping_id);




--
--
-- Name: shipping_revision shipping_revision_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_revision shipping_revision_pkey; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_revision
ALTER TABLE ONLY sales.shipping_revision
    ADD CONSTRAINT shipping_revision_pkey PRIMARY KEY (shipping_revision_id);
    ADD CONSTRAINT shipping_revision_pkey PRIMARY KEY (shipping_revision_id);




--
--
-- Name: shipping_revision shipping_revision_shipping_id_revision_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_revision shipping_revision_shipping_id_revision_no_key; Type: CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_revision
ALTER TABLE ONLY sales.shipping_revision
    ADD CONSTRAINT shipping_revision_shipping_id_revision_no_key UNIQUE (shipping_id, revision_no);
    ADD CONSTRAINT shipping_revision_shipping_id_revision_no_key UNIQUE (shipping_id, revision_no);




--
--
-- Name: buckets_analytics buckets_analytics_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: buckets_analytics buckets_analytics_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT buckets_analytics_pkey PRIMARY KEY (id);
    ADD CONSTRAINT buckets_analytics_pkey PRIMARY KEY (id);




--
--
-- Name: buckets buckets_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: buckets buckets_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT buckets_pkey PRIMARY KEY (id);
    ADD CONSTRAINT buckets_pkey PRIMARY KEY (id);




--
--
-- Name: buckets_vectors buckets_vectors_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: buckets_vectors buckets_vectors_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT buckets_vectors_pkey PRIMARY KEY (id);
    ADD CONSTRAINT buckets_vectors_pkey PRIMARY KEY (id);




--
--
-- Name: migrations migrations_name_key; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: migrations migrations_name_key; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT migrations_name_key UNIQUE (name);
    ADD CONSTRAINT migrations_name_key UNIQUE (name);




--
--
-- Name: migrations migrations_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: migrations migrations_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT migrations_pkey PRIMARY KEY (id);
    ADD CONSTRAINT migrations_pkey PRIMARY KEY (id);




--
--
-- Name: objects objects_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: objects objects_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT objects_pkey PRIMARY KEY (id);
    ADD CONSTRAINT objects_pkey PRIMARY KEY (id);




--
--
-- Name: prefixes prefixes_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: prefixes prefixes_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT prefixes_pkey PRIMARY KEY (bucket_id, level, name);
    ADD CONSTRAINT prefixes_pkey PRIMARY KEY (bucket_id, level, name);




--
--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT s3_multipart_uploads_parts_pkey PRIMARY KEY (id);
    ADD CONSTRAINT s3_multipart_uploads_parts_pkey PRIMARY KEY (id);




--
--
-- Name: s3_multipart_uploads s3_multipart_uploads_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: s3_multipart_uploads s3_multipart_uploads_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT s3_multipart_uploads_pkey PRIMARY KEY (id);
    ADD CONSTRAINT s3_multipart_uploads_pkey PRIMARY KEY (id);




--
--
-- Name: vector_indexes vector_indexes_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
-- Name: vector_indexes vector_indexes_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT vector_indexes_pkey PRIMARY KEY (id);
    ADD CONSTRAINT vector_indexes_pkey PRIMARY KEY (id);




--
--
-- Name: action_approval_map action_approval_map_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: action_approval_map action_approval_map_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.action_approval_map
ALTER TABLE ONLY system.action_approval_map
    ADD CONSTRAINT action_approval_map_pkey PRIMARY KEY (action_code, function_code);
    ADD CONSTRAINT action_approval_map_pkey PRIMARY KEY (action_code, function_code);




--
--
-- Name: ai_agent ai_agent_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: ai_agent ai_agent_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_agent
ALTER TABLE ONLY system.ai_agent
    ADD CONSTRAINT ai_agent_pkey PRIMARY KEY (agent_code);
    ADD CONSTRAINT ai_agent_pkey PRIMARY KEY (agent_code);




--
--
-- Name: ai_signal ai_signal_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: ai_signal ai_signal_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_signal
ALTER TABLE ONLY system.ai_signal
    ADD CONSTRAINT ai_signal_pkey PRIMARY KEY (signal_id);
    ADD CONSTRAINT ai_signal_pkey PRIMARY KEY (signal_id);




--
--
-- Name: ai_task ai_task_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: ai_task ai_task_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_task
ALTER TABLE ONLY system.ai_task
    ADD CONSTRAINT ai_task_pkey PRIMARY KEY (task_id);
    ADD CONSTRAINT ai_task_pkey PRIMARY KEY (task_id);




--
--
-- Name: ai_task_run ai_task_run_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: ai_task_run ai_task_run_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_task_run
ALTER TABLE ONLY system.ai_task_run
    ADD CONSTRAINT ai_task_run_pkey PRIMARY KEY (run_id);
    ADD CONSTRAINT ai_task_run_pkey PRIMARY KEY (run_id);




--
--
-- Name: approval_action_log approval_action_log_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: approval_action_log approval_action_log_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_action_log
ALTER TABLE ONLY system.approval_action_log
    ADD CONSTRAINT approval_action_log_pkey PRIMARY KEY (approval_action_id);
    ADD CONSTRAINT approval_action_log_pkey PRIMARY KEY (approval_action_id);




--
--
-- Name: approval_exec_map approval_exec_map_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: approval_exec_map approval_exec_map_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_exec_map
ALTER TABLE ONLY system.approval_exec_map
    ADD CONSTRAINT approval_exec_map_pkey PRIMARY KEY (approval_flow_code);
    ADD CONSTRAINT approval_exec_map_pkey PRIMARY KEY (approval_flow_code);




--
--
-- Name: approval_finalize_rule approval_finalize_rule_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: approval_finalize_rule approval_finalize_rule_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_finalize_rule
ALTER TABLE ONLY system.approval_finalize_rule
    ADD CONSTRAINT approval_finalize_rule_pkey PRIMARY KEY (function_code);
    ADD CONSTRAINT approval_finalize_rule_pkey PRIMARY KEY (function_code);




--
--
-- Name: approval_flow_def approval_flow_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: approval_flow_def approval_flow_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_flow_def
ALTER TABLE ONLY system.approval_flow_def
    ADD CONSTRAINT approval_flow_def_pkey PRIMARY KEY (approval_flow_code);
    ADD CONSTRAINT approval_flow_def_pkey PRIMARY KEY (approval_flow_code);




--
--
-- Name: approval_request approval_request_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: approval_request approval_request_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_request
ALTER TABLE ONLY system.approval_request
    ADD CONSTRAINT approval_request_pkey PRIMARY KEY (approval_request_id);
    ADD CONSTRAINT approval_request_pkey PRIMARY KEY (approval_request_id);




--
--
-- Name: approval_step_def approval_step_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: approval_step_def approval_step_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_step_def
ALTER TABLE ONLY system.approval_step_def
    ADD CONSTRAINT approval_step_def_pkey PRIMARY KEY (approval_flow_code, step_no);
    ADD CONSTRAINT approval_step_def_pkey PRIMARY KEY (approval_flow_code, step_no);




--
--
-- Name: business_finalize_event business_finalize_event_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: business_finalize_event business_finalize_event_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.business_finalize_event
ALTER TABLE ONLY system.business_finalize_event
    ADD CONSTRAINT business_finalize_event_pkey PRIMARY KEY (function_code);
    ADD CONSTRAINT business_finalize_event_pkey PRIMARY KEY (function_code);




--
--
-- Name: business_ops_map business_ops_map_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: business_ops_map business_ops_map_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.business_ops_map
ALTER TABLE ONLY system.business_ops_map
    ADD CONSTRAINT business_ops_map_pkey PRIMARY KEY (function_code);
    ADD CONSTRAINT business_ops_map_pkey PRIMARY KEY (function_code);




--
--
-- Name: db_session db_session_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: db_session db_session_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.db_session
ALTER TABLE ONLY system.db_session
    ADD CONSTRAINT db_session_pkey PRIMARY KEY (session_id);
    ADD CONSTRAINT db_session_pkey PRIMARY KEY (session_id);




--
--
-- Name: exec_command exec_command_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: exec_command exec_command_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.exec_command
ALTER TABLE ONLY system.exec_command
    ADD CONSTRAINT exec_command_pkey PRIMARY KEY (command_code);
    ADD CONSTRAINT exec_command_pkey PRIMARY KEY (command_code);




--
--
-- Name: exec_run_request exec_run_request_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: exec_run_request exec_run_request_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.exec_run_request
ALTER TABLE ONLY system.exec_run_request
    ADD CONSTRAINT exec_run_request_pkey PRIMARY KEY (request_id);
    ADD CONSTRAINT exec_run_request_pkey PRIMARY KEY (request_id);




--
--
-- Name: function_def function_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: function_def function_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.function_def
ALTER TABLE ONLY system.function_def
    ADD CONSTRAINT function_def_pkey PRIMARY KEY (function_code);
    ADD CONSTRAINT function_def_pkey PRIMARY KEY (function_code);




--
--
-- Name: loop_autotune_rule loop_autotune_rule_loop_code_key; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: loop_autotune_rule loop_autotune_rule_loop_code_key; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_autotune_rule
ALTER TABLE ONLY system.loop_autotune_rule
    ADD CONSTRAINT loop_autotune_rule_loop_code_key UNIQUE (loop_code);
    ADD CONSTRAINT loop_autotune_rule_loop_code_key UNIQUE (loop_code);




--
--
-- Name: loop_autotune_rule loop_autotune_rule_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: loop_autotune_rule loop_autotune_rule_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_autotune_rule
ALTER TABLE ONLY system.loop_autotune_rule
    ADD CONSTRAINT loop_autotune_rule_pkey PRIMARY KEY (rule_id);
    ADD CONSTRAINT loop_autotune_rule_pkey PRIMARY KEY (rule_id);




--
--
-- Name: loop_config loop_config_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: loop_config loop_config_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_config
ALTER TABLE ONLY system.loop_config
    ADD CONSTRAINT loop_config_pkey PRIMARY KEY (loop_code);
    ADD CONSTRAINT loop_config_pkey PRIMARY KEY (loop_code);




--
--
-- Name: loop_sla_stat loop_sla_stat_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: loop_sla_stat loop_sla_stat_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_sla_stat
ALTER TABLE ONLY system.loop_sla_stat
    ADD CONSTRAINT loop_sla_stat_pkey PRIMARY KEY (stat_id);
    ADD CONSTRAINT loop_sla_stat_pkey PRIMARY KEY (stat_id);




--
--
-- Name: loop_tick_log loop_tick_log_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: loop_tick_log loop_tick_log_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_tick_log
ALTER TABLE ONLY system.loop_tick_log
    ADD CONSTRAINT loop_tick_log_pkey PRIMARY KEY (tick_id);
    ADD CONSTRAINT loop_tick_log_pkey PRIMARY KEY (tick_id);




--
--
-- Name: module_def module_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: module_def module_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.module_def
ALTER TABLE ONLY system.module_def
    ADD CONSTRAINT module_def_pkey PRIMARY KEY (module_code);
    ADD CONSTRAINT module_def_pkey PRIMARY KEY (module_code);




--
--
-- Name: notification_endpoint notification_endpoint_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: notification_endpoint notification_endpoint_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.notification_endpoint
ALTER TABLE ONLY system.notification_endpoint
    ADD CONSTRAINT notification_endpoint_pkey PRIMARY KEY (endpoint_code);
    ADD CONSTRAINT notification_endpoint_pkey PRIMARY KEY (endpoint_code);




--
--
-- Name: notification_subscription notification_subscription_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: notification_subscription notification_subscription_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.notification_subscription
ALTER TABLE ONLY system.notification_subscription
    ADD CONSTRAINT notification_subscription_pkey PRIMARY KEY (event_type, endpoint_code);
    ADD CONSTRAINT notification_subscription_pkey PRIMARY KEY (event_type, endpoint_code);




--
--
-- Name: operation_log operation_log_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: operation_log operation_log_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.operation_log
ALTER TABLE ONLY system.operation_log
    ADD CONSTRAINT operation_log_pkey PRIMARY KEY (operation_log_id);
    ADD CONSTRAINT operation_log_pkey PRIMARY KEY (operation_log_id);




--
--
-- Name: operation_type_def operation_type_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: operation_type_def operation_type_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.operation_type_def
ALTER TABLE ONLY system.operation_type_def
    ADD CONSTRAINT operation_type_def_pkey PRIMARY KEY (operation_type);
    ADD CONSTRAINT operation_type_def_pkey PRIMARY KEY (operation_type);




--
--
-- Name: role_def role_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: role_def role_def_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.role_def
ALTER TABLE ONLY system.role_def
    ADD CONSTRAINT role_def_pkey PRIMARY KEY (role_code);
    ADD CONSTRAINT role_def_pkey PRIMARY KEY (role_code);




--
--
-- Name: role_screen_permission role_screen_permission_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: role_screen_permission role_screen_permission_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.role_screen_permission
ALTER TABLE ONLY system.role_screen_permission
    ADD CONSTRAINT role_screen_permission_pkey PRIMARY KEY (role_code, screen_code);
    ADD CONSTRAINT role_screen_permission_pkey PRIMARY KEY (role_code, screen_code);




--
--
-- Name: runtime_killswitch runtime_killswitch_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: runtime_killswitch runtime_killswitch_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.runtime_killswitch
ALTER TABLE ONLY system.runtime_killswitch
    ADD CONSTRAINT runtime_killswitch_pkey PRIMARY KEY (key);
    ADD CONSTRAINT runtime_killswitch_pkey PRIMARY KEY (key);




--
--
-- Name: screen_action_map screen_action_map_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: screen_action_map screen_action_map_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.screen_action_map
ALTER TABLE ONLY system.screen_action_map
    ADD CONSTRAINT screen_action_map_pkey PRIMARY KEY (screen_code, action_code);
    ADD CONSTRAINT screen_action_map_pkey PRIMARY KEY (screen_code, action_code);




--
--
-- Name: screen_master screen_master_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: screen_master screen_master_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.screen_master
ALTER TABLE ONLY system.screen_master
    ADD CONSTRAINT screen_master_pkey PRIMARY KEY (screen_code);
    ADD CONSTRAINT screen_master_pkey PRIMARY KEY (screen_code);




--
--
-- Name: screen_rule screen_rule_pkey; Type: CONSTRAINT; Schema: system; Owner: -
-- Name: screen_rule screen_rule_pkey; Type: CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.screen_rule
ALTER TABLE ONLY system.screen_rule
    ADD CONSTRAINT screen_rule_pkey PRIMARY KEY (screen_type);
    ADD CONSTRAINT screen_rule_pkey PRIMARY KEY (screen_type);




--
--
-- Name: company company_company_code_key; Type: CONSTRAINT; Schema: tenant; Owner: -
-- Name: company company_company_code_key; Type: CONSTRAINT; Schema: tenant; Owner: -
--
--


ALTER TABLE ONLY tenant.company
ALTER TABLE ONLY tenant.company
    ADD CONSTRAINT company_company_code_key UNIQUE (company_code);
    ADD CONSTRAINT company_company_code_key UNIQUE (company_code);




--
--
-- Name: company_license company_license_pkey; Type: CONSTRAINT; Schema: tenant; Owner: -
-- Name: company_license company_license_pkey; Type: CONSTRAINT; Schema: tenant; Owner: -
--
--


ALTER TABLE ONLY tenant.company_license
ALTER TABLE ONLY tenant.company_license
    ADD CONSTRAINT company_license_pkey PRIMARY KEY (company_id, license_code);
    ADD CONSTRAINT company_license_pkey PRIMARY KEY (company_id, license_code);




--
--
-- Name: company company_pkey; Type: CONSTRAINT; Schema: tenant; Owner: -
-- Name: company company_pkey; Type: CONSTRAINT; Schema: tenant; Owner: -
--
--


ALTER TABLE ONLY tenant.company
ALTER TABLE ONLY tenant.company
    ADD CONSTRAINT company_pkey PRIMARY KEY (company_id);
    ADD CONSTRAINT company_pkey PRIMARY KEY (company_id);




--
--
-- Name: license_master license_master_pkey; Type: CONSTRAINT; Schema: tenant; Owner: -
-- Name: license_master license_master_pkey; Type: CONSTRAINT; Schema: tenant; Owner: -
--
--


ALTER TABLE ONLY tenant.license_master
ALTER TABLE ONLY tenant.license_master
    ADD CONSTRAINT license_master_pkey PRIMARY KEY (license_code);
    ADD CONSTRAINT license_master_pkey PRIMARY KEY (license_code);




--
--
-- Name: idx_ai_event_pending; Type: INDEX; Schema: analytics; Owner: -
-- Name: idx_ai_event_pending; Type: INDEX; Schema: analytics; Owner: -
--
--


CREATE INDEX idx_ai_event_pending ON analytics.ai_event USING btree (company_id, status) WHERE (status = 'pending'::text);
CREATE INDEX idx_ai_event_pending ON analytics.ai_event USING btree (company_id, status) WHERE (status = 'pending'::text);




--
--
-- Name: idx_ai_job_pending; Type: INDEX; Schema: analytics; Owner: -
-- Name: idx_ai_job_pending; Type: INDEX; Schema: analytics; Owner: -
--
--


CREATE INDEX idx_ai_job_pending ON analytics.ai_job USING btree (company_id, status) WHERE (status = 'pending'::text);
CREATE INDEX idx_ai_job_pending ON analytics.ai_job USING btree (company_id, status) WHERE (status = 'pending'::text);




--
--
-- Name: idx_fact_metric_lookup; Type: INDEX; Schema: analytics; Owner: -
-- Name: idx_fact_metric_lookup; Type: INDEX; Schema: analytics; Owner: -
--
--


CREATE INDEX idx_fact_metric_lookup ON analytics.fact_metric USING btree (company_id, metric_code, metric_date DESC);
CREATE INDEX idx_fact_metric_lookup ON analytics.fact_metric USING btree (company_id, metric_code, metric_date DESC);




--
--
-- Name: idx_notification_pending; Type: INDEX; Schema: analytics; Owner: -
-- Name: idx_notification_pending; Type: INDEX; Schema: analytics; Owner: -
--
--


CREATE INDEX idx_notification_pending ON analytics.notification_queue USING btree (status) WHERE (status = 'pending'::text);
CREATE INDEX idx_notification_pending ON analytics.notification_queue USING btree (status) WHERE (status = 'pending'::text);




--
--
-- Name: ix_alert_notification_status; Type: INDEX; Schema: analytics; Owner: -
-- Name: ix_alert_notification_status; Type: INDEX; Schema: analytics; Owner: -
--
--


CREATE INDEX ix_alert_notification_status ON analytics.audit_alert_notification USING btree (status, created_at);
CREATE INDEX ix_alert_notification_status ON analytics.audit_alert_notification USING btree (status, created_at);




--
--
-- Name: ix_audit_alert_rule_company; Type: INDEX; Schema: analytics; Owner: -
-- Name: ix_audit_alert_rule_company; Type: INDEX; Schema: analytics; Owner: -
--
--


CREATE INDEX ix_audit_alert_rule_company ON analytics.audit_alert_rule USING btree (company_id, is_enabled);
CREATE INDEX ix_audit_alert_rule_company ON analytics.audit_alert_rule USING btree (company_id, is_enabled);




--
--
-- Name: ux_alert_event_dedupe; Type: INDEX; Schema: analytics; Owner: -
-- Name: ux_alert_event_dedupe; Type: INDEX; Schema: analytics; Owner: -
--
--


CREATE UNIQUE INDEX ux_alert_event_dedupe ON analytics.audit_alert_event USING btree (rule_id, company_id, window_end);
CREATE UNIQUE INDEX ux_alert_event_dedupe ON analytics.audit_alert_event USING btree (rule_id, company_id, window_end);




--
--
-- Name: idx_ai_prop_request; Type: INDEX; Schema: approval; Owner: -
-- Name: idx_ai_prop_request; Type: INDEX; Schema: approval; Owner: -
--
--


CREATE INDEX idx_ai_prop_request ON approval.ai_improvement_proposal USING btree (request_id);
CREATE INDEX idx_ai_prop_request ON approval.ai_improvement_proposal USING btree (request_id);




--
--
-- Name: idx_invoice_delivery_invoice; Type: INDEX; Schema: approval; Owner: -
-- Name: idx_invoice_delivery_invoice; Type: INDEX; Schema: approval; Owner: -
--
--


CREATE INDEX idx_invoice_delivery_invoice ON approval.invoice_delivery_log USING btree (invoice_id, created_at DESC);
CREATE INDEX idx_invoice_delivery_invoice ON approval.invoice_delivery_log USING btree (invoice_id, created_at DESC);




--
--
-- Name: idx_jsox_evidence_company_time; Type: INDEX; Schema: approval; Owner: -
-- Name: idx_jsox_evidence_company_time; Type: INDEX; Schema: approval; Owner: -
--
--


CREATE INDEX idx_jsox_evidence_company_time ON approval.jsox_evidence_log USING btree (company_id, created_at DESC);
CREATE INDEX idx_jsox_evidence_company_time ON approval.jsox_evidence_log USING btree (company_id, created_at DESC);




--
--
-- Name: idx_policy_eval_policy_time; Type: INDEX; Schema: approval; Owner: -
-- Name: idx_policy_eval_policy_time; Type: INDEX; Schema: approval; Owner: -
--
--


CREATE INDEX idx_policy_eval_policy_time ON approval.policy_eval_event USING btree (auto_policy_id, created_at DESC);
CREATE INDEX idx_policy_eval_policy_time ON approval.policy_eval_event USING btree (auto_policy_id, created_at DESC);




--
--
-- Name: idx_rework_open; Type: INDEX; Schema: approval; Owner: -
-- Name: idx_rework_open; Type: INDEX; Schema: approval; Owner: -
--
--


CREATE INDEX idx_rework_open ON approval.rework_task USING btree (status, created_at DESC);
CREATE INDEX idx_rework_open ON approval.rework_task USING btree (status, created_at DESC);




--
--
-- Name: idx_saas_sub_company; Type: INDEX; Schema: approval; Owner: -
-- Name: idx_saas_sub_company; Type: INDEX; Schema: approval; Owner: -
--
--


CREATE INDEX idx_saas_sub_company ON approval.saas_subscription USING btree (company_id, status);
CREATE INDEX idx_saas_sub_company ON approval.saas_subscription USING btree (company_id, status);




--
--
-- Name: idx_approval_log_request; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_approval_log_request; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_approval_log_request ON audit.approval_log USING btree (approval_request_id);
CREATE INDEX idx_approval_log_request ON audit.approval_log USING btree (approval_request_id);




--
--
-- Name: idx_approval_request_company; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_approval_request_company; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_approval_request_company ON audit.approval_request USING btree (company_id);
CREATE INDEX idx_approval_request_company ON audit.approval_request USING btree (company_id);




--
--
-- Name: idx_approval_request_domain_entity; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_approval_request_domain_entity; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_approval_request_domain_entity ON audit.approval_request USING btree (domain, entity_type, entity_id);
CREATE INDEX idx_approval_request_domain_entity ON audit.approval_request USING btree (domain, entity_type, entity_id);




--
--
-- Name: idx_approval_request_order; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_approval_request_order; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_approval_request_order ON audit.approval_request USING btree (order_id);
CREATE INDEX idx_approval_request_order ON audit.approval_request USING btree (order_id);




--
--
-- Name: idx_approval_request_status; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_approval_request_status; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_approval_request_status ON audit.approval_request USING btree (status);
CREATE INDEX idx_approval_request_status ON audit.approval_request USING btree (status);




--
--
-- Name: idx_entity_status_history_company; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_entity_status_history_company; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_entity_status_history_company ON audit.entity_status_history USING btree (company_id);
CREATE INDEX idx_entity_status_history_company ON audit.entity_status_history USING btree (company_id);




--
--
-- Name: idx_entity_status_history_entity; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_entity_status_history_entity; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_entity_status_history_entity ON audit.entity_status_history USING btree (entity_type, entity_id);
CREATE INDEX idx_entity_status_history_entity ON audit.entity_status_history USING btree (entity_type, entity_id);




--
--
-- Name: idx_ng_event_company_time; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_ng_event_company_time; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_ng_event_company_time ON audit.ng_event USING btree (company_id, occurred_at DESC);
CREATE INDEX idx_ng_event_company_time ON audit.ng_event USING btree (company_id, occurred_at DESC);




--
--
-- Name: idx_ng_event_event_key; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_ng_event_event_key; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_ng_event_event_key ON audit.ng_event USING btree (event_key);
CREATE INDEX idx_ng_event_event_key ON audit.ng_event USING btree (event_key);




--
--
-- Name: idx_ng_event_quarantined; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_ng_event_quarantined; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_ng_event_quarantined ON audit.ng_event USING btree (quarantined) WHERE (quarantined = true);
CREATE INDEX idx_ng_event_quarantined ON audit.ng_event USING btree (quarantined) WHERE (quarantined = true);




--
--
-- Name: idx_ng_event_scope_severity; Type: INDEX; Schema: audit; Owner: -
-- Name: idx_ng_event_scope_severity; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE INDEX idx_ng_event_scope_severity ON audit.ng_event USING btree (audit_scope, severity);
CREATE INDEX idx_ng_event_scope_severity ON audit.ng_event USING btree (audit_scope, severity);




--
--
-- Name: ux_audit_event_unique; Type: INDEX; Schema: audit; Owner: -
-- Name: ux_audit_event_unique; Type: INDEX; Schema: audit; Owner: -
--
--


CREATE UNIQUE INDEX ux_audit_event_unique ON audit.audit_event USING btree (company_id, occurred_at, business_domain, event_key, reason_code);
CREATE UNIQUE INDEX ux_audit_event_unique ON audit.audit_event USING btree (company_id, occurred_at, business_domain, event_key, reason_code);




--
--
-- Name: audit_logs_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: audit_logs_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: confirmation_token_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: confirmation_token_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: email_change_token_current_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: email_change_token_current_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: email_change_token_new_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: email_change_token_new_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: factor_id_created_at_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: factor_id_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: flow_state_created_at_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: flow_state_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: identities_email_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: identities_email_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: INDEX identities_email_idx; Type: COMMENT; Schema: auth; Owner: -
-- Name: INDEX identities_email_idx; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON INDEX auth.identities_email_idx IS 'Auth: Ensures indexed queries on the email column';
COMMENT ON INDEX auth.identities_email_idx IS 'Auth: Ensures indexed queries on the email column';




--
--
-- Name: identities_user_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: identities_user_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: idx_auth_code; Type: INDEX; Schema: auth; Owner: -
-- Name: idx_auth_code; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: idx_oauth_client_states_created_at; Type: INDEX; Schema: auth; Owner: -
-- Name: idx_oauth_client_states_created_at; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: idx_user_id_auth_method; Type: INDEX; Schema: auth; Owner: -
-- Name: idx_user_id_auth_method; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: mfa_challenge_created_at_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: mfa_challenge_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: mfa_factors_user_friendly_name_unique; Type: INDEX; Schema: auth; Owner: -
-- Name: mfa_factors_user_friendly_name_unique; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: mfa_factors_user_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: mfa_factors_user_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: oauth_auth_pending_exp_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: oauth_auth_pending_exp_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: oauth_clients_deleted_at_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: oauth_clients_deleted_at_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: oauth_consents_active_client_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: oauth_consents_active_client_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: oauth_consents_active_user_client_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: oauth_consents_active_user_client_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: oauth_consents_user_order_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: oauth_consents_user_order_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: one_time_tokens_relates_to_hash_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: one_time_tokens_relates_to_hash_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: one_time_tokens_token_hash_hash_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: one_time_tokens_token_hash_hash_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: one_time_tokens_user_id_token_type_key; Type: INDEX; Schema: auth; Owner: -
-- Name: one_time_tokens_user_id_token_type_key; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: reauthentication_token_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: reauthentication_token_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: recovery_token_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: recovery_token_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: refresh_tokens_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: refresh_tokens_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: refresh_tokens_instance_id_user_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: refresh_tokens_instance_id_user_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: refresh_tokens_parent_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: refresh_tokens_parent_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: refresh_tokens_session_id_revoked_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: refresh_tokens_session_id_revoked_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: refresh_tokens_updated_at_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: refresh_tokens_updated_at_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: saml_providers_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: saml_providers_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: saml_relay_states_created_at_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: saml_relay_states_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: saml_relay_states_for_email_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: saml_relay_states_for_email_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: saml_relay_states_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: saml_relay_states_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: sessions_not_after_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: sessions_not_after_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: sessions_oauth_client_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: sessions_oauth_client_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: sessions_user_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: sessions_user_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: sso_domains_domain_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: sso_domains_domain_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: sso_domains_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: sso_domains_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: sso_providers_resource_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: sso_providers_resource_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: sso_providers_resource_id_pattern_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: sso_providers_resource_id_pattern_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: unique_phone_factor_per_user; Type: INDEX; Schema: auth; Owner: -
-- Name: unique_phone_factor_per_user; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: user_id_created_at_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: user_id_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: users_email_partial_key; Type: INDEX; Schema: auth; Owner: -
-- Name: users_email_partial_key; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: INDEX users_email_partial_key; Type: COMMENT; Schema: auth; Owner: -
-- Name: INDEX users_email_partial_key; Type: COMMENT; Schema: auth; Owner: -
--
--


COMMENT ON INDEX auth.users_email_partial_key IS 'Auth: A partial unique index that applies only when is_sso_user is false';
COMMENT ON INDEX auth.users_email_partial_key IS 'Auth: A partial unique index that applies only when is_sso_user is false';




--
--
-- Name: users_instance_id_email_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: users_instance_id_email_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: users_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: users_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: users_is_anonymous_idx; Type: INDEX; Schema: auth; Owner: -
-- Name: users_is_anonymous_idx; Type: INDEX; Schema: auth; Owner: -
--
--






--
--
-- Name: idx_checkout_invoice; Type: INDEX; Schema: billing; Owner: -
-- Name: idx_checkout_invoice; Type: INDEX; Schema: billing; Owner: -
--
--


CREATE INDEX idx_checkout_invoice ON billing.checkout_session USING btree (invoice_id, created_at DESC);
CREATE INDEX idx_checkout_invoice ON billing.checkout_session USING btree (invoice_id, created_at DESC);




--
--
-- Name: idx_invoice_send_audit_invoice; Type: INDEX; Schema: billing; Owner: -
-- Name: idx_invoice_send_audit_invoice; Type: INDEX; Schema: billing; Owner: -
--
--


CREATE INDEX idx_invoice_send_audit_invoice ON billing.invoice_send_audit USING btree (invoice_id, created_at DESC);
CREATE INDEX idx_invoice_send_audit_invoice ON billing.invoice_send_audit USING btree (invoice_id, created_at DESC);




--
--
-- Name: uq_invoice_retry_once; Type: INDEX; Schema: billing; Owner: -
-- Name: uq_invoice_retry_once; Type: INDEX; Schema: billing; Owner: -
--
--


CREATE UNIQUE INDEX uq_invoice_retry_once ON billing.invoice_send_retry USING btree (invoice_id) WHERE (status = 'pending'::text);
CREATE UNIQUE INDEX uq_invoice_retry_once ON billing.invoice_send_retry USING btree (invoice_id) WHERE (status = 'pending'::text);




--
--
-- Name: idx_ops_notification_pending; Type: INDEX; Schema: ci; Owner: -
-- Name: idx_ops_notification_pending; Type: INDEX; Schema: ci; Owner: -
--
--


CREATE INDEX idx_ops_notification_pending ON ci.ops_notification_queue USING btree (status, created_at);
CREATE INDEX idx_ops_notification_pending ON ci.ops_notification_queue USING btree (status, created_at);




--
--
-- Name: idx_schema_ai_review_job_status; Type: INDEX; Schema: ci; Owner: -
-- Name: idx_schema_ai_review_job_status; Type: INDEX; Schema: ci; Owner: -
--
--


CREATE INDEX idx_schema_ai_review_job_status ON ci.schema_ai_review_job USING btree (status, created_at);
CREATE INDEX idx_schema_ai_review_job_status ON ci.schema_ai_review_job USING btree (status, created_at);




--
--
-- Name: uq_escalation_outbox_queued; Type: INDEX; Schema: ci; Owner: -
-- Name: uq_escalation_outbox_queued; Type: INDEX; Schema: ci; Owner: -
--
--


CREATE UNIQUE INDEX uq_escalation_outbox_queued ON ci.escalation_outbox USING btree (request_id) WHERE (status = 'queued'::text);
CREATE UNIQUE INDEX uq_escalation_outbox_queued ON ci.escalation_outbox USING btree (request_id) WHERE (status = 'queued'::text);




--
--
-- Name: idx_audit_trail_company_entity; Type: INDEX; Schema: core; Owner: -
-- Name: idx_audit_trail_company_entity; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX idx_audit_trail_company_entity ON ONLY core.audit_trail USING btree (company_id, entity_type, entity_id);
CREATE INDEX idx_audit_trail_company_entity ON ONLY core.audit_trail USING btree (company_id, entity_type, entity_id);




--
--
-- Name: audit_trail_2025_12_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2025_12_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2025_12_company_id_entity_type_entity_id_idx ON core.audit_trail_2025_12 USING btree (company_id, entity_type, entity_id);
CREATE INDEX audit_trail_2025_12_company_id_entity_type_entity_id_idx ON core.audit_trail_2025_12 USING btree (company_id, entity_type, entity_id);




--
--
-- Name: idx_audit_trail_company_time; Type: INDEX; Schema: core; Owner: -
-- Name: idx_audit_trail_company_time; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX idx_audit_trail_company_time ON ONLY core.audit_trail USING btree (company_id, performed_at DESC);
CREATE INDEX idx_audit_trail_company_time ON ONLY core.audit_trail USING btree (company_id, performed_at DESC);




--
--
-- Name: audit_trail_2025_12_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2025_12_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2025_12_company_id_performed_at_idx ON core.audit_trail_2025_12 USING btree (company_id, performed_at DESC);
CREATE INDEX audit_trail_2025_12_company_id_performed_at_idx ON core.audit_trail_2025_12 USING btree (company_id, performed_at DESC);




--
--
-- Name: idx_audit_trail_entity; Type: INDEX; Schema: core; Owner: -
-- Name: idx_audit_trail_entity; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX idx_audit_trail_entity ON ONLY core.audit_trail USING btree (entity_type, entity_id);
CREATE INDEX idx_audit_trail_entity ON ONLY core.audit_trail USING btree (entity_type, entity_id);




--
--
-- Name: audit_trail_2025_12_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2025_12_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2025_12_entity_type_entity_id_idx ON core.audit_trail_2025_12 USING btree (entity_type, entity_id);
CREATE INDEX audit_trail_2025_12_entity_type_entity_id_idx ON core.audit_trail_2025_12 USING btree (entity_type, entity_id);




--
--
-- Name: idx_audit_trail_entity_time; Type: INDEX; Schema: core; Owner: -
-- Name: idx_audit_trail_entity_time; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX idx_audit_trail_entity_time ON ONLY core.audit_trail USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX idx_audit_trail_entity_time ON ONLY core.audit_trail USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: audit_trail_2025_12_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2025_12_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2025_12_entity_type_entity_id_performed_at_idx ON core.audit_trail_2025_12 USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX audit_trail_2025_12_entity_type_entity_id_performed_at_idx ON core.audit_trail_2025_12 USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_01_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_01_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_01_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_01 USING btree (company_id, entity_type, entity_id);
CREATE INDEX audit_trail_2026_01_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_01 USING btree (company_id, entity_type, entity_id);




--
--
-- Name: audit_trail_2026_01_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_01_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_01_company_id_performed_at_idx ON core.audit_trail_2026_01 USING btree (company_id, performed_at DESC);
CREATE INDEX audit_trail_2026_01_company_id_performed_at_idx ON core.audit_trail_2026_01 USING btree (company_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_01_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_01_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_01_entity_type_entity_id_idx ON core.audit_trail_2026_01 USING btree (entity_type, entity_id);
CREATE INDEX audit_trail_2026_01_entity_type_entity_id_idx ON core.audit_trail_2026_01 USING btree (entity_type, entity_id);




--
--
-- Name: audit_trail_2026_01_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_01_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_01_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_01 USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX audit_trail_2026_01_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_01 USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_02_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_02_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_02_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_02 USING btree (company_id, entity_type, entity_id);
CREATE INDEX audit_trail_2026_02_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_02 USING btree (company_id, entity_type, entity_id);




--
--
-- Name: audit_trail_2026_02_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_02_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_02_company_id_performed_at_idx ON core.audit_trail_2026_02 USING btree (company_id, performed_at DESC);
CREATE INDEX audit_trail_2026_02_company_id_performed_at_idx ON core.audit_trail_2026_02 USING btree (company_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_02_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_02_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_02_entity_type_entity_id_idx ON core.audit_trail_2026_02 USING btree (entity_type, entity_id);
CREATE INDEX audit_trail_2026_02_entity_type_entity_id_idx ON core.audit_trail_2026_02 USING btree (entity_type, entity_id);




--
--
-- Name: audit_trail_2026_02_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_02_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_02_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_02 USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX audit_trail_2026_02_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_02 USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_03_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_03_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_03_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_03 USING btree (company_id, entity_type, entity_id);
CREATE INDEX audit_trail_2026_03_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_03 USING btree (company_id, entity_type, entity_id);




--
--
-- Name: audit_trail_2026_03_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_03_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_03_company_id_performed_at_idx ON core.audit_trail_2026_03 USING btree (company_id, performed_at DESC);
CREATE INDEX audit_trail_2026_03_company_id_performed_at_idx ON core.audit_trail_2026_03 USING btree (company_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_03_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_03_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_03_entity_type_entity_id_idx ON core.audit_trail_2026_03 USING btree (entity_type, entity_id);
CREATE INDEX audit_trail_2026_03_entity_type_entity_id_idx ON core.audit_trail_2026_03 USING btree (entity_type, entity_id);




--
--
-- Name: audit_trail_2026_03_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_03_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_03_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_03 USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX audit_trail_2026_03_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_03 USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_04_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_04_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_04_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_04 USING btree (company_id, entity_type, entity_id);
CREATE INDEX audit_trail_2026_04_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_04 USING btree (company_id, entity_type, entity_id);




--
--
-- Name: audit_trail_2026_04_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_04_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_04_company_id_performed_at_idx ON core.audit_trail_2026_04 USING btree (company_id, performed_at DESC);
CREATE INDEX audit_trail_2026_04_company_id_performed_at_idx ON core.audit_trail_2026_04 USING btree (company_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_04_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_04_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_04_entity_type_entity_id_idx ON core.audit_trail_2026_04 USING btree (entity_type, entity_id);
CREATE INDEX audit_trail_2026_04_entity_type_entity_id_idx ON core.audit_trail_2026_04 USING btree (entity_type, entity_id);




--
--
-- Name: audit_trail_2026_04_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_04_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_04_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_04 USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX audit_trail_2026_04_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_04 USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_05_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_05_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_05_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_05 USING btree (company_id, entity_type, entity_id);
CREATE INDEX audit_trail_2026_05_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_05 USING btree (company_id, entity_type, entity_id);




--
--
-- Name: audit_trail_2026_05_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_05_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_05_company_id_performed_at_idx ON core.audit_trail_2026_05 USING btree (company_id, performed_at DESC);
CREATE INDEX audit_trail_2026_05_company_id_performed_at_idx ON core.audit_trail_2026_05 USING btree (company_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_05_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_05_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_05_entity_type_entity_id_idx ON core.audit_trail_2026_05 USING btree (entity_type, entity_id);
CREATE INDEX audit_trail_2026_05_entity_type_entity_id_idx ON core.audit_trail_2026_05 USING btree (entity_type, entity_id);




--
--
-- Name: audit_trail_2026_05_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_05_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_05_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_05 USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX audit_trail_2026_05_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_05 USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_06_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_06_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_06_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_06 USING btree (company_id, entity_type, entity_id);
CREATE INDEX audit_trail_2026_06_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_06 USING btree (company_id, entity_type, entity_id);




--
--
-- Name: audit_trail_2026_06_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_06_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_06_company_id_performed_at_idx ON core.audit_trail_2026_06 USING btree (company_id, performed_at DESC);
CREATE INDEX audit_trail_2026_06_company_id_performed_at_idx ON core.audit_trail_2026_06 USING btree (company_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_06_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_06_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_06_entity_type_entity_id_idx ON core.audit_trail_2026_06 USING btree (entity_type, entity_id);
CREATE INDEX audit_trail_2026_06_entity_type_entity_id_idx ON core.audit_trail_2026_06 USING btree (entity_type, entity_id);




--
--
-- Name: audit_trail_2026_06_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_06_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_06_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_06 USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX audit_trail_2026_06_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_06 USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_07_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_07_company_id_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_07_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_07 USING btree (company_id, entity_type, entity_id);
CREATE INDEX audit_trail_2026_07_company_id_entity_type_entity_id_idx ON core.audit_trail_2026_07 USING btree (company_id, entity_type, entity_id);




--
--
-- Name: audit_trail_2026_07_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_07_company_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_07_company_id_performed_at_idx ON core.audit_trail_2026_07 USING btree (company_id, performed_at DESC);
CREATE INDEX audit_trail_2026_07_company_id_performed_at_idx ON core.audit_trail_2026_07 USING btree (company_id, performed_at DESC);




--
--
-- Name: audit_trail_2026_07_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_07_entity_type_entity_id_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_07_entity_type_entity_id_idx ON core.audit_trail_2026_07 USING btree (entity_type, entity_id);
CREATE INDEX audit_trail_2026_07_entity_type_entity_id_idx ON core.audit_trail_2026_07 USING btree (entity_type, entity_id);




--
--
-- Name: audit_trail_2026_07_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
-- Name: audit_trail_2026_07_entity_type_entity_id_performed_at_idx; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX audit_trail_2026_07_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_07 USING btree (entity_type, entity_id, performed_at DESC);
CREATE INDEX audit_trail_2026_07_entity_type_entity_id_performed_at_idx ON core.audit_trail_2026_07 USING btree (entity_type, entity_id, performed_at DESC);




--
--
-- Name: idx_audit_impact_rule_lookup; Type: INDEX; Schema: core; Owner: -
-- Name: idx_audit_impact_rule_lookup; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX idx_audit_impact_rule_lookup ON core.audit_impact_rule USING btree (company_id, action, priority);
CREATE INDEX idx_audit_impact_rule_lookup ON core.audit_impact_rule USING btree (company_id, action, priority);




--
--
-- Name: idx_status_history_entity; Type: INDEX; Schema: core; Owner: -
-- Name: idx_status_history_entity; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX idx_status_history_entity ON core.status_history USING btree (company_id, entity_type, entity_id, changed_at DESC);
CREATE INDEX idx_status_history_entity ON core.status_history USING btree (company_id, entity_type, entity_id, changed_at DESC);




--
--
-- Name: idx_sync_queue_status; Type: INDEX; Schema: core; Owner: -
-- Name: idx_sync_queue_status; Type: INDEX; Schema: core; Owner: -
--
--


CREATE INDEX idx_sync_queue_status ON core.sync_queue USING btree (status, created_at);
CREATE INDEX idx_sync_queue_status ON core.sync_queue USING btree (status, created_at);




--
--
-- Name: idx_audit_export_queue_status; Type: INDEX; Schema: integration; Owner: -
-- Name: idx_audit_export_queue_status; Type: INDEX; Schema: integration; Owner: -
--
--


CREATE INDEX idx_audit_export_queue_status ON integration.audit_export_queue USING btree (status, created_at);
CREATE INDEX idx_audit_export_queue_status ON integration.audit_export_queue USING btree (status, created_at);




--
--
-- Name: idx_siem_queue_status; Type: INDEX; Schema: integration; Owner: -
-- Name: idx_siem_queue_status; Type: INDEX; Schema: integration; Owner: -
--
--


CREATE INDEX idx_siem_queue_status ON integration.siem_delivery_queue USING btree (status, enqueued_at);
CREATE INDEX idx_siem_queue_status ON integration.siem_delivery_queue USING btree (status, enqueued_at);




--
--
-- Name: idx_stock_tx_item_time; Type: INDEX; Schema: inventory; Owner: -
-- Name: idx_stock_tx_item_time; Type: INDEX; Schema: inventory; Owner: -
--
--


CREATE INDEX idx_stock_tx_item_time ON inventory.stock_transaction USING btree (company_id, item_id, occurred_at DESC);
CREATE INDEX idx_stock_tx_item_time ON inventory.stock_transaction USING btree (company_id, item_id, occurred_at DESC);




--
--
-- Name: ix_asset_link_entity_role; Type: INDEX; Schema: media; Owner: -
-- Name: ix_asset_link_entity_role; Type: INDEX; Schema: media; Owner: -
--
--


CREATE INDEX ix_asset_link_entity_role ON media.asset_link USING btree (entity_table, entity_id, role, sort_order);
CREATE INDEX ix_asset_link_entity_role ON media.asset_link USING btree (entity_table, entity_id, role, sort_order);




--
--
-- Name: ix_asset_link_primary; Type: INDEX; Schema: media; Owner: -
-- Name: ix_asset_link_primary; Type: INDEX; Schema: media; Owner: -
--
--


CREATE INDEX ix_asset_link_primary ON media.asset_link USING btree (entity_table, entity_id, role, is_primary);
CREATE INDEX ix_asset_link_primary ON media.asset_link USING btree (entity_table, entity_id, role, is_primary);




--
--
-- Name: idx_ai_event_company_status; Type: INDEX; Schema: notify; Owner: -
-- Name: idx_ai_event_company_status; Type: INDEX; Schema: notify; Owner: -
--
--


CREATE INDEX idx_ai_event_company_status ON notify.ai_event USING btree (company_id, status);
CREATE INDEX idx_ai_event_company_status ON notify.ai_event USING btree (company_id, status);




--
--
-- Name: idx_approval_company_status; Type: INDEX; Schema: notify; Owner: -
-- Name: idx_approval_company_status; Type: INDEX; Schema: notify; Owner: -
--
--


CREATE INDEX idx_approval_company_status ON notify.approval_request USING btree (company_id, status);
CREATE INDEX idx_approval_company_status ON notify.approval_request USING btree (company_id, status);




--
--
-- Name: idx_approval_request_company_status; Type: INDEX; Schema: notify; Owner: -
-- Name: idx_approval_request_company_status; Type: INDEX; Schema: notify; Owner: -
--
--


CREATE INDEX idx_approval_request_company_status ON notify.approval_request USING btree (company_id, status);
CREATE INDEX idx_approval_request_company_status ON notify.approval_request USING btree (company_id, status);




--
--
-- Name: idx_audit_company_created; Type: INDEX; Schema: notify; Owner: -
-- Name: idx_audit_company_created; Type: INDEX; Schema: notify; Owner: -
--
--


CREATE INDEX idx_audit_company_created ON notify.audit_trail USING btree (company_id, created_at);
CREATE INDEX idx_audit_company_created ON notify.audit_trail USING btree (company_id, created_at);




--
--
-- Name: idx_audit_trail_company_created; Type: INDEX; Schema: notify; Owner: -
-- Name: idx_audit_trail_company_created; Type: INDEX; Schema: notify; Owner: -
--
--


CREATE INDEX idx_audit_trail_company_created ON notify.audit_trail USING btree (company_id, created_at);
CREATE INDEX idx_audit_trail_company_created ON notify.audit_trail USING btree (company_id, created_at);




--
--
-- Name: idx_notify_log_company_status; Type: INDEX; Schema: notify; Owner: -
-- Name: idx_notify_log_company_status; Type: INDEX; Schema: notify; Owner: -
--
--


CREATE INDEX idx_notify_log_company_status ON notify.notification_log USING btree (company_id, status);
CREATE INDEX idx_notify_log_company_status ON notify.notification_log USING btree (company_id, status);




--
--
-- Name: idx_notify_log_created_at; Type: INDEX; Schema: notify; Owner: -
-- Name: idx_notify_log_created_at; Type: INDEX; Schema: notify; Owner: -
--
--


CREATE INDEX idx_notify_log_created_at ON notify.notification_log USING btree (created_at);
CREATE INDEX idx_notify_log_created_at ON notify.notification_log USING btree (created_at);




--
--
-- Name: idx_notify_log_retry; Type: INDEX; Schema: notify; Owner: -
-- Name: idx_notify_log_retry; Type: INDEX; Schema: notify; Owner: -
--
--


CREATE INDEX idx_notify_log_retry ON notify.notification_log USING btree (status, retry_count);
CREATE INDEX idx_notify_log_retry ON notify.notification_log USING btree (status, retry_count);




--
--
-- Name: idx_ops_job_pending; Type: INDEX; Schema: ops; Owner: -
-- Name: idx_ops_job_pending; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE INDEX idx_ops_job_pending ON ops.ops_job_queue USING btree (job_status, created_at);
CREATE INDEX idx_ops_job_pending ON ops.ops_job_queue USING btree (job_status, created_at);




--
--
-- Name: ix_notification_outbox_pick; Type: INDEX; Schema: ops; Owner: -
-- Name: ix_notification_outbox_pick; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE INDEX ix_notification_outbox_pick ON ops.notification_outbox USING btree (status, retry_count, created_at);
CREATE INDEX ix_notification_outbox_pick ON ops.notification_outbox USING btree (status, retry_count, created_at);




--
--
-- Name: ix_notification_pick; Type: INDEX; Schema: ops; Owner: -
-- Name: ix_notification_pick; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE INDEX ix_notification_pick ON ops.notification_outbox USING btree (status, run_after, notification_id);
CREATE INDEX ix_notification_pick ON ops.notification_outbox USING btree (status, run_after, notification_id);




--
--
-- Name: ix_ops_job_queue_business; Type: INDEX; Schema: ops; Owner: -
-- Name: ix_ops_job_queue_business; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE INDEX ix_ops_job_queue_business ON ops.ops_job_queue USING btree (business_table, business_id);
CREATE INDEX ix_ops_job_queue_business ON ops.ops_job_queue USING btree (business_table, business_id);




--
--
-- Name: ix_ops_job_queue_locked; Type: INDEX; Schema: ops; Owner: -
-- Name: ix_ops_job_queue_locked; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE INDEX ix_ops_job_queue_locked ON ops.ops_job_queue USING btree (locked_at);
CREATE INDEX ix_ops_job_queue_locked ON ops.ops_job_queue USING btree (locked_at);




--
--
-- Name: ix_ops_job_queue_pick; Type: INDEX; Schema: ops; Owner: -
-- Name: ix_ops_job_queue_pick; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE INDEX ix_ops_job_queue_pick ON ops.ops_job_queue USING btree (status, run_after, priority, job_id);
CREATE INDEX ix_ops_job_queue_pick ON ops.ops_job_queue USING btree (status, run_after, priority, job_id);




--
--
-- Name: ix_ops_job_result_job; Type: INDEX; Schema: ops; Owner: -
-- Name: ix_ops_job_result_job; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE INDEX ix_ops_job_result_job ON ops.ops_job_result USING btree (job_id);
CREATE INDEX ix_ops_job_result_job ON ops.ops_job_result USING btree (job_id);




--
--
-- Name: ix_ops_job_result_job_id; Type: INDEX; Schema: ops; Owner: -
-- Name: ix_ops_job_result_job_id; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE INDEX ix_ops_job_result_job_id ON ops.ops_job_result USING btree (job_id);
CREATE INDEX ix_ops_job_result_job_id ON ops.ops_job_result USING btree (job_id);




--
--
-- Name: ux_ops_send_idempotent; Type: INDEX; Schema: ops; Owner: -
-- Name: ux_ops_send_idempotent; Type: INDEX; Schema: ops; Owner: -
--
--


CREATE UNIQUE INDEX ux_ops_send_idempotent ON ops.document_send_history USING btree (document_type_code, document_id, channel_code, resend_type_code, created_at);
CREATE UNIQUE INDEX ux_ops_send_idempotent ON ops.document_send_history USING btree (document_type_code, document_id, channel_code, resend_type_code, created_at);




--
--
-- Name: idx_supplier_address_supplier; Type: INDEX; Schema: purchase; Owner: -
-- Name: idx_supplier_address_supplier; Type: INDEX; Schema: purchase; Owner: -
--
--


CREATE INDEX idx_supplier_address_supplier ON purchase.supplier_address USING btree (supplier_id);
CREATE INDEX idx_supplier_address_supplier ON purchase.supplier_address USING btree (supplier_id);




--
--
-- Name: idx_supplier_contact_supplier; Type: INDEX; Schema: purchase; Owner: -
-- Name: idx_supplier_contact_supplier; Type: INDEX; Schema: purchase; Owner: -
--
--


CREATE INDEX idx_supplier_contact_supplier ON purchase.supplier_contact USING btree (supplier_id);
CREATE INDEX idx_supplier_contact_supplier ON purchase.supplier_contact USING btree (supplier_id);




--
--
-- Name: ix_realtime_subscription_entity; Type: INDEX; Schema: realtime; Owner: -
-- Name: ix_realtime_subscription_entity; Type: INDEX; Schema: realtime; Owner: -
--
--






--
--
-- Name: messages_inserted_at_topic_index; Type: INDEX; Schema: realtime; Owner: -
-- Name: messages_inserted_at_topic_index; Type: INDEX; Schema: realtime; Owner: -
--
--






--
--
-- Name: subscription_subscription_id_entity_filters_key; Type: INDEX; Schema: realtime; Owner: -
-- Name: subscription_subscription_id_entity_filters_key; Type: INDEX; Schema: realtime; Owner: -
--
--






--
--
-- Name: idx_customer_address_customer; Type: INDEX; Schema: sales; Owner: -
-- Name: idx_customer_address_customer; Type: INDEX; Schema: sales; Owner: -
--
--


CREATE INDEX idx_customer_address_customer ON sales.customer_address USING btree (customer_id);
CREATE INDEX idx_customer_address_customer ON sales.customer_address USING btree (customer_id);




--
--
-- Name: idx_customer_contact_customer; Type: INDEX; Schema: sales; Owner: -
-- Name: idx_customer_contact_customer; Type: INDEX; Schema: sales; Owner: -
--
--


CREATE INDEX idx_customer_contact_customer ON sales.customer_contact USING btree (customer_id);
CREATE INDEX idx_customer_contact_customer ON sales.customer_contact USING btree (customer_id);




--
--
-- Name: idx_item_price_item; Type: INDEX; Schema: sales; Owner: -
-- Name: idx_item_price_item; Type: INDEX; Schema: sales; Owner: -
--
--


CREATE INDEX idx_item_price_item ON sales.item_price_master USING btree (company_id, item_id, valid_from DESC);
CREATE INDEX idx_item_price_item ON sales.item_price_master USING btree (company_id, item_id, valid_from DESC);




--
--
-- Name: idx_qol_company; Type: INDEX; Schema: sales; Owner: -
-- Name: idx_qol_company; Type: INDEX; Schema: sales; Owner: -
--
--


CREATE INDEX idx_qol_company ON sales.quotation_order_link USING btree (company_id);
CREATE INDEX idx_qol_company ON sales.quotation_order_link USING btree (company_id);




--
--
-- Name: idx_shipping_revision_company; Type: INDEX; Schema: sales; Owner: -
-- Name: idx_shipping_revision_company; Type: INDEX; Schema: sales; Owner: -
--
--


CREATE INDEX idx_shipping_revision_company ON sales.shipping_revision USING btree (company_id);
CREATE INDEX idx_shipping_revision_company ON sales.shipping_revision USING btree (company_id);




--
--
-- Name: idx_shipping_revision_shipping; Type: INDEX; Schema: sales; Owner: -
-- Name: idx_shipping_revision_shipping; Type: INDEX; Schema: sales; Owner: -
--
--


CREATE INDEX idx_shipping_revision_shipping ON sales.shipping_revision USING btree (shipping_id);
CREATE INDEX idx_shipping_revision_shipping ON sales.shipping_revision USING btree (shipping_id);




--
--
-- Name: bname; Type: INDEX; Schema: storage; Owner: -
-- Name: bname; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: bucketid_objname; Type: INDEX; Schema: storage; Owner: -
-- Name: bucketid_objname; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: buckets_analytics_unique_name_idx; Type: INDEX; Schema: storage; Owner: -
-- Name: buckets_analytics_unique_name_idx; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: idx_multipart_uploads_list; Type: INDEX; Schema: storage; Owner: -
-- Name: idx_multipart_uploads_list; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: idx_name_bucket_level_unique; Type: INDEX; Schema: storage; Owner: -
-- Name: idx_name_bucket_level_unique; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: idx_objects_bucket_id_name; Type: INDEX; Schema: storage; Owner: -
-- Name: idx_objects_bucket_id_name; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: idx_objects_lower_name; Type: INDEX; Schema: storage; Owner: -
-- Name: idx_objects_lower_name; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: idx_prefixes_lower_name; Type: INDEX; Schema: storage; Owner: -
-- Name: idx_prefixes_lower_name; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: name_prefix_search; Type: INDEX; Schema: storage; Owner: -
-- Name: name_prefix_search; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: objects_bucket_id_level_idx; Type: INDEX; Schema: storage; Owner: -
-- Name: objects_bucket_id_level_idx; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: vector_indexes_name_bucket_id_idx; Type: INDEX; Schema: storage; Owner: -
-- Name: vector_indexes_name_bucket_id_idx; Type: INDEX; Schema: storage; Owner: -
--
--






--
--
-- Name: ix_ai_signal_pick; Type: INDEX; Schema: system; Owner: -
-- Name: ix_ai_signal_pick; Type: INDEX; Schema: system; Owner: -
--
--


CREATE INDEX ix_ai_signal_pick ON system.ai_signal USING btree (status, created_at);
CREATE INDEX ix_ai_signal_pick ON system.ai_signal USING btree (status, created_at);




--
--
-- Name: ix_ai_task_pick; Type: INDEX; Schema: system; Owner: -
-- Name: ix_ai_task_pick; Type: INDEX; Schema: system; Owner: -
--
--


CREATE INDEX ix_ai_task_pick ON system.ai_task USING btree (status, priority, requested_at);
CREATE INDEX ix_ai_task_pick ON system.ai_task USING btree (status, priority, requested_at);




--
--
-- Name: ix_exec_run_request_pick; Type: INDEX; Schema: system; Owner: -
-- Name: ix_exec_run_request_pick; Type: INDEX; Schema: system; Owner: -
--
--


CREATE INDEX ix_exec_run_request_pick ON system.exec_run_request USING btree (status, priority, requested_at);
CREATE INDEX ix_exec_run_request_pick ON system.exec_run_request USING btree (status, priority, requested_at);




--
--
-- Name: audit_trail_2025_12_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2025_12_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2025_12_company_id_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2025_12_company_id_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2025_12_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2025_12_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2025_12_company_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2025_12_company_id_performed_at_idx;




--
--
-- Name: audit_trail_2025_12_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2025_12_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2025_12_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2025_12_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2025_12_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2025_12_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2025_12_entity_type_entity_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2025_12_entity_type_entity_id_performed_at_idx;




--
--
-- Name: audit_trail_2025_12_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2025_12_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2025_12_pkey;
ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2025_12_pkey;




--
--
-- Name: audit_trail_2026_01_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_01_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_01_company_id_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_01_company_id_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_01_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_01_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_01_company_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_01_company_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_01_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_01_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_01_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_01_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_01_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_01_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_01_entity_type_entity_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_01_entity_type_entity_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_01_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_01_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_01_pkey;
ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_01_pkey;




--
--
-- Name: audit_trail_2026_02_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_02_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_02_company_id_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_02_company_id_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_02_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_02_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_02_company_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_02_company_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_02_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_02_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_02_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_02_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_02_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_02_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_02_entity_type_entity_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_02_entity_type_entity_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_02_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_02_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_02_pkey;
ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_02_pkey;




--
--
-- Name: audit_trail_2026_03_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_03_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_03_company_id_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_03_company_id_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_03_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_03_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_03_company_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_03_company_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_03_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_03_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_03_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_03_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_03_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_03_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_03_entity_type_entity_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_03_entity_type_entity_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_03_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_03_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_03_pkey;
ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_03_pkey;




--
--
-- Name: audit_trail_2026_04_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_04_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_04_company_id_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_04_company_id_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_04_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_04_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_04_company_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_04_company_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_04_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_04_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_04_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_04_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_04_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_04_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_04_entity_type_entity_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_04_entity_type_entity_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_04_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_04_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_04_pkey;
ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_04_pkey;




--
--
-- Name: audit_trail_2026_05_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_05_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_05_company_id_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_05_company_id_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_05_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_05_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_05_company_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_05_company_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_05_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_05_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_05_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_05_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_05_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_05_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_05_entity_type_entity_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_05_entity_type_entity_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_05_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_05_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_05_pkey;
ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_05_pkey;




--
--
-- Name: audit_trail_2026_06_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_06_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_06_company_id_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_06_company_id_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_06_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_06_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_06_company_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_06_company_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_06_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_06_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_06_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_06_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_06_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_06_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_06_entity_type_entity_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_06_entity_type_entity_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_06_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_06_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_06_pkey;
ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_06_pkey;




--
--
-- Name: audit_trail_2026_07_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_07_company_id_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_07_company_id_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_company_entity ATTACH PARTITION core.audit_trail_2026_07_company_id_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_07_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_07_company_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_07_company_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_company_time ATTACH PARTITION core.audit_trail_2026_07_company_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_07_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_07_entity_type_entity_id_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_07_entity_type_entity_id_idx;
ALTER INDEX core.idx_audit_trail_entity ATTACH PARTITION core.audit_trail_2026_07_entity_type_entity_id_idx;




--
--
-- Name: audit_trail_2026_07_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_07_entity_type_entity_id_performed_at_idx; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_07_entity_type_entity_id_performed_at_idx;
ALTER INDEX core.idx_audit_trail_entity_time ATTACH PARTITION core.audit_trail_2026_07_entity_type_entity_id_performed_at_idx;




--
--
-- Name: audit_trail_2026_07_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
-- Name: audit_trail_2026_07_pkey; Type: INDEX ATTACH; Schema: core; Owner: -
--
--


ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_07_pkey;
ALTER INDEX core.audit_trail_pkey ATTACH PARTITION core.audit_trail_2026_07_pkey;




--
--
-- Name: ai_job trg_ai_job_apply_master; Type: TRIGGER; Schema: analytics; Owner: -
-- Name: ai_job trg_ai_job_apply_master; Type: TRIGGER; Schema: analytics; Owner: -
--
--


CREATE TRIGGER trg_ai_job_apply_master BEFORE INSERT OR UPDATE OF job_type, requires_approval ON analytics.ai_job FOR EACH ROW EXECUTE FUNCTION analytics.trg_ai_job_apply_master();
CREATE TRIGGER trg_ai_job_apply_master BEFORE INSERT OR UPDATE OF job_type, requires_approval ON analytics.ai_job FOR EACH ROW EXECUTE FUNCTION analytics.trg_ai_job_apply_master();




--
--
-- Name: audit_alert_event trg_audit_alert_to_ai_event; Type: TRIGGER; Schema: analytics; Owner: -
-- Name: audit_alert_event trg_audit_alert_to_ai_event; Type: TRIGGER; Schema: analytics; Owner: -
--
--


CREATE TRIGGER trg_audit_alert_to_ai_event AFTER INSERT ON analytics.audit_alert_event FOR EACH ROW EXECUTE FUNCTION analytics.trg_audit_alert_to_ai_event();
CREATE TRIGGER trg_audit_alert_to_ai_event AFTER INSERT ON analytics.audit_alert_event FOR EACH ROW EXECUTE FUNCTION analytics.trg_audit_alert_to_ai_event();




--
--
-- Name: policy_rollout trg_policy_rollout_touch; Type: TRIGGER; Schema: approval; Owner: -
-- Name: policy_rollout trg_policy_rollout_touch; Type: TRIGGER; Schema: approval; Owner: -
--
--


CREATE TRIGGER trg_policy_rollout_touch BEFORE UPDATE ON approval.policy_rollout FOR EACH ROW EXECUTE FUNCTION approval.touch_updated_at();
CREATE TRIGGER trg_policy_rollout_touch BEFORE UPDATE ON approval.policy_rollout FOR EACH ROW EXECUTE FUNCTION approval.touch_updated_at();




--
--
-- Name: approval_request trg_set_policy_and_severity; Type: TRIGGER; Schema: audit; Owner: -
-- Name: approval_request trg_set_policy_and_severity; Type: TRIGGER; Schema: audit; Owner: -
--
--


CREATE TRIGGER trg_set_policy_and_severity BEFORE INSERT ON audit.approval_request FOR EACH ROW EXECUTE FUNCTION approval.set_policy_and_severity();
CREATE TRIGGER trg_set_policy_and_severity BEFORE INSERT ON audit.approval_request FOR EACH ROW EXECUTE FUNCTION approval.set_policy_and_severity();




--
--
-- Name: schema_change_request trg_audit_schema_change_transitions; Type: TRIGGER; Schema: ci; Owner: -
-- Name: schema_change_request trg_audit_schema_change_transitions; Type: TRIGGER; Schema: ci; Owner: -
--
--


CREATE TRIGGER trg_audit_schema_change_transitions AFTER UPDATE ON ci.schema_change_request FOR EACH ROW EXECUTE FUNCTION ci.audit_schema_change_transitions();
CREATE TRIGGER trg_audit_schema_change_transitions AFTER UPDATE ON ci.schema_change_request FOR EACH ROW EXECUTE FUNCTION ci.audit_schema_change_transitions();




--
--
-- Name: schema_change_request trg_enqueue_schema_ai_review; Type: TRIGGER; Schema: ci; Owner: -
-- Name: schema_change_request trg_enqueue_schema_ai_review; Type: TRIGGER; Schema: ci; Owner: -
--
--


CREATE TRIGGER trg_enqueue_schema_ai_review AFTER INSERT ON ci.schema_change_request FOR EACH ROW EXECUTE FUNCTION ci.enqueue_schema_ai_review();
CREATE TRIGGER trg_enqueue_schema_ai_review AFTER INSERT ON ci.schema_change_request FOR EACH ROW EXECUTE FUNCTION ci.enqueue_schema_ai_review();




--
--
-- Name: accounting_period trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: accounting_period trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.accounting_period FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.accounting_period FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: accounts trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: accounts trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.accounts FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.accounts FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: app_user trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: app_user trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.app_user FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.app_user FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_entity_pk_map trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_entity_pk_map trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_entity_pk_map FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_entity_pk_map FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_trail_2025_12 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_trail_2025_12 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2025_12 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2025_12 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_trail_2026_01 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_trail_2026_01 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_01 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_01 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_trail_2026_02 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_trail_2026_02 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_02 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_02 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_trail_2026_03 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_trail_2026_03 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_03 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_03 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_trail_2026_04 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_trail_2026_04 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_04 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_04 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_trail_2026_05 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_trail_2026_05 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_05 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_05 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_trail_2026_06 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_trail_2026_06 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_06 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_06 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: audit_trail_2026_07 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: audit_trail_2026_07 trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_07 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.audit_trail_2026_07 FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: company trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: company trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.company FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.company FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: company_license trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: company_license trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.company_license FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.company_license FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: company_permission trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: company_permission trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.company_permission FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.company_permission FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: company_users trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: company_users trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.company_users FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.company_users FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: document_sequence trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: document_sequence trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.document_sequence FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.document_sequence FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: entity_attribute_def trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: entity_attribute_def trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.entity_attribute_def FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.entity_attribute_def FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: entity_attribute_value trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: entity_attribute_value trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.entity_attribute_value FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.entity_attribute_value FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: journal_entries trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: journal_entries trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.journal_entries FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.journal_entries FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: journal_lines trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: journal_lines trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.journal_lines FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.journal_lines FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: journal_source_link trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: journal_source_link trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.journal_source_link FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.journal_source_link FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: license_master trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: license_master trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.license_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.license_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: login_history trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: login_history trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.login_history FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.login_history FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: payment_method trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: payment_method trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.payment_method FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.payment_method FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: payment_term trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: payment_term trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: permission_group_permissions trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: permission_group_permissions trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.permission_group_permissions FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.permission_group_permissions FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: permission_groups trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: permission_groups trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.permission_groups FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.permission_groups FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: permissions trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: permissions trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.permissions FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.permissions FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: posting_profile trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: posting_profile trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.posting_profile FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.posting_profile FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: status_history trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: status_history trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.status_history FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.status_history FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: status_master trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: status_master trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.status_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.status_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: sync_queue trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: sync_queue trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.sync_queue FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.sync_queue FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: uom trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: uom trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.uom FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.uom FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: uom_conversion trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: uom_conversion trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.uom_conversion FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.uom_conversion FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: user_permissions trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
-- Name: user_permissions trg_audit_iud; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.user_permissions FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON core.user_permissions FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: company trg_core_company_audit; Type: TRIGGER; Schema: core; Owner: -
-- Name: company trg_core_company_audit; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_core_company_audit AFTER INSERT OR DELETE OR UPDATE ON core.company FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_core_company_audit AFTER INSERT OR DELETE OR UPDATE ON core.company FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: company_license trg_core_company_license_audit; Type: TRIGGER; Schema: core; Owner: -
-- Name: company_license trg_core_company_license_audit; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_core_company_license_audit AFTER INSERT OR DELETE OR UPDATE ON core.company_license FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_core_company_license_audit AFTER INSERT OR DELETE OR UPDATE ON core.company_license FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: company_permission trg_core_company_permission_audit; Type: TRIGGER; Schema: core; Owner: -
-- Name: company_permission trg_core_company_permission_audit; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_core_company_permission_audit AFTER INSERT OR DELETE OR UPDATE ON core.company_permission FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_core_company_permission_audit AFTER INSERT OR DELETE OR UPDATE ON core.company_permission FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: posting_profile trg_core_posting_profile_audit; Type: TRIGGER; Schema: core; Owner: -
-- Name: posting_profile trg_core_posting_profile_audit; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_core_posting_profile_audit AFTER INSERT OR DELETE OR UPDATE ON core.posting_profile FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_core_posting_profile_audit AFTER INSERT OR DELETE OR UPDATE ON core.posting_profile FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: status_history trg_core_status_history_audit; Type: TRIGGER; Schema: core; Owner: -
-- Name: status_history trg_core_status_history_audit; Type: TRIGGER; Schema: core; Owner: -
--
--


CREATE TRIGGER trg_core_status_history_audit AFTER INSERT OR DELETE OR UPDATE ON core.status_history FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_core_status_history_audit AFTER INSERT OR DELETE OR UPDATE ON core.status_history FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: bank_account trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
-- Name: bank_account trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.bank_account FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.bank_account FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: bank_statement_header trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
-- Name: bank_statement_header trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.bank_statement_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.bank_statement_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: bank_statement_line trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
-- Name: bank_statement_line trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.bank_statement_line FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.bank_statement_line FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: payment trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
-- Name: payment trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.payment FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.payment FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: payment_allocation trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
-- Name: payment_allocation trg_audit_iud; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.payment_allocation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON finance.payment_allocation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: bank_account trg_finance_bank_account_audit; Type: TRIGGER; Schema: finance; Owner: -
-- Name: bank_account trg_finance_bank_account_audit; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_finance_bank_account_audit AFTER INSERT OR DELETE OR UPDATE ON finance.bank_account FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_finance_bank_account_audit AFTER INSERT OR DELETE OR UPDATE ON finance.bank_account FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: payment trg_finance_payment_audit; Type: TRIGGER; Schema: finance; Owner: -
-- Name: payment trg_finance_payment_audit; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_finance_payment_audit AFTER INSERT OR DELETE OR UPDATE ON finance.payment FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_finance_payment_audit AFTER INSERT OR DELETE OR UPDATE ON finance.payment FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: bank_account trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
-- Name: bank_account trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.bank_account FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.bank_account FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: bank_statement_header trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
-- Name: bank_statement_header trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.bank_statement_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.bank_statement_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: bank_statement_line trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
-- Name: bank_statement_line trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.bank_statement_line FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.bank_statement_line FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: payment trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
-- Name: payment trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.payment FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.payment FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: payment_allocation trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
-- Name: payment_allocation trg_require_reason_code; Type: TRIGGER; Schema: finance; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.payment_allocation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON finance.payment_allocation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: attendance_log trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: attendance_log trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.attendance_log FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.attendance_log FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: employee trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: employee trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.employee FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.employee FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: employment_contract trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: employment_contract trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.employment_contract FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.employment_contract FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: hr_department trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: hr_department trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.hr_department FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.hr_department FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: hr_position trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: hr_position trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.hr_position FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.hr_position FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: leave_request trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: leave_request trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.leave_request FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.leave_request FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: leave_type trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: leave_type trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.leave_type FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.leave_type FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: payroll_run trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: payroll_run trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.payroll_run FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.payroll_run FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: payroll_slip trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
-- Name: payroll_slip trg_audit_iud; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.payroll_slip FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON hr.payroll_slip FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: attendance_log trg_hr_attendance_log_audit; Type: TRIGGER; Schema: hr; Owner: -
-- Name: attendance_log trg_hr_attendance_log_audit; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_hr_attendance_log_audit AFTER INSERT OR DELETE OR UPDATE ON hr.attendance_log FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_hr_attendance_log_audit AFTER INSERT OR DELETE OR UPDATE ON hr.attendance_log FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: employee trg_hr_employee_audit; Type: TRIGGER; Schema: hr; Owner: -
-- Name: employee trg_hr_employee_audit; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_hr_employee_audit AFTER INSERT OR DELETE OR UPDATE ON hr.employee FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_hr_employee_audit AFTER INSERT OR DELETE OR UPDATE ON hr.employee FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: employment_contract trg_hr_employment_contract_audit; Type: TRIGGER; Schema: hr; Owner: -
-- Name: employment_contract trg_hr_employment_contract_audit; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_hr_employment_contract_audit AFTER INSERT OR DELETE OR UPDATE ON hr.employment_contract FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_hr_employment_contract_audit AFTER INSERT OR DELETE OR UPDATE ON hr.employment_contract FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: leave_request trg_hr_leave_request_audit; Type: TRIGGER; Schema: hr; Owner: -
-- Name: leave_request trg_hr_leave_request_audit; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_hr_leave_request_audit AFTER INSERT OR DELETE OR UPDATE ON hr.leave_request FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_hr_leave_request_audit AFTER INSERT OR DELETE OR UPDATE ON hr.leave_request FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: payroll_run trg_hr_payroll_run_audit; Type: TRIGGER; Schema: hr; Owner: -
-- Name: payroll_run trg_hr_payroll_run_audit; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_hr_payroll_run_audit AFTER INSERT OR DELETE OR UPDATE ON hr.payroll_run FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_hr_payroll_run_audit AFTER INSERT OR DELETE OR UPDATE ON hr.payroll_run FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: attendance_log trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: attendance_log trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.attendance_log FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.attendance_log FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: employee trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: employee trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.employee FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.employee FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: employment_contract trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: employment_contract trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.employment_contract FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.employment_contract FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: hr_department trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: hr_department trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.hr_department FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.hr_department FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: hr_position trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: hr_position trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.hr_position FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.hr_position FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: leave_request trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: leave_request trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.leave_request FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.leave_request FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: leave_type trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: leave_type trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.leave_type FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.leave_type FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: payroll_run trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: payroll_run trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.payroll_run FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.payroll_run FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: payroll_slip trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
-- Name: payroll_slip trg_require_reason_code; Type: TRIGGER; Schema: hr; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.payroll_slip FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON hr.payroll_slip FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: inventory_valuation trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: inventory_valuation trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.inventory_valuation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.inventory_valuation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stock_balance trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_balance trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_balance FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_balance FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stock_bin trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_bin trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_bin FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_bin FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stock_lot trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_lot trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_lot FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_lot FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stock_lot_balance trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_lot_balance trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_lot_balance FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_lot_balance FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stock_reservation trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_reservation trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_reservation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_reservation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stock_transaction trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_transaction trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_transaction FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_transaction FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stock_transfer_detail trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_transfer_detail trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_transfer_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_transfer_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stock_transfer_header trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_transfer_header trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_transfer_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_transfer_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stocktaking_plan trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stocktaking_plan trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stocktaking_plan FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stocktaking_plan FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: stocktaking_result trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stocktaking_result trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stocktaking_result FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.stocktaking_result FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: storage_location trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: storage_location trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.storage_location FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.storage_location FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: warehouse trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: warehouse trg_audit_iud; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.warehouse FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON inventory.warehouse FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: inventory_valuation trg_inventory_inventory_valuation_audit; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: inventory_valuation trg_inventory_inventory_valuation_audit; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_inventory_inventory_valuation_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.inventory_valuation FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_inventory_inventory_valuation_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.inventory_valuation FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: stock_balance trg_inventory_stock_balance_audit; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_balance trg_inventory_stock_balance_audit; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_balance_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_balance FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_inventory_stock_balance_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_balance FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: stock_lot trg_inventory_stock_lot_audit; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_lot trg_inventory_stock_lot_audit; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_lot_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_lot FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_inventory_stock_lot_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_lot FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: stock_lot_balance trg_inventory_stock_lot_balance_audit; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_lot_balance trg_inventory_stock_lot_balance_audit; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_lot_balance_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_lot_balance FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_inventory_stock_lot_balance_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_lot_balance FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: stock_reservation trg_inventory_stock_reservation_audit; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_reservation trg_inventory_stock_reservation_audit; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_reservation_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_reservation FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_inventory_stock_reservation_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stock_reservation FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: stocktaking_plan trg_inventory_stocktaking_plan_audit; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stocktaking_plan trg_inventory_stocktaking_plan_audit; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_inventory_stocktaking_plan_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stocktaking_plan FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_inventory_stocktaking_plan_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stocktaking_plan FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: stocktaking_result trg_inventory_stocktaking_result_audit; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stocktaking_result trg_inventory_stocktaking_result_audit; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_inventory_stocktaking_result_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stocktaking_result FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_inventory_stocktaking_result_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.stocktaking_result FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: warehouse trg_inventory_warehouse_audit; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: warehouse trg_inventory_warehouse_audit; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_inventory_warehouse_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.warehouse FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_inventory_warehouse_audit AFTER INSERT OR DELETE OR UPDATE ON inventory.warehouse FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: inventory_valuation trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: inventory_valuation trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.inventory_valuation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.inventory_valuation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stock_balance trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_balance trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_balance FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_balance FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stock_bin trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_bin trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_bin FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_bin FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stock_lot trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_lot trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_lot FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_lot FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stock_lot_balance trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_lot_balance trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_lot_balance FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_lot_balance FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stock_reservation trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_reservation trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_reservation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_reservation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stock_transaction trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_transaction trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_transaction FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_transaction FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stock_transfer_detail trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_transfer_detail trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_transfer_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_transfer_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stock_transfer_header trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stock_transfer_header trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_transfer_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stock_transfer_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stocktaking_plan trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stocktaking_plan trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stocktaking_plan FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stocktaking_plan FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: stocktaking_result trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: stocktaking_result trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stocktaking_result FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.stocktaking_result FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: storage_location trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: storage_location trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.storage_location FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.storage_location FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: warehouse trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
-- Name: warehouse trg_require_reason_code; Type: TRIGGER; Schema: inventory; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.warehouse FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON inventory.warehouse FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: bom_detail trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: bom_detail trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.bom_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.bom_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: bom_header trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: bom_header trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.bom_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.bom_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: manufacturing_cost_snapshot trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.manufacturing_cost_snapshot FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.manufacturing_cost_snapshot FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: manufacturing_execution trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.manufacturing_execution FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.manufacturing_execution FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: manufacturing_execution_detail trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.manufacturing_execution_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.manufacturing_execution_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: mps_plan trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mps_plan trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mps_plan FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mps_plan FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: mps_run trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mps_run trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mps_run FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mps_run FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: mrp_allocation trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mrp_allocation trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mrp_allocation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mrp_allocation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: mrp_requirement trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mrp_requirement trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mrp_requirement FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mrp_requirement FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: mrp_run trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mrp_run trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mrp_run FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mrp_run FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: process_master trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: process_master trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.process_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.process_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: routing_header trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: routing_header trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.routing_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.routing_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: routing_operation trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: routing_operation trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.routing_operation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.routing_operation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: work_order trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: work_order trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.work_order FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.work_order FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: yield_metric trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: yield_metric trg_audit_iud; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.yield_metric FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON manufacturing.yield_metric FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: manufacturing_cost_snapshot trg_manufacturing_manufacturing_cost_snapshot_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot trg_manufacturing_manufacturing_cost_snapshot_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_manufacturing_cost_snapshot_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.manufacturing_cost_snapshot FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_manufacturing_manufacturing_cost_snapshot_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.manufacturing_cost_snapshot FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: mps_run trg_manufacturing_mps_run_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mps_run trg_manufacturing_mps_run_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_mps_run_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mps_run FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_manufacturing_mps_run_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mps_run FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: mrp_run trg_manufacturing_mrp_run_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mrp_run trg_manufacturing_mrp_run_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_mrp_run_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mrp_run FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_manufacturing_mrp_run_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.mrp_run FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: work_order trg_manufacturing_work_order_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: work_order trg_manufacturing_work_order_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_work_order_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.work_order FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_manufacturing_work_order_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.work_order FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: yield_metric trg_manufacturing_yield_metric_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: yield_metric trg_manufacturing_yield_metric_audit; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_yield_metric_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.yield_metric FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_manufacturing_yield_metric_audit AFTER INSERT OR DELETE OR UPDATE ON manufacturing.yield_metric FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: bom_detail trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: bom_detail trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.bom_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.bom_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: bom_header trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: bom_header trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.bom_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.bom_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: manufacturing_cost_snapshot trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.manufacturing_cost_snapshot FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.manufacturing_cost_snapshot FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: manufacturing_execution trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.manufacturing_execution FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.manufacturing_execution FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: manufacturing_execution_detail trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.manufacturing_execution_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.manufacturing_execution_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: mps_plan trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mps_plan trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mps_plan FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mps_plan FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: mps_run trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mps_run trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mps_run FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mps_run FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: mrp_allocation trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mrp_allocation trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mrp_allocation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mrp_allocation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: mrp_requirement trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mrp_requirement trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mrp_requirement FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mrp_requirement FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: mrp_run trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: mrp_run trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mrp_run FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.mrp_run FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: process_master trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: process_master trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.process_master FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.process_master FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: routing_header trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: routing_header trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.routing_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.routing_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: routing_operation trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: routing_operation trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.routing_operation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.routing_operation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: work_order trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: work_order trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.work_order FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.work_order FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: yield_metric trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
-- Name: yield_metric trg_require_reason_code; Type: TRIGGER; Schema: manufacturing; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.yield_metric FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON manufacturing.yield_metric FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: ops_job_result t_after_job_result; Type: TRIGGER; Schema: ops; Owner: -
-- Name: ops_job_result t_after_job_result; Type: TRIGGER; Schema: ops; Owner: -
--
--


CREATE TRIGGER t_after_job_result AFTER INSERT OR UPDATE OF result_status ON ops.ops_job_result FOR EACH ROW EXECUTE FUNCTION ops.trg_after_job_result();
CREATE TRIGGER t_after_job_result AFTER INSERT OR UPDATE OF result_status ON ops.ops_job_result FOR EACH ROW EXECUTE FUNCTION ops.trg_after_job_result();




--
--
-- Name: business_event trg_enqueue_business_approval; Type: TRIGGER; Schema: ops; Owner: -
-- Name: business_event trg_enqueue_business_approval; Type: TRIGGER; Schema: ops; Owner: -
--
--


CREATE TRIGGER trg_enqueue_business_approval AFTER INSERT ON ops.business_event FOR EACH ROW EXECUTE FUNCTION ops.enqueue_business_approval();
CREATE TRIGGER trg_enqueue_business_approval AFTER INSERT ON ops.business_event FOR EACH ROW EXECUTE FUNCTION ops.enqueue_business_approval();




--
--
-- Name: ops_job_queue trg_ops_job_queue_touch; Type: TRIGGER; Schema: ops; Owner: -
-- Name: ops_job_queue trg_ops_job_queue_touch; Type: TRIGGER; Schema: ops; Owner: -
--
--


CREATE TRIGGER trg_ops_job_queue_touch BEFORE UPDATE ON ops.ops_job_queue FOR EACH ROW EXECUTE FUNCTION ops.tg_touch_updated_at();
CREATE TRIGGER trg_ops_job_queue_touch BEFORE UPDATE ON ops.ops_job_queue FOR EACH ROW EXECUTE FUNCTION ops.tg_touch_updated_at();




--
--
-- Name: v_core_audit_trail trg_core_audit_trail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_core_audit_trail trg_core_audit_trail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_core_audit_trail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_audit_trail FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_audit_trail_iud();
CREATE TRIGGER trg_core_audit_trail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_audit_trail FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_audit_trail_iud();




--
--
-- Name: v_core_company trg_core_company_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_core_company trg_core_company_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_core_company_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_company FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_company_iud();
CREATE TRIGGER trg_core_company_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_company FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_company_iud();




--
--
-- Name: v_core_company_license trg_core_company_license_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_core_company_license trg_core_company_license_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_core_company_license_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_company_license FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_company_license_iud();
CREATE TRIGGER trg_core_company_license_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_company_license FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_company_license_iud();




--
--
-- Name: v_core_company_permission trg_core_company_permission_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_core_company_permission trg_core_company_permission_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_core_company_permission_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_company_permission FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_company_permission_iud();
CREATE TRIGGER trg_core_company_permission_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_company_permission FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_company_permission_iud();




--
--
-- Name: v_core_journal_source_link trg_core_journal_source_link_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_core_journal_source_link trg_core_journal_source_link_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_core_journal_source_link_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_journal_source_link FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_journal_source_link_iud();
CREATE TRIGGER trg_core_journal_source_link_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_journal_source_link FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_journal_source_link_iud();




--
--
-- Name: v_core_payment_term trg_core_payment_term_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_core_payment_term trg_core_payment_term_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_core_payment_term_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_payment_term FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_payment_term_iud();
CREATE TRIGGER trg_core_payment_term_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_payment_term FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_payment_term_iud();




--
--
-- Name: v_core_posting_profile trg_core_posting_profile_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_core_posting_profile trg_core_posting_profile_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_core_posting_profile_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_posting_profile FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_posting_profile_iud();
CREATE TRIGGER trg_core_posting_profile_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_posting_profile FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_posting_profile_iud();




--
--
-- Name: v_core_status_history trg_core_status_history_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_core_status_history trg_core_status_history_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_core_status_history_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_status_history FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_status_history_iud();
CREATE TRIGGER trg_core_status_history_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_core_status_history FOR EACH ROW EXECUTE FUNCTION public.trg_v_core_status_history_iud();




--
--
-- Name: v_finance_bank_account trg_finance_bank_account_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_finance_bank_account trg_finance_bank_account_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_finance_bank_account_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_finance_bank_account FOR EACH ROW EXECUTE FUNCTION public.trg_v_finance_bank_account_iud();
CREATE TRIGGER trg_finance_bank_account_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_finance_bank_account FOR EACH ROW EXECUTE FUNCTION public.trg_v_finance_bank_account_iud();




--
--
-- Name: v_finance_bank_statement_line trg_finance_bank_statement_line_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_finance_bank_statement_line trg_finance_bank_statement_line_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_finance_bank_statement_line_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_finance_bank_statement_line FOR EACH ROW EXECUTE FUNCTION public.trg_v_finance_bank_statement_line_iud();
CREATE TRIGGER trg_finance_bank_statement_line_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_finance_bank_statement_line FOR EACH ROW EXECUTE FUNCTION public.trg_v_finance_bank_statement_line_iud();




--
--
-- Name: v_finance_payment_allocation trg_finance_payment_allocation_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_finance_payment_allocation trg_finance_payment_allocation_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_finance_payment_allocation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_finance_payment_allocation FOR EACH ROW EXECUTE FUNCTION public.trg_v_finance_payment_allocation_iud();
CREATE TRIGGER trg_finance_payment_allocation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_finance_payment_allocation FOR EACH ROW EXECUTE FUNCTION public.trg_v_finance_payment_allocation_iud();




--
--
-- Name: v_finance_payment trg_finance_payment_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_finance_payment trg_finance_payment_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_finance_payment_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_finance_payment FOR EACH ROW EXECUTE FUNCTION public.trg_v_finance_payment_iud();
CREATE TRIGGER trg_finance_payment_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_finance_payment FOR EACH ROW EXECUTE FUNCTION public.trg_v_finance_payment_iud();




--
--
-- Name: v_hr_attendance_log trg_hr_attendance_log_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_hr_attendance_log trg_hr_attendance_log_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_hr_attendance_log_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_attendance_log FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_attendance_log_iud();
CREATE TRIGGER trg_hr_attendance_log_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_attendance_log FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_attendance_log_iud();




--
--
-- Name: v_hr_employee trg_hr_employee_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_hr_employee trg_hr_employee_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_hr_employee_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_employee FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_employee_iud();
CREATE TRIGGER trg_hr_employee_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_employee FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_employee_iud();




--
--
-- Name: v_hr_employment_contract trg_hr_employment_contract_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_hr_employment_contract trg_hr_employment_contract_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_hr_employment_contract_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_employment_contract FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_employment_contract_iud();
CREATE TRIGGER trg_hr_employment_contract_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_employment_contract FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_employment_contract_iud();




--
--
-- Name: v_hr_leave_request trg_hr_leave_request_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_hr_leave_request trg_hr_leave_request_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_hr_leave_request_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_leave_request FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_leave_request_iud();
CREATE TRIGGER trg_hr_leave_request_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_leave_request FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_leave_request_iud();




--
--
-- Name: v_hr_payroll_run trg_hr_payroll_run_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_hr_payroll_run trg_hr_payroll_run_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_hr_payroll_run_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_payroll_run FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_payroll_run_iud();
CREATE TRIGGER trg_hr_payroll_run_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_payroll_run FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_payroll_run_iud();




--
--
-- Name: v_hr_payroll_slip trg_hr_payroll_slip_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_hr_payroll_slip trg_hr_payroll_slip_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_hr_payroll_slip_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_payroll_slip FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_payroll_slip_iud();
CREATE TRIGGER trg_hr_payroll_slip_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_hr_payroll_slip FOR EACH ROW EXECUTE FUNCTION public.trg_v_hr_payroll_slip_iud();




--
--
-- Name: v_inventory_inventory_valuation trg_inventory_inventory_valuation_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_inventory_valuation trg_inventory_inventory_valuation_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_inventory_valuation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_inventory_valuation FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_inventory_valuation_iud();
CREATE TRIGGER trg_inventory_inventory_valuation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_inventory_valuation FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_inventory_valuation_iud();




--
--
-- Name: v_inventory_stock_balance trg_inventory_stock_balance_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_stock_balance trg_inventory_stock_balance_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_balance_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_balance FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_balance_iud();
CREATE TRIGGER trg_inventory_stock_balance_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_balance FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_balance_iud();




--
--
-- Name: v_inventory_stock_lot_balance trg_inventory_stock_lot_balance_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_stock_lot_balance trg_inventory_stock_lot_balance_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_lot_balance_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_lot_balance FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_lot_balance_iud();
CREATE TRIGGER trg_inventory_stock_lot_balance_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_lot_balance FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_lot_balance_iud();




--
--
-- Name: v_inventory_stock_lot trg_inventory_stock_lot_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_stock_lot trg_inventory_stock_lot_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_lot_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_lot FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_lot_iud();
CREATE TRIGGER trg_inventory_stock_lot_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_lot FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_lot_iud();




--
--
-- Name: v_inventory_stock_reservation trg_inventory_stock_reservation_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_stock_reservation trg_inventory_stock_reservation_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_reservation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_reservation FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_reservation_iud();
CREATE TRIGGER trg_inventory_stock_reservation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_reservation FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_reservation_iud();




--
--
-- Name: v_inventory_stock_transfer_detail trg_inventory_stock_transfer_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_stock_transfer_detail trg_inventory_stock_transfer_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_stock_transfer_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_transfer_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_transfer_detail_iud();
CREATE TRIGGER trg_inventory_stock_transfer_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stock_transfer_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stock_transfer_detail_iud();




--
--
-- Name: v_inventory_stocktaking_plan trg_inventory_stocktaking_plan_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_stocktaking_plan trg_inventory_stocktaking_plan_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_stocktaking_plan_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stocktaking_plan FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stocktaking_plan_iud();
CREATE TRIGGER trg_inventory_stocktaking_plan_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stocktaking_plan FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stocktaking_plan_iud();




--
--
-- Name: v_inventory_stocktaking_result trg_inventory_stocktaking_result_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_stocktaking_result trg_inventory_stocktaking_result_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_stocktaking_result_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stocktaking_result FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stocktaking_result_iud();
CREATE TRIGGER trg_inventory_stocktaking_result_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_stocktaking_result FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_stocktaking_result_iud();




--
--
-- Name: v_inventory_warehouse trg_inventory_warehouse_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_inventory_warehouse trg_inventory_warehouse_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_inventory_warehouse_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_warehouse FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_warehouse_iud();
CREATE TRIGGER trg_inventory_warehouse_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_inventory_warehouse FOR EACH ROW EXECUTE FUNCTION public.trg_v_inventory_warehouse_iud();




--
--
-- Name: v_manufacturing_bom_detail trg_manufacturing_bom_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_bom_detail trg_manufacturing_bom_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_bom_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_bom_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_bom_detail_iud();
CREATE TRIGGER trg_manufacturing_bom_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_bom_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_bom_detail_iud();




--
--
-- Name: v_manufacturing_manufacturing_cost_snapshot trg_manufacturing_manufacturing_cost_snapshot_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_manufacturing_cost_snapshot trg_manufacturing_manufacturing_cost_snapshot_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_manufacturing_cost_snapshot_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_manufacturing_cost_snapshot FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_manufacturing_cost_snapshot_iud();
CREATE TRIGGER trg_manufacturing_manufacturing_cost_snapshot_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_manufacturing_cost_snapshot FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_manufacturing_cost_snapshot_iud();




--
--
-- Name: v_manufacturing_mps_plan trg_manufacturing_mps_plan_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_mps_plan trg_manufacturing_mps_plan_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_mps_plan_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mps_plan FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mps_plan_iud();
CREATE TRIGGER trg_manufacturing_mps_plan_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mps_plan FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mps_plan_iud();




--
--
-- Name: v_manufacturing_mps_run trg_manufacturing_mps_run_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_mps_run trg_manufacturing_mps_run_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_mps_run_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mps_run FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mps_run_iud();
CREATE TRIGGER trg_manufacturing_mps_run_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mps_run FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mps_run_iud();




--
--
-- Name: v_manufacturing_mrp_allocation trg_manufacturing_mrp_allocation_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_mrp_allocation trg_manufacturing_mrp_allocation_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_mrp_allocation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mrp_allocation FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mrp_allocation_iud();
CREATE TRIGGER trg_manufacturing_mrp_allocation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mrp_allocation FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mrp_allocation_iud();




--
--
-- Name: v_manufacturing_mrp_requirement trg_manufacturing_mrp_requirement_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_mrp_requirement trg_manufacturing_mrp_requirement_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_mrp_requirement_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mrp_requirement FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mrp_requirement_iud();
CREATE TRIGGER trg_manufacturing_mrp_requirement_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mrp_requirement FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mrp_requirement_iud();




--
--
-- Name: v_manufacturing_mrp_run trg_manufacturing_mrp_run_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_mrp_run trg_manufacturing_mrp_run_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_mrp_run_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mrp_run FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mrp_run_iud();
CREATE TRIGGER trg_manufacturing_mrp_run_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_mrp_run FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_mrp_run_iud();




--
--
-- Name: v_manufacturing_routing_operation trg_manufacturing_routing_operation_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_routing_operation trg_manufacturing_routing_operation_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_routing_operation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_routing_operation FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_routing_operation_iud();
CREATE TRIGGER trg_manufacturing_routing_operation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_routing_operation FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_routing_operation_iud();




--
--
-- Name: v_manufacturing_work_order trg_manufacturing_work_order_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_work_order trg_manufacturing_work_order_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_work_order_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_work_order FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_work_order_iud();
CREATE TRIGGER trg_manufacturing_work_order_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_work_order FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_work_order_iud();




--
--
-- Name: v_manufacturing_yield_metric trg_manufacturing_yield_metric_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_manufacturing_yield_metric trg_manufacturing_yield_metric_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_manufacturing_yield_metric_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_yield_metric FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_yield_metric_iud();
CREATE TRIGGER trg_manufacturing_yield_metric_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_manufacturing_yield_metric FOR EACH ROW EXECUTE FUNCTION public.trg_v_manufacturing_yield_metric_iud();




--
--
-- Name: v_purchase_purchase_invoice_detail trg_purchase_purchase_invoice_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_purchase_invoice_detail trg_purchase_purchase_invoice_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_invoice_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_invoice_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_invoice_detail_iud();
CREATE TRIGGER trg_purchase_purchase_invoice_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_invoice_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_invoice_detail_iud();




--
--
-- Name: v_purchase_purchase_invoice trg_purchase_purchase_invoice_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_purchase_invoice trg_purchase_purchase_invoice_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_invoice_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_invoice FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_invoice_iud();
CREATE TRIGGER trg_purchase_purchase_invoice_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_invoice FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_invoice_iud();




--
--
-- Name: v_purchase_purchase_order_detail trg_purchase_purchase_order_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_purchase_order_detail trg_purchase_purchase_order_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_order_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_order_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_order_detail_iud();
CREATE TRIGGER trg_purchase_purchase_order_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_order_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_order_detail_iud();




--
--
-- Name: v_purchase_purchase_quotation_detail trg_purchase_purchase_quotation_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_purchase_quotation_detail trg_purchase_purchase_quotation_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_quotation_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_quotation_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_quotation_detail_iud();
CREATE TRIGGER trg_purchase_purchase_quotation_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_quotation_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_quotation_detail_iud();




--
--
-- Name: v_purchase_purchase_quotation trg_purchase_purchase_quotation_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_purchase_quotation trg_purchase_purchase_quotation_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_quotation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_quotation FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_quotation_iud();
CREATE TRIGGER trg_purchase_purchase_quotation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_quotation FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_quotation_iud();




--
--
-- Name: v_purchase_purchase_requisition_detail trg_purchase_purchase_requisition_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_purchase_requisition_detail trg_purchase_purchase_requisition_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_requisition_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_requisition_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_requisition_detail_iud();
CREATE TRIGGER trg_purchase_purchase_requisition_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_requisition_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_requisition_detail_iud();




--
--
-- Name: v_purchase_purchase_requisition trg_purchase_purchase_requisition_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_purchase_requisition trg_purchase_purchase_requisition_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_requisition_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_requisition FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_requisition_iud();
CREATE TRIGGER trg_purchase_purchase_requisition_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_requisition FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_requisition_iud();




--
--
-- Name: v_purchase_purchase_three_way_match trg_purchase_purchase_three_way_match_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_purchase_three_way_match trg_purchase_purchase_three_way_match_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_three_way_match_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_three_way_match FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_three_way_match_iud();
CREATE TRIGGER trg_purchase_purchase_three_way_match_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_purchase_three_way_match FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_purchase_three_way_match_iud();




--
--
-- Name: v_purchase_supplier_address trg_purchase_supplier_address_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_supplier_address trg_purchase_supplier_address_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_supplier_address_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_supplier_address FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_supplier_address_iud();
CREATE TRIGGER trg_purchase_supplier_address_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_supplier_address FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_supplier_address_iud();




--
--
-- Name: v_purchase_supplier_contact trg_purchase_supplier_contact_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_supplier_contact trg_purchase_supplier_contact_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_supplier_contact_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_supplier_contact FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_supplier_contact_iud();
CREATE TRIGGER trg_purchase_supplier_contact_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_supplier_contact FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_supplier_contact_iud();




--
--
-- Name: v_purchase_supplier_item_price trg_purchase_supplier_item_price_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_supplier_item_price trg_purchase_supplier_item_price_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_supplier_item_price_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_supplier_item_price FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_supplier_item_price_iud();
CREATE TRIGGER trg_purchase_supplier_item_price_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_supplier_item_price FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_supplier_item_price_iud();




--
--
-- Name: v_purchase_supplier_payment_term trg_purchase_supplier_payment_term_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_purchase_supplier_payment_term trg_purchase_supplier_payment_term_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_purchase_supplier_payment_term_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_supplier_payment_term FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_supplier_payment_term_iud();
CREATE TRIGGER trg_purchase_supplier_payment_term_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_purchase_supplier_payment_term FOR EACH ROW EXECUTE FUNCTION public.trg_v_purchase_supplier_payment_term_iud();




--
--
-- Name: v_sales_billing_detail trg_sales_billing_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_billing_detail trg_sales_billing_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_billing_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_billing_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_billing_detail_iud();
CREATE TRIGGER trg_sales_billing_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_billing_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_billing_detail_iud();




--
--
-- Name: v_sales_customer_address trg_sales_customer_address_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_customer_address trg_sales_customer_address_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_customer_address_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_customer_address FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_customer_address_iud();
CREATE TRIGGER trg_sales_customer_address_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_customer_address FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_customer_address_iud();




--
--
-- Name: v_sales_customer_contact trg_sales_customer_contact_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_customer_contact trg_sales_customer_contact_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_customer_contact_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_customer_contact FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_customer_contact_iud();
CREATE TRIGGER trg_sales_customer_contact_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_customer_contact FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_customer_contact_iud();




--
--
-- Name: v_sales_customer trg_sales_customer_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_customer trg_sales_customer_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_customer_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_customer FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_customer_iud();
CREATE TRIGGER trg_sales_customer_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_customer FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_customer_iud();




--
--
-- Name: v_sales_customer_payment_term trg_sales_customer_payment_term_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_customer_payment_term trg_sales_customer_payment_term_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_customer_payment_term_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_customer_payment_term FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_customer_payment_term_iud();
CREATE TRIGGER trg_sales_customer_payment_term_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_customer_payment_term FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_customer_payment_term_iud();




--
--
-- Name: v_sales_invoice_pdf trg_sales_invoice_pdf_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_invoice_pdf trg_sales_invoice_pdf_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_invoice_pdf_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_invoice_pdf FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_invoice_pdf_iud();
CREATE TRIGGER trg_sales_invoice_pdf_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_invoice_pdf FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_invoice_pdf_iud();




--
--
-- Name: v_sales_item_category trg_sales_item_category_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_item_category trg_sales_item_category_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_item_category_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_item_category FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_item_category_iud();
CREATE TRIGGER trg_sales_item_category_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_item_category FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_item_category_iud();




--
--
-- Name: v_sales_item trg_sales_item_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_item trg_sales_item_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_item_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_item FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_item_iud();
CREATE TRIGGER trg_sales_item_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_item FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_item_iud();




--
--
-- Name: v_sales_item_uom trg_sales_item_uom_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_item_uom trg_sales_item_uom_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_item_uom_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_item_uom FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_item_uom_iud();
CREATE TRIGGER trg_sales_item_uom_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_item_uom FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_item_uom_iud();




--
--
-- Name: v_sales_order_detail trg_sales_order_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_order_detail trg_sales_order_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_order_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_order_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_order_detail_iud();
CREATE TRIGGER trg_sales_order_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_order_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_order_detail_iud();




--
--
-- Name: v_sales_return_detail trg_sales_return_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_return_detail trg_sales_return_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_return_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_return_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_return_detail_iud();
CREATE TRIGGER trg_sales_return_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_return_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_return_detail_iud();




--
--
-- Name: v_sales_sales_quotation_detail trg_sales_sales_quotation_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_sales_quotation_detail trg_sales_sales_quotation_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_sales_quotation_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_sales_quotation_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_sales_quotation_detail_iud();
CREATE TRIGGER trg_sales_sales_quotation_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_sales_quotation_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_sales_quotation_detail_iud();




--
--
-- Name: v_sales_sales_quotation trg_sales_sales_quotation_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_sales_quotation trg_sales_sales_quotation_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_sales_quotation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_sales_quotation FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_sales_quotation_iud();
CREATE TRIGGER trg_sales_sales_quotation_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_sales_quotation FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_sales_quotation_iud();




--
--
-- Name: v_sales_shipping_detail trg_sales_shipping_detail_iud; Type: TRIGGER; Schema: public; Owner: -
-- Name: v_sales_shipping_detail trg_sales_shipping_detail_iud; Type: TRIGGER; Schema: public; Owner: -
--
--


CREATE TRIGGER trg_sales_shipping_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_shipping_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_shipping_detail_iud();
CREATE TRIGGER trg_sales_shipping_detail_iud INSTEAD OF INSERT OR DELETE OR UPDATE ON public.v_sales_shipping_detail FOR EACH ROW EXECUTE FUNCTION public.trg_v_sales_shipping_detail_iud();




--
--
-- Name: purchase_invoice trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_invoice trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_invoice FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_invoice FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_invoice_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_invoice_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_invoice_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_order_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_order_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_order_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_order_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_order_header trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_order_header trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_order_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_order_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_quotation trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_quotation trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_quotation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_quotation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_quotation_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_quotation_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_quotation_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_receipt trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_receipt trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_receipt FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_receipt FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_receipt_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_receipt_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_receipt_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_requisition trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_requisition trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_requisition FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_requisition FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_requisition_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_requisition_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_requisition_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_three_way_match trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_three_way_match trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_three_way_match FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_three_way_match FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: supplier_address trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_address trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_address FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_address FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: supplier_contact trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_contact trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_contact FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_contact FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: supplier_item_price trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_item_price trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_item_price FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_item_price FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: supplier_master trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_master trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: supplier_payment_term trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_payment_term trg_audit_iud; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: purchase_invoice trg_purchase_purchase_invoice_audit; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_invoice trg_purchase_purchase_invoice_audit; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_invoice_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_invoice FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_purchase_purchase_invoice_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_invoice FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: purchase_quotation trg_purchase_purchase_quotation_audit; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_quotation trg_purchase_purchase_quotation_audit; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_quotation_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_quotation FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_purchase_purchase_quotation_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_quotation FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: purchase_requisition trg_purchase_purchase_requisition_audit; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_requisition trg_purchase_purchase_requisition_audit; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_requisition_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_requisition FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_purchase_purchase_requisition_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_requisition FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: purchase_three_way_match trg_purchase_purchase_three_way_match_audit; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_three_way_match trg_purchase_purchase_three_way_match_audit; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_purchase_purchase_three_way_match_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_three_way_match FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_purchase_purchase_three_way_match_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.purchase_three_way_match FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: supplier_item_price trg_purchase_supplier_item_price_audit; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_item_price trg_purchase_supplier_item_price_audit; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_purchase_supplier_item_price_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_item_price FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_purchase_supplier_item_price_audit AFTER INSERT OR DELETE OR UPDATE ON purchase.supplier_item_price FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: purchase_invoice trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_invoice trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_invoice FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_invoice FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_invoice_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_invoice_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_invoice_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_order_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_order_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_order_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_order_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_order_header trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_order_header trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_order_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_order_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_quotation trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_quotation trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_quotation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_quotation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_quotation_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_quotation_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_quotation_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_receipt trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_receipt trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_receipt FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_receipt FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_receipt_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_receipt_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_receipt_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_requisition trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_requisition trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_requisition FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_requisition FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_requisition_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_requisition_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_requisition_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: purchase_three_way_match trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: purchase_three_way_match trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_three_way_match FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.purchase_three_way_match FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: supplier_address trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_address trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_address FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_address FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: supplier_contact trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_contact trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_contact FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_contact FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: supplier_item_price trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_item_price trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_item_price FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_item_price FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: supplier_master trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_master trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_master FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_master FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: supplier_payment_term trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
-- Name: supplier_payment_term trg_require_reason_code; Type: TRIGGER; Schema: purchase; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON purchase.supplier_payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: subscription tr_check_filters; Type: TRIGGER; Schema: realtime; Owner: -
-- Name: subscription tr_check_filters; Type: TRIGGER; Schema: realtime; Owner: -
--
--






--
--
-- Name: billing_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: billing_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.billing_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.billing_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: billing_header trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: billing_header trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.billing_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.billing_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: customer trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.customer FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.customer FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: customer_address trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer_address trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.customer_address FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.customer_address FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: customer_contact trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer_contact trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.customer_contact FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.customer_contact FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: customer_payment_term trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer_payment_term trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.customer_payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.customer_payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: invoice_pdf trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: invoice_pdf trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.invoice_pdf FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.invoice_pdf FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: item trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.item FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.item FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: item_category trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item_category trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.item_category FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.item_category FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: item_price_master trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item_price_master trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.item_price_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.item_price_master FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: item_uom trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item_uom trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.item_uom FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.item_uom FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: order_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: order_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.order_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.order_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: order_header trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: order_header trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.order_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.order_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: return_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: return_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.return_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.return_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: return_header trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: return_header trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.return_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.return_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: sales_quotation trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: sales_quotation trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.sales_quotation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.sales_quotation FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: sales_quotation_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: sales_quotation_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.sales_quotation_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.sales_quotation_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: shipping_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: shipping_detail trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.shipping_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.shipping_detail FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: shipping_header trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
-- Name: shipping_header trg_audit_iud; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.shipping_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();
CREATE TRIGGER trg_audit_iud AFTER INSERT OR DELETE OR UPDATE ON sales.shipping_header FOR EACH ROW EXECUTE FUNCTION core.trg_audit_iud();




--
--
-- Name: billing_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: billing_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.billing_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.billing_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: billing_header trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: billing_header trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.billing_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.billing_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: customer trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.customer FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.customer FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: customer_address trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer_address trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.customer_address FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.customer_address FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: customer_contact trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer_contact trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.customer_contact FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.customer_contact FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: customer_payment_term trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer_payment_term trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.customer_payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.customer_payment_term FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: invoice_pdf trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: invoice_pdf trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.invoice_pdf FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.invoice_pdf FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: item trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.item FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.item FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: item_category trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item_category trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.item_category FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.item_category FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: item_price_master trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item_price_master trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.item_price_master FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.item_price_master FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: item_uom trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item_uom trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.item_uom FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.item_uom FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: order_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: order_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.order_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.order_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: order_header trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: order_header trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.order_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.order_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: return_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: return_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.return_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.return_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: return_header trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: return_header trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.return_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.return_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: sales_quotation trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: sales_quotation trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.sales_quotation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.sales_quotation FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: sales_quotation_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: sales_quotation_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.sales_quotation_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.sales_quotation_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: shipping_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: shipping_detail trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.shipping_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.shipping_detail FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: shipping_header trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
-- Name: shipping_header trg_require_reason_code; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.shipping_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();
CREATE TRIGGER trg_require_reason_code BEFORE DELETE OR UPDATE ON sales.shipping_header FOR EACH ROW EXECUTE FUNCTION core.trg_require_reason_code();




--
--
-- Name: customer trg_sales_customer_audit; Type: TRIGGER; Schema: sales; Owner: -
-- Name: customer trg_sales_customer_audit; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_sales_customer_audit AFTER INSERT OR DELETE OR UPDATE ON sales.customer FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_sales_customer_audit AFTER INSERT OR DELETE OR UPDATE ON sales.customer FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: invoice_pdf trg_sales_invoice_pdf_audit; Type: TRIGGER; Schema: sales; Owner: -
-- Name: invoice_pdf trg_sales_invoice_pdf_audit; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_sales_invoice_pdf_audit AFTER INSERT OR DELETE OR UPDATE ON sales.invoice_pdf FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_sales_invoice_pdf_audit AFTER INSERT OR DELETE OR UPDATE ON sales.invoice_pdf FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: item trg_sales_item_audit; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item trg_sales_item_audit; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_sales_item_audit AFTER INSERT OR DELETE OR UPDATE ON sales.item FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_sales_item_audit AFTER INSERT OR DELETE OR UPDATE ON sales.item FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: item_category trg_sales_item_category_audit; Type: TRIGGER; Schema: sales; Owner: -
-- Name: item_category trg_sales_item_category_audit; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_sales_item_category_audit AFTER INSERT OR DELETE OR UPDATE ON sales.item_category FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_sales_item_category_audit AFTER INSERT OR DELETE OR UPDATE ON sales.item_category FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: sales_quotation trg_sales_sales_quotation_audit; Type: TRIGGER; Schema: sales; Owner: -
-- Name: sales_quotation trg_sales_sales_quotation_audit; Type: TRIGGER; Schema: sales; Owner: -
--
--


CREATE TRIGGER trg_sales_sales_quotation_audit AFTER INSERT OR DELETE OR UPDATE ON sales.sales_quotation FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();
CREATE TRIGGER trg_sales_sales_quotation_audit AFTER INSERT OR DELETE OR UPDATE ON sales.sales_quotation FOR EACH ROW EXECUTE FUNCTION core.fn_audit_trail();




--
--
-- Name: buckets enforce_bucket_name_length_trigger; Type: TRIGGER; Schema: storage; Owner: -
-- Name: buckets enforce_bucket_name_length_trigger; Type: TRIGGER; Schema: storage; Owner: -
--
--






--
--
-- Name: objects objects_delete_delete_prefix; Type: TRIGGER; Schema: storage; Owner: -
-- Name: objects objects_delete_delete_prefix; Type: TRIGGER; Schema: storage; Owner: -
--
--






--
--
-- Name: objects objects_insert_create_prefix; Type: TRIGGER; Schema: storage; Owner: -
-- Name: objects objects_insert_create_prefix; Type: TRIGGER; Schema: storage; Owner: -
--
--






--
--
-- Name: objects objects_update_create_prefix; Type: TRIGGER; Schema: storage; Owner: -
-- Name: objects objects_update_create_prefix; Type: TRIGGER; Schema: storage; Owner: -
--
--






--
--
-- Name: prefixes prefixes_create_hierarchy; Type: TRIGGER; Schema: storage; Owner: -
-- Name: prefixes prefixes_create_hierarchy; Type: TRIGGER; Schema: storage; Owner: -
--
--






--
--
-- Name: prefixes prefixes_delete_hierarchy; Type: TRIGGER; Schema: storage; Owner: -
-- Name: prefixes prefixes_delete_hierarchy; Type: TRIGGER; Schema: storage; Owner: -
--
--






--
--
-- Name: objects update_objects_updated_at; Type: TRIGGER; Schema: storage; Owner: -
-- Name: objects update_objects_updated_at; Type: TRIGGER; Schema: storage; Owner: -
--
--






--
--
-- Name: exec_command trg_exec_command_updated_at; Type: TRIGGER; Schema: system; Owner: -
-- Name: exec_command trg_exec_command_updated_at; Type: TRIGGER; Schema: system; Owner: -
--
--


CREATE TRIGGER trg_exec_command_updated_at BEFORE UPDATE ON system.exec_command FOR EACH ROW EXECUTE FUNCTION system.tg_set_updated_at();
CREATE TRIGGER trg_exec_command_updated_at BEFORE UPDATE ON system.exec_command FOR EACH ROW EXECUTE FUNCTION system.tg_set_updated_at();




--
--
-- Name: exec_run_request trg_exec_request_audit_ins; Type: TRIGGER; Schema: system; Owner: -
-- Name: exec_run_request trg_exec_request_audit_ins; Type: TRIGGER; Schema: system; Owner: -
--
--


CREATE TRIGGER trg_exec_request_audit_ins AFTER INSERT ON system.exec_run_request FOR EACH ROW EXECUTE FUNCTION audit.tg_exec_request_ins();
CREATE TRIGGER trg_exec_request_audit_ins AFTER INSERT ON system.exec_run_request FOR EACH ROW EXECUTE FUNCTION audit.tg_exec_request_ins();




--
--
-- Name: exec_run_request trg_exec_request_audit_upd; Type: TRIGGER; Schema: system; Owner: -
-- Name: exec_run_request trg_exec_request_audit_upd; Type: TRIGGER; Schema: system; Owner: -
--
--


CREATE TRIGGER trg_exec_request_audit_upd AFTER UPDATE ON system.exec_run_request FOR EACH ROW EXECUTE FUNCTION audit.tg_exec_request_upd();
CREATE TRIGGER trg_exec_request_audit_upd AFTER UPDATE ON system.exec_run_request FOR EACH ROW EXECUTE FUNCTION audit.tg_exec_request_upd();




--
--
-- Name: exec_run_request trg_exec_run_notify; Type: TRIGGER; Schema: system; Owner: -
-- Name: exec_run_request trg_exec_run_notify; Type: TRIGGER; Schema: system; Owner: -
--
--


CREATE TRIGGER trg_exec_run_notify AFTER UPDATE ON system.exec_run_request FOR EACH ROW EXECUTE FUNCTION system.tg_exec_run_notify();
CREATE TRIGGER trg_exec_run_notify AFTER UPDATE ON system.exec_run_request FOR EACH ROW EXECUTE FUNCTION system.tg_exec_run_notify();




--
--
-- Name: loop_config trg_loop_config_updated_at; Type: TRIGGER; Schema: system; Owner: -
-- Name: loop_config trg_loop_config_updated_at; Type: TRIGGER; Schema: system; Owner: -
--
--


CREATE TRIGGER trg_loop_config_updated_at BEFORE UPDATE ON system.loop_config FOR EACH ROW EXECUTE FUNCTION system.tg_set_updated_at();
CREATE TRIGGER trg_loop_config_updated_at BEFORE UPDATE ON system.loop_config FOR EACH ROW EXECUTE FUNCTION system.tg_set_updated_at();




--
--
-- Name: paper_send_fee_journal paper_send_fee_journal_send_history_id_fkey; Type: FK CONSTRAINT; Schema: accounting; Owner: -
-- Name: paper_send_fee_journal paper_send_fee_journal_send_history_id_fkey; Type: FK CONSTRAINT; Schema: accounting; Owner: -
--
--


ALTER TABLE ONLY accounting.paper_send_fee_journal
ALTER TABLE ONLY accounting.paper_send_fee_journal
    ADD CONSTRAINT paper_send_fee_journal_send_history_id_fkey FOREIGN KEY (send_history_id) REFERENCES ops.document_send_history(send_history_id);
    ADD CONSTRAINT paper_send_fee_journal_send_history_id_fkey FOREIGN KEY (send_history_id) REFERENCES ops.document_send_history(send_history_id);




--
--
-- Name: audit_ai_feedback audit_ai_feedback_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_ai_feedback audit_ai_feedback_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_feedback
ALTER TABLE ONLY analytics.audit_ai_feedback
    ADD CONSTRAINT audit_ai_feedback_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_ai_feedback_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;




--
--
-- Name: audit_ai_feedback audit_ai_feedback_judgement_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_ai_feedback audit_ai_feedback_judgement_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_feedback
ALTER TABLE ONLY analytics.audit_ai_feedback
    ADD CONSTRAINT audit_ai_feedback_judgement_id_fkey FOREIGN KEY (judgement_id) REFERENCES analytics.audit_alert_ai_judgement(judgement_id) ON DELETE SET NULL;
    ADD CONSTRAINT audit_ai_feedback_judgement_id_fkey FOREIGN KEY (judgement_id) REFERENCES analytics.audit_alert_ai_judgement(judgement_id) ON DELETE SET NULL;




--
--
-- Name: audit_ai_job audit_ai_job_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_ai_job audit_ai_job_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_job
ALTER TABLE ONLY analytics.audit_ai_job
    ADD CONSTRAINT audit_ai_job_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_ai_job_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;




--
--
-- Name: audit_ai_llm_result audit_ai_llm_result_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_ai_llm_result audit_ai_llm_result_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_ai_llm_result
ALTER TABLE ONLY analytics.audit_ai_llm_result
    ADD CONSTRAINT audit_ai_llm_result_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_ai_llm_result_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;




--
--
-- Name: audit_alert_ai_judgement audit_alert_ai_judgement_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement audit_alert_ai_judgement_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_ai_judgement
ALTER TABLE ONLY analytics.audit_alert_ai_judgement
    ADD CONSTRAINT audit_alert_ai_judgement_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_alert_ai_judgement_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;




--
--
-- Name: audit_alert_event audit_alert_event_rule_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_alert_event audit_alert_event_rule_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_event
ALTER TABLE ONLY analytics.audit_alert_event
    ADD CONSTRAINT audit_alert_event_rule_id_fkey FOREIGN KEY (rule_id) REFERENCES analytics.audit_alert_rule(rule_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_alert_event_rule_id_fkey FOREIGN KEY (rule_id) REFERENCES analytics.audit_alert_rule(rule_id) ON DELETE CASCADE;




--
--
-- Name: audit_alert_notification audit_alert_notification_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
-- Name: audit_alert_notification audit_alert_notification_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.audit_alert_notification
ALTER TABLE ONLY analytics.audit_alert_notification
    ADD CONSTRAINT audit_alert_notification_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_alert_notification_alert_event_id_fkey FOREIGN KEY (alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id) ON DELETE CASCADE;




--
--
-- Name: fact_metric fact_metric_company_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
-- Name: fact_metric fact_metric_company_id_fkey; Type: FK CONSTRAINT; Schema: analytics; Owner: -
--
--


ALTER TABLE ONLY analytics.fact_metric
ALTER TABLE ONLY analytics.fact_metric
    ADD CONSTRAINT fact_metric_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT fact_metric_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: billing_payment billing_payment_invoice_id_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
-- Name: billing_payment billing_payment_invoice_id_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.billing_payment
ALTER TABLE ONLY approval.billing_payment
    ADD CONSTRAINT billing_payment_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES approval.billing_invoice(invoice_id);
    ADD CONSTRAINT billing_payment_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES approval.billing_invoice(invoice_id);




--
--
-- Name: company_plan company_plan_plan_code_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
-- Name: company_plan company_plan_plan_code_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.company_plan
ALTER TABLE ONLY approval.company_plan
    ADD CONSTRAINT company_plan_plan_code_fkey FOREIGN KEY (plan_code) REFERENCES approval.plan_master(plan_code);
    ADD CONSTRAINT company_plan_plan_code_fkey FOREIGN KEY (plan_code) REFERENCES approval.plan_master(plan_code);




--
--
-- Name: invoice_delivery_log invoice_delivery_log_invoice_id_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
-- Name: invoice_delivery_log invoice_delivery_log_invoice_id_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.invoice_delivery_log
ALTER TABLE ONLY approval.invoice_delivery_log
    ADD CONSTRAINT invoice_delivery_log_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES approval.billing_invoice(invoice_id);
    ADD CONSTRAINT invoice_delivery_log_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES approval.billing_invoice(invoice_id);




--
--
-- Name: saas_company_map saas_company_map_subscription_id_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
-- Name: saas_company_map saas_company_map_subscription_id_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.saas_company_map
ALTER TABLE ONLY approval.saas_company_map
    ADD CONSTRAINT saas_company_map_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES approval.saas_subscription(subscription_id);
    ADD CONSTRAINT saas_company_map_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES approval.saas_subscription(subscription_id);




--
--
-- Name: saas_subscription saas_subscription_plan_code_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
-- Name: saas_subscription saas_subscription_plan_code_fkey; Type: FK CONSTRAINT; Schema: approval; Owner: -
--
--


ALTER TABLE ONLY approval.saas_subscription
ALTER TABLE ONLY approval.saas_subscription
    ADD CONSTRAINT saas_subscription_plan_code_fkey FOREIGN KEY (plan_code) REFERENCES approval.saas_plan(plan_code);
    ADD CONSTRAINT saas_subscription_plan_code_fkey FOREIGN KEY (plan_code) REFERENCES approval.saas_plan(plan_code);




--
--
-- Name: approval_log approval_log_approval_request_id_fkey; Type: FK CONSTRAINT; Schema: audit; Owner: -
-- Name: approval_log approval_log_approval_request_id_fkey; Type: FK CONSTRAINT; Schema: audit; Owner: -
--
--


ALTER TABLE ONLY audit.approval_log
ALTER TABLE ONLY audit.approval_log
    ADD CONSTRAINT approval_log_approval_request_id_fkey FOREIGN KEY (approval_request_id) REFERENCES audit.approval_request(request_id) ON DELETE CASCADE;
    ADD CONSTRAINT approval_log_approval_request_id_fkey FOREIGN KEY (approval_request_id) REFERENCES audit.approval_request(request_id) ON DELETE CASCADE;




--
--
-- Name: identities identities_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: identities identities_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT identities_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;
    ADD CONSTRAINT identities_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;




--
--
-- Name: mfa_amr_claims mfa_amr_claims_session_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: mfa_amr_claims mfa_amr_claims_session_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT mfa_amr_claims_session_id_fkey FOREIGN KEY (session_id) REFERENCES auth.sessions(id) ON DELETE CASCADE;
    ADD CONSTRAINT mfa_amr_claims_session_id_fkey FOREIGN KEY (session_id) REFERENCES auth.sessions(id) ON DELETE CASCADE;




--
--
-- Name: mfa_challenges mfa_challenges_auth_factor_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: mfa_challenges mfa_challenges_auth_factor_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT mfa_challenges_auth_factor_id_fkey FOREIGN KEY (factor_id) REFERENCES auth.mfa_factors(id) ON DELETE CASCADE;
    ADD CONSTRAINT mfa_challenges_auth_factor_id_fkey FOREIGN KEY (factor_id) REFERENCES auth.mfa_factors(id) ON DELETE CASCADE;




--
--
-- Name: mfa_factors mfa_factors_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: mfa_factors mfa_factors_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT mfa_factors_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;
    ADD CONSTRAINT mfa_factors_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;




--
--
-- Name: oauth_authorizations oauth_authorizations_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_authorizations oauth_authorizations_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_authorizations_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;
    ADD CONSTRAINT oauth_authorizations_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;




--
--
-- Name: oauth_authorizations oauth_authorizations_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_authorizations oauth_authorizations_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_authorizations_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;
    ADD CONSTRAINT oauth_authorizations_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;




--
--
-- Name: oauth_consents oauth_consents_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_consents oauth_consents_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_consents_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;
    ADD CONSTRAINT oauth_consents_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;




--
--
-- Name: oauth_consents oauth_consents_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: oauth_consents oauth_consents_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT oauth_consents_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;
    ADD CONSTRAINT oauth_consents_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;




--
--
-- Name: one_time_tokens one_time_tokens_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: one_time_tokens one_time_tokens_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT one_time_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;
    ADD CONSTRAINT one_time_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;




--
--
-- Name: refresh_tokens refresh_tokens_session_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: refresh_tokens refresh_tokens_session_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT refresh_tokens_session_id_fkey FOREIGN KEY (session_id) REFERENCES auth.sessions(id) ON DELETE CASCADE;
    ADD CONSTRAINT refresh_tokens_session_id_fkey FOREIGN KEY (session_id) REFERENCES auth.sessions(id) ON DELETE CASCADE;




--
--
-- Name: saml_providers saml_providers_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: saml_providers saml_providers_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT saml_providers_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;
    ADD CONSTRAINT saml_providers_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;




--
--
-- Name: saml_relay_states saml_relay_states_flow_state_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: saml_relay_states saml_relay_states_flow_state_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT saml_relay_states_flow_state_id_fkey FOREIGN KEY (flow_state_id) REFERENCES auth.flow_state(id) ON DELETE CASCADE;
    ADD CONSTRAINT saml_relay_states_flow_state_id_fkey FOREIGN KEY (flow_state_id) REFERENCES auth.flow_state(id) ON DELETE CASCADE;




--
--
-- Name: saml_relay_states saml_relay_states_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: saml_relay_states saml_relay_states_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT saml_relay_states_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;
    ADD CONSTRAINT saml_relay_states_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;




--
--
-- Name: sessions sessions_oauth_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: sessions sessions_oauth_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT sessions_oauth_client_id_fkey FOREIGN KEY (oauth_client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;
    ADD CONSTRAINT sessions_oauth_client_id_fkey FOREIGN KEY (oauth_client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;




--
--
-- Name: sessions sessions_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: sessions sessions_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;
    ADD CONSTRAINT sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;




--
--
-- Name: sso_domains sso_domains_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
-- Name: sso_domains sso_domains_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--
--


    ADD CONSTRAINT sso_domains_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;
    ADD CONSTRAINT sso_domains_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;




--
--
-- Name: checkout_session checkout_session_invoice_id_fkey; Type: FK CONSTRAINT; Schema: billing; Owner: -
-- Name: checkout_session checkout_session_invoice_id_fkey; Type: FK CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.checkout_session
ALTER TABLE ONLY billing.checkout_session
    ADD CONSTRAINT checkout_session_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES billing.invoice(invoice_id);
    ADD CONSTRAINT checkout_session_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES billing.invoice(invoice_id);




--
--
-- Name: invoice_line invoice_line_invoice_id_fkey; Type: FK CONSTRAINT; Schema: billing; Owner: -
-- Name: invoice_line invoice_line_invoice_id_fkey; Type: FK CONSTRAINT; Schema: billing; Owner: -
--
--


ALTER TABLE ONLY billing.invoice_line
ALTER TABLE ONLY billing.invoice_line
    ADD CONSTRAINT invoice_line_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES billing.invoice(invoice_id);
    ADD CONSTRAINT invoice_line_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES billing.invoice(invoice_id);




--
--
-- Name: audit_action audit_action_audit_issue_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_action audit_action_audit_issue_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_action
ALTER TABLE ONLY compliance.audit_action
    ADD CONSTRAINT audit_action_audit_issue_id_fkey FOREIGN KEY (audit_issue_id) REFERENCES compliance.audit_issue(audit_issue_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_action_audit_issue_id_fkey FOREIGN KEY (audit_issue_id) REFERENCES compliance.audit_issue(audit_issue_id) ON DELETE CASCADE;




--
--
-- Name: audit_action audit_action_owner_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_action audit_action_owner_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_action
ALTER TABLE ONLY compliance.audit_action
    ADD CONSTRAINT audit_action_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT audit_action_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES core.app_user(user_id);




--
--
-- Name: audit_event audit_event_company_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_event audit_event_company_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_event
ALTER TABLE ONLY compliance.audit_event
    ADD CONSTRAINT audit_event_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_event_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: audit_event audit_event_iso_standard_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_event audit_event_iso_standard_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_event
ALTER TABLE ONLY compliance.audit_event
    ADD CONSTRAINT audit_event_iso_standard_id_fkey FOREIGN KEY (iso_standard_id) REFERENCES compliance.iso_standard(iso_standard_id);
    ADD CONSTRAINT audit_event_iso_standard_id_fkey FOREIGN KEY (iso_standard_id) REFERENCES compliance.iso_standard(iso_standard_id);




--
--
-- Name: audit_issue audit_issue_audit_event_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_issue audit_issue_audit_event_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_issue
ALTER TABLE ONLY compliance.audit_issue
    ADD CONSTRAINT audit_issue_audit_event_id_fkey FOREIGN KEY (audit_event_id) REFERENCES compliance.audit_event(audit_event_id) ON DELETE CASCADE;
    ADD CONSTRAINT audit_issue_audit_event_id_fkey FOREIGN KEY (audit_event_id) REFERENCES compliance.audit_event(audit_event_id) ON DELETE CASCADE;




--
--
-- Name: audit_issue audit_issue_iso_clause_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
-- Name: audit_issue audit_issue_iso_clause_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.audit_issue
ALTER TABLE ONLY compliance.audit_issue
    ADD CONSTRAINT audit_issue_iso_clause_id_fkey FOREIGN KEY (iso_clause_id) REFERENCES compliance.iso_clause(iso_clause_id);
    ADD CONSTRAINT audit_issue_iso_clause_id_fkey FOREIGN KEY (iso_clause_id) REFERENCES compliance.iso_clause(iso_clause_id);




--
--
-- Name: iso_clause iso_clause_iso_standard_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
-- Name: iso_clause iso_clause_iso_standard_id_fkey; Type: FK CONSTRAINT; Schema: compliance; Owner: -
--
--


ALTER TABLE ONLY compliance.iso_clause
ALTER TABLE ONLY compliance.iso_clause
    ADD CONSTRAINT iso_clause_iso_standard_id_fkey FOREIGN KEY (iso_standard_id) REFERENCES compliance.iso_standard(iso_standard_id) ON DELETE CASCADE;
    ADD CONSTRAINT iso_clause_iso_standard_id_fkey FOREIGN KEY (iso_standard_id) REFERENCES compliance.iso_standard(iso_standard_id) ON DELETE CASCADE;




--
--
-- Name: accounting_period accounting_period_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: accounting_period accounting_period_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.accounting_period
ALTER TABLE ONLY core.accounting_period
    ADD CONSTRAINT accounting_period_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT accounting_period_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: accounts accounts_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: accounts accounts_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.accounts
ALTER TABLE ONLY core.accounts
    ADD CONSTRAINT accounts_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT accounts_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: app_user app_user_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: app_user app_user_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.app_user
ALTER TABLE ONLY core.app_user
    ADD CONSTRAINT app_user_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT app_user_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: company_license company_license_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: company_license company_license_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_license
ALTER TABLE ONLY core.company_license
    ADD CONSTRAINT company_license_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT company_license_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: company_license company_license_license_code_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: company_license company_license_license_code_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_license
ALTER TABLE ONLY core.company_license
    ADD CONSTRAINT company_license_license_code_fkey FOREIGN KEY (license_code) REFERENCES core.license_master(code);
    ADD CONSTRAINT company_license_license_code_fkey FOREIGN KEY (license_code) REFERENCES core.license_master(code);




--
--
-- Name: company_permission company_permission_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: company_permission company_permission_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_permission
ALTER TABLE ONLY core.company_permission
    ADD CONSTRAINT company_permission_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT company_permission_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: company_users company_users_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: company_users company_users_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_users
ALTER TABLE ONLY core.company_users
    ADD CONSTRAINT company_users_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT company_users_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: company_users company_users_user_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: company_users company_users_user_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.company_users
ALTER TABLE ONLY core.company_users
    ADD CONSTRAINT company_users_user_id_fkey FOREIGN KEY (user_id) REFERENCES core.app_user(user_id) ON DELETE CASCADE;
    ADD CONSTRAINT company_users_user_id_fkey FOREIGN KEY (user_id) REFERENCES core.app_user(user_id) ON DELETE CASCADE;




--
--
-- Name: document_sequence document_sequence_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: document_sequence document_sequence_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.document_sequence
ALTER TABLE ONLY core.document_sequence
    ADD CONSTRAINT document_sequence_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT document_sequence_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: entity_attribute_value entity_attribute_value_attribute_def_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: entity_attribute_value entity_attribute_value_attribute_def_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.entity_attribute_value
ALTER TABLE ONLY core.entity_attribute_value
    ADD CONSTRAINT entity_attribute_value_attribute_def_id_fkey FOREIGN KEY (attribute_def_id) REFERENCES core.entity_attribute_def(attribute_def_id) ON DELETE CASCADE;
    ADD CONSTRAINT entity_attribute_value_attribute_def_id_fkey FOREIGN KEY (attribute_def_id) REFERENCES core.entity_attribute_def(attribute_def_id) ON DELETE CASCADE;




--
--
-- Name: journal_entries journal_entries_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: journal_entries journal_entries_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_entries
ALTER TABLE ONLY core.journal_entries
    ADD CONSTRAINT journal_entries_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT journal_entries_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: journal_entries journal_entries_created_by_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: journal_entries journal_entries_created_by_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_entries
ALTER TABLE ONLY core.journal_entries
    ADD CONSTRAINT journal_entries_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT journal_entries_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);




--
--
-- Name: journal_entries journal_entries_period_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: journal_entries journal_entries_period_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_entries
ALTER TABLE ONLY core.journal_entries
    ADD CONSTRAINT journal_entries_period_id_fkey FOREIGN KEY (period_id) REFERENCES core.accounting_period(period_id);
    ADD CONSTRAINT journal_entries_period_id_fkey FOREIGN KEY (period_id) REFERENCES core.accounting_period(period_id);




--
--
-- Name: journal_lines journal_lines_account_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: journal_lines journal_lines_account_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_lines
ALTER TABLE ONLY core.journal_lines
    ADD CONSTRAINT journal_lines_account_id_fkey FOREIGN KEY (account_id) REFERENCES core.accounts(account_id);
    ADD CONSTRAINT journal_lines_account_id_fkey FOREIGN KEY (account_id) REFERENCES core.accounts(account_id);




--
--
-- Name: journal_lines journal_lines_journal_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: journal_lines journal_lines_journal_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_lines
ALTER TABLE ONLY core.journal_lines
    ADD CONSTRAINT journal_lines_journal_id_fkey FOREIGN KEY (journal_id) REFERENCES core.journal_entries(journal_id) ON DELETE CASCADE;
    ADD CONSTRAINT journal_lines_journal_id_fkey FOREIGN KEY (journal_id) REFERENCES core.journal_entries(journal_id) ON DELETE CASCADE;




--
--
-- Name: journal_source_link journal_source_link_journal_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: journal_source_link journal_source_link_journal_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.journal_source_link
ALTER TABLE ONLY core.journal_source_link
    ADD CONSTRAINT journal_source_link_journal_id_fkey FOREIGN KEY (journal_id) REFERENCES core.journal_entries(journal_id) ON DELETE CASCADE;
    ADD CONSTRAINT journal_source_link_journal_id_fkey FOREIGN KEY (journal_id) REFERENCES core.journal_entries(journal_id) ON DELETE CASCADE;




--
--
-- Name: login_history login_history_user_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: login_history login_history_user_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.login_history
ALTER TABLE ONLY core.login_history
    ADD CONSTRAINT login_history_user_id_fkey FOREIGN KEY (user_id) REFERENCES core.app_user(user_id) ON DELETE CASCADE;
    ADD CONSTRAINT login_history_user_id_fkey FOREIGN KEY (user_id) REFERENCES core.app_user(user_id) ON DELETE CASCADE;




--
--
-- Name: permission_group_permissions permission_group_permissions_group_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: permission_group_permissions permission_group_permissions_group_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permission_group_permissions
ALTER TABLE ONLY core.permission_group_permissions
    ADD CONSTRAINT permission_group_permissions_group_id_fkey FOREIGN KEY (group_id) REFERENCES core.permission_groups(group_id) ON DELETE CASCADE;
    ADD CONSTRAINT permission_group_permissions_group_id_fkey FOREIGN KEY (group_id) REFERENCES core.permission_groups(group_id) ON DELETE CASCADE;




--
--
-- Name: permission_group_permissions permission_group_permissions_permission_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: permission_group_permissions permission_group_permissions_permission_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permission_group_permissions
ALTER TABLE ONLY core.permission_group_permissions
    ADD CONSTRAINT permission_group_permissions_permission_id_fkey FOREIGN KEY (permission_id) REFERENCES core.permissions(permission_id) ON DELETE CASCADE;
    ADD CONSTRAINT permission_group_permissions_permission_id_fkey FOREIGN KEY (permission_id) REFERENCES core.permissions(permission_id) ON DELETE CASCADE;




--
--
-- Name: permission_groups permission_groups_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: permission_groups permission_groups_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.permission_groups
ALTER TABLE ONLY core.permission_groups
    ADD CONSTRAINT permission_groups_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT permission_groups_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: posting_profile posting_profile_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: posting_profile posting_profile_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.posting_profile
ALTER TABLE ONLY core.posting_profile
    ADD CONSTRAINT posting_profile_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT posting_profile_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: posting_profile posting_profile_credit_account_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: posting_profile posting_profile_credit_account_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.posting_profile
ALTER TABLE ONLY core.posting_profile
    ADD CONSTRAINT posting_profile_credit_account_id_fkey FOREIGN KEY (credit_account_id) REFERENCES core.accounts(account_id);
    ADD CONSTRAINT posting_profile_credit_account_id_fkey FOREIGN KEY (credit_account_id) REFERENCES core.accounts(account_id);




--
--
-- Name: posting_profile posting_profile_debit_account_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: posting_profile posting_profile_debit_account_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.posting_profile
ALTER TABLE ONLY core.posting_profile
    ADD CONSTRAINT posting_profile_debit_account_id_fkey FOREIGN KEY (debit_account_id) REFERENCES core.accounts(account_id);
    ADD CONSTRAINT posting_profile_debit_account_id_fkey FOREIGN KEY (debit_account_id) REFERENCES core.accounts(account_id);




--
--
-- Name: status_history status_history_changed_by_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: status_history status_history_changed_by_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.status_history
ALTER TABLE ONLY core.status_history
    ADD CONSTRAINT status_history_changed_by_fkey FOREIGN KEY (changed_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT status_history_changed_by_fkey FOREIGN KEY (changed_by) REFERENCES core.app_user(user_id);




--
--
-- Name: status_history status_history_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: status_history status_history_company_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.status_history
ALTER TABLE ONLY core.status_history
    ADD CONSTRAINT status_history_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT status_history_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: uom_conversion uom_conversion_from_uom_code_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: uom_conversion uom_conversion_from_uom_code_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.uom_conversion
ALTER TABLE ONLY core.uom_conversion
    ADD CONSTRAINT uom_conversion_from_uom_code_fkey FOREIGN KEY (from_uom_code) REFERENCES core.uom(uom_code);
    ADD CONSTRAINT uom_conversion_from_uom_code_fkey FOREIGN KEY (from_uom_code) REFERENCES core.uom(uom_code);




--
--
-- Name: uom_conversion uom_conversion_to_uom_code_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: uom_conversion uom_conversion_to_uom_code_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.uom_conversion
ALTER TABLE ONLY core.uom_conversion
    ADD CONSTRAINT uom_conversion_to_uom_code_fkey FOREIGN KEY (to_uom_code) REFERENCES core.uom(uom_code);
    ADD CONSTRAINT uom_conversion_to_uom_code_fkey FOREIGN KEY (to_uom_code) REFERENCES core.uom(uom_code);




--
--
-- Name: user_permissions user_permissions_permission_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: user_permissions user_permissions_permission_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.user_permissions
ALTER TABLE ONLY core.user_permissions
    ADD CONSTRAINT user_permissions_permission_id_fkey FOREIGN KEY (permission_id) REFERENCES core.permissions(permission_id) ON DELETE CASCADE;
    ADD CONSTRAINT user_permissions_permission_id_fkey FOREIGN KEY (permission_id) REFERENCES core.permissions(permission_id) ON DELETE CASCADE;




--
--
-- Name: user_permissions user_permissions_user_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
-- Name: user_permissions user_permissions_user_id_fkey; Type: FK CONSTRAINT; Schema: core; Owner: -
--
--


ALTER TABLE ONLY core.user_permissions
ALTER TABLE ONLY core.user_permissions
    ADD CONSTRAINT user_permissions_user_id_fkey FOREIGN KEY (user_id) REFERENCES core.app_user(user_id) ON DELETE CASCADE;
    ADD CONSTRAINT user_permissions_user_id_fkey FOREIGN KEY (user_id) REFERENCES core.app_user(user_id) ON DELETE CASCADE;




--
--
-- Name: codegen_artifact codegen_artifact_run_id_fkey; Type: FK CONSTRAINT; Schema: devops; Owner: -
-- Name: codegen_artifact codegen_artifact_run_id_fkey; Type: FK CONSTRAINT; Schema: devops; Owner: -
--
--


ALTER TABLE ONLY devops.codegen_artifact
ALTER TABLE ONLY devops.codegen_artifact
    ADD CONSTRAINT codegen_artifact_run_id_fkey FOREIGN KEY (run_id) REFERENCES devops.codegen_run(run_id);
    ADD CONSTRAINT codegen_artifact_run_id_fkey FOREIGN KEY (run_id) REFERENCES devops.codegen_run(run_id);




--
--
-- Name: bank_account bank_account_company_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
-- Name: bank_account bank_account_company_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_account
ALTER TABLE ONLY finance.bank_account
    ADD CONSTRAINT bank_account_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT bank_account_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: bank_statement_header bank_statement_header_bank_account_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
-- Name: bank_statement_header bank_statement_header_bank_account_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_statement_header
ALTER TABLE ONLY finance.bank_statement_header
    ADD CONSTRAINT bank_statement_header_bank_account_id_fkey FOREIGN KEY (bank_account_id) REFERENCES finance.bank_account(bank_account_id) ON DELETE CASCADE;
    ADD CONSTRAINT bank_statement_header_bank_account_id_fkey FOREIGN KEY (bank_account_id) REFERENCES finance.bank_account(bank_account_id) ON DELETE CASCADE;




--
--
-- Name: bank_statement_line bank_statement_line_bank_statement_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
-- Name: bank_statement_line bank_statement_line_bank_statement_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.bank_statement_line
ALTER TABLE ONLY finance.bank_statement_line
    ADD CONSTRAINT bank_statement_line_bank_statement_id_fkey FOREIGN KEY (bank_statement_id) REFERENCES finance.bank_statement_header(bank_statement_id) ON DELETE CASCADE;
    ADD CONSTRAINT bank_statement_line_bank_statement_id_fkey FOREIGN KEY (bank_statement_id) REFERENCES finance.bank_statement_header(bank_statement_id) ON DELETE CASCADE;




--
--
-- Name: payment_allocation payment_allocation_payment_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
-- Name: payment_allocation payment_allocation_payment_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.payment_allocation
ALTER TABLE ONLY finance.payment_allocation
    ADD CONSTRAINT payment_allocation_payment_id_fkey FOREIGN KEY (payment_id) REFERENCES finance.payment(payment_id) ON DELETE CASCADE;
    ADD CONSTRAINT payment_allocation_payment_id_fkey FOREIGN KEY (payment_id) REFERENCES finance.payment(payment_id) ON DELETE CASCADE;




--
--
-- Name: payment payment_bank_account_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
-- Name: payment payment_bank_account_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.payment
ALTER TABLE ONLY finance.payment
    ADD CONSTRAINT payment_bank_account_id_fkey FOREIGN KEY (bank_account_id) REFERENCES finance.bank_account(bank_account_id);
    ADD CONSTRAINT payment_bank_account_id_fkey FOREIGN KEY (bank_account_id) REFERENCES finance.bank_account(bank_account_id);




--
--
-- Name: payment payment_company_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
-- Name: payment payment_company_id_fkey; Type: FK CONSTRAINT; Schema: finance; Owner: -
--
--


ALTER TABLE ONLY finance.payment
ALTER TABLE ONLY finance.payment
    ADD CONSTRAINT payment_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT payment_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: business_rule_action business_rule_action_business_rule_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: business_rule_action business_rule_action_business_rule_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule_action
ALTER TABLE ONLY governance.business_rule_action
    ADD CONSTRAINT business_rule_action_business_rule_id_fkey FOREIGN KEY (business_rule_id) REFERENCES governance.business_rule(business_rule_id) ON DELETE CASCADE;
    ADD CONSTRAINT business_rule_action_business_rule_id_fkey FOREIGN KEY (business_rule_id) REFERENCES governance.business_rule(business_rule_id) ON DELETE CASCADE;




--
--
-- Name: business_rule business_rule_company_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: business_rule business_rule_company_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule
ALTER TABLE ONLY governance.business_rule
    ADD CONSTRAINT business_rule_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT business_rule_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: business_rule_condition business_rule_condition_business_rule_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: business_rule_condition business_rule_condition_business_rule_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.business_rule_condition
ALTER TABLE ONLY governance.business_rule_condition
    ADD CONSTRAINT business_rule_condition_business_rule_id_fkey FOREIGN KEY (business_rule_id) REFERENCES governance.business_rule(business_rule_id) ON DELETE CASCADE;
    ADD CONSTRAINT business_rule_condition_business_rule_id_fkey FOREIGN KEY (business_rule_id) REFERENCES governance.business_rule(business_rule_id) ON DELETE CASCADE;




--
--
-- Name: contract_header contract_header_company_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: contract_header contract_header_company_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.contract_header
ALTER TABLE ONLY governance.contract_header
    ADD CONSTRAINT contract_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT contract_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: contract_item_price contract_item_price_contract_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: contract_item_price contract_item_price_contract_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.contract_item_price
ALTER TABLE ONLY governance.contract_item_price
    ADD CONSTRAINT contract_item_price_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES governance.contract_header(contract_id) ON DELETE CASCADE;
    ADD CONSTRAINT contract_item_price_contract_id_fkey FOREIGN KEY (contract_id) REFERENCES governance.contract_header(contract_id) ON DELETE CASCADE;




--
--
-- Name: contract_item_price contract_item_price_item_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: contract_item_price contract_item_price_item_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.contract_item_price
ALTER TABLE ONLY governance.contract_item_price
    ADD CONSTRAINT contract_item_price_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT contract_item_price_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: document_archive document_archive_company_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: document_archive document_archive_company_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.document_archive
ALTER TABLE ONLY governance.document_archive
    ADD CONSTRAINT document_archive_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT document_archive_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: document_archive document_archive_document_category_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: document_archive document_archive_document_category_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.document_archive
ALTER TABLE ONLY governance.document_archive
    ADD CONSTRAINT document_archive_document_category_id_fkey FOREIGN KEY (document_category_id) REFERENCES governance.document_category(document_category_id);
    ADD CONSTRAINT document_archive_document_category_id_fkey FOREIGN KEY (document_category_id) REFERENCES governance.document_category(document_category_id);




--
--
-- Name: policy_change_queue policy_change_queue_source_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
-- Name: policy_change_queue policy_change_queue_source_alert_event_id_fkey; Type: FK CONSTRAINT; Schema: governance; Owner: -
--
--


ALTER TABLE ONLY governance.policy_change_queue
ALTER TABLE ONLY governance.policy_change_queue
    ADD CONSTRAINT policy_change_queue_source_alert_event_id_fkey FOREIGN KEY (source_alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id);
    ADD CONSTRAINT policy_change_queue_source_alert_event_id_fkey FOREIGN KEY (source_alert_event_id) REFERENCES analytics.audit_alert_event(alert_event_id);




--
--
-- Name: attendance_log attendance_log_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: attendance_log attendance_log_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.attendance_log
ALTER TABLE ONLY hr.attendance_log
    ADD CONSTRAINT attendance_log_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT attendance_log_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: attendance_log attendance_log_employee_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: attendance_log attendance_log_employee_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.attendance_log
ALTER TABLE ONLY hr.attendance_log
    ADD CONSTRAINT attendance_log_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES hr.employee(employee_id) ON DELETE CASCADE;
    ADD CONSTRAINT attendance_log_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES hr.employee(employee_id) ON DELETE CASCADE;




--
--
-- Name: employee employee_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: employee employee_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employee
ALTER TABLE ONLY hr.employee
    ADD CONSTRAINT employee_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT employee_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: employee employee_department_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: employee employee_department_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employee
ALTER TABLE ONLY hr.employee
    ADD CONSTRAINT employee_department_id_fkey FOREIGN KEY (department_id) REFERENCES hr.hr_department(department_id);
    ADD CONSTRAINT employee_department_id_fkey FOREIGN KEY (department_id) REFERENCES hr.hr_department(department_id);




--
--
-- Name: employee employee_position_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: employee employee_position_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employee
ALTER TABLE ONLY hr.employee
    ADD CONSTRAINT employee_position_id_fkey FOREIGN KEY (position_id) REFERENCES hr.hr_position(position_id);
    ADD CONSTRAINT employee_position_id_fkey FOREIGN KEY (position_id) REFERENCES hr.hr_position(position_id);




--
--
-- Name: employment_contract employment_contract_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: employment_contract employment_contract_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employment_contract
ALTER TABLE ONLY hr.employment_contract
    ADD CONSTRAINT employment_contract_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT employment_contract_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: employment_contract employment_contract_employee_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: employment_contract employment_contract_employee_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.employment_contract
ALTER TABLE ONLY hr.employment_contract
    ADD CONSTRAINT employment_contract_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES hr.employee(employee_id) ON DELETE CASCADE;
    ADD CONSTRAINT employment_contract_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES hr.employee(employee_id) ON DELETE CASCADE;




--
--
-- Name: hr_department hr_department_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: hr_department hr_department_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.hr_department
ALTER TABLE ONLY hr.hr_department
    ADD CONSTRAINT hr_department_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT hr_department_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: hr_position hr_position_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: hr_position hr_position_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.hr_position
ALTER TABLE ONLY hr.hr_position
    ADD CONSTRAINT hr_position_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT hr_position_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: leave_request leave_request_approved_by_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: leave_request leave_request_approved_by_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.leave_request
ALTER TABLE ONLY hr.leave_request
    ADD CONSTRAINT leave_request_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT leave_request_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES core.app_user(user_id);




--
--
-- Name: leave_request leave_request_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: leave_request leave_request_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.leave_request
ALTER TABLE ONLY hr.leave_request
    ADD CONSTRAINT leave_request_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT leave_request_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: leave_request leave_request_employee_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: leave_request leave_request_employee_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.leave_request
ALTER TABLE ONLY hr.leave_request
    ADD CONSTRAINT leave_request_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES hr.employee(employee_id) ON DELETE CASCADE;
    ADD CONSTRAINT leave_request_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES hr.employee(employee_id) ON DELETE CASCADE;




--
--
-- Name: leave_request leave_request_leave_type_code_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: leave_request leave_request_leave_type_code_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.leave_request
ALTER TABLE ONLY hr.leave_request
    ADD CONSTRAINT leave_request_leave_type_code_fkey FOREIGN KEY (leave_type_code) REFERENCES hr.leave_type(leave_type_code);
    ADD CONSTRAINT leave_request_leave_type_code_fkey FOREIGN KEY (leave_type_code) REFERENCES hr.leave_type(leave_type_code);




--
--
-- Name: payroll_run payroll_run_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: payroll_run payroll_run_company_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_run
ALTER TABLE ONLY hr.payroll_run
    ADD CONSTRAINT payroll_run_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT payroll_run_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: payroll_slip payroll_slip_employee_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: payroll_slip payroll_slip_employee_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_slip
ALTER TABLE ONLY hr.payroll_slip
    ADD CONSTRAINT payroll_slip_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES hr.employee(employee_id);
    ADD CONSTRAINT payroll_slip_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES hr.employee(employee_id);




--
--
-- Name: payroll_slip payroll_slip_payroll_run_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
-- Name: payroll_slip payroll_slip_payroll_run_id_fkey; Type: FK CONSTRAINT; Schema: hr; Owner: -
--
--


ALTER TABLE ONLY hr.payroll_slip
ALTER TABLE ONLY hr.payroll_slip
    ADD CONSTRAINT payroll_slip_payroll_run_id_fkey FOREIGN KEY (payroll_run_id) REFERENCES hr.payroll_run(payroll_run_id) ON DELETE CASCADE;
    ADD CONSTRAINT payroll_slip_payroll_run_id_fkey FOREIGN KEY (payroll_run_id) REFERENCES hr.payroll_run(payroll_run_id) ON DELETE CASCADE;




--
--
-- Name: api_credential api_credential_external_system_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
-- Name: api_credential api_credential_external_system_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.api_credential
ALTER TABLE ONLY integration.api_credential
    ADD CONSTRAINT api_credential_external_system_id_fkey FOREIGN KEY (external_system_id) REFERENCES integration.external_system(external_system_id) ON DELETE CASCADE;
    ADD CONSTRAINT api_credential_external_system_id_fkey FOREIGN KEY (external_system_id) REFERENCES integration.external_system(external_system_id) ON DELETE CASCADE;




--
--
-- Name: external_system external_system_company_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
-- Name: external_system external_system_company_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.external_system
ALTER TABLE ONLY integration.external_system
    ADD CONSTRAINT external_system_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT external_system_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: integration_job integration_job_external_system_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
-- Name: integration_job integration_job_external_system_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.integration_job
ALTER TABLE ONLY integration.integration_job
    ADD CONSTRAINT integration_job_external_system_id_fkey FOREIGN KEY (external_system_id) REFERENCES integration.external_system(external_system_id) ON DELETE CASCADE;
    ADD CONSTRAINT integration_job_external_system_id_fkey FOREIGN KEY (external_system_id) REFERENCES integration.external_system(external_system_id) ON DELETE CASCADE;




--
--
-- Name: integration_log integration_log_integration_job_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
-- Name: integration_log integration_log_integration_job_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.integration_log
ALTER TABLE ONLY integration.integration_log
    ADD CONSTRAINT integration_log_integration_job_id_fkey FOREIGN KEY (integration_job_id) REFERENCES integration.integration_job(integration_job_id) ON DELETE CASCADE;
    ADD CONSTRAINT integration_log_integration_job_id_fkey FOREIGN KEY (integration_job_id) REFERENCES integration.integration_job(integration_job_id) ON DELETE CASCADE;




--
--
-- Name: siem_delivery_queue siem_delivery_queue_endpoint_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
-- Name: siem_delivery_queue siem_delivery_queue_endpoint_id_fkey; Type: FK CONSTRAINT; Schema: integration; Owner: -
--
--


ALTER TABLE ONLY integration.siem_delivery_queue
ALTER TABLE ONLY integration.siem_delivery_queue
    ADD CONSTRAINT siem_delivery_queue_endpoint_id_fkey FOREIGN KEY (endpoint_id) REFERENCES integration.siem_endpoint(endpoint_id) ON DELETE CASCADE;
    ADD CONSTRAINT siem_delivery_queue_endpoint_id_fkey FOREIGN KEY (endpoint_id) REFERENCES integration.siem_endpoint(endpoint_id) ON DELETE CASCADE;




--
--
-- Name: inventory_valuation inventory_valuation_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: inventory_valuation inventory_valuation_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.inventory_valuation
ALTER TABLE ONLY inventory.inventory_valuation
    ADD CONSTRAINT inventory_valuation_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT inventory_valuation_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: inventory_valuation inventory_valuation_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: inventory_valuation inventory_valuation_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.inventory_valuation
ALTER TABLE ONLY inventory.inventory_valuation
    ADD CONSTRAINT inventory_valuation_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT inventory_valuation_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: stock_balance stock_balance_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_balance stock_balance_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_balance
ALTER TABLE ONLY inventory.stock_balance
    ADD CONSTRAINT stock_balance_bin_id_fkey FOREIGN KEY (bin_id) REFERENCES inventory.stock_bin(bin_id);
    ADD CONSTRAINT stock_balance_bin_id_fkey FOREIGN KEY (bin_id) REFERENCES inventory.stock_bin(bin_id);




--
--
-- Name: stock_balance stock_balance_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_balance stock_balance_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_balance
ALTER TABLE ONLY inventory.stock_balance
    ADD CONSTRAINT stock_balance_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_balance_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stock_balance stock_balance_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_balance stock_balance_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_balance
ALTER TABLE ONLY inventory.stock_balance
    ADD CONSTRAINT stock_balance_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT stock_balance_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: stock_balance stock_balance_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_balance stock_balance_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_balance
ALTER TABLE ONLY inventory.stock_balance
    ADD CONSTRAINT stock_balance_location_id_fkey FOREIGN KEY (location_id) REFERENCES inventory.storage_location(location_id);
    ADD CONSTRAINT stock_balance_location_id_fkey FOREIGN KEY (location_id) REFERENCES inventory.storage_location(location_id);




--
--
-- Name: stock_balance stock_balance_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_balance stock_balance_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_balance
ALTER TABLE ONLY inventory.stock_balance
    ADD CONSTRAINT stock_balance_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT stock_balance_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: stock_bin stock_bin_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_bin stock_bin_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_bin
ALTER TABLE ONLY inventory.stock_bin
    ADD CONSTRAINT stock_bin_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_bin_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stock_bin stock_bin_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_bin stock_bin_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_bin
ALTER TABLE ONLY inventory.stock_bin
    ADD CONSTRAINT stock_bin_location_id_fkey FOREIGN KEY (location_id) REFERENCES inventory.storage_location(location_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_bin_location_id_fkey FOREIGN KEY (location_id) REFERENCES inventory.storage_location(location_id) ON DELETE CASCADE;




--
--
-- Name: stock_lot_balance stock_lot_balance_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance
ALTER TABLE ONLY inventory.stock_lot_balance
    ADD CONSTRAINT stock_lot_balance_bin_id_fkey FOREIGN KEY (bin_id) REFERENCES inventory.stock_bin(bin_id);
    ADD CONSTRAINT stock_lot_balance_bin_id_fkey FOREIGN KEY (bin_id) REFERENCES inventory.stock_bin(bin_id);




--
--
-- Name: stock_lot_balance stock_lot_balance_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance
ALTER TABLE ONLY inventory.stock_lot_balance
    ADD CONSTRAINT stock_lot_balance_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_lot_balance_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stock_lot_balance stock_lot_balance_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance
ALTER TABLE ONLY inventory.stock_lot_balance
    ADD CONSTRAINT stock_lot_balance_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT stock_lot_balance_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: stock_lot_balance stock_lot_balance_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance
ALTER TABLE ONLY inventory.stock_lot_balance
    ADD CONSTRAINT stock_lot_balance_location_id_fkey FOREIGN KEY (location_id) REFERENCES inventory.storage_location(location_id);
    ADD CONSTRAINT stock_lot_balance_location_id_fkey FOREIGN KEY (location_id) REFERENCES inventory.storage_location(location_id);




--
--
-- Name: stock_lot_balance stock_lot_balance_stock_lot_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_stock_lot_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance
ALTER TABLE ONLY inventory.stock_lot_balance
    ADD CONSTRAINT stock_lot_balance_stock_lot_id_fkey FOREIGN KEY (stock_lot_id) REFERENCES inventory.stock_lot(stock_lot_id);
    ADD CONSTRAINT stock_lot_balance_stock_lot_id_fkey FOREIGN KEY (stock_lot_id) REFERENCES inventory.stock_lot(stock_lot_id);




--
--
-- Name: stock_lot_balance stock_lot_balance_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot_balance stock_lot_balance_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot_balance
ALTER TABLE ONLY inventory.stock_lot_balance
    ADD CONSTRAINT stock_lot_balance_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT stock_lot_balance_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: stock_lot stock_lot_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot stock_lot_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot
ALTER TABLE ONLY inventory.stock_lot
    ADD CONSTRAINT stock_lot_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_lot_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stock_lot stock_lot_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_lot stock_lot_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_lot
ALTER TABLE ONLY inventory.stock_lot
    ADD CONSTRAINT stock_lot_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT stock_lot_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: stock_reservation stock_reservation_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_reservation stock_reservation_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_reservation
ALTER TABLE ONLY inventory.stock_reservation
    ADD CONSTRAINT stock_reservation_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_reservation_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stock_reservation stock_reservation_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_reservation stock_reservation_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_reservation
ALTER TABLE ONLY inventory.stock_reservation
    ADD CONSTRAINT stock_reservation_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT stock_reservation_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: stock_reservation stock_reservation_stock_lot_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_reservation stock_reservation_stock_lot_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_reservation
ALTER TABLE ONLY inventory.stock_reservation
    ADD CONSTRAINT stock_reservation_stock_lot_id_fkey FOREIGN KEY (stock_lot_id) REFERENCES inventory.stock_lot(stock_lot_id);
    ADD CONSTRAINT stock_reservation_stock_lot_id_fkey FOREIGN KEY (stock_lot_id) REFERENCES inventory.stock_lot(stock_lot_id);




--
--
-- Name: stock_transaction stock_transaction_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transaction stock_transaction_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transaction
ALTER TABLE ONLY inventory.stock_transaction
    ADD CONSTRAINT stock_transaction_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_transaction_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stock_transaction stock_transaction_from_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transaction stock_transaction_from_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transaction
ALTER TABLE ONLY inventory.stock_transaction
    ADD CONSTRAINT stock_transaction_from_bin_id_fkey FOREIGN KEY (from_bin_id) REFERENCES inventory.stock_bin(bin_id);
    ADD CONSTRAINT stock_transaction_from_bin_id_fkey FOREIGN KEY (from_bin_id) REFERENCES inventory.stock_bin(bin_id);




--
--
-- Name: stock_transaction stock_transaction_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transaction stock_transaction_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transaction
ALTER TABLE ONLY inventory.stock_transaction
    ADD CONSTRAINT stock_transaction_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT stock_transaction_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: stock_transaction stock_transaction_stock_lot_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transaction stock_transaction_stock_lot_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transaction
ALTER TABLE ONLY inventory.stock_transaction
    ADD CONSTRAINT stock_transaction_stock_lot_id_fkey FOREIGN KEY (stock_lot_id) REFERENCES inventory.stock_lot(stock_lot_id);
    ADD CONSTRAINT stock_transaction_stock_lot_id_fkey FOREIGN KEY (stock_lot_id) REFERENCES inventory.stock_lot(stock_lot_id);




--
--
-- Name: stock_transaction stock_transaction_to_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transaction stock_transaction_to_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transaction
ALTER TABLE ONLY inventory.stock_transaction
    ADD CONSTRAINT stock_transaction_to_bin_id_fkey FOREIGN KEY (to_bin_id) REFERENCES inventory.stock_bin(bin_id);
    ADD CONSTRAINT stock_transaction_to_bin_id_fkey FOREIGN KEY (to_bin_id) REFERENCES inventory.stock_bin(bin_id);




--
--
-- Name: stock_transaction stock_transaction_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transaction stock_transaction_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transaction
ALTER TABLE ONLY inventory.stock_transaction
    ADD CONSTRAINT stock_transaction_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT stock_transaction_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_from_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_from_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_from_bin_id_fkey FOREIGN KEY (from_bin_id) REFERENCES inventory.stock_bin(bin_id);
    ADD CONSTRAINT stock_transfer_detail_from_bin_id_fkey FOREIGN KEY (from_bin_id) REFERENCES inventory.stock_bin(bin_id);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_from_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_from_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_from_location_id_fkey FOREIGN KEY (from_location_id) REFERENCES inventory.storage_location(location_id);
    ADD CONSTRAINT stock_transfer_detail_from_location_id_fkey FOREIGN KEY (from_location_id) REFERENCES inventory.storage_location(location_id);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT stock_transfer_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_stock_lot_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_stock_lot_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_stock_lot_id_fkey FOREIGN KEY (stock_lot_id) REFERENCES inventory.stock_lot(stock_lot_id);
    ADD CONSTRAINT stock_transfer_detail_stock_lot_id_fkey FOREIGN KEY (stock_lot_id) REFERENCES inventory.stock_lot(stock_lot_id);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_stock_transfer_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_stock_transfer_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_stock_transfer_id_fkey FOREIGN KEY (stock_transfer_id) REFERENCES inventory.stock_transfer_header(stock_transfer_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_transfer_detail_stock_transfer_id_fkey FOREIGN KEY (stock_transfer_id) REFERENCES inventory.stock_transfer_header(stock_transfer_id) ON DELETE CASCADE;




--
--
-- Name: stock_transfer_detail stock_transfer_detail_to_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_to_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_to_bin_id_fkey FOREIGN KEY (to_bin_id) REFERENCES inventory.stock_bin(bin_id);
    ADD CONSTRAINT stock_transfer_detail_to_bin_id_fkey FOREIGN KEY (to_bin_id) REFERENCES inventory.stock_bin(bin_id);




--
--
-- Name: stock_transfer_detail stock_transfer_detail_to_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_detail stock_transfer_detail_to_location_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_detail
ALTER TABLE ONLY inventory.stock_transfer_detail
    ADD CONSTRAINT stock_transfer_detail_to_location_id_fkey FOREIGN KEY (to_location_id) REFERENCES inventory.storage_location(location_id);
    ADD CONSTRAINT stock_transfer_detail_to_location_id_fkey FOREIGN KEY (to_location_id) REFERENCES inventory.storage_location(location_id);




--
--
-- Name: stock_transfer_header stock_transfer_header_approved_by_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_header stock_transfer_header_approved_by_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_header
ALTER TABLE ONLY inventory.stock_transfer_header
    ADD CONSTRAINT stock_transfer_header_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT stock_transfer_header_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES core.app_user(user_id);




--
--
-- Name: stock_transfer_header stock_transfer_header_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_header stock_transfer_header_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_header
ALTER TABLE ONLY inventory.stock_transfer_header
    ADD CONSTRAINT stock_transfer_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stock_transfer_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stock_transfer_header stock_transfer_header_from_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_header stock_transfer_header_from_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_header
ALTER TABLE ONLY inventory.stock_transfer_header
    ADD CONSTRAINT stock_transfer_header_from_warehouse_id_fkey FOREIGN KEY (from_warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT stock_transfer_header_from_warehouse_id_fkey FOREIGN KEY (from_warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: stock_transfer_header stock_transfer_header_requested_by_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_header stock_transfer_header_requested_by_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_header
ALTER TABLE ONLY inventory.stock_transfer_header
    ADD CONSTRAINT stock_transfer_header_requested_by_fkey FOREIGN KEY (requested_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT stock_transfer_header_requested_by_fkey FOREIGN KEY (requested_by) REFERENCES core.app_user(user_id);




--
--
-- Name: stock_transfer_header stock_transfer_header_to_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stock_transfer_header stock_transfer_header_to_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stock_transfer_header
ALTER TABLE ONLY inventory.stock_transfer_header
    ADD CONSTRAINT stock_transfer_header_to_warehouse_id_fkey FOREIGN KEY (to_warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT stock_transfer_header_to_warehouse_id_fkey FOREIGN KEY (to_warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: stocktaking_plan stocktaking_plan_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stocktaking_plan stocktaking_plan_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_plan
ALTER TABLE ONLY inventory.stocktaking_plan
    ADD CONSTRAINT stocktaking_plan_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stocktaking_plan_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stocktaking_plan stocktaking_plan_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stocktaking_plan stocktaking_plan_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_plan
ALTER TABLE ONLY inventory.stocktaking_plan
    ADD CONSTRAINT stocktaking_plan_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT stocktaking_plan_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: stocktaking_result stocktaking_result_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stocktaking_result stocktaking_result_bin_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_result
ALTER TABLE ONLY inventory.stocktaking_result
    ADD CONSTRAINT stocktaking_result_bin_id_fkey FOREIGN KEY (bin_id) REFERENCES inventory.stock_bin(bin_id);
    ADD CONSTRAINT stocktaking_result_bin_id_fkey FOREIGN KEY (bin_id) REFERENCES inventory.stock_bin(bin_id);




--
--
-- Name: stocktaking_result stocktaking_result_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stocktaking_result stocktaking_result_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_result
ALTER TABLE ONLY inventory.stocktaking_result
    ADD CONSTRAINT stocktaking_result_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT stocktaking_result_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: stocktaking_result stocktaking_result_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stocktaking_result stocktaking_result_item_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_result
ALTER TABLE ONLY inventory.stocktaking_result
    ADD CONSTRAINT stocktaking_result_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT stocktaking_result_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: stocktaking_result stocktaking_result_stocktaking_plan_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: stocktaking_result stocktaking_result_stocktaking_plan_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.stocktaking_result
ALTER TABLE ONLY inventory.stocktaking_result
    ADD CONSTRAINT stocktaking_result_stocktaking_plan_id_fkey FOREIGN KEY (stocktaking_plan_id) REFERENCES inventory.stocktaking_plan(stocktaking_plan_id) ON DELETE CASCADE;
    ADD CONSTRAINT stocktaking_result_stocktaking_plan_id_fkey FOREIGN KEY (stocktaking_plan_id) REFERENCES inventory.stocktaking_plan(stocktaking_plan_id) ON DELETE CASCADE;




--
--
-- Name: storage_location storage_location_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: storage_location storage_location_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.storage_location
ALTER TABLE ONLY inventory.storage_location
    ADD CONSTRAINT storage_location_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT storage_location_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: storage_location storage_location_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: storage_location storage_location_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.storage_location
ALTER TABLE ONLY inventory.storage_location
    ADD CONSTRAINT storage_location_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id) ON DELETE CASCADE;
    ADD CONSTRAINT storage_location_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id) ON DELETE CASCADE;




--
--
-- Name: warehouse warehouse_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
-- Name: warehouse warehouse_company_id_fkey; Type: FK CONSTRAINT; Schema: inventory; Owner: -
--
--


ALTER TABLE ONLY inventory.warehouse
ALTER TABLE ONLY inventory.warehouse
    ADD CONSTRAINT warehouse_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT warehouse_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: bom_detail bom_detail_bom_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: bom_detail bom_detail_bom_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_detail
ALTER TABLE ONLY manufacturing.bom_detail
    ADD CONSTRAINT bom_detail_bom_id_fkey FOREIGN KEY (bom_id) REFERENCES manufacturing.bom_header(bom_id) ON DELETE CASCADE;
    ADD CONSTRAINT bom_detail_bom_id_fkey FOREIGN KEY (bom_id) REFERENCES manufacturing.bom_header(bom_id) ON DELETE CASCADE;




--
--
-- Name: bom_detail bom_detail_component_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: bom_detail bom_detail_component_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_detail
ALTER TABLE ONLY manufacturing.bom_detail
    ADD CONSTRAINT bom_detail_component_item_id_fkey FOREIGN KEY (component_item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT bom_detail_component_item_id_fkey FOREIGN KEY (component_item_id) REFERENCES sales.item(item_id);




--
--
-- Name: bom_header bom_header_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: bom_header bom_header_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_header
ALTER TABLE ONLY manufacturing.bom_header
    ADD CONSTRAINT bom_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT bom_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: bom_header bom_header_parent_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: bom_header bom_header_parent_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.bom_header
ALTER TABLE ONLY manufacturing.bom_header
    ADD CONSTRAINT bom_header_parent_item_id_fkey FOREIGN KEY (parent_item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT bom_header_parent_item_id_fkey FOREIGN KEY (parent_item_id) REFERENCES sales.item(item_id);




--
--
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot
ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot
    ADD CONSTRAINT manufacturing_cost_snapshot_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT manufacturing_cost_snapshot_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_work_order_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot manufacturing_cost_snapshot_work_order_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot
ALTER TABLE ONLY manufacturing.manufacturing_cost_snapshot
    ADD CONSTRAINT manufacturing_cost_snapshot_work_order_id_fkey FOREIGN KEY (work_order_id) REFERENCES manufacturing.work_order(work_order_id) ON DELETE CASCADE;
    ADD CONSTRAINT manufacturing_cost_snapshot_work_order_id_fkey FOREIGN KEY (work_order_id) REFERENCES manufacturing.work_order(work_order_id) ON DELETE CASCADE;




--
--
-- Name: manufacturing_execution manufacturing_execution_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution manufacturing_execution_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution
ALTER TABLE ONLY manufacturing.manufacturing_execution
    ADD CONSTRAINT manufacturing_execution_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT manufacturing_execution_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: manufacturing_execution_detail manufacturing_execution_detail_execution_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail manufacturing_execution_detail_execution_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution_detail
ALTER TABLE ONLY manufacturing.manufacturing_execution_detail
    ADD CONSTRAINT manufacturing_execution_detail_execution_id_fkey FOREIGN KEY (execution_id) REFERENCES manufacturing.manufacturing_execution(execution_id) ON DELETE CASCADE;
    ADD CONSTRAINT manufacturing_execution_detail_execution_id_fkey FOREIGN KEY (execution_id) REFERENCES manufacturing.manufacturing_execution(execution_id) ON DELETE CASCADE;




--
--
-- Name: manufacturing_execution_detail manufacturing_execution_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution_detail manufacturing_execution_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution_detail
ALTER TABLE ONLY manufacturing.manufacturing_execution_detail
    ADD CONSTRAINT manufacturing_execution_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT manufacturing_execution_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: manufacturing_execution manufacturing_execution_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution manufacturing_execution_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution
ALTER TABLE ONLY manufacturing.manufacturing_execution
    ADD CONSTRAINT manufacturing_execution_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT manufacturing_execution_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: manufacturing_execution manufacturing_execution_work_order_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution manufacturing_execution_work_order_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.manufacturing_execution
ALTER TABLE ONLY manufacturing.manufacturing_execution
    ADD CONSTRAINT manufacturing_execution_work_order_id_fkey FOREIGN KEY (work_order_id) REFERENCES manufacturing.work_order(work_order_id) ON DELETE CASCADE;
    ADD CONSTRAINT manufacturing_execution_work_order_id_fkey FOREIGN KEY (work_order_id) REFERENCES manufacturing.work_order(work_order_id) ON DELETE CASCADE;




--
--
-- Name: mps_plan mps_plan_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mps_plan mps_plan_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mps_plan
ALTER TABLE ONLY manufacturing.mps_plan
    ADD CONSTRAINT mps_plan_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT mps_plan_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: mps_plan mps_plan_mps_run_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mps_plan mps_plan_mps_run_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mps_plan
ALTER TABLE ONLY manufacturing.mps_plan
    ADD CONSTRAINT mps_plan_mps_run_id_fkey FOREIGN KEY (mps_run_id) REFERENCES manufacturing.mps_run(mps_run_id) ON DELETE CASCADE;
    ADD CONSTRAINT mps_plan_mps_run_id_fkey FOREIGN KEY (mps_run_id) REFERENCES manufacturing.mps_run(mps_run_id) ON DELETE CASCADE;




--
--
-- Name: mps_run mps_run_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mps_run mps_run_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mps_run
ALTER TABLE ONLY manufacturing.mps_run
    ADD CONSTRAINT mps_run_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT mps_run_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: mrp_allocation mrp_allocation_mrp_requirement_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mrp_allocation mrp_allocation_mrp_requirement_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_allocation
ALTER TABLE ONLY manufacturing.mrp_allocation
    ADD CONSTRAINT mrp_allocation_mrp_requirement_id_fkey FOREIGN KEY (mrp_requirement_id) REFERENCES manufacturing.mrp_requirement(mrp_requirement_id) ON DELETE CASCADE;
    ADD CONSTRAINT mrp_allocation_mrp_requirement_id_fkey FOREIGN KEY (mrp_requirement_id) REFERENCES manufacturing.mrp_requirement(mrp_requirement_id) ON DELETE CASCADE;




--
--
-- Name: mrp_requirement mrp_requirement_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mrp_requirement mrp_requirement_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_requirement
ALTER TABLE ONLY manufacturing.mrp_requirement
    ADD CONSTRAINT mrp_requirement_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT mrp_requirement_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: mrp_requirement mrp_requirement_mrp_run_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mrp_requirement mrp_requirement_mrp_run_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_requirement
ALTER TABLE ONLY manufacturing.mrp_requirement
    ADD CONSTRAINT mrp_requirement_mrp_run_id_fkey FOREIGN KEY (mrp_run_id) REFERENCES manufacturing.mrp_run(mrp_run_id) ON DELETE CASCADE;
    ADD CONSTRAINT mrp_requirement_mrp_run_id_fkey FOREIGN KEY (mrp_run_id) REFERENCES manufacturing.mrp_run(mrp_run_id) ON DELETE CASCADE;




--
--
-- Name: mrp_run mrp_run_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: mrp_run mrp_run_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.mrp_run
ALTER TABLE ONLY manufacturing.mrp_run
    ADD CONSTRAINT mrp_run_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT mrp_run_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: process_master process_master_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: process_master process_master_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.process_master
ALTER TABLE ONLY manufacturing.process_master
    ADD CONSTRAINT process_master_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT process_master_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: routing_header routing_header_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: routing_header routing_header_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_header
ALTER TABLE ONLY manufacturing.routing_header
    ADD CONSTRAINT routing_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT routing_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: routing_header routing_header_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: routing_header routing_header_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_header
ALTER TABLE ONLY manufacturing.routing_header
    ADD CONSTRAINT routing_header_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT routing_header_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: routing_operation routing_operation_process_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: routing_operation routing_operation_process_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_operation
ALTER TABLE ONLY manufacturing.routing_operation
    ADD CONSTRAINT routing_operation_process_id_fkey FOREIGN KEY (process_id) REFERENCES manufacturing.process_master(process_id);
    ADD CONSTRAINT routing_operation_process_id_fkey FOREIGN KEY (process_id) REFERENCES manufacturing.process_master(process_id);




--
--
-- Name: routing_operation routing_operation_routing_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: routing_operation routing_operation_routing_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.routing_operation
ALTER TABLE ONLY manufacturing.routing_operation
    ADD CONSTRAINT routing_operation_routing_id_fkey FOREIGN KEY (routing_id) REFERENCES manufacturing.routing_header(routing_id) ON DELETE CASCADE;
    ADD CONSTRAINT routing_operation_routing_id_fkey FOREIGN KEY (routing_id) REFERENCES manufacturing.routing_header(routing_id) ON DELETE CASCADE;




--
--
-- Name: work_order work_order_bom_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: work_order work_order_bom_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.work_order
ALTER TABLE ONLY manufacturing.work_order
    ADD CONSTRAINT work_order_bom_id_fkey FOREIGN KEY (bom_id) REFERENCES manufacturing.bom_header(bom_id);
    ADD CONSTRAINT work_order_bom_id_fkey FOREIGN KEY (bom_id) REFERENCES manufacturing.bom_header(bom_id);




--
--
-- Name: work_order work_order_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: work_order work_order_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.work_order
ALTER TABLE ONLY manufacturing.work_order
    ADD CONSTRAINT work_order_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT work_order_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: work_order work_order_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: work_order work_order_item_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.work_order
ALTER TABLE ONLY manufacturing.work_order
    ADD CONSTRAINT work_order_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT work_order_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: work_order work_order_routing_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: work_order work_order_routing_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.work_order
ALTER TABLE ONLY manufacturing.work_order
    ADD CONSTRAINT work_order_routing_id_fkey FOREIGN KEY (routing_id) REFERENCES manufacturing.routing_header(routing_id);
    ADD CONSTRAINT work_order_routing_id_fkey FOREIGN KEY (routing_id) REFERENCES manufacturing.routing_header(routing_id);




--
--
-- Name: work_order work_order_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: work_order work_order_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.work_order
ALTER TABLE ONLY manufacturing.work_order
    ADD CONSTRAINT work_order_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT work_order_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: yield_metric yield_metric_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: yield_metric yield_metric_company_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.yield_metric
ALTER TABLE ONLY manufacturing.yield_metric
    ADD CONSTRAINT yield_metric_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT yield_metric_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: yield_metric yield_metric_process_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
-- Name: yield_metric yield_metric_process_id_fkey; Type: FK CONSTRAINT; Schema: manufacturing; Owner: -
--
--


ALTER TABLE ONLY manufacturing.yield_metric
ALTER TABLE ONLY manufacturing.yield_metric
    ADD CONSTRAINT yield_metric_process_id_fkey FOREIGN KEY (process_id) REFERENCES manufacturing.process_master(process_id);
    ADD CONSTRAINT yield_metric_process_id_fkey FOREIGN KEY (process_id) REFERENCES manufacturing.process_master(process_id);




--
--
-- Name: asset_link asset_link_asset_id_fkey; Type: FK CONSTRAINT; Schema: media; Owner: -
-- Name: asset_link asset_link_asset_id_fkey; Type: FK CONSTRAINT; Schema: media; Owner: -
--
--


ALTER TABLE ONLY media.asset_link
ALTER TABLE ONLY media.asset_link
    ADD CONSTRAINT asset_link_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES media.asset(asset_id) ON DELETE CASCADE;
    ADD CONSTRAINT asset_link_asset_id_fkey FOREIGN KEY (asset_id) REFERENCES media.asset(asset_id) ON DELETE CASCADE;




--
--
-- Name: ai_event ai_event_ai_rule_id_fkey; Type: FK CONSTRAINT; Schema: notify; Owner: -
-- Name: ai_event ai_event_ai_rule_id_fkey; Type: FK CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.ai_event
ALTER TABLE ONLY notify.ai_event
    ADD CONSTRAINT ai_event_ai_rule_id_fkey FOREIGN KEY (ai_rule_id) REFERENCES notify.ai_rule(ai_rule_id) ON DELETE SET NULL;
    ADD CONSTRAINT ai_event_ai_rule_id_fkey FOREIGN KEY (ai_rule_id) REFERENCES notify.ai_rule(ai_rule_id) ON DELETE SET NULL;




--
--
-- Name: approval_action_log approval_action_log_approval_request_id_fkey; Type: FK CONSTRAINT; Schema: notify; Owner: -
-- Name: approval_action_log approval_action_log_approval_request_id_fkey; Type: FK CONSTRAINT; Schema: notify; Owner: -
--
--


ALTER TABLE ONLY notify.approval_action_log
ALTER TABLE ONLY notify.approval_action_log
    ADD CONSTRAINT approval_action_log_approval_request_id_fkey FOREIGN KEY (approval_request_id) REFERENCES notify.approval_request(approval_request_id) ON DELETE CASCADE;
    ADD CONSTRAINT approval_action_log_approval_request_id_fkey FOREIGN KEY (approval_request_id) REFERENCES notify.approval_request(approval_request_id) ON DELETE CASCADE;




--
--
-- Name: document_file document_file_document_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
-- Name: document_file document_file_document_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_file
ALTER TABLE ONLY ops.document_file
    ADD CONSTRAINT document_file_document_type_code_fkey FOREIGN KEY (document_type_code) REFERENCES ops.document_type_master(document_type_code);
    ADD CONSTRAINT document_file_document_type_code_fkey FOREIGN KEY (document_type_code) REFERENCES ops.document_type_master(document_type_code);




--
--
-- Name: document_send_history document_send_history_channel_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
-- Name: document_send_history document_send_history_channel_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_send_history
ALTER TABLE ONLY ops.document_send_history
    ADD CONSTRAINT document_send_history_channel_code_fkey FOREIGN KEY (channel_code) REFERENCES ops.send_channel_master(channel_code);
    ADD CONSTRAINT document_send_history_channel_code_fkey FOREIGN KEY (channel_code) REFERENCES ops.send_channel_master(channel_code);




--
--
-- Name: document_send_history document_send_history_document_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
-- Name: document_send_history document_send_history_document_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_send_history
ALTER TABLE ONLY ops.document_send_history
    ADD CONSTRAINT document_send_history_document_type_code_fkey FOREIGN KEY (document_type_code) REFERENCES ops.document_type_master(document_type_code);
    ADD CONSTRAINT document_send_history_document_type_code_fkey FOREIGN KEY (document_type_code) REFERENCES ops.document_type_master(document_type_code);




--
--
-- Name: document_send_history document_send_history_resend_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
-- Name: document_send_history document_send_history_resend_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.document_send_history
ALTER TABLE ONLY ops.document_send_history
    ADD CONSTRAINT document_send_history_resend_type_code_fkey FOREIGN KEY (resend_type_code) REFERENCES ops.resend_type_master(resend_type_code);
    ADD CONSTRAINT document_send_history_resend_type_code_fkey FOREIGN KEY (resend_type_code) REFERENCES ops.resend_type_master(resend_type_code);




--
--
-- Name: ops_job_result fk_ops_job_result_job; Type: FK CONSTRAINT; Schema: ops; Owner: -
-- Name: ops_job_result fk_ops_job_result_job; Type: FK CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.ops_job_result
ALTER TABLE ONLY ops.ops_job_result
    ADD CONSTRAINT fk_ops_job_result_job FOREIGN KEY (job_id) REFERENCES ops.ops_job_queue(job_id) NOT VALID;
    ADD CONSTRAINT fk_ops_job_result_job FOREIGN KEY (job_id) REFERENCES ops.ops_job_queue(job_id) NOT VALID;




--
--
-- Name: ops_job_result ops_job_result_job_id_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
-- Name: ops_job_result ops_job_result_job_id_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.ops_job_result
ALTER TABLE ONLY ops.ops_job_result
    ADD CONSTRAINT ops_job_result_job_id_fkey FOREIGN KEY (job_id) REFERENCES ops.ops_job_queue(job_id) ON DELETE CASCADE;
    ADD CONSTRAINT ops_job_result_job_id_fkey FOREIGN KEY (job_id) REFERENCES ops.ops_job_queue(job_id) ON DELETE CASCADE;




--
--
-- Name: send_fee_master send_fee_master_document_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
-- Name: send_fee_master send_fee_master_document_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.send_fee_master
ALTER TABLE ONLY ops.send_fee_master
    ADD CONSTRAINT send_fee_master_document_type_code_fkey FOREIGN KEY (document_type_code) REFERENCES ops.document_type_master(document_type_code);
    ADD CONSTRAINT send_fee_master_document_type_code_fkey FOREIGN KEY (document_type_code) REFERENCES ops.document_type_master(document_type_code);




--
--
-- Name: send_fee_master send_fee_master_resend_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
-- Name: send_fee_master send_fee_master_resend_type_code_fkey; Type: FK CONSTRAINT; Schema: ops; Owner: -
--
--


ALTER TABLE ONLY ops.send_fee_master
ALTER TABLE ONLY ops.send_fee_master
    ADD CONSTRAINT send_fee_master_resend_type_code_fkey FOREIGN KEY (resend_type_code) REFERENCES ops.resend_type_master(resend_type_code);
    ADD CONSTRAINT send_fee_master_resend_type_code_fkey FOREIGN KEY (resend_type_code) REFERENCES ops.resend_type_master(resend_type_code);




--
--
-- Name: purchase_invoice purchase_invoice_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice purchase_invoice_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice
ALTER TABLE ONLY purchase.purchase_invoice
    ADD CONSTRAINT purchase_invoice_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_invoice_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: purchase_invoice_detail purchase_invoice_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail purchase_invoice_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice_detail
ALTER TABLE ONLY purchase.purchase_invoice_detail
    ADD CONSTRAINT purchase_invoice_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT purchase_invoice_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: purchase_invoice_detail purchase_invoice_detail_purchase_invoice_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail purchase_invoice_detail_purchase_invoice_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice_detail
ALTER TABLE ONLY purchase.purchase_invoice_detail
    ADD CONSTRAINT purchase_invoice_detail_purchase_invoice_id_fkey FOREIGN KEY (purchase_invoice_id) REFERENCES purchase.purchase_invoice(purchase_invoice_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_invoice_detail_purchase_invoice_id_fkey FOREIGN KEY (purchase_invoice_id) REFERENCES purchase.purchase_invoice(purchase_invoice_id) ON DELETE CASCADE;




--
--
-- Name: purchase_invoice_detail purchase_invoice_detail_purchase_order_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail purchase_invoice_detail_purchase_order_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice_detail
ALTER TABLE ONLY purchase.purchase_invoice_detail
    ADD CONSTRAINT purchase_invoice_detail_purchase_order_detail_id_fkey FOREIGN KEY (purchase_order_detail_id) REFERENCES purchase.purchase_order_detail(purchase_order_detail_id);
    ADD CONSTRAINT purchase_invoice_detail_purchase_order_detail_id_fkey FOREIGN KEY (purchase_order_detail_id) REFERENCES purchase.purchase_order_detail(purchase_order_detail_id);




--
--
-- Name: purchase_invoice_detail purchase_invoice_detail_receipt_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice_detail purchase_invoice_detail_receipt_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice_detail
ALTER TABLE ONLY purchase.purchase_invoice_detail
    ADD CONSTRAINT purchase_invoice_detail_receipt_detail_id_fkey FOREIGN KEY (receipt_detail_id) REFERENCES purchase.purchase_receipt_detail(receipt_detail_id);
    ADD CONSTRAINT purchase_invoice_detail_receipt_detail_id_fkey FOREIGN KEY (receipt_detail_id) REFERENCES purchase.purchase_receipt_detail(receipt_detail_id);




--
--
-- Name: purchase_invoice purchase_invoice_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_invoice purchase_invoice_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_invoice
ALTER TABLE ONLY purchase.purchase_invoice
    ADD CONSTRAINT purchase_invoice_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id);
    ADD CONSTRAINT purchase_invoice_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id);




--
--
-- Name: purchase_order_detail purchase_order_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_detail purchase_order_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_detail
ALTER TABLE ONLY purchase.purchase_order_detail
    ADD CONSTRAINT purchase_order_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT purchase_order_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: purchase_order_detail purchase_order_detail_purchase_order_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_detail purchase_order_detail_purchase_order_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_detail
ALTER TABLE ONLY purchase.purchase_order_detail
    ADD CONSTRAINT purchase_order_detail_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES purchase.purchase_order_header(purchase_order_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_order_detail_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES purchase.purchase_order_header(purchase_order_id) ON DELETE CASCADE;




--
--
-- Name: purchase_order_header purchase_order_header_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_header purchase_order_header_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_header
ALTER TABLE ONLY purchase.purchase_order_header
    ADD CONSTRAINT purchase_order_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_order_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: purchase_order_header purchase_order_header_created_by_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_header purchase_order_header_created_by_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_header
ALTER TABLE ONLY purchase.purchase_order_header
    ADD CONSTRAINT purchase_order_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT purchase_order_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);




--
--
-- Name: purchase_order_header purchase_order_header_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_order_header purchase_order_header_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_order_header
ALTER TABLE ONLY purchase.purchase_order_header
    ADD CONSTRAINT purchase_order_header_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id);
    ADD CONSTRAINT purchase_order_header_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id);




--
--
-- Name: purchase_quotation purchase_quotation_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_quotation purchase_quotation_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation
ALTER TABLE ONLY purchase.purchase_quotation
    ADD CONSTRAINT purchase_quotation_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_quotation_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: purchase_quotation_detail purchase_quotation_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail purchase_quotation_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation_detail
ALTER TABLE ONLY purchase.purchase_quotation_detail
    ADD CONSTRAINT purchase_quotation_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT purchase_quotation_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: purchase_quotation_detail purchase_quotation_detail_purchase_quotation_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_quotation_detail purchase_quotation_detail_purchase_quotation_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation_detail
ALTER TABLE ONLY purchase.purchase_quotation_detail
    ADD CONSTRAINT purchase_quotation_detail_purchase_quotation_id_fkey FOREIGN KEY (purchase_quotation_id) REFERENCES purchase.purchase_quotation(purchase_quotation_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_quotation_detail_purchase_quotation_id_fkey FOREIGN KEY (purchase_quotation_id) REFERENCES purchase.purchase_quotation(purchase_quotation_id) ON DELETE CASCADE;




--
--
-- Name: purchase_quotation purchase_quotation_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_quotation purchase_quotation_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_quotation
ALTER TABLE ONLY purchase.purchase_quotation
    ADD CONSTRAINT purchase_quotation_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id);
    ADD CONSTRAINT purchase_quotation_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id);




--
--
-- Name: purchase_receipt purchase_receipt_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt purchase_receipt_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt
ALTER TABLE ONLY purchase.purchase_receipt
    ADD CONSTRAINT purchase_receipt_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_receipt_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: purchase_receipt_detail purchase_receipt_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail purchase_receipt_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt_detail
ALTER TABLE ONLY purchase.purchase_receipt_detail
    ADD CONSTRAINT purchase_receipt_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT purchase_receipt_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: purchase_receipt_detail purchase_receipt_detail_purchase_order_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail purchase_receipt_detail_purchase_order_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt_detail
ALTER TABLE ONLY purchase.purchase_receipt_detail
    ADD CONSTRAINT purchase_receipt_detail_purchase_order_detail_id_fkey FOREIGN KEY (purchase_order_detail_id) REFERENCES purchase.purchase_order_detail(purchase_order_detail_id);
    ADD CONSTRAINT purchase_receipt_detail_purchase_order_detail_id_fkey FOREIGN KEY (purchase_order_detail_id) REFERENCES purchase.purchase_order_detail(purchase_order_detail_id);




--
--
-- Name: purchase_receipt_detail purchase_receipt_detail_receipt_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt_detail purchase_receipt_detail_receipt_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt_detail
ALTER TABLE ONLY purchase.purchase_receipt_detail
    ADD CONSTRAINT purchase_receipt_detail_receipt_id_fkey FOREIGN KEY (receipt_id) REFERENCES purchase.purchase_receipt(receipt_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_receipt_detail_receipt_id_fkey FOREIGN KEY (receipt_id) REFERENCES purchase.purchase_receipt(receipt_id) ON DELETE CASCADE;




--
--
-- Name: purchase_receipt purchase_receipt_purchase_order_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt purchase_receipt_purchase_order_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt
ALTER TABLE ONLY purchase.purchase_receipt
    ADD CONSTRAINT purchase_receipt_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES purchase.purchase_order_header(purchase_order_id);
    ADD CONSTRAINT purchase_receipt_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES purchase.purchase_order_header(purchase_order_id);




--
--
-- Name: purchase_receipt purchase_receipt_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_receipt purchase_receipt_warehouse_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_receipt
ALTER TABLE ONLY purchase.purchase_receipt
    ADD CONSTRAINT purchase_receipt_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);
    ADD CONSTRAINT purchase_receipt_warehouse_id_fkey FOREIGN KEY (warehouse_id) REFERENCES inventory.warehouse(warehouse_id);




--
--
-- Name: purchase_requisition purchase_requisition_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_requisition purchase_requisition_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition
ALTER TABLE ONLY purchase.purchase_requisition
    ADD CONSTRAINT purchase_requisition_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_requisition_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: purchase_requisition_detail purchase_requisition_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail purchase_requisition_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition_detail
ALTER TABLE ONLY purchase.purchase_requisition_detail
    ADD CONSTRAINT purchase_requisition_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT purchase_requisition_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: purchase_requisition_detail purchase_requisition_detail_purchase_requisition_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_requisition_detail purchase_requisition_detail_purchase_requisition_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition_detail
ALTER TABLE ONLY purchase.purchase_requisition_detail
    ADD CONSTRAINT purchase_requisition_detail_purchase_requisition_id_fkey FOREIGN KEY (purchase_requisition_id) REFERENCES purchase.purchase_requisition(purchase_requisition_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_requisition_detail_purchase_requisition_id_fkey FOREIGN KEY (purchase_requisition_id) REFERENCES purchase.purchase_requisition(purchase_requisition_id) ON DELETE CASCADE;




--
--
-- Name: purchase_requisition purchase_requisition_requester_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_requisition purchase_requisition_requester_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_requisition
ALTER TABLE ONLY purchase.purchase_requisition
    ADD CONSTRAINT purchase_requisition_requester_id_fkey FOREIGN KEY (requester_id) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT purchase_requisition_requester_id_fkey FOREIGN KEY (requester_id) REFERENCES core.app_user(user_id);




--
--
-- Name: purchase_three_way_match purchase_three_way_match_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_three_way_match purchase_three_way_match_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_three_way_match
ALTER TABLE ONLY purchase.purchase_three_way_match
    ADD CONSTRAINT purchase_three_way_match_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT purchase_three_way_match_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: purchase_three_way_match purchase_three_way_match_purchase_invoice_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_three_way_match purchase_three_way_match_purchase_invoice_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_three_way_match
ALTER TABLE ONLY purchase.purchase_three_way_match
    ADD CONSTRAINT purchase_three_way_match_purchase_invoice_detail_id_fkey FOREIGN KEY (purchase_invoice_detail_id) REFERENCES purchase.purchase_invoice_detail(purchase_invoice_detail_id);
    ADD CONSTRAINT purchase_three_way_match_purchase_invoice_detail_id_fkey FOREIGN KEY (purchase_invoice_detail_id) REFERENCES purchase.purchase_invoice_detail(purchase_invoice_detail_id);




--
--
-- Name: purchase_three_way_match purchase_three_way_match_purchase_order_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_three_way_match purchase_three_way_match_purchase_order_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_three_way_match
ALTER TABLE ONLY purchase.purchase_three_way_match
    ADD CONSTRAINT purchase_three_way_match_purchase_order_detail_id_fkey FOREIGN KEY (purchase_order_detail_id) REFERENCES purchase.purchase_order_detail(purchase_order_detail_id);
    ADD CONSTRAINT purchase_three_way_match_purchase_order_detail_id_fkey FOREIGN KEY (purchase_order_detail_id) REFERENCES purchase.purchase_order_detail(purchase_order_detail_id);




--
--
-- Name: purchase_three_way_match purchase_three_way_match_receipt_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: purchase_three_way_match purchase_three_way_match_receipt_detail_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.purchase_three_way_match
ALTER TABLE ONLY purchase.purchase_three_way_match
    ADD CONSTRAINT purchase_three_way_match_receipt_detail_id_fkey FOREIGN KEY (receipt_detail_id) REFERENCES purchase.purchase_receipt_detail(receipt_detail_id);
    ADD CONSTRAINT purchase_three_way_match_receipt_detail_id_fkey FOREIGN KEY (receipt_detail_id) REFERENCES purchase.purchase_receipt_detail(receipt_detail_id);




--
--
-- Name: supplier_address supplier_address_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_address supplier_address_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_address
ALTER TABLE ONLY purchase.supplier_address
    ADD CONSTRAINT supplier_address_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id) ON DELETE CASCADE;
    ADD CONSTRAINT supplier_address_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id) ON DELETE CASCADE;




--
--
-- Name: supplier_contact supplier_contact_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_contact supplier_contact_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_contact
ALTER TABLE ONLY purchase.supplier_contact
    ADD CONSTRAINT supplier_contact_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id) ON DELETE CASCADE;
    ADD CONSTRAINT supplier_contact_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id) ON DELETE CASCADE;




--
--
-- Name: supplier_item_price supplier_item_price_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_item_price supplier_item_price_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_item_price
ALTER TABLE ONLY purchase.supplier_item_price
    ADD CONSTRAINT supplier_item_price_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT supplier_item_price_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: supplier_item_price supplier_item_price_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_item_price supplier_item_price_item_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_item_price
ALTER TABLE ONLY purchase.supplier_item_price
    ADD CONSTRAINT supplier_item_price_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT supplier_item_price_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: supplier_item_price supplier_item_price_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_item_price supplier_item_price_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_item_price
ALTER TABLE ONLY purchase.supplier_item_price
    ADD CONSTRAINT supplier_item_price_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id);
    ADD CONSTRAINT supplier_item_price_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id);




--
--
-- Name: supplier_master supplier_master_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_master supplier_master_company_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_master
ALTER TABLE ONLY purchase.supplier_master
    ADD CONSTRAINT supplier_master_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT supplier_master_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: supplier_payment_term supplier_payment_term_payment_method_code_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_payment_term supplier_payment_term_payment_method_code_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_payment_term
ALTER TABLE ONLY purchase.supplier_payment_term
    ADD CONSTRAINT supplier_payment_term_payment_method_code_fkey FOREIGN KEY (payment_method_code) REFERENCES core.payment_method(payment_method_code);
    ADD CONSTRAINT supplier_payment_term_payment_method_code_fkey FOREIGN KEY (payment_method_code) REFERENCES core.payment_method(payment_method_code);




--
--
-- Name: supplier_payment_term supplier_payment_term_payment_term_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_payment_term supplier_payment_term_payment_term_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_payment_term
ALTER TABLE ONLY purchase.supplier_payment_term
    ADD CONSTRAINT supplier_payment_term_payment_term_id_fkey FOREIGN KEY (payment_term_id) REFERENCES core.payment_term(payment_term_id);
    ADD CONSTRAINT supplier_payment_term_payment_term_id_fkey FOREIGN KEY (payment_term_id) REFERENCES core.payment_term(payment_term_id);




--
--
-- Name: supplier_payment_term supplier_payment_term_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
-- Name: supplier_payment_term supplier_payment_term_supplier_id_fkey; Type: FK CONSTRAINT; Schema: purchase; Owner: -
--
--


ALTER TABLE ONLY purchase.supplier_payment_term
ALTER TABLE ONLY purchase.supplier_payment_term
    ADD CONSTRAINT supplier_payment_term_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id) ON DELETE CASCADE;
    ADD CONSTRAINT supplier_payment_term_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES purchase.supplier_master(supplier_id) ON DELETE CASCADE;




--
--
-- Name: billing_detail billing_detail_billing_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_detail billing_detail_billing_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_detail
ALTER TABLE ONLY sales.billing_detail
    ADD CONSTRAINT billing_detail_billing_id_fkey FOREIGN KEY (billing_id) REFERENCES sales.billing_header(billing_id) ON DELETE CASCADE;
    ADD CONSTRAINT billing_detail_billing_id_fkey FOREIGN KEY (billing_id) REFERENCES sales.billing_header(billing_id) ON DELETE CASCADE;




--
--
-- Name: billing_detail billing_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_detail billing_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_detail
ALTER TABLE ONLY sales.billing_detail
    ADD CONSTRAINT billing_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT billing_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: billing_header billing_header_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_header billing_header_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_header
ALTER TABLE ONLY sales.billing_header
    ADD CONSTRAINT billing_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT billing_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: billing_header billing_header_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_header billing_header_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_header
ALTER TABLE ONLY sales.billing_header
    ADD CONSTRAINT billing_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT billing_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);




--
--
-- Name: billing_header billing_header_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: billing_header billing_header_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.billing_header
ALTER TABLE ONLY sales.billing_header
    ADD CONSTRAINT billing_header_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id);
    ADD CONSTRAINT billing_header_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id);




--
--
-- Name: customer_address customer_address_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_address customer_address_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_address
ALTER TABLE ONLY sales.customer_address
    ADD CONSTRAINT customer_address_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id) ON DELETE CASCADE;
    ADD CONSTRAINT customer_address_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id) ON DELETE CASCADE;




--
--
-- Name: customer customer_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: customer customer_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer
ALTER TABLE ONLY sales.customer
    ADD CONSTRAINT customer_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT customer_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: customer_contact customer_contact_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_contact customer_contact_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_contact
ALTER TABLE ONLY sales.customer_contact
    ADD CONSTRAINT customer_contact_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id) ON DELETE CASCADE;
    ADD CONSTRAINT customer_contact_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id) ON DELETE CASCADE;




--
--
-- Name: customer_payment_term customer_payment_term_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_payment_term customer_payment_term_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_payment_term
ALTER TABLE ONLY sales.customer_payment_term
    ADD CONSTRAINT customer_payment_term_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id) ON DELETE CASCADE;
    ADD CONSTRAINT customer_payment_term_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id) ON DELETE CASCADE;




--
--
-- Name: customer_payment_term customer_payment_term_payment_method_code_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_payment_term customer_payment_term_payment_method_code_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_payment_term
ALTER TABLE ONLY sales.customer_payment_term
    ADD CONSTRAINT customer_payment_term_payment_method_code_fkey FOREIGN KEY (payment_method_code) REFERENCES core.payment_method(payment_method_code);
    ADD CONSTRAINT customer_payment_term_payment_method_code_fkey FOREIGN KEY (payment_method_code) REFERENCES core.payment_method(payment_method_code);




--
--
-- Name: customer_payment_term customer_payment_term_payment_term_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: customer_payment_term customer_payment_term_payment_term_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.customer_payment_term
ALTER TABLE ONLY sales.customer_payment_term
    ADD CONSTRAINT customer_payment_term_payment_term_id_fkey FOREIGN KEY (payment_term_id) REFERENCES core.payment_term(payment_term_id);
    ADD CONSTRAINT customer_payment_term_payment_term_id_fkey FOREIGN KEY (payment_term_id) REFERENCES core.payment_term(payment_term_id);




--
--
-- Name: invoice_pdf invoice_pdf_billing_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: invoice_pdf invoice_pdf_billing_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.invoice_pdf
ALTER TABLE ONLY sales.invoice_pdf
    ADD CONSTRAINT invoice_pdf_billing_id_fkey FOREIGN KEY (billing_id) REFERENCES sales.billing_header(billing_id) ON DELETE CASCADE;
    ADD CONSTRAINT invoice_pdf_billing_id_fkey FOREIGN KEY (billing_id) REFERENCES sales.billing_header(billing_id) ON DELETE CASCADE;




--
--
-- Name: invoice_pdf invoice_pdf_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: invoice_pdf invoice_pdf_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.invoice_pdf
ALTER TABLE ONLY sales.invoice_pdf
    ADD CONSTRAINT invoice_pdf_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT invoice_pdf_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: item_category item_category_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: item_category item_category_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_category
ALTER TABLE ONLY sales.item_category
    ADD CONSTRAINT item_category_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT item_category_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: item_category item_category_parent_category_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: item_category item_category_parent_category_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_category
ALTER TABLE ONLY sales.item_category
    ADD CONSTRAINT item_category_parent_category_id_fkey FOREIGN KEY (parent_category_id) REFERENCES sales.item_category(item_category_id);
    ADD CONSTRAINT item_category_parent_category_id_fkey FOREIGN KEY (parent_category_id) REFERENCES sales.item_category(item_category_id);




--
--
-- Name: item item_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: item item_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item
ALTER TABLE ONLY sales.item
    ADD CONSTRAINT item_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT item_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: item item_item_category_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: item item_item_category_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item
ALTER TABLE ONLY sales.item
    ADD CONSTRAINT item_item_category_id_fkey FOREIGN KEY (item_category_id) REFERENCES sales.item_category(item_category_id);
    ADD CONSTRAINT item_item_category_id_fkey FOREIGN KEY (item_category_id) REFERENCES sales.item_category(item_category_id);




--
--
-- Name: item_price_master item_price_master_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: item_price_master item_price_master_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_price_master
ALTER TABLE ONLY sales.item_price_master
    ADD CONSTRAINT item_price_master_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT item_price_master_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: item_price_master item_price_master_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: item_price_master item_price_master_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_price_master
ALTER TABLE ONLY sales.item_price_master
    ADD CONSTRAINT item_price_master_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id) ON DELETE CASCADE;
    ADD CONSTRAINT item_price_master_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id) ON DELETE CASCADE;




--
--
-- Name: item_uom item_uom_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: item_uom item_uom_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_uom
ALTER TABLE ONLY sales.item_uom
    ADD CONSTRAINT item_uom_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id) ON DELETE CASCADE;
    ADD CONSTRAINT item_uom_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id) ON DELETE CASCADE;




--
--
-- Name: item_uom item_uom_uom_code_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: item_uom item_uom_uom_code_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.item_uom
ALTER TABLE ONLY sales.item_uom
    ADD CONSTRAINT item_uom_uom_code_fkey FOREIGN KEY (uom_code) REFERENCES core.uom(uom_code);
    ADD CONSTRAINT item_uom_uom_code_fkey FOREIGN KEY (uom_code) REFERENCES core.uom(uom_code);




--
--
-- Name: order_detail order_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: order_detail order_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_detail
ALTER TABLE ONLY sales.order_detail
    ADD CONSTRAINT order_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT order_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: order_detail order_detail_order_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: order_detail order_detail_order_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_detail
ALTER TABLE ONLY sales.order_detail
    ADD CONSTRAINT order_detail_order_id_fkey FOREIGN KEY (order_id) REFERENCES sales.order_header(order_id) ON DELETE CASCADE;
    ADD CONSTRAINT order_detail_order_id_fkey FOREIGN KEY (order_id) REFERENCES sales.order_header(order_id) ON DELETE CASCADE;




--
--
-- Name: order_header order_header_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: order_header order_header_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_header
ALTER TABLE ONLY sales.order_header
    ADD CONSTRAINT order_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT order_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: order_header order_header_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: order_header order_header_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_header
ALTER TABLE ONLY sales.order_header
    ADD CONSTRAINT order_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT order_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);




--
--
-- Name: order_header order_header_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: order_header order_header_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.order_header
ALTER TABLE ONLY sales.order_header
    ADD CONSTRAINT order_header_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id);
    ADD CONSTRAINT order_header_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id);




--
--
-- Name: return_detail return_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: return_detail return_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_detail
ALTER TABLE ONLY sales.return_detail
    ADD CONSTRAINT return_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT return_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: return_detail return_detail_return_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: return_detail return_detail_return_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_detail
ALTER TABLE ONLY sales.return_detail
    ADD CONSTRAINT return_detail_return_id_fkey FOREIGN KEY (return_id) REFERENCES sales.return_header(return_id) ON DELETE CASCADE;
    ADD CONSTRAINT return_detail_return_id_fkey FOREIGN KEY (return_id) REFERENCES sales.return_header(return_id) ON DELETE CASCADE;




--
--
-- Name: return_header return_header_billing_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: return_header return_header_billing_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_header
ALTER TABLE ONLY sales.return_header
    ADD CONSTRAINT return_header_billing_id_fkey FOREIGN KEY (billing_id) REFERENCES sales.billing_header(billing_id);
    ADD CONSTRAINT return_header_billing_id_fkey FOREIGN KEY (billing_id) REFERENCES sales.billing_header(billing_id);




--
--
-- Name: return_header return_header_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: return_header return_header_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_header
ALTER TABLE ONLY sales.return_header
    ADD CONSTRAINT return_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT return_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: return_header return_header_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: return_header return_header_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.return_header
ALTER TABLE ONLY sales.return_header
    ADD CONSTRAINT return_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT return_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);




--
--
-- Name: sales_quotation sales_quotation_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation sales_quotation_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation
ALTER TABLE ONLY sales.sales_quotation
    ADD CONSTRAINT sales_quotation_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT sales_quotation_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: sales_quotation sales_quotation_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation sales_quotation_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation
ALTER TABLE ONLY sales.sales_quotation
    ADD CONSTRAINT sales_quotation_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT sales_quotation_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);




--
--
-- Name: sales_quotation sales_quotation_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation sales_quotation_customer_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation
ALTER TABLE ONLY sales.sales_quotation
    ADD CONSTRAINT sales_quotation_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id);
    ADD CONSTRAINT sales_quotation_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES sales.customer(customer_id);




--
--
-- Name: sales_quotation_detail sales_quotation_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation_detail sales_quotation_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation_detail
ALTER TABLE ONLY sales.sales_quotation_detail
    ADD CONSTRAINT sales_quotation_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT sales_quotation_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: sales_quotation_detail sales_quotation_detail_sales_quotation_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: sales_quotation_detail sales_quotation_detail_sales_quotation_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.sales_quotation_detail
ALTER TABLE ONLY sales.sales_quotation_detail
    ADD CONSTRAINT sales_quotation_detail_sales_quotation_id_fkey FOREIGN KEY (sales_quotation_id) REFERENCES sales.sales_quotation(sales_quotation_id) ON DELETE CASCADE;
    ADD CONSTRAINT sales_quotation_detail_sales_quotation_id_fkey FOREIGN KEY (sales_quotation_id) REFERENCES sales.sales_quotation(sales_quotation_id) ON DELETE CASCADE;




--
--
-- Name: shipping_detail shipping_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_detail shipping_detail_item_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_detail
ALTER TABLE ONLY sales.shipping_detail
    ADD CONSTRAINT shipping_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);
    ADD CONSTRAINT shipping_detail_item_id_fkey FOREIGN KEY (item_id) REFERENCES sales.item(item_id);




--
--
-- Name: shipping_detail shipping_detail_order_detail_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_detail shipping_detail_order_detail_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_detail
ALTER TABLE ONLY sales.shipping_detail
    ADD CONSTRAINT shipping_detail_order_detail_id_fkey FOREIGN KEY (order_detail_id) REFERENCES sales.order_detail(order_detail_id);
    ADD CONSTRAINT shipping_detail_order_detail_id_fkey FOREIGN KEY (order_detail_id) REFERENCES sales.order_detail(order_detail_id);




--
--
-- Name: shipping_detail shipping_detail_shipping_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_detail shipping_detail_shipping_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_detail
ALTER TABLE ONLY sales.shipping_detail
    ADD CONSTRAINT shipping_detail_shipping_id_fkey FOREIGN KEY (shipping_id) REFERENCES sales.shipping_header(shipping_id) ON DELETE CASCADE;
    ADD CONSTRAINT shipping_detail_shipping_id_fkey FOREIGN KEY (shipping_id) REFERENCES sales.shipping_header(shipping_id) ON DELETE CASCADE;




--
--
-- Name: shipping_header shipping_header_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_header shipping_header_company_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_header
ALTER TABLE ONLY sales.shipping_header
    ADD CONSTRAINT shipping_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;
    ADD CONSTRAINT shipping_header_company_id_fkey FOREIGN KEY (company_id) REFERENCES core.company(company_id) ON DELETE CASCADE;




--
--
-- Name: shipping_header shipping_header_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_header shipping_header_created_by_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_header
ALTER TABLE ONLY sales.shipping_header
    ADD CONSTRAINT shipping_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);
    ADD CONSTRAINT shipping_header_created_by_fkey FOREIGN KEY (created_by) REFERENCES core.app_user(user_id);




--
--
-- Name: shipping_header shipping_header_order_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
-- Name: shipping_header shipping_header_order_id_fkey; Type: FK CONSTRAINT; Schema: sales; Owner: -
--
--


ALTER TABLE ONLY sales.shipping_header
ALTER TABLE ONLY sales.shipping_header
    ADD CONSTRAINT shipping_header_order_id_fkey FOREIGN KEY (order_id) REFERENCES sales.order_header(order_id);
    ADD CONSTRAINT shipping_header_order_id_fkey FOREIGN KEY (order_id) REFERENCES sales.order_header(order_id);




--
--
-- Name: objects objects_bucketId_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
-- Name: objects objects_bucketId_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT "objects_bucketId_fkey" FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);
    ADD CONSTRAINT "objects_bucketId_fkey" FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);




--
--
-- Name: prefixes prefixes_bucketId_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
-- Name: prefixes prefixes_bucketId_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT "prefixes_bucketId_fkey" FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);
    ADD CONSTRAINT "prefixes_bucketId_fkey" FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);




--
--
-- Name: s3_multipart_uploads s3_multipart_uploads_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
-- Name: s3_multipart_uploads s3_multipart_uploads_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT s3_multipart_uploads_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);
    ADD CONSTRAINT s3_multipart_uploads_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);




--
--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT s3_multipart_uploads_parts_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);
    ADD CONSTRAINT s3_multipart_uploads_parts_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);




--
--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_upload_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_upload_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT s3_multipart_uploads_parts_upload_id_fkey FOREIGN KEY (upload_id) REFERENCES storage.s3_multipart_uploads(id) ON DELETE CASCADE;
    ADD CONSTRAINT s3_multipart_uploads_parts_upload_id_fkey FOREIGN KEY (upload_id) REFERENCES storage.s3_multipart_uploads(id) ON DELETE CASCADE;




--
--
-- Name: vector_indexes vector_indexes_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
-- Name: vector_indexes vector_indexes_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--
--


    ADD CONSTRAINT vector_indexes_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets_vectors(id);
    ADD CONSTRAINT vector_indexes_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets_vectors(id);




--
--
-- Name: action_approval_map action_approval_map_approval_flow_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: action_approval_map action_approval_map_approval_flow_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.action_approval_map
ALTER TABLE ONLY system.action_approval_map
    ADD CONSTRAINT action_approval_map_approval_flow_code_fkey FOREIGN KEY (approval_flow_code) REFERENCES system.approval_flow_def(approval_flow_code);
    ADD CONSTRAINT action_approval_map_approval_flow_code_fkey FOREIGN KEY (approval_flow_code) REFERENCES system.approval_flow_def(approval_flow_code);




--
--
-- Name: ai_task ai_task_agent_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: ai_task ai_task_agent_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_task
ALTER TABLE ONLY system.ai_task
    ADD CONSTRAINT ai_task_agent_code_fkey FOREIGN KEY (agent_code) REFERENCES system.ai_agent(agent_code);
    ADD CONSTRAINT ai_task_agent_code_fkey FOREIGN KEY (agent_code) REFERENCES system.ai_agent(agent_code);




--
--
-- Name: ai_task_run ai_task_run_task_id_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: ai_task_run ai_task_run_task_id_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.ai_task_run
ALTER TABLE ONLY system.ai_task_run
    ADD CONSTRAINT ai_task_run_task_id_fkey FOREIGN KEY (task_id) REFERENCES system.ai_task(task_id) ON DELETE CASCADE;
    ADD CONSTRAINT ai_task_run_task_id_fkey FOREIGN KEY (task_id) REFERENCES system.ai_task(task_id) ON DELETE CASCADE;




--
--
-- Name: approval_action_log approval_action_log_approval_request_id_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: approval_action_log approval_action_log_approval_request_id_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_action_log
ALTER TABLE ONLY system.approval_action_log
    ADD CONSTRAINT approval_action_log_approval_request_id_fkey FOREIGN KEY (approval_request_id) REFERENCES system.approval_request(approval_request_id);
    ADD CONSTRAINT approval_action_log_approval_request_id_fkey FOREIGN KEY (approval_request_id) REFERENCES system.approval_request(approval_request_id);




--
--
-- Name: approval_exec_map approval_exec_map_command_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: approval_exec_map approval_exec_map_command_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_exec_map
ALTER TABLE ONLY system.approval_exec_map
    ADD CONSTRAINT approval_exec_map_command_code_fkey FOREIGN KEY (command_code) REFERENCES system.exec_command(command_code);
    ADD CONSTRAINT approval_exec_map_command_code_fkey FOREIGN KEY (command_code) REFERENCES system.exec_command(command_code);




--
--
-- Name: approval_step_def approval_step_def_approval_flow_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: approval_step_def approval_step_def_approval_flow_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.approval_step_def
ALTER TABLE ONLY system.approval_step_def
    ADD CONSTRAINT approval_step_def_approval_flow_code_fkey FOREIGN KEY (approval_flow_code) REFERENCES system.approval_flow_def(approval_flow_code);
    ADD CONSTRAINT approval_step_def_approval_flow_code_fkey FOREIGN KEY (approval_flow_code) REFERENCES system.approval_flow_def(approval_flow_code);




--
--
-- Name: exec_run_request exec_run_request_command_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: exec_run_request exec_run_request_command_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.exec_run_request
ALTER TABLE ONLY system.exec_run_request
    ADD CONSTRAINT exec_run_request_command_code_fkey FOREIGN KEY (command_code) REFERENCES system.exec_command(command_code);
    ADD CONSTRAINT exec_run_request_command_code_fkey FOREIGN KEY (command_code) REFERENCES system.exec_command(command_code);




--
--
-- Name: business_ops_map fk_business_ops_document; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: business_ops_map fk_business_ops_document; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.business_ops_map
ALTER TABLE ONLY system.business_ops_map
    ADD CONSTRAINT fk_business_ops_document FOREIGN KEY (document_type_code) REFERENCES ops.document_type_master(document_type_code);
    ADD CONSTRAINT fk_business_ops_document FOREIGN KEY (document_type_code) REFERENCES ops.document_type_master(document_type_code);




--
--
-- Name: function_def function_def_module_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: function_def function_def_module_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.function_def
ALTER TABLE ONLY system.function_def
    ADD CONSTRAINT function_def_module_code_fkey FOREIGN KEY (module_code) REFERENCES system.module_def(module_code);
    ADD CONSTRAINT function_def_module_code_fkey FOREIGN KEY (module_code) REFERENCES system.module_def(module_code);




--
--
-- Name: loop_config loop_config_command_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: loop_config loop_config_command_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.loop_config
ALTER TABLE ONLY system.loop_config
    ADD CONSTRAINT loop_config_command_code_fkey FOREIGN KEY (command_code) REFERENCES system.exec_command(command_code);
    ADD CONSTRAINT loop_config_command_code_fkey FOREIGN KEY (command_code) REFERENCES system.exec_command(command_code);




--
--
-- Name: notification_subscription notification_subscription_endpoint_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: notification_subscription notification_subscription_endpoint_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.notification_subscription
ALTER TABLE ONLY system.notification_subscription
    ADD CONSTRAINT notification_subscription_endpoint_code_fkey FOREIGN KEY (endpoint_code) REFERENCES system.notification_endpoint(endpoint_code) ON DELETE CASCADE;
    ADD CONSTRAINT notification_subscription_endpoint_code_fkey FOREIGN KEY (endpoint_code) REFERENCES system.notification_endpoint(endpoint_code) ON DELETE CASCADE;




--
--
-- Name: operation_log operation_log_operation_type_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: operation_log operation_log_operation_type_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.operation_log
ALTER TABLE ONLY system.operation_log
    ADD CONSTRAINT operation_log_operation_type_fkey FOREIGN KEY (operation_type) REFERENCES system.operation_type_def(operation_type);
    ADD CONSTRAINT operation_log_operation_type_fkey FOREIGN KEY (operation_type) REFERENCES system.operation_type_def(operation_type);




--
--
-- Name: operation_log operation_log_role_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: operation_log operation_log_role_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.operation_log
ALTER TABLE ONLY system.operation_log
    ADD CONSTRAINT operation_log_role_code_fkey FOREIGN KEY (role_code) REFERENCES system.role_def(role_code);
    ADD CONSTRAINT operation_log_role_code_fkey FOREIGN KEY (role_code) REFERENCES system.role_def(role_code);




--
--
-- Name: operation_log operation_log_screen_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: operation_log operation_log_screen_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.operation_log
ALTER TABLE ONLY system.operation_log
    ADD CONSTRAINT operation_log_screen_code_fkey FOREIGN KEY (screen_code) REFERENCES system.screen_master(screen_code);
    ADD CONSTRAINT operation_log_screen_code_fkey FOREIGN KEY (screen_code) REFERENCES system.screen_master(screen_code);




--
--
-- Name: operation_log operation_log_session_id_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: operation_log operation_log_session_id_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.operation_log
ALTER TABLE ONLY system.operation_log
    ADD CONSTRAINT operation_log_session_id_fkey FOREIGN KEY (session_id) REFERENCES system.db_session(session_id);
    ADD CONSTRAINT operation_log_session_id_fkey FOREIGN KEY (session_id) REFERENCES system.db_session(session_id);




--
--
-- Name: role_screen_permission role_screen_permission_role_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: role_screen_permission role_screen_permission_role_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.role_screen_permission
ALTER TABLE ONLY system.role_screen_permission
    ADD CONSTRAINT role_screen_permission_role_code_fkey FOREIGN KEY (role_code) REFERENCES system.role_def(role_code);
    ADD CONSTRAINT role_screen_permission_role_code_fkey FOREIGN KEY (role_code) REFERENCES system.role_def(role_code);




--
--
-- Name: role_screen_permission role_screen_permission_screen_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
-- Name: role_screen_permission role_screen_permission_screen_code_fkey; Type: FK CONSTRAINT; Schema: system; Owner: -
--
--


ALTER TABLE ONLY system.role_screen_permission
ALTER TABLE ONLY system.role_screen_permission
    ADD CONSTRAINT role_screen_permission_screen_code_fkey FOREIGN KEY (screen_code) REFERENCES system.screen_master(screen_code);
    ADD CONSTRAINT role_screen_permission_screen_code_fkey FOREIGN KEY (screen_code) REFERENCES system.screen_master(screen_code);




--
--
-- Name: company_license company_license_company_id_fkey; Type: FK CONSTRAINT; Schema: tenant; Owner: -
-- Name: company_license company_license_company_id_fkey; Type: FK CONSTRAINT; Schema: tenant; Owner: -
--
--


ALTER TABLE ONLY tenant.company_license
ALTER TABLE ONLY tenant.company_license
    ADD CONSTRAINT company_license_company_id_fkey FOREIGN KEY (company_id) REFERENCES tenant.company(company_id);
    ADD CONSTRAINT company_license_company_id_fkey FOREIGN KEY (company_id) REFERENCES tenant.company(company_id);




--
--
-- Name: company_license company_license_license_code_fkey; Type: FK CONSTRAINT; Schema: tenant; Owner: -
-- Name: company_license company_license_license_code_fkey; Type: FK CONSTRAINT; Schema: tenant; Owner: -
--
--


ALTER TABLE ONLY tenant.company_license
ALTER TABLE ONLY tenant.company_license
    ADD CONSTRAINT company_license_license_code_fkey FOREIGN KEY (license_code) REFERENCES tenant.license_master(license_code);
    ADD CONSTRAINT company_license_license_code_fkey FOREIGN KEY (license_code) REFERENCES tenant.license_master(license_code);




--
--
-- Name: audit_alert_ai_judgement; Type: ROW SECURITY; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement; Type: ROW SECURITY; Schema: analytics; Owner: -
--
--




--
--
-- Name: fact_metric; Type: ROW SECURITY; Schema: analytics; Owner: -
-- Name: fact_metric; Type: ROW SECURITY; Schema: analytics; Owner: -
--
--




--
--
-- Name: fact_metric p_analytics_fact_metric_admin_bypass; Type: POLICY; Schema: analytics; Owner: -
-- Name: fact_metric p_analytics_fact_metric_admin_bypass; Type: POLICY; Schema: analytics; Owner: -
--
--






--
--
-- Name: fact_metric p_analytics_fact_metric_company; Type: POLICY; Schema: analytics; Owner: -
-- Name: fact_metric p_analytics_fact_metric_company; Type: POLICY; Schema: analytics; Owner: -
--
--






--
--
-- Name: audit_alert_ai_judgement p_judge_select; Type: POLICY; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement p_judge_select; Type: POLICY; Schema: analytics; Owner: -
--
--






--
--
-- Name: audit_alert_ai_judgement p_judge_update_admin; Type: POLICY; Schema: analytics; Owner: -
-- Name: audit_alert_ai_judgement p_judge_update_admin; Type: POLICY; Schema: analytics; Owner: -
--
--






--
--
-- Name: approval_log; Type: ROW SECURITY; Schema: audit; Owner: -
-- Name: approval_log; Type: ROW SECURITY; Schema: audit; Owner: -
--
--




--
--
-- Name: approval_request; Type: ROW SECURITY; Schema: audit; Owner: -
-- Name: approval_request; Type: ROW SECURITY; Schema: audit; Owner: -
--
--




--
--
-- Name: audit_event; Type: ROW SECURITY; Schema: audit; Owner: -
-- Name: audit_event; Type: ROW SECURITY; Schema: audit; Owner: -
--
--




--
--
-- Name: entity_status_history; Type: ROW SECURITY; Schema: audit; Owner: -
-- Name: entity_status_history; Type: ROW SECURITY; Schema: audit; Owner: -
--
--




--
--
-- Name: exec_audit_event; Type: ROW SECURITY; Schema: audit; Owner: -
-- Name: exec_audit_event; Type: ROW SECURITY; Schema: audit; Owner: -
--
--




--
--
-- Name: ng_event; Type: ROW SECURITY; Schema: audit; Owner: -
-- Name: ng_event; Type: ROW SECURITY; Schema: audit; Owner: -
--
--




--
--
-- Name: approval_log p_al_insert_approver; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_log p_al_insert_approver; Type: POLICY; Schema: audit; Owner: -
--
--


   FROM (audit.approval_request ar
   FROM (audit.approval_request ar
     JOIN approval.approver ap ON (((ap.company_id = ar.company_id) AND (ap.user_id = auth.uid()))))
     JOIN approval.approver ap ON (((ap.company_id = ar.company_id) AND (ap.user_id = auth.uid()))))
  WHERE ((ar.request_id = approval_log.approval_request_id) AND (ar.company_id = public.my_company_id())))));
  WHERE ((ar.request_id = approval_log.approval_request_id) AND (ar.company_id = public.my_company_id())))));




--
--
-- Name: approval_log p_al_select_company; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_log p_al_select_company; Type: POLICY; Schema: audit; Owner: -
--
--


   FROM audit.approval_request ar
   FROM audit.approval_request ar
  WHERE ((ar.request_id = approval_log.approval_request_id) AND (ar.company_id = public.my_company_id())))));
  WHERE ((ar.request_id = approval_log.approval_request_id) AND (ar.company_id = public.my_company_id())))));




--
--
-- Name: approval_log p_approval_log_company; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_log p_approval_log_company; Type: POLICY; Schema: audit; Owner: -
--
--


   FROM audit.approval_request r
   FROM audit.approval_request r
  WHERE ((r.request_id = approval_log.approval_request_id) AND (r.company_id = audit.current_company_id()))))) WITH CHECK ((EXISTS ( SELECT 1
  WHERE ((r.request_id = approval_log.approval_request_id) AND (r.company_id = audit.current_company_id()))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM audit.approval_request r
   FROM audit.approval_request r
  WHERE ((r.request_id = approval_log.approval_request_id) AND (r.company_id = audit.current_company_id())))));
  WHERE ((r.request_id = approval_log.approval_request_id) AND (r.company_id = audit.current_company_id())))));




--
--
-- Name: approval_request p_approval_request_approver_update; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_request p_approval_request_approver_update; Type: POLICY; Schema: audit; Owner: -
--
--






--
--
-- Name: approval_request p_approval_request_company; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_request p_approval_request_company; Type: POLICY; Schema: audit; Owner: -
--
--






--
--
-- Name: approval_request p_approval_request_insert; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_request p_approval_request_insert; Type: POLICY; Schema: audit; Owner: -
--
--






--
--
-- Name: approval_request p_ar_insert_company; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_request p_ar_insert_company; Type: POLICY; Schema: audit; Owner: -
--
--






--
--
-- Name: approval_request p_ar_select_company; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_request p_ar_select_company; Type: POLICY; Schema: audit; Owner: -
--
--






--
--
-- Name: approval_request p_ar_update_approver; Type: POLICY; Schema: audit; Owner: -
-- Name: approval_request p_ar_update_approver; Type: POLICY; Schema: audit; Owner: -
--
--


   FROM approval.approver ap
   FROM approval.approver ap
  WHERE ((ap.company_id = approval_request.company_id) AND (ap.user_id = auth.uid())))))) WITH CHECK ((status = ANY (ARRAY['approved'::text, 'rejected'::text])));
  WHERE ((ap.company_id = approval_request.company_id) AND (ap.user_id = auth.uid())))))) WITH CHECK ((status = ANY (ARRAY['approved'::text, 'rejected'::text])));




--
--
-- Name: exec_audit_event p_audit_exec_audit_event_owner; Type: POLICY; Schema: audit; Owner: -
-- Name: exec_audit_event p_audit_exec_audit_event_owner; Type: POLICY; Schema: audit; Owner: -
--
--






--
--
-- Name: entity_status_history p_entity_status_history_company; Type: POLICY; Schema: audit; Owner: -
-- Name: entity_status_history p_entity_status_history_company; Type: POLICY; Schema: audit; Owner: -
--
--






--
--
-- Name: ng_event p_ng_event_company; Type: POLICY; Schema: audit; Owner: -
-- Name: ng_event p_ng_event_company; Type: POLICY; Schema: audit; Owner: -
--
--






--
--
-- Name: audit_log_entries; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: audit_log_entries; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: flow_state; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: flow_state; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: identities; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: identities; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: instances; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: instances; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: mfa_amr_claims; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: mfa_amr_claims; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: mfa_challenges; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: mfa_challenges; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: mfa_factors; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: mfa_factors; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: one_time_tokens; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: one_time_tokens; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: refresh_tokens; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: refresh_tokens; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: saml_providers; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: saml_providers; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: saml_relay_states; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: saml_relay_states; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: schema_migrations; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: schema_migrations; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: sessions; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: sessions; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: sso_domains; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: sso_domains; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: sso_providers; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: sso_providers; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: users; Type: ROW SECURITY; Schema: auth; Owner: -
-- Name: users; Type: ROW SECURITY; Schema: auth; Owner: -
--
--




--
--
-- Name: audit_event; Type: ROW SECURITY; Schema: compliance; Owner: -
-- Name: audit_event; Type: ROW SECURITY; Schema: compliance; Owner: -
--
--




--
--
-- Name: audit_event p_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
-- Name: audit_event p_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
--
--






--
--
-- Name: audit_action p_compliance_audit_action_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
-- Name: audit_action p_compliance_audit_action_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
--
--






--
--
-- Name: audit_event p_compliance_audit_event_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
-- Name: audit_event p_compliance_audit_event_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
--
--






--
--
-- Name: audit_event p_compliance_audit_event_company; Type: POLICY; Schema: compliance; Owner: -
-- Name: audit_event p_compliance_audit_event_company; Type: POLICY; Schema: compliance; Owner: -
--
--






--
--
-- Name: audit_issue p_compliance_audit_issue_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
-- Name: audit_issue p_compliance_audit_issue_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
--
--






--
--
-- Name: iso_clause p_compliance_iso_clause_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
-- Name: iso_clause p_compliance_iso_clause_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
--
--






--
--
-- Name: iso_standard p_compliance_iso_standard_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
-- Name: iso_standard p_compliance_iso_standard_admin_bypass; Type: POLICY; Schema: compliance; Owner: -
--
--






--
--
-- Name: accounting_period; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: accounting_period; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: accounts; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: accounts; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: app_user; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: app_user; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_column_weight; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_column_weight; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_impact_rule; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_impact_rule; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail_2025_12; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail_2025_12; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail_2026_01; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail_2026_01; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail_2026_02; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail_2026_02; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail_2026_03; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail_2026_03; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail_2026_04; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail_2026_04; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail_2026_05; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail_2026_05; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail_2026_06; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail_2026_06; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: audit_trail_2026_07; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: audit_trail_2026_07; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: company; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: company; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: company_license; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: company_license; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: company_permission; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: company_permission; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: company_users; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: company_users; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: document_sequence; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: document_sequence; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: journal_entries; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: journal_entries; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: accounting_period p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: accounting_period p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: accounts p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: accounts p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: app_user p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: app_user p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_column_weight p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_column_weight p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_impact_rule p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_impact_rule p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2025_12 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2025_12 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_01 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_01 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_02 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_02 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_03 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_03 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_04 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_04 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_05 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_05 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_06 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_06 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_07 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_07 p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: company p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_license p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: company_license p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_permission p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: company_permission p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_users p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: company_users p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: document_sequence p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: document_sequence p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: journal_entries p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: journal_entries p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: permission_groups p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: permission_groups p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: permissions p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: permissions p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: posting_profile p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: posting_profile p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: status_history p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: status_history p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: sync_queue p_admin_bypass; Type: POLICY; Schema: core; Owner: -
-- Name: sync_queue p_admin_bypass; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail p_audit_trail_read; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail p_audit_trail_read; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: accounting_period p_core_accounting_period_company; Type: POLICY; Schema: core; Owner: -
-- Name: accounting_period p_core_accounting_period_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: accounting_period p_core_accounting_period_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: accounting_period p_core_accounting_period_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: accounts p_core_accounts_company; Type: POLICY; Schema: core; Owner: -
-- Name: accounts p_core_accounts_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: accounts p_core_accounts_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: accounts p_core_accounts_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: app_user p_core_app_user_company; Type: POLICY; Schema: core; Owner: -
-- Name: app_user p_core_app_user_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: app_user p_core_app_user_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: app_user p_core_app_user_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_column_weight p_core_audit_column_weight_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_column_weight p_core_audit_column_weight_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_column_weight p_core_audit_column_weight_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_column_weight p_core_audit_column_weight_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_impact_rule p_core_audit_impact_rule_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_impact_rule p_core_audit_impact_rule_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_impact_rule p_core_audit_impact_rule_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_impact_rule p_core_audit_impact_rule_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2025_12 p_core_audit_trail_2025_12_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2025_12 p_core_audit_trail_2025_12_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2025_12 p_core_audit_trail_2025_12_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2025_12 p_core_audit_trail_2025_12_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_01 p_core_audit_trail_2026_01_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_01 p_core_audit_trail_2026_01_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_01 p_core_audit_trail_2026_01_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_01 p_core_audit_trail_2026_01_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_02 p_core_audit_trail_2026_02_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_02 p_core_audit_trail_2026_02_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_02 p_core_audit_trail_2026_02_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_02 p_core_audit_trail_2026_02_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_03 p_core_audit_trail_2026_03_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_03 p_core_audit_trail_2026_03_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_03 p_core_audit_trail_2026_03_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_03 p_core_audit_trail_2026_03_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_04 p_core_audit_trail_2026_04_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_04 p_core_audit_trail_2026_04_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_04 p_core_audit_trail_2026_04_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_04 p_core_audit_trail_2026_04_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_05 p_core_audit_trail_2026_05_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_05 p_core_audit_trail_2026_05_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_05 p_core_audit_trail_2026_05_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_05 p_core_audit_trail_2026_05_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_06 p_core_audit_trail_2026_06_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_06 p_core_audit_trail_2026_06_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_06 p_core_audit_trail_2026_06_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_06 p_core_audit_trail_2026_06_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_07 p_core_audit_trail_2026_07_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_07 p_core_audit_trail_2026_07_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail_2026_07 p_core_audit_trail_2026_07_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail_2026_07 p_core_audit_trail_2026_07_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail p_core_audit_trail_company; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail p_core_audit_trail_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: audit_trail p_core_audit_trail_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: audit_trail p_core_audit_trail_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company p_core_company_company; Type: POLICY; Schema: core; Owner: -
-- Name: company p_core_company_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company p_core_company_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: company p_core_company_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_license p_core_company_license_company; Type: POLICY; Schema: core; Owner: -
-- Name: company_license p_core_company_license_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_license p_core_company_license_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: company_license p_core_company_license_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_permission p_core_company_permission_company; Type: POLICY; Schema: core; Owner: -
-- Name: company_permission p_core_company_permission_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_permission p_core_company_permission_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: company_permission p_core_company_permission_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_users p_core_company_users_company; Type: POLICY; Schema: core; Owner: -
-- Name: company_users p_core_company_users_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: company_users p_core_company_users_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: company_users p_core_company_users_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: document_sequence p_core_document_sequence_company; Type: POLICY; Schema: core; Owner: -
-- Name: document_sequence p_core_document_sequence_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: document_sequence p_core_document_sequence_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: document_sequence p_core_document_sequence_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: journal_entries p_core_journal_entries_company; Type: POLICY; Schema: core; Owner: -
-- Name: journal_entries p_core_journal_entries_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: journal_entries p_core_journal_entries_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: journal_entries p_core_journal_entries_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: permission_groups p_core_permission_groups_company; Type: POLICY; Schema: core; Owner: -
-- Name: permission_groups p_core_permission_groups_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: permission_groups p_core_permission_groups_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: permission_groups p_core_permission_groups_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: permissions p_core_permissions_company; Type: POLICY; Schema: core; Owner: -
-- Name: permissions p_core_permissions_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: permissions p_core_permissions_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: permissions p_core_permissions_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: posting_profile p_core_posting_profile_company; Type: POLICY; Schema: core; Owner: -
-- Name: posting_profile p_core_posting_profile_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: posting_profile p_core_posting_profile_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: posting_profile p_core_posting_profile_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: status_history p_core_status_history_company; Type: POLICY; Schema: core; Owner: -
-- Name: status_history p_core_status_history_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: status_history p_core_status_history_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: status_history p_core_status_history_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: sync_queue p_core_sync_queue_company; Type: POLICY; Schema: core; Owner: -
-- Name: sync_queue p_core_sync_queue_company; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: sync_queue p_core_sync_queue_company_rls; Type: POLICY; Schema: core; Owner: -
-- Name: sync_queue p_core_sync_queue_company_rls; Type: POLICY; Schema: core; Owner: -
--
--






--
--
-- Name: permission_groups; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: permission_groups; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: permissions; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: permissions; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: posting_profile; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: posting_profile; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: status_history; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: status_history; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: sync_queue; Type: ROW SECURITY; Schema: core; Owner: -
-- Name: sync_queue; Type: ROW SECURITY; Schema: core; Owner: -
--
--




--
--
-- Name: bank_account; Type: ROW SECURITY; Schema: finance; Owner: -
-- Name: bank_account; Type: ROW SECURITY; Schema: finance; Owner: -
--
--




--
--
-- Name: bank_account p_admin_bypass; Type: POLICY; Schema: finance; Owner: -
-- Name: bank_account p_admin_bypass; Type: POLICY; Schema: finance; Owner: -
--
--






--
--
-- Name: payment p_admin_bypass; Type: POLICY; Schema: finance; Owner: -
-- Name: payment p_admin_bypass; Type: POLICY; Schema: finance; Owner: -
--
--






--
--
-- Name: bank_account p_finance_bank_account_company; Type: POLICY; Schema: finance; Owner: -
-- Name: bank_account p_finance_bank_account_company; Type: POLICY; Schema: finance; Owner: -
--
--






--
--
-- Name: bank_account p_finance_bank_account_company_rls; Type: POLICY; Schema: finance; Owner: -
-- Name: bank_account p_finance_bank_account_company_rls; Type: POLICY; Schema: finance; Owner: -
--
--






--
--
-- Name: payment p_finance_payment_company; Type: POLICY; Schema: finance; Owner: -
-- Name: payment p_finance_payment_company; Type: POLICY; Schema: finance; Owner: -
--
--






--
--
-- Name: payment p_finance_payment_company_rls; Type: POLICY; Schema: finance; Owner: -
-- Name: payment p_finance_payment_company_rls; Type: POLICY; Schema: finance; Owner: -
--
--






--
--
-- Name: payment; Type: ROW SECURITY; Schema: finance; Owner: -
-- Name: payment; Type: ROW SECURITY; Schema: finance; Owner: -
--
--




--
--
-- Name: business_rule; Type: ROW SECURITY; Schema: governance; Owner: -
-- Name: business_rule; Type: ROW SECURITY; Schema: governance; Owner: -
--
--




--
--
-- Name: contract_header; Type: ROW SECURITY; Schema: governance; Owner: -
-- Name: contract_header; Type: ROW SECURITY; Schema: governance; Owner: -
--
--




--
--
-- Name: document_archive; Type: ROW SECURITY; Schema: governance; Owner: -
-- Name: document_archive; Type: ROW SECURITY; Schema: governance; Owner: -
--
--




--
--
-- Name: business_rule p_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: business_rule p_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: contract_header p_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: contract_header p_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: document_archive p_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: document_archive p_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: business_rule_action p_governance_business_rule_action_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: business_rule_action p_governance_business_rule_action_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: business_rule p_governance_business_rule_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: business_rule p_governance_business_rule_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: business_rule p_governance_business_rule_company; Type: POLICY; Schema: governance; Owner: -
-- Name: business_rule p_governance_business_rule_company; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: business_rule_condition p_governance_business_rule_condition_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: business_rule_condition p_governance_business_rule_condition_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: contract_header p_governance_contract_header_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: contract_header p_governance_contract_header_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: contract_header p_governance_contract_header_company; Type: POLICY; Schema: governance; Owner: -
-- Name: contract_header p_governance_contract_header_company; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: contract_item_price p_governance_contract_item_price_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: contract_item_price p_governance_contract_item_price_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: document_archive p_governance_document_archive_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: document_archive p_governance_document_archive_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: document_archive p_governance_document_archive_company; Type: POLICY; Schema: governance; Owner: -
-- Name: document_archive p_governance_document_archive_company; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: document_category p_governance_document_category_admin_bypass; Type: POLICY; Schema: governance; Owner: -
-- Name: document_category p_governance_document_category_admin_bypass; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: policy_change_queue p_pcq_select; Type: POLICY; Schema: governance; Owner: -
-- Name: policy_change_queue p_pcq_select; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: policy_change_queue p_pcq_update_admin; Type: POLICY; Schema: governance; Owner: -
-- Name: policy_change_queue p_pcq_update_admin; Type: POLICY; Schema: governance; Owner: -
--
--






--
--
-- Name: policy_change_queue; Type: ROW SECURITY; Schema: governance; Owner: -
-- Name: policy_change_queue; Type: ROW SECURITY; Schema: governance; Owner: -
--
--




--
--
-- Name: attendance_log; Type: ROW SECURITY; Schema: hr; Owner: -
-- Name: attendance_log; Type: ROW SECURITY; Schema: hr; Owner: -
--
--




--
--
-- Name: employee; Type: ROW SECURITY; Schema: hr; Owner: -
-- Name: employee; Type: ROW SECURITY; Schema: hr; Owner: -
--
--




--
--
-- Name: employment_contract; Type: ROW SECURITY; Schema: hr; Owner: -
-- Name: employment_contract; Type: ROW SECURITY; Schema: hr; Owner: -
--
--




--
--
-- Name: hr_department; Type: ROW SECURITY; Schema: hr; Owner: -
-- Name: hr_department; Type: ROW SECURITY; Schema: hr; Owner: -
--
--




--
--
-- Name: hr_position; Type: ROW SECURITY; Schema: hr; Owner: -
-- Name: hr_position; Type: ROW SECURITY; Schema: hr; Owner: -
--
--




--
--
-- Name: leave_request; Type: ROW SECURITY; Schema: hr; Owner: -
-- Name: leave_request; Type: ROW SECURITY; Schema: hr; Owner: -
--
--




--
--
-- Name: attendance_log p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
-- Name: attendance_log p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: employee p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
-- Name: employee p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: employment_contract p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
-- Name: employment_contract p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: hr_department p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
-- Name: hr_department p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: hr_position p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
-- Name: hr_position p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: leave_request p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
-- Name: leave_request p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: payroll_run p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
-- Name: payroll_run p_admin_bypass; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: attendance_log p_hr_attendance_log_company; Type: POLICY; Schema: hr; Owner: -
-- Name: attendance_log p_hr_attendance_log_company; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: attendance_log p_hr_attendance_log_company_rls; Type: POLICY; Schema: hr; Owner: -
-- Name: attendance_log p_hr_attendance_log_company_rls; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: employee p_hr_employee_company; Type: POLICY; Schema: hr; Owner: -
-- Name: employee p_hr_employee_company; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: employee p_hr_employee_company_rls; Type: POLICY; Schema: hr; Owner: -
-- Name: employee p_hr_employee_company_rls; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: employment_contract p_hr_employment_contract_company; Type: POLICY; Schema: hr; Owner: -
-- Name: employment_contract p_hr_employment_contract_company; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: employment_contract p_hr_employment_contract_company_rls; Type: POLICY; Schema: hr; Owner: -
-- Name: employment_contract p_hr_employment_contract_company_rls; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: hr_department p_hr_hr_department_company; Type: POLICY; Schema: hr; Owner: -
-- Name: hr_department p_hr_hr_department_company; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: hr_department p_hr_hr_department_company_rls; Type: POLICY; Schema: hr; Owner: -
-- Name: hr_department p_hr_hr_department_company_rls; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: hr_position p_hr_hr_position_company; Type: POLICY; Schema: hr; Owner: -
-- Name: hr_position p_hr_hr_position_company; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: hr_position p_hr_hr_position_company_rls; Type: POLICY; Schema: hr; Owner: -
-- Name: hr_position p_hr_hr_position_company_rls; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: leave_request p_hr_leave_request_company; Type: POLICY; Schema: hr; Owner: -
-- Name: leave_request p_hr_leave_request_company; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: leave_request p_hr_leave_request_company_rls; Type: POLICY; Schema: hr; Owner: -
-- Name: leave_request p_hr_leave_request_company_rls; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: payroll_run p_hr_payroll_run_company; Type: POLICY; Schema: hr; Owner: -
-- Name: payroll_run p_hr_payroll_run_company; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: payroll_run p_hr_payroll_run_company_rls; Type: POLICY; Schema: hr; Owner: -
-- Name: payroll_run p_hr_payroll_run_company_rls; Type: POLICY; Schema: hr; Owner: -
--
--






--
--
-- Name: payroll_run; Type: ROW SECURITY; Schema: hr; Owner: -
-- Name: payroll_run; Type: ROW SECURITY; Schema: hr; Owner: -
--
--




--
--
-- Name: audit_export_queue; Type: ROW SECURITY; Schema: integration; Owner: -
-- Name: audit_export_queue; Type: ROW SECURITY; Schema: integration; Owner: -
--
--




--
--
-- Name: external_system; Type: ROW SECURITY; Schema: integration; Owner: -
-- Name: external_system; Type: ROW SECURITY; Schema: integration; Owner: -
--
--




--
--
-- Name: audit_export_queue p_admin_bypass; Type: POLICY; Schema: integration; Owner: -
-- Name: audit_export_queue p_admin_bypass; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: external_system p_admin_bypass; Type: POLICY; Schema: integration; Owner: -
-- Name: external_system p_admin_bypass; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: siem_delivery_queue p_admin_bypass; Type: POLICY; Schema: integration; Owner: -
-- Name: siem_delivery_queue p_admin_bypass; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: siem_endpoint p_admin_bypass; Type: POLICY; Schema: integration; Owner: -
-- Name: siem_endpoint p_admin_bypass; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: api_credential p_integration_api_credential_admin_bypass; Type: POLICY; Schema: integration; Owner: -
-- Name: api_credential p_integration_api_credential_admin_bypass; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: audit_export_queue p_integration_audit_export_queue_company; Type: POLICY; Schema: integration; Owner: -
-- Name: audit_export_queue p_integration_audit_export_queue_company; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: external_system p_integration_external_system_admin_bypass; Type: POLICY; Schema: integration; Owner: -
-- Name: external_system p_integration_external_system_admin_bypass; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: external_system p_integration_external_system_company; Type: POLICY; Schema: integration; Owner: -
-- Name: external_system p_integration_external_system_company; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: integration_job p_integration_integration_job_admin_bypass; Type: POLICY; Schema: integration; Owner: -
-- Name: integration_job p_integration_integration_job_admin_bypass; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: integration_log p_integration_integration_log_admin_bypass; Type: POLICY; Schema: integration; Owner: -
-- Name: integration_log p_integration_integration_log_admin_bypass; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: siem_delivery_queue p_integration_siem_delivery_queue_company; Type: POLICY; Schema: integration; Owner: -
-- Name: siem_delivery_queue p_integration_siem_delivery_queue_company; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: siem_endpoint p_integration_siem_endpoint_company; Type: POLICY; Schema: integration; Owner: -
-- Name: siem_endpoint p_integration_siem_endpoint_company; Type: POLICY; Schema: integration; Owner: -
--
--






--
--
-- Name: siem_delivery_queue; Type: ROW SECURITY; Schema: integration; Owner: -
-- Name: siem_delivery_queue; Type: ROW SECURITY; Schema: integration; Owner: -
--
--




--
--
-- Name: siem_endpoint; Type: ROW SECURITY; Schema: integration; Owner: -
-- Name: siem_endpoint; Type: ROW SECURITY; Schema: integration; Owner: -
--
--




--
--
-- Name: inventory_valuation; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: inventory_valuation; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: inventory_valuation p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: inventory_valuation p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_balance p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_balance p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_bin p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_bin p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_lot p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_lot p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_lot_balance p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_lot_balance p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_reservation p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_reservation p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_transaction p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_transaction p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_transfer_header p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_transfer_header p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stocktaking_plan p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stocktaking_plan p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stocktaking_result p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: stocktaking_result p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: storage_location p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: storage_location p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: warehouse p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
-- Name: warehouse p_admin_bypass; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: inventory_valuation p_inventory_inventory_valuation_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: inventory_valuation p_inventory_inventory_valuation_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: inventory_valuation p_inventory_inventory_valuation_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: inventory_valuation p_inventory_inventory_valuation_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_balance p_inventory_stock_balance_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_balance p_inventory_stock_balance_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_balance p_inventory_stock_balance_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_balance p_inventory_stock_balance_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_bin p_inventory_stock_bin_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_bin p_inventory_stock_bin_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_bin p_inventory_stock_bin_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_bin p_inventory_stock_bin_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_lot_balance p_inventory_stock_lot_balance_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_lot_balance p_inventory_stock_lot_balance_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_lot_balance p_inventory_stock_lot_balance_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_lot_balance p_inventory_stock_lot_balance_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_lot p_inventory_stock_lot_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_lot p_inventory_stock_lot_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_lot p_inventory_stock_lot_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_lot p_inventory_stock_lot_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_reservation p_inventory_stock_reservation_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_reservation p_inventory_stock_reservation_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_reservation p_inventory_stock_reservation_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_reservation p_inventory_stock_reservation_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_transaction p_inventory_stock_transaction_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_transaction p_inventory_stock_transaction_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_transaction p_inventory_stock_transaction_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_transaction p_inventory_stock_transaction_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_transfer_header p_inventory_stock_transfer_header_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_transfer_header p_inventory_stock_transfer_header_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_transfer_header p_inventory_stock_transfer_header_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stock_transfer_header p_inventory_stock_transfer_header_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stocktaking_plan p_inventory_stocktaking_plan_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stocktaking_plan p_inventory_stocktaking_plan_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stocktaking_plan p_inventory_stocktaking_plan_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stocktaking_plan p_inventory_stocktaking_plan_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stocktaking_result p_inventory_stocktaking_result_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: stocktaking_result p_inventory_stocktaking_result_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stocktaking_result p_inventory_stocktaking_result_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: stocktaking_result p_inventory_stocktaking_result_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: storage_location p_inventory_storage_location_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: storage_location p_inventory_storage_location_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: storage_location p_inventory_storage_location_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: storage_location p_inventory_storage_location_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: warehouse p_inventory_warehouse_company; Type: POLICY; Schema: inventory; Owner: -
-- Name: warehouse p_inventory_warehouse_company; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: warehouse p_inventory_warehouse_company_rls; Type: POLICY; Schema: inventory; Owner: -
-- Name: warehouse p_inventory_warehouse_company_rls; Type: POLICY; Schema: inventory; Owner: -
--
--






--
--
-- Name: stock_balance; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stock_balance; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: stock_bin; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stock_bin; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: stock_lot; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stock_lot; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: stock_lot_balance; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stock_lot_balance; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: stock_reservation; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stock_reservation; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: stock_transaction; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stock_transaction; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: stock_transfer_header; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stock_transfer_header; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: stocktaking_plan; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stocktaking_plan; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: stocktaking_result; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: stocktaking_result; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: storage_location; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: storage_location; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: warehouse; Type: ROW SECURITY; Schema: inventory; Owner: -
-- Name: warehouse; Type: ROW SECURITY; Schema: inventory; Owner: -
--
--




--
--
-- Name: bom_header; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: bom_header; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: manufacturing_cost_snapshot; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: manufacturing_execution; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: mps_run; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: mps_run; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: mrp_run; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: mrp_run; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: bom_header p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: bom_header p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: manufacturing_cost_snapshot p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: manufacturing_execution p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: mps_run p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: mps_run p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: mrp_run p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: mrp_run p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: process_master p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: process_master p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: routing_header p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: routing_header p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: work_order p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: work_order p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: yield_metric p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: yield_metric p_admin_bypass; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: bom_header p_manufacturing_bom_header_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: bom_header p_manufacturing_bom_header_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: bom_header p_manufacturing_bom_header_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: bom_header p_manufacturing_bom_header_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: manufacturing_cost_snapshot p_manufacturing_manufacturing_cost_snapshot_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot p_manufacturing_manufacturing_cost_snapshot_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: manufacturing_cost_snapshot p_manufacturing_manufacturing_cost_snapshot_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: manufacturing_cost_snapshot p_manufacturing_manufacturing_cost_snapshot_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: manufacturing_execution p_manufacturing_manufacturing_execution_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution p_manufacturing_manufacturing_execution_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: manufacturing_execution p_manufacturing_manufacturing_execution_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: manufacturing_execution p_manufacturing_manufacturing_execution_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: mps_run p_manufacturing_mps_run_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: mps_run p_manufacturing_mps_run_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: mps_run p_manufacturing_mps_run_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: mps_run p_manufacturing_mps_run_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: mrp_run p_manufacturing_mrp_run_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: mrp_run p_manufacturing_mrp_run_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: mrp_run p_manufacturing_mrp_run_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: mrp_run p_manufacturing_mrp_run_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: process_master p_manufacturing_process_master_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: process_master p_manufacturing_process_master_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: process_master p_manufacturing_process_master_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: process_master p_manufacturing_process_master_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: routing_header p_manufacturing_routing_header_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: routing_header p_manufacturing_routing_header_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: routing_header p_manufacturing_routing_header_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: routing_header p_manufacturing_routing_header_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: work_order p_manufacturing_work_order_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: work_order p_manufacturing_work_order_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: work_order p_manufacturing_work_order_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: work_order p_manufacturing_work_order_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: yield_metric p_manufacturing_yield_metric_company; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: yield_metric p_manufacturing_yield_metric_company; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: yield_metric p_manufacturing_yield_metric_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
-- Name: yield_metric p_manufacturing_yield_metric_company_rls; Type: POLICY; Schema: manufacturing; Owner: -
--
--






--
--
-- Name: process_master; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: process_master; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: routing_header; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: routing_header; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: work_order; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: work_order; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: yield_metric; Type: ROW SECURITY; Schema: manufacturing; Owner: -
-- Name: yield_metric; Type: ROW SECURITY; Schema: manufacturing; Owner: -
--
--




--
--
-- Name: asset; Type: ROW SECURITY; Schema: media; Owner: -
-- Name: asset; Type: ROW SECURITY; Schema: media; Owner: -
--
--




--
--
-- Name: asset_link; Type: ROW SECURITY; Schema: media; Owner: -
-- Name: asset_link; Type: ROW SECURITY; Schema: media; Owner: -
--
--




--
--
-- Name: asset_link p_media_asset_link_owner; Type: POLICY; Schema: media; Owner: -
-- Name: asset_link p_media_asset_link_owner; Type: POLICY; Schema: media; Owner: -
--
--






--
--
-- Name: asset p_media_asset_owner; Type: POLICY; Schema: media; Owner: -
-- Name: asset p_media_asset_owner; Type: POLICY; Schema: media; Owner: -
--
--






--
--
-- Name: document_file; Type: ROW SECURITY; Schema: ops; Owner: -
-- Name: document_file; Type: ROW SECURITY; Schema: ops; Owner: -
--
--




--
--
-- Name: document_send_history; Type: ROW SECURITY; Schema: ops; Owner: -
-- Name: document_send_history; Type: ROW SECURITY; Schema: ops; Owner: -
--
--




--
--
-- Name: notification_outbox; Type: ROW SECURITY; Schema: ops; Owner: -
-- Name: notification_outbox; Type: ROW SECURITY; Schema: ops; Owner: -
--
--




--
--
-- Name: ops_job_queue; Type: ROW SECURITY; Schema: ops; Owner: -
-- Name: ops_job_queue; Type: ROW SECURITY; Schema: ops; Owner: -
--
--




--
--
-- Name: ops_job_result; Type: ROW SECURITY; Schema: ops; Owner: -
-- Name: ops_job_result; Type: ROW SECURITY; Schema: ops; Owner: -
--
--




--
--
-- Name: document_file p_ops_document_file_user; Type: POLICY; Schema: ops; Owner: -
-- Name: document_file p_ops_document_file_user; Type: POLICY; Schema: ops; Owner: -
--
--






--
--
-- Name: ops_job_queue p_ops_job_queue_owner; Type: POLICY; Schema: ops; Owner: -
-- Name: ops_job_queue p_ops_job_queue_owner; Type: POLICY; Schema: ops; Owner: -
--
--






--
--
-- Name: ops_job_result p_ops_job_result_owner; Type: POLICY; Schema: ops; Owner: -
-- Name: ops_job_result p_ops_job_result_owner; Type: POLICY; Schema: ops; Owner: -
--
--






--
--
-- Name: notification_outbox p_ops_notification_owner; Type: POLICY; Schema: ops; Owner: -
-- Name: notification_outbox p_ops_notification_owner; Type: POLICY; Schema: ops; Owner: -
--
--






--
--
-- Name: document_send_history p_ops_send_history_user; Type: POLICY; Schema: ops; Owner: -
-- Name: document_send_history p_ops_send_history_user; Type: POLICY; Schema: ops; Owner: -
--
--






--
--
-- Name: purchase_invoice p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_invoice p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_order_header p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_order_header p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_quotation p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_quotation p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_receipt p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_receipt p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_requisition p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_requisition p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_three_way_match p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_three_way_match p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: supplier_item_price p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
-- Name: supplier_item_price p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: supplier_master p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
-- Name: supplier_master p_admin_bypass; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_invoice p_purchase_purchase_invoice_company; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_invoice p_purchase_purchase_invoice_company; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_invoice p_purchase_purchase_invoice_company_rls; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_invoice p_purchase_purchase_invoice_company_rls; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_order_header p_purchase_purchase_order_header_company; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_order_header p_purchase_purchase_order_header_company; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_order_header p_purchase_purchase_order_header_company_rls; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_order_header p_purchase_purchase_order_header_company_rls; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_quotation p_purchase_purchase_quotation_company; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_quotation p_purchase_purchase_quotation_company; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_quotation p_purchase_purchase_quotation_company_rls; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_quotation p_purchase_purchase_quotation_company_rls; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_receipt p_purchase_purchase_receipt_company; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_receipt p_purchase_purchase_receipt_company; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_receipt p_purchase_purchase_receipt_company_rls; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_receipt p_purchase_purchase_receipt_company_rls; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_requisition p_purchase_purchase_requisition_company; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_requisition p_purchase_purchase_requisition_company; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_requisition p_purchase_purchase_requisition_company_rls; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_requisition p_purchase_purchase_requisition_company_rls; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_three_way_match p_purchase_purchase_three_way_match_company; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_three_way_match p_purchase_purchase_three_way_match_company; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_three_way_match p_purchase_purchase_three_way_match_company_rls; Type: POLICY; Schema: purchase; Owner: -
-- Name: purchase_three_way_match p_purchase_purchase_three_way_match_company_rls; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: supplier_item_price p_purchase_supplier_item_price_company; Type: POLICY; Schema: purchase; Owner: -
-- Name: supplier_item_price p_purchase_supplier_item_price_company; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: supplier_item_price p_purchase_supplier_item_price_company_rls; Type: POLICY; Schema: purchase; Owner: -
-- Name: supplier_item_price p_purchase_supplier_item_price_company_rls; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: supplier_master p_purchase_supplier_master_company; Type: POLICY; Schema: purchase; Owner: -
-- Name: supplier_master p_purchase_supplier_master_company; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: supplier_master p_purchase_supplier_master_company_rls; Type: POLICY; Schema: purchase; Owner: -
-- Name: supplier_master p_purchase_supplier_master_company_rls; Type: POLICY; Schema: purchase; Owner: -
--
--






--
--
-- Name: purchase_invoice; Type: ROW SECURITY; Schema: purchase; Owner: -
-- Name: purchase_invoice; Type: ROW SECURITY; Schema: purchase; Owner: -
--
--




--
--
-- Name: purchase_order_header; Type: ROW SECURITY; Schema: purchase; Owner: -
-- Name: purchase_order_header; Type: ROW SECURITY; Schema: purchase; Owner: -
--
--




--
--
-- Name: purchase_quotation; Type: ROW SECURITY; Schema: purchase; Owner: -
-- Name: purchase_quotation; Type: ROW SECURITY; Schema: purchase; Owner: -
--
--




--
--
-- Name: purchase_receipt; Type: ROW SECURITY; Schema: purchase; Owner: -
-- Name: purchase_receipt; Type: ROW SECURITY; Schema: purchase; Owner: -
--
--




--
--
-- Name: purchase_requisition; Type: ROW SECURITY; Schema: purchase; Owner: -
-- Name: purchase_requisition; Type: ROW SECURITY; Schema: purchase; Owner: -
--
--




--
--
-- Name: purchase_three_way_match; Type: ROW SECURITY; Schema: purchase; Owner: -
-- Name: purchase_three_way_match; Type: ROW SECURITY; Schema: purchase; Owner: -
--
--




--
--
-- Name: supplier_item_price; Type: ROW SECURITY; Schema: purchase; Owner: -
-- Name: supplier_item_price; Type: ROW SECURITY; Schema: purchase; Owner: -
--
--




--
--
-- Name: supplier_master; Type: ROW SECURITY; Schema: purchase; Owner: -
-- Name: supplier_master; Type: ROW SECURITY; Schema: purchase; Owner: -
--
--




--
--
-- Name: messages; Type: ROW SECURITY; Schema: realtime; Owner: -
-- Name: messages; Type: ROW SECURITY; Schema: realtime; Owner: -
--
--




--
--
-- Name: billing_header; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: billing_header; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: customer; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: customer; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: invoice_pdf; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: invoice_pdf; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: item; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: item; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: item_category; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: item_category; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: item_price_master; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: item_price_master; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: order_header; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: order_header; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: billing_header p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: billing_header p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: customer p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: customer p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: invoice_pdf p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: invoice_pdf p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: item p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item_category p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: item_category p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item_price_master p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: item_price_master p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: order_header p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: order_header p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: return_header p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: return_header p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: sales_quotation p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: sales_quotation p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: shipping_header p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
-- Name: shipping_header p_admin_bypass; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: quotation_order_link p_quotation_order_link_company; Type: POLICY; Schema: sales; Owner: -
-- Name: quotation_order_link p_quotation_order_link_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: billing_header p_sales_billing_header_company; Type: POLICY; Schema: sales; Owner: -
-- Name: billing_header p_sales_billing_header_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: billing_header p_sales_billing_header_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: billing_header p_sales_billing_header_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: customer p_sales_customer_company; Type: POLICY; Schema: sales; Owner: -
-- Name: customer p_sales_customer_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: customer p_sales_customer_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: customer p_sales_customer_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: invoice_pdf p_sales_invoice_pdf_company; Type: POLICY; Schema: sales; Owner: -
-- Name: invoice_pdf p_sales_invoice_pdf_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: invoice_pdf p_sales_invoice_pdf_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: invoice_pdf p_sales_invoice_pdf_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item_category p_sales_item_category_company; Type: POLICY; Schema: sales; Owner: -
-- Name: item_category p_sales_item_category_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item_category p_sales_item_category_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: item_category p_sales_item_category_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item p_sales_item_company; Type: POLICY; Schema: sales; Owner: -
-- Name: item p_sales_item_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item p_sales_item_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: item p_sales_item_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item_price_master p_sales_item_price_master_company; Type: POLICY; Schema: sales; Owner: -
-- Name: item_price_master p_sales_item_price_master_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: item_price_master p_sales_item_price_master_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: item_price_master p_sales_item_price_master_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: order_header p_sales_order_header_company; Type: POLICY; Schema: sales; Owner: -
-- Name: order_header p_sales_order_header_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: order_header p_sales_order_header_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: order_header p_sales_order_header_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: return_header p_sales_return_header_company; Type: POLICY; Schema: sales; Owner: -
-- Name: return_header p_sales_return_header_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: return_header p_sales_return_header_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: return_header p_sales_return_header_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: sales_quotation p_sales_sales_quotation_company; Type: POLICY; Schema: sales; Owner: -
-- Name: sales_quotation p_sales_sales_quotation_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: sales_quotation p_sales_sales_quotation_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: sales_quotation p_sales_sales_quotation_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: shipping_header p_sales_shipping_header_company; Type: POLICY; Schema: sales; Owner: -
-- Name: shipping_header p_sales_shipping_header_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: shipping_header p_sales_shipping_header_company_rls; Type: POLICY; Schema: sales; Owner: -
-- Name: shipping_header p_sales_shipping_header_company_rls; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: shipping_revision p_shipping_revision_company; Type: POLICY; Schema: sales; Owner: -
-- Name: shipping_revision p_shipping_revision_company; Type: POLICY; Schema: sales; Owner: -
--
--






--
--
-- Name: quotation_order_link; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: quotation_order_link; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: return_header; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: return_header; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: sales_quotation; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: sales_quotation; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: shipping_header; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: shipping_header; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: shipping_revision; Type: ROW SECURITY; Schema: sales; Owner: -
-- Name: shipping_revision; Type: ROW SECURITY; Schema: sales; Owner: -
--
--




--
--
-- Name: buckets; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: buckets; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: buckets_analytics; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: buckets_analytics; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: buckets_vectors; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: buckets_vectors; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: migrations; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: migrations; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: objects; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: objects; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: prefixes; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: prefixes; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: s3_multipart_uploads; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: s3_multipart_uploads; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: s3_multipart_uploads_parts; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: s3_multipart_uploads_parts; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: vector_indexes; Type: ROW SECURITY; Schema: storage; Owner: -
-- Name: vector_indexes; Type: ROW SECURITY; Schema: storage; Owner: -
--
--




--
--
-- Name: ai_signal; Type: ROW SECURITY; Schema: system; Owner: -
-- Name: ai_signal; Type: ROW SECURITY; Schema: system; Owner: -
--
--




--
--
-- Name: ai_task; Type: ROW SECURITY; Schema: system; Owner: -
-- Name: ai_task; Type: ROW SECURITY; Schema: system; Owner: -
--
--




--
--
-- Name: db_session; Type: ROW SECURITY; Schema: system; Owner: -
-- Name: db_session; Type: ROW SECURITY; Schema: system; Owner: -
--
--




--
--
-- Name: exec_command; Type: ROW SECURITY; Schema: system; Owner: -
-- Name: exec_command; Type: ROW SECURITY; Schema: system; Owner: -
--
--




--
--
-- Name: exec_run_request; Type: ROW SECURITY; Schema: system; Owner: -
-- Name: exec_run_request; Type: ROW SECURITY; Schema: system; Owner: -
--
--




--
--
-- Name: loop_config; Type: ROW SECURITY; Schema: system; Owner: -
-- Name: loop_config; Type: ROW SECURITY; Schema: system; Owner: -
--
--




--
--
-- Name: operation_log; Type: ROW SECURITY; Schema: system; Owner: -
-- Name: operation_log; Type: ROW SECURITY; Schema: system; Owner: -
--
--




--
--
-- Name: ai_signal p_ai_signal_all; Type: POLICY; Schema: system; Owner: -
-- Name: ai_signal p_ai_signal_all; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: ai_task p_ai_task_owner; Type: POLICY; Schema: system; Owner: -
-- Name: ai_task p_ai_task_owner; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: db_session p_db_session_owner; Type: POLICY; Schema: system; Owner: -
-- Name: db_session p_db_session_owner; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: exec_command p_exec_command_owner; Type: POLICY; Schema: system; Owner: -
-- Name: exec_command p_exec_command_owner; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: exec_run_request p_exec_run_request_owner; Type: POLICY; Schema: system; Owner: -
-- Name: exec_run_request p_exec_run_request_owner; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: runtime_killswitch p_killswitch_read; Type: POLICY; Schema: system; Owner: -
-- Name: runtime_killswitch p_killswitch_read; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: loop_config p_loop_config_open; Type: POLICY; Schema: system; Owner: -
-- Name: loop_config p_loop_config_open; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: loop_config p_loop_config_owner; Type: POLICY; Schema: system; Owner: -
-- Name: loop_config p_loop_config_owner; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: operation_log p_operation_log_owner; Type: POLICY; Schema: system; Owner: -
-- Name: operation_log p_operation_log_owner; Type: POLICY; Schema: system; Owner: -
--
--






--
--
-- Name: runtime_killswitch; Type: ROW SECURITY; Schema: system; Owner: -
-- Name: runtime_killswitch; Type: ROW SECURITY; Schema: system; Owner: -
--
--




--
--
-- Name: supabase_realtime; Type: PUBLICATION; Schema: -; Owner: -
-- Name: supabase_realtime; Type: PUBLICATION; Schema: -; Owner: -
--
--


CREATE PUBLICATION supabase_realtime WITH (publish = 'insert, update, delete, truncate');
CREATE PUBLICATION supabase_realtime WITH (publish = 'insert, update, delete, truncate');




--
--
-- Name: issue_graphql_placeholder; Type: EVENT TRIGGER; Schema: -; Owner: -
-- Name: issue_graphql_placeholder; Type: EVENT TRIGGER; Schema: -; Owner: -
--
--


CREATE EVENT TRIGGER issue_graphql_placeholder ON sql_drop
CREATE EVENT TRIGGER issue_graphql_placeholder ON sql_drop
         WHEN TAG IN ('DROP EXTENSION')
         WHEN TAG IN ('DROP EXTENSION')
   EXECUTE FUNCTION extensions.set_graphql_placeholder();
   EXECUTE FUNCTION extensions.set_graphql_placeholder();




--
--
-- Name: issue_pg_cron_access; Type: EVENT TRIGGER; Schema: -; Owner: -
-- Name: issue_pg_cron_access; Type: EVENT TRIGGER; Schema: -; Owner: -
--
--


CREATE EVENT TRIGGER issue_pg_cron_access ON ddl_command_end
CREATE EVENT TRIGGER issue_pg_cron_access ON ddl_command_end
         WHEN TAG IN ('CREATE EXTENSION')
         WHEN TAG IN ('CREATE EXTENSION')
   EXECUTE FUNCTION extensions.grant_pg_cron_access();
   EXECUTE FUNCTION extensions.grant_pg_cron_access();




--
--
-- Name: issue_pg_graphql_access; Type: EVENT TRIGGER; Schema: -; Owner: -
-- Name: issue_pg_graphql_access; Type: EVENT TRIGGER; Schema: -; Owner: -
--
--


CREATE EVENT TRIGGER issue_pg_graphql_access ON ddl_command_end
CREATE EVENT TRIGGER issue_pg_graphql_access ON ddl_command_end
         WHEN TAG IN ('CREATE FUNCTION')
         WHEN TAG IN ('CREATE FUNCTION')
   EXECUTE FUNCTION extensions.grant_pg_graphql_access();
   EXECUTE FUNCTION extensions.grant_pg_graphql_access();




--
--
-- Name: issue_pg_net_access; Type: EVENT TRIGGER; Schema: -; Owner: -
-- Name: issue_pg_net_access; Type: EVENT TRIGGER; Schema: -; Owner: -
--
--


CREATE EVENT TRIGGER issue_pg_net_access ON ddl_command_end
CREATE EVENT TRIGGER issue_pg_net_access ON ddl_command_end
         WHEN TAG IN ('CREATE EXTENSION')
         WHEN TAG IN ('CREATE EXTENSION')
   EXECUTE FUNCTION extensions.grant_pg_net_access();
   EXECUTE FUNCTION extensions.grant_pg_net_access();




--
--
-- Name: pgrst_ddl_watch; Type: EVENT TRIGGER; Schema: -; Owner: -
-- Name: pgrst_ddl_watch; Type: EVENT TRIGGER; Schema: -; Owner: -
--
--


CREATE EVENT TRIGGER pgrst_ddl_watch ON ddl_command_end
CREATE EVENT TRIGGER pgrst_ddl_watch ON ddl_command_end
   EXECUTE FUNCTION extensions.pgrst_ddl_watch();
   EXECUTE FUNCTION extensions.pgrst_ddl_watch();




--
--
-- Name: pgrst_drop_watch; Type: EVENT TRIGGER; Schema: -; Owner: -
-- Name: pgrst_drop_watch; Type: EVENT TRIGGER; Schema: -; Owner: -
--
--


CREATE EVENT TRIGGER pgrst_drop_watch ON sql_drop
CREATE EVENT TRIGGER pgrst_drop_watch ON sql_drop
   EXECUTE FUNCTION extensions.pgrst_drop_watch();
   EXECUTE FUNCTION extensions.pgrst_drop_watch();




--
--
-- PostgreSQL database dump complete
-- PostgreSQL database dump complete
--
--


\unrestrict DkrQVuibXIsZSjxFtU8nJK2M1MThrhXcViCROqfXBMgLLYBbM9XuNsewHAFmbQG
\unrestrict DkrQVuibXIsZSjxFtU8nJK2M1MThrhXcViCROqfXBMgLLYBbM9XuNsewHAFmbQG


